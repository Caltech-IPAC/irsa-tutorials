{"version":3,"kind":"Notebook","sha256":"20fc81215be045077586718ba1cbf233899464034369ed44721b8048b32fe795","slug":"cosmodc2-tap-access","location":"/tutorials/cosmodc2/cosmoDC2_TAP_access.md","dependencies":[],"frontmatter":{"title":"Querying the CosmoDC2 Mock v1 Catalogs","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{"formats":"md:myst","text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.18.1"}},"content_includes_title":false,"authors":[{"id":"IRSA Scientists and Developers","name":"IRSA Scientists and Developers"}],"github":"https://github.com/Caltech-IPAC/irsa-tutorials/","subject":"IRSA Tutorials","keywords":["astronomy"],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":2}},"source_url":"https://github.com/Caltech-IPAC/irsa-tutorials//blob/main/tutorials/cosmodc2/cosmoDC2_TAP_access.md","edit_url":"https://github.com/Caltech-IPAC/irsa-tutorials//edit/main/tutorials/cosmodc2/cosmoDC2_TAP_access.md","exports":[{"format":"md","filename":"cosmoDC2_TAP_access.md","url":"/irsa-tutorials/build/cosmoDC2_TAP_access-df32f5394b029f991cba4a68ec5aba56.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"This tutorial demonstrates how to access and query the ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"mAzltxiirG"},{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"CosmoDC2 Mock v1","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"lMqW0ms52f"}],"key":"QA39wpDQvK"},{"type":"text","value":" catalogs using IRSA’s Table Access Protocol (TAP) service. Background information on the catalogs is available on the ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"Ccrsuu0llW"},{"type":"link","url":"https://irsa.ipac.caltech.edu/Missions/cosmodc2.html","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"IRSA CosmoDC2 page","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"k7LrgEDF1c"}],"urlSource":"https://irsa.ipac.caltech.edu/Missions/cosmodc2.html","key":"Q2Lvf8Soop"},{"type":"text","value":".","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"t0Ll2IxRpH"}],"key":"WmzlIcAOaT"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"The catalogs are served through IRSA’s Virtual Observatory–standard ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"a4f1C2NJwg"},{"type":"strong","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"TAP","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"UfkBdLfloV"}],"key":"lE0NIVPJ4C"},{"type":"text","value":" ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"ClpDr7WxFg"},{"type":"link","url":"https://irsa.ipac.caltech.edu/docs/program_interface/TAP.html","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"interface","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"qyFnoFV4su"}],"urlSource":"https://irsa.ipac.caltech.edu/docs/program_interface/TAP.html","key":"TA6gTp76Rk"},{"type":"text","value":", which you can access programmatically in Python via the ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"z7QuV80N7k"},{"type":"strong","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"PyVO","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"CTzmZR1Snc"}],"key":"AfZ0jb8K8Y"},{"type":"text","value":" library. TAP queries are written in the ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"ApHyg2EkQ4"},{"type":"strong","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Astronomical Data Query Language (ADQL)","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"dp9LXciNXq"}],"key":"JQxgKbXNiE"},{"type":"text","value":" — a SQL-like language designed for astronomical catalogs (see the ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"Mxw12BG4Tj"},{"type":"link","url":"https://www.ivoa.net/documents/latest/ADQL.html","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"ADQL specification","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"RYgddsDz4g"}],"urlSource":"https://www.ivoa.net/documents/latest/ADQL.html","key":"eTf7Df7j4E"},{"type":"text","value":").","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"HhMvUEQNsU"}],"key":"Yhy3Dk4H3Z"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"If you are new to PyVO’s query modes, the documentation provides a helpful comparison between ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"BimOtC0lMV"},{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"synchronous","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"MV59mGtcGk"}],"key":"F93avEPkJt"},{"type":"text","value":" and ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"NPun4Ezsiu"},{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"asynchronous","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"bAgs9e8EkZ"}],"key":"vI2jqZigpm"},{"type":"text","value":" execution:  ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"q4fNdJPHmu"},{"type":"link","url":"https://pyvo.readthedocs.io/en/latest/dal/index.html#synchronous-vs-asynchronous-query","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"PyVO: Synchronous vs. Asynchronous Queries","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"s80xG9ft5M"}],"urlSource":"https://pyvo.readthedocs.io/en/latest/dal/index.html#synchronous-vs-asynchronous-query","key":"MRxKtwBrVU"}],"key":"XPU7c3lq1k"},{"type":"heading","depth":2,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Tips for Working with CosmoDC2 via TAP","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"NYenKGc2zH"}],"identifier":"tips-for-working-with-cosmodc2-via-tap","label":"Tips for Working with CosmoDC2 via TAP","html_id":"tips-for-working-with-cosmodc2-via-tap","implicit":true,"key":"oYMoyMTVIF"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":28,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":28,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"strong","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Use indexed columns for fast queries.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"F33xGGxOvd"}],"key":"e8bv6LKO6e"},{"type":"text","value":"\nCosmoDC2 is indexed on the following fields:\n","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"O6ef8qvF5R"},{"type":"inlineCode","value":"ra","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"lBPANJbwtU"},{"type":"text","value":", ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"lsWNNUfkeb"},{"type":"inlineCode","value":"dec","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"Fg8GqRRvMY"},{"type":"text","value":", ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"inNfJIgymf"},{"type":"inlineCode","value":"redshift","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"mHvOYAxaq4"},{"type":"text","value":", ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"njWxKSutKM"},{"type":"inlineCode","value":"mag*_lsst","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"h6Fq4xONEv"},{"type":"text","value":", ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"kQMD1sa6Oa"},{"type":"inlineCode","value":"halo_mass","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"lwRlmNbVZA"},{"type":"text","value":", ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"vwXREfyEk9"},{"type":"inlineCode","value":"stellar_mass","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"lKlo9O4FPh"},{"type":"text","value":"\nQueries involving these columns generally return much faster.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"iZUAgPTMaH"}],"key":"vAiB8KRESx"}],"key":"ebhleOAJWF"},{"type":"listItem","spread":true,"position":{"start":{"line":33,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"strong","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"Ensure your positional queries fall within the survey footprint.","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"lQX3MhVjTd"}],"key":"s5ob59zfRk"},{"type":"text","value":"\nCosmoDC2 covers the area specified by the\nfollowing (R.A., decl.) coordinate pairs (J2000):\n(71.46,−27.25), (52.25,−27.25),\n(73.79,−44.33), (49.42,−44.33).","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"RrgW9tz6XI"}],"key":"AOISQl0CNZ"}],"key":"P3OfKPWw5u"},{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":39,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"strong","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"Avoid overloading the TAP service.","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"tQYOswrvN2"}],"key":"Hz8eDOZliV"},{"type":"text","value":"\nPreferentially use ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"aaWRWwkyOF"},{"type":"strong","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"asynchronous","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"quEh6jTYRZ"}],"key":"HiUsfFQ9DT"},{"type":"text","value":" queries for long running queries to avoid timing out.  The whole system will slow down if a lot of people are using it for large queries, or if you decide to kick off many large queries at the same time.","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"iu9617vq13"}],"key":"P5TqeYtTb2"}],"key":"NH3ij2TKsp"}],"key":"cQJWCmVX9j"}],"key":"jn3M9qnzpT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Uncomment the next line to install dependencies if needed.\n# !pip install numpy matplotlib pyvo","key":"cBms9pT43l"},{"type":"outputs","id":"yrq0LUPNjugYu8jiy1h_f","children":[],"key":"jLhED9WUAb"}],"key":"BPLtoGxhBU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pyvo as vo\nimport numpy as np\nimport matplotlib.mlab as mlab\nimport matplotlib.pyplot as plt","key":"K0je7DwWhE"},{"type":"outputs","id":"tw3aHte9f9eIyLYghC6HL","children":[],"key":"uLdauTRLM1"}],"key":"EtODPrP4xs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"service = vo.dal.TAPService(\"https://irsa.ipac.caltech.edu/TAP\")","key":"qnTZCjKEYr"},{"type":"outputs","id":"a1gHYHsoPbomLLnVIGDP8","children":[],"key":"kt44bPjBDf"}],"key":"dj452SlVzw"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"1. List the available DC2 tables","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"hjQLgKu4Mm"}],"identifier":"id-1-list-the-available-dc2-tables","label":"1. List the available DC2 tables","html_id":"id-1-list-the-available-dc2-tables","implicit":true,"key":"e8w2FeXbYX"}],"key":"aRkApYT3Ch"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"tables = service.tables\nfor tablename in tables.keys():\n    if not \"tap_schema\" in tablename:\n        if \"dc2\" in tablename:\n            tables[tablename].describe()","key":"aHQdw7bQKV"},{"type":"outputs","id":"A1hgiz1mFJhK02fppOf2F","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"cosmodc2mockv1\n    CosmoDC2MockV1 Catalog - unabridged, spatially partitioned\n\n"},"key":"SfwcJF7HHc"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"cosmodc2mockv1_heavy\n    CosmoDC2MockV1 Catalog - stellar mass > 10^7 Msun\n\n"},"key":"qfgKCsuCtP"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"cosmodc2mockv1_new\n    CosmoDC2MockV1 Catalog - unabridged\n\n"},"key":"AQMlhfs9k8"}],"key":"Cpj87vLzpi"}],"key":"RVrNQw7z6a"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"2. Choose the DC2 catalog you want to work with.","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"PvNcmCCMpB"}],"identifier":"id-2-choose-the-dc2-catalog-you-want-to-work-with","label":"2. Choose the DC2 catalog you want to work with.","html_id":"id-2-choose-the-dc2-catalog-you-want-to-work-with","implicit":true,"key":"cQyykfkAI6"},{"type":"paragraph","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"IRSA currently offers 3 versions of the DC2 catalog.","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"G5dutXzqFe"}],"key":"WK3mmuqmDh"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":72,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":72,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"inlineCode","value":"cosmodc2mockv1_new","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"NCUBKBEQSs"},{"type":"text","value":" has been optimized to make searches with constraints on stellar mass and redshift fast.","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"FvRdSpvFq2"}],"key":"UmVgqFzvjE"}],"key":"EAZjxacApu"},{"type":"listItem","spread":true,"position":{"start":{"line":74,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"inlineCode","value":"cosmodc2mockv1","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"X92zaQATuX"},{"type":"text","value":" has been optimized to make searches with spatial constraints fast.","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"sd1rnxKSWc"}],"key":"UPOr4TQpPc"}],"key":"JOYaTcOYZ5"},{"type":"listItem","spread":true,"position":{"start":{"line":76,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"children":[{"type":"inlineCode","value":"cosmodc2mockv1_heavy","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"hn9rpmzk7Z"},{"type":"text","value":" is the same as ","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"GHNK0KZ4Bl"},{"type":"inlineCode","value":"cosmodc2mockv1_new","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"oG4KwDO9YE"},{"type":"text","value":", except that it does not contain galaxies with stellar masses <= 10^7 solar masses.","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"Wk0Eo1ryms"}],"key":"Tgta0MhrDO"}],"key":"OgeEnSrsM8"}],"key":"u7rj5DogEp"},{"type":"paragraph","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"If you are new to the DC2 catalog, we recommend that you start with ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"OdsssISIOJ"},{"type":"inlineCode","value":"cosmodc2mockv1_heavy","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"h1NyxiDJs3"}],"key":"jI3GJcCYNz"}],"key":"GaJYYZW5Oq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Choose the abridged table to start with.\n# Queries should be faster on smaller tables.\n\ntablename = 'cosmodc2mockv1_heavy'","key":"Ez4BhwS1QF"},{"type":"outputs","id":"wznRmytFLuB121QJ0ZARf","children":[],"key":"IDzaCZ9dWT"}],"key":"Hva45SBtEM"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"text","value":"3. What is the default maximum number of rows returned by the service?","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"uiTOH97nMf"}],"identifier":"id-3-what-is-the-default-maximum-number-of-rows-returned-by-the-service","label":"3. What is the default maximum number of rows returned by the service?","html_id":"id-3-what-is-the-default-maximum-number-of-rows-returned-by-the-service","implicit":true,"key":"MfeRB21PFL"},{"type":"paragraph","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"This service will return a maximum of 2 billion rows by default.","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"HdZdwaW1jY"}],"key":"gEnEjrLg14"}],"key":"XO4LMRZwgq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"service.maxrec","key":"SdHsFjmmix"},{"type":"outputs","id":"nNGt1wQ7CwMzKnbDFDTpW","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"2000000000","content_type":"text/plain"}}},"key":"J5nBzHXk3g"}],"key":"SaivrJbFW2"}],"key":"QOBPVLMOkS"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"children":[{"type":"text","value":"This default maximum can be changed, and there is no hard upper limit to what it can be changed to.","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"YP0q2dkTGy"}],"key":"mBseTJUicv"}],"key":"dKZ9OolWCZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(service.hardlimit)","key":"XLfWzImq0y"},{"type":"outputs","id":"SpHZr6DauwPRSWYEgbk5s","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"None\n"},"key":"uIT12X6A7V"}],"key":"XVYEYpcADC"}],"key":"o6mM8GtIpA"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"text","value":"4. List the columns in the chosen table","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"a2ZJGkTPOx"}],"identifier":"id-4-list-the-columns-in-the-chosen-table","label":"4. List the columns in the chosen table","html_id":"id-4-list-the-columns-in-the-chosen-table","implicit":true,"key":"fuLSocNsuI"},{"type":"paragraph","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"text","value":"This table contains 301 columns.","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"Y74z9g7GjL"}],"key":"Af5vVz0RPz"}],"key":"H6rjmlkAhZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"columns = tables[tablename].columns\nprint(len(columns))","key":"CyQW87L61j"},{"type":"outputs","id":"v5Aqa_5nsR52BvjlANATd","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"301\n"},"key":"eGa6K44HLO"}],"key":"DjgLLHydGk"}],"key":"zFoqNWFfND"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"Let’s learn a bit more about them.","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"KPNgp2CQEh"}],"key":"sI87wQwGzz"}],"key":"Lzh0nUvAoT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"for col in columns:\n    print(f'{f\"{col.name}\":30s}  {col.description}')","key":"PaL9IlYd4y"},{"type":"outputs","id":"lK2ql8OZFQqn08__A0PoU","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"ra                              Right ascension, lensed\ndec  ...","hash":"a0f1bf6c4a6724b463b6c68c215d37a6","path":"/irsa-tutorials/build/a0f1bf6c4a6724b463b6c68c215d37a6.txt"},"key":"RlThp5PcRZ"}],"key":"uUFXMtsnAz"}],"key":"ZZI6nMZMvI"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":117,"column":1},"end":{"line":117,"column":1}},"children":[{"type":"text","value":"5. Retrieve a list of galaxies within a small area","position":{"start":{"line":117,"column":1},"end":{"line":117,"column":1}},"key":"Zi74GPVZ0O"}],"identifier":"id-5-retrieve-a-list-of-galaxies-within-a-small-area","label":"5. Retrieve a list of galaxies within a small area","html_id":"id-5-retrieve-a-list-of-galaxies-within-a-small-area","implicit":true,"key":"hNWV0w7yW5"},{"type":"paragraph","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"children":[{"type":"text","value":"Since we know that cosmoDC2 is a large catalog, we can start with a spatial search over a small square area. The ADQL that is needed for the spatial constraint is shown below.  We then show how to make a redshift histogram of the sample generated.","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"EUJo6d2hot"}],"key":"lGWNPJIT0f"}],"key":"AkM6r1K7SZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Setup the query\nadql = f\"\"\"\nSELECT redshift\nFROM {tablename}\nWHERE CONTAINS(\n    POINT('ICRS', ra, dec),\n    CIRCLE('ICRS', 54.0, -37.0, 0.05)\n) = 1\n\"\"\"\n\ncone_results = service.run_sync(adql)","key":"fdJ73RZLzx"},{"type":"outputs","id":"HzdM5M0IZbtouqiBE40Nr","children":[],"key":"zWDSTPcofA"}],"key":"SSOUZ5LOzl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#how many redshifts does this return?\nprint(len(cone_results))","key":"sagbvzfMck"},{"type":"outputs","id":"8xQGeG9VGxlreSIEW9W1i","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"10640\n"},"key":"boTVueNszh"}],"key":"Qtgxa1Mk3F"}],"key":"diYgauxDuH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Now that we have a list of galaxy redshifts in that region, we can\n# create a histogram of the redshifts to see what redshifts this survey includes.\n\n# Plot a histogram\nnum_bins = 20\n# the histogram of the data\nn, bins, patches = plt.hist(cone_results['redshift'], num_bins,\n                            facecolor='blue', alpha = 0.5)\nplt.xlabel('Redshift')\nplt.ylabel('Number')\nplt.title(f'Redshift Histogram {tablename}')","key":"DX4we7cd0B"},{"type":"outputs","id":"EXmLDTkqjiGELQGEfffMQ","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"dc94691dd971cb3ab27db20e7e86093a","path":"/irsa-tutorials/build/dc94691dd971cb3ab27db20e7e86093a.png"}}},"key":"Vs5ZiAqiFI"}],"key":"rarm9riOWL"}],"key":"hzdqnOv6Nz"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"text","value":"We can see form this plot that the simulated galaxies go out to z = 3.","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"key":"CTTkqtYq1E"}],"key":"WjlFMXQu8w"}],"key":"WYCZp3qi9n"},{"type":"block","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":158,"column":1},"end":{"line":158,"column":1}},"children":[{"type":"text","value":"6. Visualize galaxy colors: redshift search","position":{"start":{"line":158,"column":1},"end":{"line":158,"column":1}},"key":"McZOBkZifI"}],"identifier":"id-6-visualize-galaxy-colors-redshift-search","label":"6. Visualize galaxy colors: redshift search","html_id":"id-6-visualize-galaxy-colors-redshift-search","implicit":true,"key":"CCPNdG53md"},{"type":"paragraph","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"children":[{"type":"text","value":"First, we’ll do a narrow redshift cut with no spatial constraint.  Then, from that redshift sample we will visualize the galaxy main sequence at z = 2.0.","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"SztBlUbmHz"}],"key":"nOS5FgWdgy"}],"key":"Y1GqmS1W39"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Setup the query\nadql = f\"\"\"\nSELECT TOP 50000\n    mag_r_lsst,\n    (mag_g_lsst - mag_r_lsst) AS color,\n    redshift\nFROM {tablename}\nWHERE redshift BETWEEN 1.95 AND 2.05\n\"\"\"\nredshift_results = service.run_sync(adql)","key":"w00B6mMWkx"},{"type":"outputs","id":"cCzzNIrODYmf2RSgAuFlv","children":[],"key":"rrjH4vetUB"}],"key":"yPxm8ccAA9"},{"type":"block","children":[],"key":"BNwrKRhtMh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"redshift_results","key":"TlCIoLxs5h"},{"type":"outputs","id":"bckcVDPx165RtnXU2QuX-","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/plain":{"content":"<DALResultsTable length=50000>\nmag_r_lsst    color     redshift\n   mag                          \n float32     float32    float32 \n---------- ------------ --------\n    26.848 -0.021268845   2.0165\n    27.889   0.35132408   2.0119\n    26.606  -0.01011467   2.0120\n    27.618    0.1490097   2.0102\n    27.806   0.31212997   2.0162\n    26.255  -0.18672943   2.0109\n    29.849    1.6436062   2.0146\n    26.824  -0.02711296   2.0132\n    26.303  -0.16145706   2.0108\n       ...          ...      ...\n    27.172 -0.051956177   2.0221\n    27.482 -0.038871765   2.0201\n    28.166   0.26872253   2.0147\n    28.274   0.19420052   2.0396\n    26.913  -0.04233551   2.0170\n    28.426   0.27457047   2.0124\n    30.236    1.1904049   2.0226\n    28.847   0.34114647   2.0401\n    29.401   0.58423233   2.0365","content_type":"text/plain"}}},"key":"lHN2LG9Dn4"}],"key":"xPqzxiPRpi"}],"key":"ffiapasKFO"},{"type":"block","children":[],"key":"OFGY2zyzCS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Construct a 2D histogram of the galaxy colors\nplt.hist2d(redshift_results['mag_r_lsst'], redshift_results['color'],\n            bins=100, cmap='plasma', cmax=500)\n\n# Plot a colorbar with label.\ncb = plt.colorbar()\ncb.set_label('Number')\n\n# Add title and labels to plot.\nplt.xlabel('LSST Mag r')\nplt.ylabel('LSST rest-frame g-r color')","key":"TML7W9V8bN"},{"type":"outputs","id":"PCWYeyDj4NKBLqPqGOwye","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"0611656c15ed124895c299fd5925f59a","path":"/irsa-tutorials/build/0611656c15ed124895c299fd5925f59a.png"}}},"key":"TlstYFwAfj"}],"key":"Z6jhoMlAIf"}],"key":"xW7qnIA7Rf"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"children":[{"type":"text","value":"7. Suggestions for further queries:","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"key":"sB6vd15Ze4"}],"identifier":"id-7-suggestions-for-further-queries","label":"7. Suggestions for further queries:","html_id":"id-7-suggestions-for-further-queries","implicit":true,"key":"F8msIGouCm"},{"type":"paragraph","position":{"start":{"line":194,"column":1},"end":{"line":197,"column":1}},"children":[{"type":"text","value":"TAP queries are extremely powerful and provide flexible ways to explore large catalogs like CosmoDC2, including spatial searches, photometric selections, cross-matching, and more.\nHowever, many valid ADQL queries can take minutes or longer to complete due to the size of the catalog, so we avoid running those directly in this tutorial.\nInstead, the examples here have so far focused on fast, lightweight queries that illustrate the key concepts without long wait times.\nIf you are interested in exploring further, here are some additional query ideas that are scientifically useful but may take longer to run depending on server conditions.","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"Z58pnciEpB"}],"key":"eEca7uc9it"},{"type":"heading","depth":3,"position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"children":[{"type":"text","value":"Count the total number of redshifts in the chosen table","position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"key":"Ep83qLYxiO"}],"identifier":"count-the-total-number-of-redshifts-in-the-chosen-table","label":"Count the total number of redshifts in the chosen table","html_id":"count-the-total-number-of-redshifts-in-the-chosen-table","implicit":true,"key":"HdB7kXfGiq"},{"type":"paragraph","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"children":[{"type":"text","value":"The answer for the ","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"key":"gpP4ILMMuI"},{"type":"inlineCode","value":"'cosmodc2mockv1_heavy'","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"key":"TWEfpJEt6h"},{"type":"text","value":" table is 597,488,849 redshifts.","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"key":"KPvZsn0WKj"}],"key":"tWBDBdUrxK"},{"type":"code","lang":"sql","value":"adql = f\"SELECT count(redshift) FROM {tablename}\"","position":{"start":{"line":202,"column":1},"end":{"line":204,"column":1}},"key":"VjDVhaAUlL"},{"type":"heading","depth":3,"position":{"start":{"line":206,"column":1},"end":{"line":206,"column":1}},"children":[{"type":"text","value":"Count galaxies in a sky region (cone search)","position":{"start":{"line":206,"column":1},"end":{"line":206,"column":1}},"key":"Wlp0Umhpzo"}],"identifier":"count-galaxies-in-a-sky-region-cone-search","label":"Count galaxies in a sky region (cone search)","html_id":"count-galaxies-in-a-sky-region-cone-search","implicit":true,"key":"toQKKEmHa1"},{"type":"paragraph","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":1}},"children":[{"type":"text","value":"Generally useful for: estimating source density, validating spatial footprint, testing spatial completeness.","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":1}},"key":"AYRdBBzTM8"}],"key":"YAnHEdYHE9"},{"type":"code","lang":"sql","value":"adql = f\"\"\"\nSELECT COUNT(*)\nFROM {tablename}\nWHERE CONTAINS(POINT('ICRS', ra, dec), CIRCLE('ICRS', 54.2, -37.5, 0.2)) = 1\n\"\"\"","position":{"start":{"line":209,"column":1},"end":{"line":215,"column":1}},"key":"DIS5WwgaDL"},{"type":"heading","depth":3,"position":{"start":{"line":217,"column":1},"end":{"line":217,"column":1}},"children":[{"type":"text","value":"Retrieve only a subset of columns (recommended for speed) and rows","position":{"start":{"line":217,"column":1},"end":{"line":217,"column":1}},"key":"DRCKDnjQUH"}],"identifier":"retrieve-only-a-subset-of-columns-recommended-for-speed-and-rows","label":"Retrieve only a subset of columns (recommended for speed) and rows","html_id":"retrieve-only-a-subset-of-columns-recommended-for-speed-and-rows","implicit":true,"key":"p81fmqKdlx"},{"type":"paragraph","position":{"start":{"line":218,"column":1},"end":{"line":219,"column":1}},"children":[{"type":"text","value":"This use of “TOP 5000” just limits the number of rows returned.\nRemove it if you want all rows, but keep in mind such a query can take a much longer time.","position":{"start":{"line":218,"column":1},"end":{"line":218,"column":1}},"key":"GLalVjNb7G"}],"key":"rwroRfDa3U"},{"type":"code","lang":"sql","value":"adql = f\"\"\"\nSELECT TOP 5000\n    ra,\n    dec,\n    redshift,\n    stellar_mass\nFROM {tablename}\"\"\"","position":{"start":{"line":221,"column":1},"end":{"line":229,"column":1}},"key":"CsHLHxjywD"},{"type":"heading","depth":3,"position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"children":[{"type":"text","value":"Explore the stellar–halo mass relation","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"key":"Dz1uTPcuHo"}],"identifier":"explore-the-stellar-halo-mass-relation","label":"Explore the stellar–halo mass relation","html_id":"explore-the-stellar-halo-mass-relation","implicit":true,"key":"UIR0IJ8Hi9"},{"type":"code","lang":"sql","value":"adql = f\"\"\"\nSELECT TOP 500000\n    stellar_mass,\n    halo_mass\nFROM {tablename}\nWHERE halo_mass > 1e11\"\"\"","position":{"start":{"line":233,"column":1},"end":{"line":240,"column":1}},"key":"lHk4mJtIm5"},{"type":"heading","depth":3,"position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"children":[{"type":"text","value":"Find the brightest galaxies at high redshift","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"key":"rOaaxIcuE4"}],"identifier":"find-the-brightest-galaxies-at-high-redshift","label":"Find the brightest galaxies at high redshift","html_id":"find-the-brightest-galaxies-at-high-redshift","implicit":true,"key":"CUIcm1RV9x"},{"type":"paragraph","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"children":[{"type":"text","value":"Return the results in ascending (ASC) order by r band magnitude.","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"UdN7Im2Kp4"}],"key":"Yw5JBX6ojh"},{"type":"code","lang":"sql","value":"adql = f\"\"\"\nSELECT TOP 10000\n    ra, dec, redshift, mag_r_lsst\nFROM {tablename}\nWHERE redshift > 2.5\nORDER BY mag_r_lsst ASC\n\"\"\"","position":{"start":{"line":245,"column":1},"end":{"line":253,"column":1}},"key":"DL9GcaqN7b"}],"key":"tG9I7TBY0B"},{"type":"block","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"children":[{"type":"text","value":"About this notebook","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"aVlYGsOPNt"}],"identifier":"about-this-notebook","label":"About this notebook","html_id":"about-this-notebook","implicit":true,"key":"bPae4YnsKD"},{"type":"paragraph","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"children":[{"type":"strong","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"children":[{"type":"text","value":"Author:","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"TG9mbzwinm"}],"key":"aPlzyAHxq8"},{"type":"text","value":" IRSA Data Science Team, including Vandana Desai, Jessica Krick, Troy Raen, Brigitta Sipőcz, Andreas Faisst, Jaladh Singhal","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"YGNo6KOVFR"}],"key":"rTsMRBvQLV"},{"type":"paragraph","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"children":[{"type":"strong","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"children":[{"type":"text","value":"Updated:","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"OeOHFS3xDA"}],"key":"y6ZYsViRQQ"},{"type":"text","value":" 2025-12-16","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"aNc3hlujQ0"}],"key":"Ez45XIadoU"},{"type":"paragraph","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"children":[{"type":"strong","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"children":[{"type":"text","value":"Contact:","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"XbPSIgsvHT"}],"key":"odR3wnJemu"},{"type":"text","value":" ","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"MdCqFT7WAH"},{"type":"link","url":"https://irsa.ipac.caltech.edu/docs/help_desk.html","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"children":[{"type":"text","value":"the IRSA Helpdesk","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"Yf5jg0h0Yd"}],"urlSource":"https://irsa.ipac.caltech.edu/docs/help_desk.html","key":"s27tjIzyNq"},{"type":"text","value":" with questions or reporting problems.","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"Wx555gmTos"}],"key":"hQ2WngCTgg"},{"type":"paragraph","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"children":[{"type":"strong","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"children":[{"type":"text","value":"Runtime:","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"vTOcG6BA4G"}],"key":"kSFpDfdIen"},{"type":"text","value":" As of the date above, this notebook takes about 2 minutes to run to completion on a machine with 8GB RAM and 2 CPU.  Large variations in this runtime can be expected if the TAP server is busy with many queries at once.","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"oveWxPsua5"}],"key":"btrgNdnZd1"}],"key":"XA6J6Kqery"}],"key":"Nlo7irsmaK"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Analyzing cloud-hosted simulated Roman Time Domain Survey images","url":"/openuniverse2024-roman-simulated-timedomainsurvey","group":"OpenUniverse 2024"},"next":{"title":"IRSA cloud access introduction","url":"/cloud-access-intro","group":"Special Topics"}}},"domain":"http://localhost:3000"}