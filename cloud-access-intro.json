{"version":3,"kind":"Notebook","sha256":"5a2f2a4bff3c1c0b43f7a3a7b8b27bf2f4f2d5654953d54bd1c05f88abb9164c","slug":"cloud-access-intro","location":"/tutorials/techniques-and-tools/cloud-access-intro.md","dependencies":[],"frontmatter":{"title":"IRSA cloud access introduction","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.16.7"}},"content_includes_title":false,"authors":[{"id":"IRSA Scientists and Developers","name":"IRSA Scientists and Developers"}],"license":{"content":{"id":"BSD-3-Clause","url":"https://github.com/Caltech-IPAC/irsa-tutorials/blob/main/LICENSE","name":"BSD 3-Clause \"New\" or \"Revised\" License","free":true,"osi":true}},"github":"https://github.com/Caltech-IPAC/irsa-tutorials/","subject":"IRSA Tutorials","keywords":["astronomy"],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":1}},"source_url":"https://github.com/Caltech-IPAC/irsa-tutorials//blob/main/tutorials/techniques-and-tools/cloud-access-intro.md","edit_url":"https://github.com/Caltech-IPAC/irsa-tutorials//edit/main/tutorials/techniques-and-tools/cloud-access-intro.md","exports":[{"format":"md","filename":"cloud-access-intro.md","url":"/irsa-tutorials/build/cloud-access-intro-8378458e72f43c73af3cc4452e9b5014.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"This is the introductory tutorial demonstrating basic python access to the IRSA-curated images and catalogs available in AWS S3 cloud storage buckets.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"DdWW1SnKzc"}],"key":"rZA2BhsTW4"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Learning Goals:","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"z0OnWkA6dv"}],"key":"MGSHEG2J03"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":21,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Find datasets and connection information.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"Sr6rrrudXz"}],"key":"zAnnHUhNEB"}],"key":"iLWiM8uDbV"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Browse buckets.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"pt1Jb3fdyW"}],"key":"DTITJd6f4Y"}],"key":"XKr5juDAHE"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Find an image and retrieve a cutout.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"EElsxiMbQf"}],"key":"agBSiGBvZM"}],"key":"ZtHPJASBYS"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Navigate a catalog and perform a basic query.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"gyN4RsQZUh"}],"key":"o1iK9SNiNu"}],"key":"Im5XHrHnDY"}],"key":"L2ZwWAhbuP"}],"key":"wDblUVeyOM"},{"type":"block","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"1. Cloud basics","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"W3u9pVSK72"}],"identifier":"id-1-cloud-basics","label":"1. Cloud basics","html_id":"id-1-cloud-basics","implicit":true,"key":"gUsKpoxgWJ"},{"type":"paragraph","position":{"start":{"line":30,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"AWS S3 is an ","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"YCrZIAkUXL"},{"type":"link","url":"https://en.wikipedia.org/wiki/Object_storage","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"object store","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"fywn20vJ6c"}],"urlSource":"https://en.wikipedia.org/wiki/Object_storage","data":{"page":"Object_storage","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"iwQWjCxq90"},{"type":"text","value":" where the fundamental entities are “buckets” and “objects”.\nBuckets are containers for objects, and objects are blobs of data.\nUsers may be more familiar with ","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"jjmL1rcSRu"},{"type":"link","url":"https://en.wikipedia.org/wiki/File_system","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"filesystem","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"TZbBdlZslU"}],"urlSource":"https://en.wikipedia.org/wiki/File_system","data":{"page":"File_system","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"fQ4tr20dMZ"},{"type":"text","value":" “files” and “directories”.\nFiles are analogous to objects, and the terms are often used interchangeably.\nWhile there is no directory-like structure in S3 itself, various layers on top of S3 have implemented functionality to mimic it.\nAs a result, users can generally interact using familiar filesystem logic, but may notice subtle differences.","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"tVsrLvX5kW"}],"key":"YeznoGCcyU"},{"type":"paragraph","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"The following S3 terms are also used in this notebook:","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"AxI5a3l8xO"}],"key":"CJrPcZar6x"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":39,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Key: Unique ID for an object, relative to the bucket. Analogous to the full path to a file.","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"nuxTtgTmQt"}],"key":"xUhhc6BNMH"}],"key":"yQqP9DtJJn"},{"type":"listItem","spread":true,"position":{"start":{"line":40,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Prefix: String of characters at the beginning of the object key. Analogous to the full path to a directory.","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"EEmsIUTVHI"}],"key":"r3XzymFSNs"}],"key":"Hcg3EYJJOd"}],"key":"vcGCnQ7wOD"}],"key":"ohq6FIO5OK"},{"type":"block","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"1.1 General access","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"klcsUizCrh"}],"identifier":"id-1-1-general-access","label":"1.1 General access","html_id":"id-1-1-general-access","implicit":true,"key":"RL2Z1Z17aP"},{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"Most of the common python methods used to read images and catalogs from a local disk can also be pointed at cloud storage buckets.\nThis includes methods like Astropy ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"E1djHGlWpU"},{"type":"inlineCode","value":"fits.open","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"pbplkCOlUu"},{"type":"text","value":" and Pandas ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"EfsBtn8lfG"},{"type":"inlineCode","value":"read_parquet","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"N4Q6vmlFcY"},{"type":"text","value":".\nThe cloud connection is handled by a separate library, usually ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"f2W1EncV4j"},{"type":"link","url":"https://s3fs.readthedocs.io","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"s3fs","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"WdtVwWYgmJ"}],"urlSource":"https://s3fs.readthedocs.io","key":"x3v5h74ggl"},{"type":"text","value":", ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"G2KgKaSQNh"},{"type":"link","url":"https://filesystem-spec.readthedocs.io","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"fsspec","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"hp8L7UAt51"}],"urlSource":"https://filesystem-spec.readthedocs.io","key":"FuRpjnW4Eo"},{"type":"text","value":", or ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"UEZHcaz5w9"},{"type":"link","url":"https://arrow.apache.org/docs/python/api/filesystems.html","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"pyarrow.fs","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"wct6K3cSGE"}],"urlSource":"https://arrow.apache.org/docs/python/api/filesystems.html","key":"bafLxVjoKU"},{"type":"text","value":".","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"evzvLb5O2A"}],"key":"RK5S35nuFZ"},{"type":"paragraph","position":{"start":{"line":50,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"text","value":"The IRSA buckets are public and access is free.\nCredentials are not required.\nHowever, most tools will look for credentials by default and raise an error when none are found.\nTo access without credentials, users can make an anonymous connection, usually with a keyword argument such as ","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"yBiiSqGIjg"},{"type":"inlineCode","value":"anon=True","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"rnEgk9Gsrw"},{"type":"text","value":".\nThis notebook demonstrates with the ","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"ulESqGWF9P"},{"type":"inlineCode","value":"s3fs","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"XQtLOkIMq2"},{"type":"text","value":", ","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"LBTVPrB1lI"},{"type":"inlineCode","value":"astropy","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"ycTqEYEFl3"},{"type":"text","value":", and ","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"Fn80rmU5qC"},{"type":"inlineCode","value":"pyarrow","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"EyPEFfENfh"},{"type":"text","value":" libraries.","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"H6o9JJNPPD"}],"key":"hrbTDBg6OR"}],"key":"MxWQkzPQSx"},{"type":"block","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"2. Find datasets and connection information","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"Kh9TReyf9I"}],"identifier":"id-2-find-datasets-and-connection-information","label":"2. Find datasets and connection information","html_id":"id-2-find-datasets-and-connection-information","implicit":true,"key":"w1ahGtgcaw"},{"type":"paragraph","position":{"start":{"line":60,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"A listing of the available datasets is maintained on ","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"RGIvGXCrh9"},{"type":"link","url":"https://irsa.ipac.caltech.edu/cloud_access/","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"IRSA’s Cloud Access","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"DMfZgnDQDB"}],"urlSource":"https://irsa.ipac.caltech.edu/cloud_access/","key":"vxvqHqN0dL"},{"type":"text","value":" page.\nIt can be used to substitute values for the following variables, which are used throughout this notebook and identified by all caps:","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"D3bvU6BvSn"}],"key":"tLcSnLbvJy"},{"type":"table","position":{"start":{"line":63,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"text","value":"Cloud Access Variable","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"dPnbRJy9fz"}],"key":"yuzjeutcTn"},{"type":"tableCell","header":true,"position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"text","value":"Definition","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"kxXc7W8Y0J"}],"key":"W2GOZTvYLu"}],"key":"JPjvp7ZNSJ"},{"type":"tableRow","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"children":[{"type":"inlineCode","value":"BUCKET_NAME","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"HKCEdke9uI"}],"key":"obc5XH6K5w"},{"type":"tableCell","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"children":[{"type":"text","value":"AWS S3 bucket name.","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"bouquxM3c9"}],"key":"dH3hWXRCwd"}],"key":"nAfdos7Aed"},{"type":"tableRow","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"inlineCode","value":"BUCKET_REGION","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"azv5xaiKI1"}],"key":"uTTjCI4wAu"},{"type":"tableCell","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"AWS region the bucket is in.","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"eLr9XLJruC"}],"key":"TRTqJNHWtB"}],"key":"D0oe8CFKbc"},{"type":"tableRow","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"children":[{"type":"inlineCode","value":"IMAGES_PREFIX","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"key":"NVee7Zg2Xf"}],"key":"AiDU4JgCiL"},{"type":"tableCell","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"children":[{"type":"text","value":"S3 prefix to the base of an image set.","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"key":"JkIJqUdkEb"}],"key":"qg0pVR8OjH"}],"key":"aAtZiZcAGD"},{"type":"tableRow","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"inlineCode","value":"CATALOG_PREFIX","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"j3LLQq5oEO"}],"key":"EY1fj9n8HD"},{"type":"tableCell","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"S3 prefix to the base of a catalog.","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"W6BoVUpHBh"}],"key":"YR3nAVoAr0"}],"key":"aFMkRio3el"},{"type":"tableRow","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"inlineCode","value":"PARQUET_NAME","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"iyUM5mJ7k7"}],"key":"kW8jrcswF0"},{"type":"tableCell","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"text","value":"Path to the base of the catalog’s Parquet dataset, relative to the prefix.","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"tFEv3ebXsf"}],"key":"ubmgQcYslX"}],"key":"H7WlOvF5Ep"}],"key":"uREyD5qChz"}],"key":"PizMXHVj4V"},{"type":"block","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"text","value":"3. Imports","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"wAso0034Mp"}],"identifier":"id-3-imports","label":"3. Imports","html_id":"id-3-imports","implicit":true,"key":"D6lSuiwkrJ"},{"type":"paragraph","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"The following libraries will be used:","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"XXlBTXzNPh"}],"key":"q7olkwMAkP"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":77,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"astropy: perform image cutouts","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"Pd56ebTtJB"}],"key":"EHUd4F7BJn"}],"key":"yRIOiBVWf8"},{"type":"listItem","spread":true,"position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"hpgeom: map sky location to catalog partition","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"DQl82AQWQ8"}],"key":"k9wUeiLPne"}],"key":"vGRkzVYEOc"},{"type":"listItem","spread":true,"position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"matplotlib: view results","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"iSFucKzi7Y"}],"key":"xZtgrIl9PS"}],"key":"EjVRGmq9rZ"},{"type":"listItem","spread":true,"position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"pandas: query Parquet datasets","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"rINEdWqmVD"}],"key":"TlAzq27mV1"}],"key":"mDWYStpFHa"},{"type":"listItem","spread":true,"position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"pyarrow: work with Parquet datasets","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"gXJC08ql6C"}],"key":"Y34dBUX2LO"}],"key":"lsvk2xqPQy"},{"type":"listItem","spread":true,"position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"pyvo: locate images in the cloud (pyvo>=1.5 required)","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"Nx8raPXPuV"}],"key":"vOCMZqnAuL"}],"key":"JoBEG49LBF"},{"type":"listItem","spread":true,"position":{"start":{"line":83,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"s3fs: browse buckets","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"LMu4xSrl2J"}],"key":"BT0DrcnfTL"}],"key":"qwtHqt1ylN"}],"key":"c2jFURhf1k"},{"type":"paragraph","position":{"start":{"line":85,"column":1},"end":{"line":86,"column":1}},"children":[{"type":"text","value":"Libraries are imported at the top of each section where used.\nThis cell will install them if needed:","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"PkeeBa5Bz0"}],"key":"JccZTWYEmG"}],"key":"eZUfwgyHa9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Uncomment the next line to install dependencies if needed.\n# !pip install astropy hpgeom pandas pyarrow 'pyvo>=1.5' s3fs matplotlib astroquery","key":"AMI6iVs9t6"},{"type":"outputs","id":"Hpe96YZ_ARc_OCn7WdBgQ","children":[],"key":"g0MLI8BSaN"}],"key":"n3ri2W56V7"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"4. Browse buckets","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"q687PhIZE2"}],"identifier":"id-4-browse-buckets","label":"4. Browse buckets","html_id":"id-4-browse-buckets","implicit":true,"key":"XwBnADZQS3"},{"type":"paragraph","position":{"start":{"line":95,"column":1},"end":{"line":97,"column":1}},"children":[{"type":"text","value":"Generally, it is not necessary to look through the buckets.\nThe Cloud Access page is the best way to understand what is available.\nHowever, browsing buckets can sometimes be useful.","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"wgyekd2453"}],"key":"AnzLJCQUsr"},{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"WHcN25A2a2"},{"type":"link","url":"https://s3fs.readthedocs.io","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"s3fs","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"GT6LswBT9R"}],"urlSource":"https://s3fs.readthedocs.io","key":"jeqghYU1pD"},{"type":"text","value":" library offers a filesystem-like experience and is demonstrated below.\nBeware that these datasets can contain millions of files or more --\nif calls are taking a long time to return, try narrowing the search by adding additional levels to the prefix.","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"Qcn91P8ckc"}],"key":"PLggIpppDA"},{"type":"paragraph","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"text","value":"Users who want to interact with the buckets and objects more directly may instead prefer the ","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"iRiDJslX7a"},{"type":"link","url":"https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/s3.html","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"text","value":"AWS Boto3","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"GMaTzQJnfC"}],"urlSource":"https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/s3.html","key":"PZvDhxeRpK"},{"type":"text","value":" library.","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"apSMNLNJm8"}],"key":"tTBeGj7TTi"}],"key":"UJB3tKnEQs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import s3fs","key":"zsxY8TYaY2"},{"type":"outputs","id":"_azy7-ev00kmLzMo0Rptm","children":[],"key":"lXzUu8t4x9"}],"key":"mmnQIlArq5"},{"type":"block","children":[],"key":"ZIXkwp23lZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# create an S3 client\ns3 = s3fs.S3FileSystem(anon=True)","key":"hyzmxr2BcA"},{"type":"outputs","id":"ifADicw4jM6w0a39OpD1L","children":[],"key":"iWWEsz2o2C"}],"key":"Oi3U0gt97a"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"children":[{"type":"inlineCode","value":"ls","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"key":"cjken1g8sA"},{"type":"text","value":" the root directory of the Spitzer SEIP Super Mosaics image set:","position":{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},"key":"QDvckiQpJv"}],"key":"CrtTcJAuVL"}],"key":"u9qxp93lSP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"BUCKET_NAME = \"nasa-irsa-spitzer\"\nIMAGES_PREFIX = \"spitzer/seip/seip_science/images\"\n\ns3.ls(f\"{BUCKET_NAME}/{IMAGES_PREFIX}/\")","key":"OQfzL1HcVc"},{"type":"outputs","id":"ng_dAW21l9RcUm4Uri8Iw","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"['nasa-irsa-spitzer/spitzer/seip/seip_science/images/2',\n 'nasa-irsa-spitzer/spitzer/seip/seip_science/images/3',\n 'nasa-irsa-spitzer/spitzer/seip/seip_science/images/4',\n 'nasa-irsa-spitzer/spitzer/seip/seip_science/images/5',\n 'nasa-irsa-spitzer/spitzer/seip/seip_science/images/6',\n 'nasa-irsa-spitzer/spitzer/seip/seip_science/images/7']","content_type":"text/plain"}}},"key":"fiQQQ9OKEM"}],"key":"f7KToeXqxS"}],"key":"lObtXl688a"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":123,"column":1},"end":{"line":125,"column":1}},"children":[{"type":"text","value":"Use wildcard (glob) matching to find mosaics.\nThis can be slow if looking through a large number of files, so we’ll add a few levels to the base prefix to reduce the number of files in the search.\nThe additional levels can be found using ","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"cSa84QbwnM"},{"type":"inlineCode","value":"ls","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"oXij7EFBxi"},{"type":"text","value":" recursively or constructed using information on the Cloud Access page.","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"N92pIzue52"}],"key":"RcHFeyzFSK"}],"key":"Tg1LVQJtno"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sub_prefix = \"4/0019/40019821/9\"\nglob_pattern = \"**/*.mosaic.fits\"\n\ns3.glob(f\"{BUCKET_NAME}/{IMAGES_PREFIX}/{sub_prefix}/{glob_pattern}\")","key":"BAK0BgZNjV"},{"type":"outputs","id":"s-bPqiO20OSlLdaTgNCzE","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"['nasa-irsa-spitzer/spitzer/seip/seip_science/images/4/0019/40019821/9/40019821-19/40019821.40019821-19.MIPS.1.mosaic.fits',\n 'nasa-irsa-spitzer/spitzer/seip/seip_science/images/4/0019/40019821/9/40019821-9/40019821.40019821-9-short.IRAC.1.mosaic.fits',\n 'nasa-irsa-spitzer/spitzer/seip/seip_science/images/4/0019/40019821/9/40019821-9/40019821.40019821-9-short.IRAC.2.mosaic.fits',\n 'nasa-irsa-spitzer/spitzer/seip/seip_science/images/4/0019/40019821/9/40019821-9/40019821.40019821-9-short.IRAC.3.mosaic.fits',\n 'nasa-irsa-spitzer/spitzer/seip/seip_science/images/4/0019/40019821/9/40019821-9/40019821.40019821-9-short.IRAC.4.mosaic.fits',\n 'nasa-irsa-spitzer/spitzer/seip/seip_science/images/4/0019/40019821/9/40019821-9/40019821.40019821-9.IRAC.1.mosaic.fits',\n 'nasa-irsa-spitzer/spitzer/seip/seip_science/images/4/0019/40019821/9/40019821-9/40019821.40019821-9.IRAC.2.mosaic.fits',\n 'nasa-irsa-spitzer/spitzer/seip/seip_science/images/4/0019/40019821/9/40019821-9/40019821.40019821-9.IRAC.3.mosaic.fits',\n 'nasa-irsa-spitzer/spitzer/seip/seip_science/images/4/0019/40019821/9/40019821-9/40019821.40019821-9.IRAC.4.mosaic.fits',\n 'nasa-irsa-spitzer/spitzer/seip/seip_science/images/4/0019/40019821/9/40019821-9/40019821.40019821-9.MIPS.1.mosaic.fits']","content_type":"text/plain"}}},"key":"FWjeBYnHGb"}],"key":"QEPkzAAEhK"}],"key":"CnGuSgFe6t"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"children":[{"type":"text","value":"5. Find an image and retrieve a cutout","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"clvJw9szC7"}],"identifier":"id-5-find-an-image-and-retrieve-a-cutout","label":"5. Find an image and retrieve a cutout","html_id":"id-5-find-an-image-and-retrieve-a-cutout","implicit":true,"key":"mFY0rm3Gyd"},{"type":"paragraph","position":{"start":{"line":136,"column":1},"end":{"line":138,"column":1}},"children":[{"type":"text","value":"A basic image cutout using ","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"key":"uwd7NCIKkn"},{"type":"link","url":"https://docs.astropy.org/en/stable/","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"children":[{"type":"text","value":"Astropy","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"key":"bwqPzAVom4"}],"urlSource":"https://docs.astropy.org/en/stable/","key":"S8aNwm6mmJ"},{"type":"text","value":" is demonstrated in section 5.2.\nIt requires a bucket name and image key.\nSection 5.1 demonstrates how to query IRSA for this information using ","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"key":"X5lCH55OGD"},{"type":"link","url":"https://pyvo.readthedocs.io/en/latest/index.html","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"children":[{"type":"text","value":"PyVO","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"key":"WEZQSONFFF"}],"urlSource":"https://pyvo.readthedocs.io/en/latest/index.html","key":"Q9YzsNfawi"},{"type":"text","value":" and a coordinate search.","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"key":"FjIdAQFg1U"}],"key":"DY3zBdmKBS"},{"type":"paragraph","position":{"start":{"line":140,"column":1},"end":{"line":142,"column":1}},"children":[{"type":"text","value":"Note: There may be a delay between the time when a new dataset is made available in S3 and when IRSA’s image services are able to return the new cloud access information.\nIn this case, the IRSA URL that is returned by the service can be mapped to the cloud information.\nThis is explained further on the Cloud Access page, and also demonstrated in section 5.1 below.","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"daKU1di3ZM"}],"key":"wOpjSPLtkx"}],"key":"UebvpgWC5w"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import astropy.io\nimport json\nimport pyvo\nfrom astropy import units as u\nfrom astropy.coordinates import SkyCoord\nfrom astropy.nddata import Cutout2D\nfrom astropy.wcs import WCS\nfrom matplotlib import pyplot as plt","key":"JBkTIozAHI"},{"type":"outputs","id":"_ra91Utfh9fvGqbb7lvPJ","children":[],"key":"h06L5EsLph"}],"key":"Q3X8z63qhJ"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":155,"column":1},"end":{"line":155,"column":1}},"children":[{"type":"text","value":"5.1 Find an image using PyVO and a coordinate search","position":{"start":{"line":155,"column":1},"end":{"line":155,"column":1}},"key":"spe6PaHrWR"}],"identifier":"id-5-1-find-an-image-using-pyvo-and-a-coordinate-search","label":"5.1 Find an image using PyVO and a coordinate search","html_id":"id-5-1-find-an-image-using-pyvo-and-a-coordinate-search","implicit":true,"key":"Sh6ZMnMoPy"}],"key":"oDIXvmE2Sp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"coords = SkyCoord(\"150.01d 2.2d\", frame=\"icrs\")\nsize = 0.01 * u.deg","key":"ZR9VJ9cJ2R"},{"type":"outputs","id":"Lgum_xmd0ZXVzNkge2vwe","children":[],"key":"Id1bB8iKv8"}],"key":"YEXypZ6gSm"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":162,"column":1},"end":{"line":164,"column":1}},"children":[{"type":"text","value":"For the full list of datasets that can be used with the ","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"key":"Nd75Jto99J"},{"type":"inlineCode","value":"collection","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"key":"cQ2UNz3P69"},{"type":"text","value":" parameter in the SIA search below, uncomment the next cell.\nNote that only some of these are currently available in cloud storage.\nTo request that additional datasets be made available in cloud storage, please contact IRSA’s ","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"key":"umbU36ya0m"},{"type":"link","url":"https://irsa.ipac.caltech.edu/docs/help_desk.html","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"children":[{"type":"text","value":"Help Desk","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"key":"JulEVMyRs0"}],"urlSource":"https://irsa.ipac.caltech.edu/docs/help_desk.html","key":"i77Nd9r80K"},{"type":"text","value":".","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"key":"QODPE0Q1BM"}],"key":"rtVq3WBi4L"}],"key":"PpuQPyJjLT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# from astroquery.ipac.irsa import Irsa\n\n# Irsa.list_collections()","key":"cb2sAs5c8r"},{"type":"outputs","id":"ahCpWi4tqu0iJXJ3dgFNa","children":[],"key":"efN4G1nDoy"}],"key":"DrvQw17ryz"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"children":[{"type":"text","value":"Use PyVO to execute a search for Spitzer SEIP Super Mosaics and find cloud access information:","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"um2F4kJfNj"}],"key":"XygWVVUafy"}],"key":"At8R4MKMmV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"irsa_SIA = pyvo.dal.SIA2Service(\"https://irsa.ipac.caltech.edu/SIA\")\nseip_results = irsa_SIA.search((coords, size), collection=\"spitzer_seip\")\n\n# view cloud access info for the first few files overlapping the search area\nseip_results[\"cloud_access\"][:5]","key":"m2qJwG63u3"},{"type":"outputs","id":"dtWgnAR6d1AydoBMj_oGF","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"masked_array(data=['{\"aws\": {\"bucket_name\": \"nasa-irsa-spitzer\", \"key\":\"spitzer/seip/seip_science/images/6/0095/60095931/5/60095931-15/60095931.60095931-15.IRAC.4.median_mosaic.fits\", \"region\": \"us-west-2\"}}',\n                   '{\"aws\": {\"bucket_name\": \"nasa-irsa-spitzer\", \"key\":\"spitzer/seip/seip_science/images/6/0095/60095931/5/60095931-15/60095931.60095931-15.IRAC.3.mosaic.fits\", \"region\": \"us-west-2\"}}',\n                   '{\"aws\": {\"bucket_name\": \"nasa-irsa-spitzer\", \"key\":\"spitzer/seip/seip_science/images/6/0095/60095931/5/60095931-15/60095931.60095931-15.IRAC.3.median_mosaic.fits\", \"region\": \"us-west-2\"}}',\n                   '{\"aws\": {\"bucket_name\": \"nasa-irsa-spitzer\", \"key\":\"spitzer/seip/seip_science/images/6/0095/60095931/5/60095931-15/60095931.60095931-15.IRAC.2.median_mosaic.fits\", \"region\": \"us-west-2\"}}',\n                   '{\"aws\": {\"bucket_name\": \"nasa-irsa-spitzer\", \"key\":\"spitzer/seip/seip_science/images/6/0095/60095931/5/60095931-15/60095931.60095931-15.IRAC.1.median_mosaic.fits\", \"region\": \"us-west-2\"}}'],\n             mask=[False, False, False, False, False],\n       fill_value=array('?', dtype='<U1'),\n            dtype=object)","content_type":"text/plain"}}},"key":"LO2zxZL7Kq"}],"key":"dnbIs4HWyS"}],"key":"ao0KAJPCsU"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":182,"column":1},"end":{"line":182,"column":1}},"children":[{"type":"strong","position":{"start":{"line":182,"column":1},"end":{"line":182,"column":1}},"children":[{"type":"text","value":"Option 1","position":{"start":{"line":182,"column":1},"end":{"line":182,"column":1}},"key":"UYavSClfmM"}],"key":"glrIExmuct"},{"type":"text","value":": Extract the cloud information from the “cloud_access” column for a single mosaic file:","position":{"start":{"line":182,"column":1},"end":{"line":182,"column":1}},"key":"fvm2bYwnzb"}],"key":"IpGVeCHoXF"}],"key":"LnFLyirWMD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# find the first mosaic file in the results\n# use json to convert the string containing the cloud info to a dictionary\nmosaics = [i for i in seip_results[\"cloud_access\"] if \".mosaic.fits\" in i]\nseip_mosaic_cloud_info = json.loads(mosaics[0])\n\n# extract\nBUCKET_NAME = seip_mosaic_cloud_info[\"aws\"][\"bucket_name\"]\nimage_key = seip_mosaic_cloud_info[\"aws\"][\"key\"]","key":"cQfA182TTV"},{"type":"outputs","id":"L_maK7D1WbOJ_CfGbhQMH","children":[],"key":"YM8Lb5sCun"}],"key":"EDsr5xQp1L"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"children":[{"type":"strong","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"children":[{"type":"text","value":"Option 2","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"f253I8RTvS"}],"key":"bzROjCHAVX"},{"type":"text","value":": Construct the cloud information for a single mosaic file from the IRSA URL (useful if you know the dataset is in S3, but results in the “cloud_access” column were empty):","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"mQO5MfFiCF"}],"key":"xrioVMIgKn"}],"key":"M75l6I6k0S"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"BUCKET_NAME = \"nasa-irsa-spitzer\"\nIMAGES_PREFIX = \"spitzer/seip/seip_science/images\"\n\n# find the first mosaic URL in the results\nimage_url = [url for url in seip_results[\"access_url\"] if \".mosaic.fits\" in url][0]\n\n# construct the key by replacing the first part of the URL with the IMAGES_PREFIX\n# split the URL at the data product ID, the final level of the prefix\ndata_product_id = IMAGES_PREFIX.split(\"/\")[-1]\nkey_suffix = image_url.split(f\"/{data_product_id}/\")[-1]\nimage_key = f\"{IMAGES_PREFIX}/{key_suffix}\"","key":"hMy9pVljzm"},{"type":"outputs","id":"ULnZhIFBVC2TGFms8SZOz","children":[],"key":"N6VmUjGhh1"}],"key":"tsM2DF02Bk"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"children":[{"type":"text","value":"5.2 Retrieve a cutout using Astropy","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"cle3yNrDGC"}],"identifier":"id-5-2-retrieve-a-cutout-using-astropy","label":"5.2 Retrieve a cutout using Astropy","html_id":"id-5-2-retrieve-a-cutout-using-astropy","implicit":true,"key":"CP3Sorl0vY"},{"type":"paragraph","position":{"start":{"line":213,"column":1},"end":{"line":216,"column":1}},"children":[{"type":"text","value":"Lazy-load data for better performance.\nThe relevant options are enabled by default when using ","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"gsyW4rRp5y"},{"type":"inlineCode","value":"astropy.io.fits.open","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"FALI6WG8L4"},{"type":"text","value":" with ","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"MkuyxLISc6"},{"type":"inlineCode","value":"fsspec","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"F1HJiVbTrM"},{"type":"text","value":".\nIn addition, use the HDU ","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"Gx0eJdZjpb"},{"type":"inlineCode","value":"section","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"xdrpfpz0Ky"},{"type":"text","value":" method in place of the usual ","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"cvpajKDG3u"},{"type":"inlineCode","value":"data","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"ba2vu9KlDx"},{"type":"text","value":" to avoid downloading the full data block.\n(See ","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"HrVjJEtXXZ"},{"type":"link","url":"https://docs.astropy.org/en/stable/io/fits/usage/cloud.html#fits-io-cloud","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"children":[{"type":"text","value":"Obtaining subsets from cloud-hosted FITS files","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"lwA8BUM1MD"}],"urlSource":"https://docs.astropy.org/en/stable/io/fits/usage/cloud.html#fits-io-cloud","key":"hlPF1R5qBt"},{"type":"text","value":".)","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"fcf5NAO3KO"}],"key":"q4IbDr16li"}],"key":"zIj5SWTceh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"s3_image_path = f\"s3://{BUCKET_NAME}/{image_key}\"\nwith astropy.io.fits.open(s3_image_path, fsspec_kwargs={\"anon\": True}) as hdul:\n    cutout = Cutout2D(hdul[0].section, position=coords, size=size, wcs=WCS(hdul[0].header))","key":"H7BNbkNyUq"},{"type":"outputs","id":"aJi-ety2mLCkv_H8Adsex","children":[],"key":"uSp4NufAyy"}],"key":"mD37qM6n5L"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":224,"column":1},"end":{"line":224,"column":1}},"children":[{"type":"text","value":"Show the cutout:","position":{"start":{"line":224,"column":1},"end":{"line":224,"column":1}},"key":"SKatpgyheD"}],"key":"BME74WoHVl"}],"key":"W6WDM02ACx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.imshow(cutout.data, cmap=\"gray\")","key":"zXqGEDeJmG"},{"type":"outputs","id":"DiY9F8ZVxMm0k4ezuwQtE","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"6c77d5fbf93c4908170404e78f2a10fd","path":"/irsa-tutorials/build/6c77d5fbf93c4908170404e78f2a10fd.png"}}},"key":"i6ZEfaDm8B"}],"key":"F4GKbsQyQn"}],"key":"qfZdwL21za"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"children":[{"type":"text","value":"6. Navigate a catalog and perform a basic query","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"cNYJYT1Toa"}],"identifier":"id-6-navigate-a-catalog-and-perform-a-basic-query","label":"6. Navigate a catalog and perform a basic query","html_id":"id-6-navigate-a-catalog-and-perform-a-basic-query","implicit":true,"key":"ABVJZ9fDLq"},{"type":"paragraph","position":{"start":{"line":232,"column":1},"end":{"line":234,"column":1}},"children":[{"type":"text","value":"The catalogs are in Apache Parquet format and partitioned spatially using HEALPix order k=5.\nParquet datasets can be queried directly using SQL-like logic by applying filters during the file reads.\nFor queries that have a spatial constraint, including a filter on the partitioning column can greatly improve performance.","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"Ez3K996dc6"}],"key":"muxH6UFAld"},{"type":"paragraph","position":{"start":{"line":236,"column":1},"end":{"line":237,"column":1}},"children":[{"type":"text","value":"Section 6.1 demonstrates how to view the catalog schema using ","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"key":"bNjbWBIIty"},{"type":"link","url":"https://arrow.apache.org/docs/python/","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"children":[{"type":"text","value":"PyArrow","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"key":"leXYZ31jTD"}],"urlSource":"https://arrow.apache.org/docs/python/","key":"rH6optxXwE"},{"type":"text","value":" to find the column names, etc. needed for constructing queries.\nA basic spatial query using ","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"key":"FLk8xgDBSz"},{"type":"link","url":"https://pandas.pydata.org/docs/","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"children":[{"type":"text","value":"Pandas","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"key":"zMm6Y0yKia"}],"urlSource":"https://pandas.pydata.org/docs/","key":"VYWWFwPKYJ"},{"type":"text","value":" is shown in section 6.2 and includes finding the relevant partitions using ","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"key":"zH1Vq7C0Ej"},{"type":"link","url":"https://hpgeom.readthedocs.io/en/latest/","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"children":[{"type":"text","value":"HPGeom","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"key":"QKoMOesifj"}],"urlSource":"https://hpgeom.readthedocs.io/en/latest/","key":"pBZhhPmOv7"},{"type":"text","value":".","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"key":"sh6d6GEYoB"}],"key":"b0NK8YjDUV"}],"key":"nVqq5itruq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import hpgeom\nimport pandas as pd\nimport pyarrow.dataset\nimport pyarrow.fs\nfrom matplotlib import colors","key":"Y2E7Qc4Zz8"},{"type":"outputs","id":"GvjdOe1luAfkQMOhxQQHE","children":[],"key":"ItO21be4s4"}],"key":"pjvMHbvx1a"},{"type":"block","children":[],"key":"v5QgRMFRSb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"BUCKET_NAME = \"nasa-irsa-wise\"\nBUCKET_REGION = \"us-west-2\"\n\nCATALOG_PREFIX = \"wise/allwise/catalogs/p3as_psd/healpix_k5\"\nPARQUET_NAME = \"wise-allwise.parquet\"\n\nparquet_root = f\"{BUCKET_NAME}/{CATALOG_PREFIX}/{PARQUET_NAME}\"\n\nfs = pyarrow.fs.S3FileSystem(region=BUCKET_REGION, anonymous=True)","key":"Z9KaZZEUZN"},{"type":"outputs","id":"hQO10kscYiuirSvaCQYAS","children":[],"key":"Ads9qMEjUe"}],"key":"B88P3dfAsY"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"children":[{"type":"text","value":"6.1 View the schema using PyArrow","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"RkAZjPA91S"}],"identifier":"id-6-1-view-the-schema-using-pyarrow","label":"6.1 View the schema using PyArrow","html_id":"id-6-1-view-the-schema-using-pyarrow","implicit":true,"key":"dF3DhuJ3PC"}],"key":"CxUS0kJsbL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# load the schema from the \"_common_metadata\" file\ns3_schema_path = f\"{parquet_root}/_common_metadata\"\nschema = pyarrow.dataset.parquet_dataset(s3_schema_path, filesystem=fs).schema\n\n# the full schema can be quite large since catalogs often have hundreds of columns\n# but if you do want to look at the entire schema, uncomment the next line\n# schema","key":"pUoOoIMyIx"},{"type":"outputs","id":"TBdrtf3z3b6h0Nt9X1zV_","children":[],"key":"NSwFH1ZFpR"}],"key":"kmf4d95SqE"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"children":[{"type":"text","value":"Search through the column names to find the HEALPix partitioning columns:","position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"key":"Wfeb5rTCUO"}],"key":"Wy22EGVBYO"}],"key":"v8FKrhDLio"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"[name for name in schema.names if \"healpix\" in name]\n# the result shows that both orders k=0 and k=5 are available, but typical use cases only need k=5","key":"Xb7JUwVTBd"},{"type":"outputs","id":"4ex31wC-YnFVxWEH4imX_","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":17,"metadata":{},"data":{"text/plain":{"content":"['healpix_k0', 'healpix_k5']","content_type":"text/plain"}}},"key":"Z9y7JzUqiy"}],"key":"mjcjNE7uUW"}],"key":"NnpnKqSf4j"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"children":[{"type":"text","value":"Look at a specific column (“ext_flg” will be used below to query for likely stars):","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"rCqthH6Rt8"}],"key":"bE0x3Z8M1a"}],"key":"ELkoYuuqQQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# this will display basic information like name and type\nschema.field(\"ext_flg\")","key":"r7Q6WOPCTj"},{"type":"outputs","id":"6woCLZT06Aoix8wI9pif4","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":18,"metadata":{},"data":{"text/plain":{"content":"pyarrow.Field<ext_flg: int64>","content_type":"text/plain"}}},"key":"H4mU3qgc6U"}],"key":"TypinUdsAg"}],"key":"ox5cydHE2x"},{"type":"block","children":[],"key":"GaYysur5ao"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# units and descriptions are in the field's metadata attribute\nschema.field(\"ext_flg\").metadata","key":"RrB7SNwpd1"},{"type":"outputs","id":"LmSB_J006PaBtl6l7UUuF","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":19,"metadata":{},"data":{"text/plain":{"content":"{b'units': b'',\n b'description': b'Extended source flag. This is an integer flag, the value of which indicates whether or not the morphology of a source is consistent with the WISE point spread function in any band, or whether the source is associated with or superimposed on a previously known extended object from the 2MASS Extended Source Catalog (XSC). The values of the ext_flg indicate the following conditions: 0 - The source shape is consistent with a point-source and the source is not associated with or superimposed on a 2MASS XSC source 1 - The profile-fit photometry goodness-of-fit, w?rchi2, is >3.0 in one or more bands. 2 - The source falls within the extrapolated isophotal footprint of a 2MASS XSC source. 3 - The profile-fit photometry goodness-of-fit, w?rchi2, is >3.0 in one or more bands, and The source falls within the extrapolated isophotal footprint of a 2MASS XSC source. 4 - The source position falls within 5\" of a 2MASS XSC source. 5 - The profile-fit photometry goodness-of-fit, w?rchi2, is >3.0 in one or more bands, and the source position falls within 5\" of a 2MASS XSC source. CAUTION: WISE profile-fit (w?mpro) and standard aperture (w?mag) measurements are optimized for point sources and will systematically underestimate the true flux of resolved objects. If a source entry has ext_flg>0, you may wish to examine the large aperture photometry, or the elliptical aperture photometry which are measured using areas that are scaled from 2MASS XSC morphologies.'}","content_type":"text/plain"}}},"key":"n1L5qaEMmh"}],"key":"eAICt1yN61"}],"key":"YiCO44YWhU"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"children":[{"type":"text","value":"6.2 Perform a basic spatial search with Pandas","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"key":"TrTCvgOCuc"}],"identifier":"id-6-2-perform-a-basic-spatial-search-with-pandas","label":"6.2 Perform a basic spatial search with Pandas","html_id":"id-6-2-perform-a-basic-spatial-search-with-pandas","implicit":true,"key":"pD0uszgM80"},{"type":"paragraph","position":{"start":{"line":292,"column":1},"end":{"line":292,"column":1}},"children":[{"type":"text","value":"Query the AllWISE catalog for likely stars within an RA/Dec polygon.","position":{"start":{"line":292,"column":1},"end":{"line":292,"column":1}},"key":"DqOfF8MLDr"}],"key":"aSa9ZgXNrX"},{"type":"paragraph","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"children":[{"type":"text","value":"Spatial limits roughly covering the Taurus L1495 star-forming region:","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"key":"OkpX9eun4c"}],"key":"t0zmpM0DfN"}],"key":"N0qkX8MXUs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ra_min, ra_max, dec_min, dec_max = 62, 66, 25, 29  # deg\n\npolygon_corners = [(ra_min, dec_min), (ra_min, dec_max), (ra_max, dec_max), (ra_max, dec_min)]\ncorners = list(zip(*polygon_corners))  # [(ra values), (dec values)]","key":"NrbuKdr8nj"},{"type":"outputs","id":"b2rgFC7zdNLLbhzI9-R5v","children":[],"key":"bi3Y3lBk1D"}],"key":"SsCBfAG4Jc"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"children":[{"type":"text","value":"Find the partitions (HEALPix pixel indexes) that overlap the polygon:","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"du5YR516Hv"}],"key":"EwynnYHElm"}],"key":"WgpLbOSLkH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"k = 5\npolygon_pixels = hpgeom.query_polygon(\n    a=corners[0], b=corners[1], nside=hpgeom.order_to_nside(k), inclusive=True\n)","key":"tISPHt8zkx"},{"type":"outputs","id":"8PL_8aKfEs3BShrE-GXzg","children":[],"key":"wkcSsLr20F"}],"key":"eSuYhXfvuv"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"children":[{"type":"text","value":"Query:","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"key":"mrsIy9wof2"}],"key":"qyiVgiOGO6"}],"key":"lCNxIYDSmq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"results_df = pd.read_parquet(\n    parquet_root,\n    filesystem=fs,\n    # columns to be returned. similar to a SQL SELECT clause.\n    columns=[\"designation\", \"w1mpro\", \"w2mpro\", \"w3mpro\", \"w4mpro\", f\"healpix_k{k}\"],\n    # row filters. similar to a SQL WHERE clause.\n    # supported operators: ==, !=, <, >, <=, >=, in, not in\n    # tuple conditions are joined by AND (for OR, use a list of lists)\n    filters=[\n        (\"ext_flg\", \"==\", 0),\n        (\"ra\", \">\", ra_min),\n        (\"ra\", \"<\", ra_max),\n        (\"dec\", \">\", dec_min),\n        (\"dec\", \"<\", dec_max),\n        # include filter on partition column for efficiency. similar to a database index.\n        (f\"healpix_k{k}\", \"in\", polygon_pixels),\n    ],\n)","key":"O1KvMCW4NT"},{"type":"outputs","id":"GrnJTEGpsEr1bDK9hZct7","children":[],"key":"P6ZLnLZEzI"}],"key":"VyTHF8ije0"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"children":[{"type":"text","value":"View results on a color-color diagram:","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"key":"Oh8LC96Pnu"}],"key":"TYScDgp4vQ"}],"key":"DuIhCX7MV0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"results_df[\"W1-W2\"] = results_df[\"w1mpro\"] - results_df[\"w2mpro\"]\nresults_df[\"W2-W3\"] = results_df[\"w2mpro\"] - results_df[\"w3mpro\"]\nresults_df.plot.hexbin(\"W2-W3\", \"W1-W2\", norm=colors.LogNorm(vmin=1, vmax=500))","key":"nLAmf8TTMR"},{"type":"outputs","id":"gWNTsneTRyDiVME-Ic-Is","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":23,"metadata":{},"data":{"text/plain":{"content":"<Axes: xlabel='W2-W3', ylabel='W1-W2'>","content_type":"text/plain"}}},"key":"h0opRZ0Ut6"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"0cc7a1886e1e7aa9b39176ba22a1c672","path":"/irsa-tutorials/build/0cc7a1886e1e7aa9b39176ba22a1c672.png"}}},"key":"qFmp9wcBym"}],"key":"nU2PSnCQgY"}],"key":"e51Ncqv2Dy"},{"type":"block","children":[{"type":"thematicBreak","position":{"start":{"line":343,"column":1},"end":{"line":343,"column":1}},"key":"HlBWFUN8K8"},{"type":"heading","depth":2,"position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"children":[{"type":"text","value":"About this notebook","position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"key":"tFdidPeVbP"}],"identifier":"about-this-notebook","label":"About this notebook","html_id":"about-this-notebook","implicit":true,"key":"pCl7uBlteX"},{"type":"paragraph","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"children":[{"type":"strong","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"children":[{"type":"text","value":"Author:","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"key":"UyQhNY97h4"}],"key":"Z4tc6WgnYF"},{"type":"text","value":" Troy Raen (IRSA Developer) in conjunction with Brigitta Sipőcz, Jessica Krick and the IPAC Science Platform team","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"key":"ulyyNgKovM"}],"key":"Jjsx0TYgvo"},{"type":"paragraph","position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"children":[{"type":"strong","position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"children":[{"type":"text","value":"Updated:","position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"key":"jkMd5pHCBh"}],"key":"Ie54sU4DEF"},{"type":"text","value":" 2024-07-29","position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"key":"kFMvkRn6K9"}],"key":"cVF4LT8g7V"},{"type":"paragraph","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"children":[{"type":"strong","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"children":[{"type":"text","value":"Contact:","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"key":"YxX5TcSrxO"}],"key":"nUDiL7e5Cm"},{"type":"text","value":" ","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"key":"PhgInFKxPr"},{"type":"link","url":"https://irsa.ipac.caltech.edu/docs/help_desk.html","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"children":[{"type":"text","value":"the IRSA Helpdesk","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"key":"jLLcSr0uuj"}],"urlSource":"https://irsa.ipac.caltech.edu/docs/help_desk.html","key":"ebHorDN0we"},{"type":"text","value":" with questions or reporting problems.","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"key":"BnR877txcu"}],"key":"fa5HT1BqnG"}],"key":"dTzGtumWxL"}],"key":"T7zsQgpeGH"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Techniques & Tools Tutorial Notebooks","short_title":"Techniques & Tools","url":"/techniques","group":"COSMOS"},"next":{"title":"Access HATS Collections Using LSDB: Euclid Q1 and ZTF DR23","short_title":"LSDB HATS","url":"/irsa-hats-with-lsdb","group":"COSMOS"}}},"domain":"http://localhost:3000"}