{"version":2,"kind":"Notebook","sha256":"8e10f122cfc32baed49bff8eed029aa816f5eb5f7d06352a3b987e463b6a3289","slug":"euclid-ero","location":"/tutorials/euclid_access/Euclid_ERO.md","dependencies":[],"frontmatter":{"title":"Exploring Star Clusters in the Euclid ERO Data","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{"formats":"md:myst","text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.16.7"}},"content_includes_title":false,"authors":[{"id":"IRSA Scientists and Developers","name":"IRSA Scientists and Developers"}],"github":"https://github.com/Caltech-IPAC/irsa-tutorials/","subject":"IRSA Tutorials","keywords":["astronomy"],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":2}},"source_url":"https://github.com/Caltech-IPAC/irsa-tutorials//blob/main/tutorials/euclid_access/Euclid_ERO.md","edit_url":"https://github.com/Caltech-IPAC/irsa-tutorials//edit/main/tutorials/euclid_access/Euclid_ERO.md","exports":[{"format":"md","filename":"Euclid_ERO.md","url":"/irsa-tutorials/build/Euclid_ERO-08212a738341e14f332d0240d8260aba.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Learning Goals","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"AI4P39uTkl"}],"identifier":"learning-goals","label":"Learning Goals","html_id":"learning-goals","implicit":true,"key":"xatIiGfdlA"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"By the end of this tutorial, you will be able to:","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"Ts5MteyCdw"}],"key":"vMZTzrhKjP"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"• Access the Euclid ERO images using ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"wJBDtCIZSW"},{"type":"inlineCode","value":"astroquery","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"yOc4qsxRNQ"}],"key":"xZNJQsm3Kh"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"• Create cutouts on the large Euclid ERO images directly","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"vDwtYGdMIm"}],"key":"nCoeyraBsh"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"• Extract sources on the Euclid image and run photometry tools","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"L48nuYjB9d"}],"key":"jICRH07ZZU"},{"type":"paragraph","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"• Compare photometry to the Gaia catalog","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"B5D23QJpty"}],"key":"Ch4aHS0rex"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"• Visualize the Euclid ERO image and the Gaia catalog in ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"ghXCiTc8fc"},{"type":"inlineCode","value":"Firefly","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"hScmrOKzr1"}],"key":"Q7YW7rBf4i"},{"type":"heading","depth":2,"position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"qqTFFCVCXH"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"jPBT7QnUtN"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"Euclid is a European Space Agency (ESA) space mission with NASA participation, to study the geometry and nature of the dark Universe. As part of its first observations, Euclid publicly released so-called ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"PjJTHrtpqr"},{"type":"emphasis","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"Early Release Observations","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"HZQf14V7pF"}],"key":"H9IvbvW8GE"},{"type":"text","value":" (ERO) targeting some press-worthy targets on the sky such as star clusters or local galaxies.","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"C0GDLQpexc"}],"key":"Pyh8o4OMAe"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"In this notebook, we will focus on the ERO data of ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"OAVTQBXBpG"},{"type":"strong","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"NGC 6397","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"UEmWtWmZmV"}],"key":"JLhQheAOeD"},{"type":"text","value":", a globular cluster 78,000 light years away. (Note that there is another globular cluster, ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"pZWz1kPFAk"},{"type":"strong","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"NGC 6254","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"XJIOPQLTdA"}],"key":"xWUiYWyiAH"},{"type":"text","value":" that can also be used for this analysis - in fact the user can choose which one to use) The goal of this analysis is to extract the Euclid photometry of the stars belonging to the cluster and compare them to the photometry of Gaia. Due to the different pixel scales of the visible (VIS, ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"chReUpb7pc"},{"type":"inlineMath","value":"0.1^{\\prime\\prime}","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0.</mn><msup><mn>1</mn><mrow><mo mathvariant=\"normal\">′</mo><mo mathvariant=\"normal\">′</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">0.1^{\\prime\\prime}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\">0.</span><span class=\"mord\"><span class=\"mord\">1</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′′</span></span></span></span></span></span></span></span></span></span></span></span>","key":"oMrDUy2z8Y"},{"type":"text","value":") and near-IR (NISP, ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"hPYBbUemA7"},{"type":"inlineMath","value":"0.3^{\\prime\\prime}","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0.</mn><msup><mn>3</mn><mrow><mo mathvariant=\"normal\">′</mo><mo mathvariant=\"normal\">′</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">0.3^{\\prime\\prime}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\">0.</span><span class=\"mord\"><span class=\"mord\">3</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′′</span></span></span></span></span></span></span></span></span></span></span></span>","key":"A3qRLODWdW"},{"type":"text","value":") wavelengths, we will first detect and extract the stars in the VIS filter and use their position to subsequently extract the photometry in the NISP (Y, J, H) filters (a method also referred to as ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"W15PyTog6f"},{"type":"emphasis","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"forced photometry","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"ldoiCpeD4x"}],"key":"Exdn5IUOD4"},{"type":"text","value":").","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"FB9P9gjeqD"}],"key":"JeAjACJPO0"},{"type":"paragraph","position":{"start":{"line":37,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"One challenge with Euclid data is their size due to the large sky coverage and small pixel size.\nThis notebook demonstrates how to download only a cutout of the large Euclid ERO observation image (namely focussing only on the position of the globular cluster. Furthermore, this notebook demonstrates how to extract sources on a large astronomical image and how to measure their photometry across different pixel scales using a very simple implementation of the forced photometry method with positional priors.\nFinally, we also demonstrate how to visualize the Euclid images and catalog in ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"OtS4ymlMSf"},{"type":"inlineCode","value":"Firefly","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"cTNAaflPpT"},{"type":"text","value":", an open-source web-based UI library for astronomical data archive access and visualization developed at Caltech (","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"v5RCqBtJEJ"},{"type":"link","url":"https://github.com/Caltech-IPAC/firefly","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"https://​github​.com​/Caltech​-IPAC​/firefly","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"yhaRFLJlxh"}],"urlSource":"https://github.com/Caltech-IPAC/firefly","error":true,"key":"BaKXz9LvkI"},{"type":"text","value":"). ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"wMhmuOuI59"},{"type":"inlineCode","value":"Firefly","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"Pj6d5AWl56"},{"type":"text","value":" is a convenient tool to visualize images similar to DS9 on your local computer, but it can run on a cloud-based science platform.","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"yMwyRIe4fS"}],"key":"lst6L7Phxl"},{"type":"paragraph","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"This notebook is written to be used in Fornax which is a cloud based computing platform using AWS. The advantage of this is that the user does not need to download actuall data, hence the analysis of large datasets is not limited by local computing resources. It also allows to access data across all archives fast and easy.","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"Ca7W9Iet5F"}],"key":"vsVuD7bnsG"},{"type":"heading","depth":2,"position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"text","value":"Data Volume","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"FUlbf2TbzX"}],"identifier":"data-volume","label":"Data Volume","html_id":"data-volume","implicit":true,"key":"layy7W68r7"},{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"The total data volume required for running this notebook is less than 20 MB.","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"i7m67qJIFE"}],"key":"Lami84cc1P"}],"key":"PKMdZNTuPK"},{"type":"block","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"FegV24SFpq"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"P3bSqKneZG"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Important","key":"PQTIUZwKQ7"}],"key":"TqLxaR8ZSb"},{"type":"paragraph","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"text","value":"We rely on ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"VrB5xOa60C"},{"type":"inlineCode","value":"astroquery","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"Rr5aItANJf"},{"type":"text","value":", ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"V16ikaxh25"},{"type":"inlineCode","value":"firefly_client","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"PNHukDbbV1"},{"type":"text","value":", ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"QBg0MXXVPW"},{"type":"inlineCode","value":"photutils","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"QghaCIfqYI"},{"type":"text","value":", and ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"uSS0kJB5eE"},{"type":"inlineCode","value":"sep","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"XvZ1vg7cPF"},{"type":"text","value":" features that have been recently added, so please make sure you have the respective versions v0.4.10, v3.2, v2.0, and v1.4 or newer installed.","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"SOCBl1FFEO"}],"key":"i3vmOPJUC4"}],"key":"bQRz6iTz9J"}],"key":"SAjdYEk7qw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Uncomment the next line to install dependencies if needed.\n# !pip install tqdm numpy matplotlib astropy 'photutils>=2.0' 'astroquery>=0.4.10' 'sep>=1.4' 'firefly_client>=3.2'","key":"S5RxAbyYwo"},{"type":"output","id":"81e0g2_w5qbJRbv7BsQ3C","data":[],"key":"wRgP7iScbj"}],"key":"h7jbUFk8ba"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"First, we import all necessary packages.","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"U38fYjwiVm"}],"key":"xHyCtz9g8H"}],"key":"zPu2unTZgO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# General imports\nimport os\nimport numpy as np\nfrom tqdm import tqdm\n\n# Astroquery\nfrom astroquery.ipac.irsa import Irsa\nfrom astroquery.gaia import Gaia\n\n# Astropy\nfrom astropy.coordinates import SkyCoord\nfrom astropy import units as u\nfrom astropy.io import fits\nfrom astropy.nddata import Cutout2D\nfrom astropy.wcs import WCS\nfrom astropy.table import Table\nfrom astropy.stats import sigma_clipped_stats\n\n# Photometry tools\nimport sep\nfrom photutils.detection import DAOStarFinder\nfrom photutils.psf import PSFPhotometry, IterativePSFPhotometry, CircularGaussianSigmaPRF, make_psf_model_image\nfrom photutils.background import LocalBackground, MMMBackground\n\n# Firefly\nfrom firefly_client import FireflyClient\n\n# Matplotlib\nimport matplotlib.pyplot as plt\nimport matplotlib as mpl","key":"aXOaHm2smL"},{"type":"output","id":"GsFTXZ0ObROcrc4Y0J_D7","data":[{"output_type":"stream","name":"stderr","text":"/home/runner/work/irsa-tutorials/irsa-tutorials/.tox/py312-buildhtml/lib/python3.12/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html\n  from .autonotebook import tqdm as notebook_tqdm\n"}],"key":"F9BrZfB4NX"}],"key":"uJ9HdJtmAi"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"children":[{"type":"text","value":"Next, we define some parameters for ","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"Hg60lrtGEq"},{"type":"inlineCode","value":"Matplotlib","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"wYnzVQuUS4"},{"type":"text","value":" plotting.","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"giYx2mcrtc"}],"key":"LXMIPOvrpQ"}],"key":"LFdk8gKhjI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"## Plotting stuff\nmpl.rcParams['font.size'] = 14\nmpl.rcParams['axes.labelpad'] = 7\nmpl.rcParams['xtick.major.pad'] = 7\nmpl.rcParams['ytick.major.pad'] = 7\nmpl.rcParams['xtick.minor.visible'] = True\nmpl.rcParams['ytick.minor.visible'] = True\nmpl.rcParams['xtick.minor.top'] = True\nmpl.rcParams['xtick.minor.bottom'] = True\nmpl.rcParams['ytick.minor.left'] = True\nmpl.rcParams['ytick.minor.right'] = True\nmpl.rcParams['xtick.major.size'] = 5\nmpl.rcParams['ytick.major.size'] = 5\nmpl.rcParams['xtick.minor.size'] = 3\nmpl.rcParams['ytick.minor.size'] = 3\nmpl.rcParams['xtick.direction'] = 'in'\nmpl.rcParams['ytick.direction'] = 'in'\n#mpl.rc('text', usetex=True)\nmpl.rc('font', family='serif')\nmpl.rcParams['xtick.top'] = True\nmpl.rcParams['ytick.right'] = True\nmpl.rcParams['hatch.linewidth'] = 1\n\ndef_cols = plt.rcParams['axes.prop_cycle'].by_key()['color']","key":"CBPo7Qzn4q"},{"type":"output","id":"bTR-jUXiX8kPhAodbsCms","data":[],"key":"hLABjotwzs"}],"key":"miNiAtLNQr"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"children":[{"type":"text","value":"Setting up the Environment","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"key":"GnjrtR3nFB"}],"identifier":"setting-up-the-environment","label":"Setting up the Environment","html_id":"setting-up-the-environment","implicit":true,"key":"DdETM6HeLC"},{"type":"paragraph","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"children":[{"type":"text","value":"Next, we set up the environment. This includes","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"KSB7YP4Fnh"}],"key":"Bestk9Js0G"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":129,"column":1},"end":{"line":132,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":129,"column":1},"end":{"line":129,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"setting up an output data directory (will be created if it does not exist)","position":{"start":{"line":129,"column":1},"end":{"line":129,"column":1}},"key":"dFdM7xAdps"}],"key":"CRfUkZFfl2"}],"key":"tF7Q8kvrk4"},{"type":"listItem","spread":true,"position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"define the search radius around the target of interest to pull data from the Gaia catalog","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"LepI7dQ9we"}],"key":"Ctg6mbfu5p"}],"key":"da3PIwYT1C"},{"type":"listItem","spread":true,"position":{"start":{"line":131,"column":1},"end":{"line":132,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"define the cutout size that will be used to download a certain part of the Euclid ERO images","position":{"start":{"line":131,"column":1},"end":{"line":131,"column":1}},"key":"xk3u5hm6GB"}],"key":"v6j8M7nGKG"}],"key":"uMgclHnPR4"}],"key":"FtjVVnBAay"},{"type":"paragraph","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"children":[{"type":"text","value":"Finally, we also define the target of interest here. We can choose between two globular clusters, ","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"TtV6xjEFe8"},{"type":"strong","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"children":[{"type":"text","value":"NGC 6254","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"wxYxRyW0Po"}],"key":"h3mPJJgiOr"},{"type":"text","value":" and ","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"qvkfI4Ip2m"},{"type":"strong","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"children":[{"type":"text","value":"NGC6397","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"ZAgRJlM8CS"}],"key":"ZYd69WvjMQ"},{"type":"text","value":", both covered by the Euclid ERO data.","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"n7BLeLB1xX"}],"key":"CPrF93mTyD"},{"type":"paragraph","position":{"start":{"line":135,"column":1},"end":{"line":135,"column":1}},"children":[{"type":"text","value":"Note that ","position":{"start":{"line":135,"column":1},"end":{"line":135,"column":1}},"key":"LRBjAhS1vc"},{"type":"inlineCode","value":"astropy","position":{"start":{"line":135,"column":1},"end":{"line":135,"column":1}},"key":"EzzVlgDFHs"},{"type":"text","value":" units can be attached to the ","position":{"start":{"line":135,"column":1},"end":{"line":135,"column":1}},"key":"si6rQnrRpS"},{"type":"inlineCode","value":"search_radius","position":{"start":{"line":135,"column":1},"end":{"line":135,"column":1}},"key":"n0IqTx50qX"},{"type":"text","value":" and ","position":{"start":{"line":135,"column":1},"end":{"line":135,"column":1}},"key":"QBkrj8BHDi"},{"type":"inlineCode","value":"cutout_size","position":{"start":{"line":135,"column":1},"end":{"line":135,"column":1}},"key":"rDicLlhPop"},{"type":"text","value":".","position":{"start":{"line":135,"column":1},"end":{"line":135,"column":1}},"key":"bPhmz6AH1c"}],"key":"ezheKHVr3j"}],"key":"AtI1iwwR0O"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# create output directory\nif os.path.exists(\"./data/\"):\n    print(\"Output directory already created.\")\nelse:\n    print(\"Creating data directory.\")\n    os.mkdir(\"./data/\")\n\nsearch_radius = 1.5 * u.arcmin # search radius\ncutout_size = 1.5 * u.arcmin # cutout size\n\ncoord = SkyCoord.from_name('NGC 6397')","key":"PJ5NQDU89Y"},{"type":"output","id":"-KF-3Wp9B7o1VnmuA00Kb","data":[{"output_type":"stream","name":"stdout","text":"Creating data directory.\n"}],"key":"jOm7GQWqCP"}],"key":"TT1hWM4Ieu"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"text","value":"Search Euclid ERO Images","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"K0sJ6g2VBN"}],"identifier":"search-euclid-ero-images","label":"Search Euclid ERO Images","html_id":"search-euclid-ero-images","implicit":true,"key":"xWAsdkqsvt"},{"type":"paragraph","position":{"start":{"line":153,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"text","value":"Now, we search for the Euclid ERO images using the ","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"fn2QC9eRok"},{"type":"inlineCode","value":"astroquery","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"OK18Mdhby0"},{"type":"text","value":" package.\nNote that the Euclid ERO images are no in the cloud currently, but we access them directly from IRSA using IRSA’s ","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"bRnKYHwaw0"},{"type":"emphasis","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"children":[{"type":"text","value":"Simple Image Access","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"zsBCRXZD6X"}],"key":"mIOTFJCulK"},{"type":"text","value":" (SIA) methods.","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"wJzxGTYCq1"}],"key":"qZmuXYMZT1"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"EwUbxG46AS"}],"key":"EKE8HNjnLX"},{"type":"paragraph","position":{"start":{"line":157,"column":1},"end":{"line":157,"column":1}},"children":[{"type":"text","value":"The following only works for combined images (either extended or point source stacks). This would not work if there are multiple, let’s say, H-band images of Euclid at a given position. Therefore, no time domain studies here (which is anyway not one of the main goals of Euclid).","position":{"start":{"line":157,"column":1},"end":{"line":157,"column":1}},"key":"UbRwzsR6YQ"}],"key":"s38rSVd8jD"}],"key":"Rc0nnevS4h"},{"type":"comment","value":"The IRSA SIA products can be listed via\n ```\n Irsa.list_collections(servicetype='SIA')\n ```","position":{"start":{"line":160,"column":1},"end":{"line":163,"column":1}},"key":"o32FRT3hF7"},{"type":"paragraph","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"children":[{"type":"text","value":"Here we use the collection ","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"YS55vdEW54"},{"type":"emphasis","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"children":[{"type":"text","value":"euclid_ero","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"Huytu3nB8s"}],"key":"LIy67Ci1Xw"},{"type":"text","value":", containing the Euclid ERO images. We first create a ","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"XdFr6NYVVh"},{"type":"inlineCode","value":"SkyCoord","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"AH0fPmuypg"},{"type":"text","value":" object and then query the SIA.","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"HkOSMbi9WT"}],"key":"mRUSlL4UW0"}],"key":"Lm6EO4gv9d"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"image_tab = Irsa.query_sia(pos=(coord, search_radius), collection='euclid_ero')\nprint(\"Number of images available: {}\".format(len(image_tab)))","key":"sN3rTN0zJ1"},{"type":"output","id":"0XP8r4F37lj1ITIwLcJxX","data":[{"output_type":"stream","name":"stdout","text":"Number of images available: 25\n"}],"key":"tWJ6kT5JDj"}],"key":"zJpXeIhK1Z"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"children":[{"type":"text","value":"Sort the queried table by wavelength (column ","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"POgOqCH3cR"},{"type":"inlineCode","value":"em_min","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"X2Q23ac8nr"},{"type":"text","value":"). This allows us later when we plot the images to keep them sorted by wavelength (VIS, Y, J, H).","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"TBsejeYG6e"}],"key":"VnMw5aybQ3"}],"key":"r3aOxGlehh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"image_tab.sort('em_min')","key":"mFec0PNC5p"},{"type":"output","id":"Zp8Jb46GSh0aLw-E9chJu","data":[],"key":"OtD64xtMN9"}],"key":"soI1p7BdA7"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"children":[{"type":"text","value":"Let’s inspec the table that was downloaded.","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"key":"ipSH3ZBC5z"}],"key":"XiBozVmX7y"}],"key":"BvE1rofjPQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"image_tab[0:3]","key":"IaFviuXqE6"},{"type":"output","id":"hCi70RXvS7rGTeCcUE6BM","data":[{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"<Table length=3>\n    s_ra       s_dec    facility_name ... cloud_access o_ucd  upload_row_id\n    deg         deg                   ...                                  \n  float64     float64       object    ...    object    object     int64    \n----------- ----------- ------------- ... ------------ ------ -------------\n265.1744234 -53.6588139        Euclid ...           {}                    1\n265.1744234 -53.6588139        Euclid ...           {}                    1\n265.1744234 -53.6588139        Euclid ...           {}                    1","content_type":"text/plain"},"text/html":{"content":"<div><i>Table length=3</i>\n<table id=\"table140099201773696\" class=\"table-striped table-bordered table-condensed\">\n<thead><tr><th>s_ra</th><th>s_dec</th><th>facility_name</th><th>instrument_name</th><th>dataproduct_subtype</th><th>calib_level</th><th>dataproduct_type</th><th>energy_bandpassname</th><th>energy_emband</th><th>obs_id</th><th>s_resolution</th><th>em_min</th><th>em_max</th><th>em_res_power</th><th>proposal_title</th><th>access_url</th><th>access_format</th><th>access_estsize</th><th>t_exptime</th><th>s_region</th><th>obs_collection</th><th>obs_intent</th><th>algorithm_name</th><th>facility_keywords</th><th>instrument_keywords</th><th>environment_photometric</th><th>proposal_id</th><th>proposal_pi</th><th>proposal_project</th><th>target_name</th><th>target_type</th><th>target_standard</th><th>target_moving</th><th>target_keywords</th><th>obs_release_date</th><th>s_xel1</th><th>s_xel2</th><th>s_pixel_scale</th><th>position_timedependent</th><th>t_min</th><th>t_max</th><th>t_resolution</th><th>t_xel</th><th>obs_publisher_did</th><th>s_fov</th><th>em_xel</th><th>pol_states</th><th>pol_xel</th><th>cloud_access</th><th>o_ucd</th><th>upload_row_id</th></tr></thead>\n<thead><tr><th>deg</th><th>deg</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th>arcsec</th><th>m</th><th>m</th><th></th><th></th><th></th><th></th><th>kbyte</th><th>s</th><th>deg</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th>arcsec</th><th></th><th>d</th><th>d</th><th>s</th><th></th><th></th><th>deg</th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead>\n<thead><tr><th>float64</th><th>float64</th><th>object</th><th>object</th><th>object</th><th>int16</th><th>object</th><th>object</th><th>object</th><th>object</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>object</th><th>object</th><th>object</th><th>int64</th><th>float64</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>bool</th><th>object</th><th>object</th><th>object</th><th>object</th><th>object</th><th>bool</th><th>bool</th><th>object</th><th>object</th><th>int64</th><th>int64</th><th>float64</th><th>bool</th><th>float64</th><th>float64</th><th>float64</th><th>int64</th><th>object</th><th>float64</th><th>int64</th><th>object</th><th>int64</th><th>object</th><th>object</th><th>int64</th></tr></thead>\n<tr><td>265.1744234</td><td>-53.6588139</td><td>Euclid</td><td>VIS</td><td>science</td><td>3</td><td>image</td><td>VIS</td><td>Optical</td><td>VIS-ERO-NGC6397</td><td>0.16</td><td>5.5e-07</td><td>9e-07</td><td>2.1</td><td>Euclid Early Release Observations</td><td>https://irsa.ipac.caltech.edu/data/Euclid/ERO/images/NGC6397/ERO-NGC6397/Euclid-VIS-ERO-NGC6397-LSB.DR3.fits</td><td>image/fits</td><td>5184015</td><td>--</td><td>POLYGON ICRS 266.0282156 -54.1557675 266.0082 -53.1559013 264.3406 -53.1559013 264.3205844 -54.1557675 266.0282156 -54.1557675</td><td>euclid_ero</td><td>science</td><td>coadd</td><td></td><td></td><td>--</td><td></td><td></td><td>Euclid</td><td>NGC 6397</td><td>object</td><td>False</td><td>False</td><td></td><td>2024-05-23 00:00:00</td><td>36000</td><td>36000</td><td>0.1000000000008</td><td>False</td><td>--</td><td>--</td><td>--</td><td>--</td><td>ivo://irsa.ipac/euclid_ero?VIS-ERO-NGC6397/LSB</td><td>1.000000000008</td><td>--</td><td></td><td>--</td><td>{}</td><td></td><td>1</td></tr>\n<tr><td>265.1744234</td><td>-53.6588139</td><td>Euclid</td><td>VIS</td><td>weight</td><td>3</td><td>image</td><td>VIS</td><td>Optical</td><td>VIS-ERO-NGC6397</td><td>0.16</td><td>5.5e-07</td><td>9e-07</td><td>2.1</td><td>Euclid Early Release Observations</td><td>https://irsa.ipac.caltech.edu/data/Euclid/ERO/images/NGC6397/ERO-NGC6397/Euclid-VIS-ERO-NGC6397-Flattened.DR3.weight.fits</td><td>image/fits</td><td>5184009</td><td>--</td><td>POLYGON ICRS 266.0282156 -54.1557675 266.0082 -53.1559013 264.3406 -53.1559013 264.3205844 -54.1557675 266.0282156 -54.1557675</td><td>euclid_ero</td><td>science</td><td>coadd</td><td></td><td></td><td>--</td><td></td><td></td><td>Euclid</td><td>NGC 6397</td><td>object</td><td>False</td><td>False</td><td></td><td>2024-05-23 00:00:00</td><td>36000</td><td>36000</td><td>0.1000000000008</td><td>False</td><td>--</td><td>--</td><td>--</td><td>--</td><td>ivo://irsa.ipac/euclid_ero?VIS-ERO-NGC6397/Flattened</td><td>1.000000000008</td><td>--</td><td></td><td>--</td><td>{}</td><td></td><td>1</td></tr>\n<tr><td>265.1744234</td><td>-53.6588139</td><td>Euclid</td><td>VIS</td><td>auxiliary</td><td>3</td><td>image</td><td>VIS</td><td>Optical</td><td>VIS-ERO-NGC6397</td><td>0.16</td><td>5.5e-07</td><td>9e-07</td><td>2.1</td><td>Euclid Early Release Observations</td><td>https://irsa.ipac.caltech.edu/data/Euclid/ERO/images/NGC6397/ERO-NGC6397/Euclid-VIS-Mask-ERO-NGC6397-LSB.DR3.fits</td><td>image/fits</td><td>5184006</td><td>--</td><td>POLYGON ICRS 266.0282156 -54.1557675 266.0082 -53.1559013 264.3406 -53.1559013 264.3205844 -54.1557675 266.0282156 -54.1557675</td><td>euclid_ero</td><td>science</td><td>coadd</td><td></td><td></td><td>--</td><td></td><td></td><td>Euclid</td><td>NGC 6397</td><td>object</td><td>False</td><td>False</td><td></td><td>2024-05-23 00:00:00</td><td>36000</td><td>36000</td><td>0.1000000000008</td><td>False</td><td>--</td><td>--</td><td>--</td><td>--</td><td>ivo://irsa.ipac/euclid_ero?VIS-ERO-NGC6397/LSB</td><td>1.000000000008</td><td>--</td><td></td><td>--</td><td>{}</td><td></td><td>1</td></tr>\n</table></div>","content_type":"text/html"}}}],"key":"WgLdwoUELj"}],"key":"h4mxrkG7mx"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"Next, we add additional restrictions to narrow down the images.","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"ah2wu8l2es"}],"key":"L6h9TeYgrv"},{"type":"paragraph","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"children":[{"type":"text","value":"The Euclid ERO images come in two different flavors:","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"key":"hTSEkiDxxa"}],"key":"BsN6aldibV"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":187,"column":1},"end":{"line":189,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"children":[{"type":"paragraph","children":[{"type":"emphasis","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"children":[{"type":"text","value":"Flattened","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"ZjDoij7ATt"}],"key":"klDjOFUHqN"},{"type":"text","value":" images: idealized for compact sources (for example stars)","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"wkknfyuRXc"}],"key":"QvQUZURCVn"}],"key":"IZ5xHDubER"},{"type":"listItem","spread":true,"position":{"start":{"line":188,"column":1},"end":{"line":189,"column":1}},"children":[{"type":"paragraph","children":[{"type":"emphasis","position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"children":[{"type":"text","value":"LSB","position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"key":"muQAH5wQzj"}],"key":"NLkN71aL5F"},{"type":"text","value":" images: idealized for low surface brightness objects (for example galaxies)","position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"key":"Kos40r0ngN"}],"key":"Y9k4qihA0E"}],"key":"D4NZj1xCbk"}],"key":"GQhc6xnRxn"},{"type":"paragraph","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"children":[{"type":"text","value":"Maybe counter-intuitively, we select the ","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"eFRIxj2hOS"},{"type":"emphasis","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"children":[{"type":"text","value":"LSB","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"QzySjQEUhb"}],"key":"Sz9Yui80xw"},{"type":"text","value":" images here by checking if the file name given in the URL (","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"f5GqyMa0wR"},{"type":"inlineCode","value":"access_url","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"E6iHEzYTSL"},{"type":"text","value":" column) contains that key word. We found that the ","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"g8MxGN4eAX"},{"type":"emphasis","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"children":[{"type":"text","value":"Flattened","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"ypB8RV0tlU"}],"key":"nlDvp7zvRm"},{"type":"text","value":" images contain many masked pixels.","position":{"start":{"line":190,"column":1},"end":{"line":190,"column":1}},"key":"O85B81S6S0"}],"key":"SgOjnmKnaA"}],"key":"o9qIwCHVCY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#sel_basic = np.where( [\"Flattened\" in tt[\"access_url\"] for tt in image_tab] )[0]\nsel_basic = np.where( [\"LSB\" in tt[\"access_url\"] for tt in image_tab] )[0]\nimage_tab = image_tab[sel_basic]","key":"N5Ekdi8nHA"},{"type":"output","id":"OvYaMegG8t5FVqQIf0D1N","data":[],"key":"YyHjlgiNyi"}],"key":"ibmlMxPyZJ"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"children":[{"type":"text","value":"Next, we want to check what filteres are available. This can be done by ","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"OeHF2sEH9R"},{"type":"inlineCode","value":"np.unique()","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"ozatwd6LAK"},{"type":"text","value":", however, in that case it would sort the filters alphabetically. We want to keep the sorting based on the wavelength, therefore we opt for a more complicated way.","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"ZWUQTgxLYJ"}],"key":"StUbALf8eT"}],"key":"ftcPei6Zsa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"idxs = np.unique(image_tab[\"energy_bandpassname\"], return_index=True)[1]\nfilters = [image_tab[\"energy_bandpassname\"][idx] for idx in sorted(idxs)]\nprint(\"Filters: {}\".format(filters))","key":"hj0xP1LdGl"},{"type":"output","id":"OL9QTJNa1eFJERMDBpUQa","data":[{"output_type":"stream","name":"stdout","text":"Filters: ['VIS', 'Y', 'J', 'H']\n"}],"key":"jpxEW9gLjA"}],"key":"inUFkn5HpL"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":206,"column":1},"end":{"line":206,"column":1}},"children":[{"type":"text","value":"We can now loop throught the filters and collect the images to create a handy summary table with all the data we have. This way we will have an easier time to later access the data.","position":{"start":{"line":206,"column":1},"end":{"line":206,"column":1}},"key":"wB6hTZWLmE"}],"key":"xqAvQA1dhr"}],"key":"ah99hdP7MV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Create a dictionary with all the necessary information (science, weight, noise, mask)\nsummary_table = Table(names=[\"filter\",\"products\",\"facility_name\",\"instrument_name\"] , dtype=[str,str,str,str])\nfor filt in filters:\n    sel = np.where(image_tab['energy_bandpassname'] == filt)[0]\n    products = list( np.unique(image_tab[\"dataproduct_subtype\"][sel].value) )\n    if \"science\" in products: # sort so that science is the first in the list. This is the order we create the hdu extensions\n        products.remove(\"science\")\n        products.insert(0,\"science\")\n    else:\n        print(\"WARNING: no science image found!\")\n    print(products)\n\n    summary_table.add_row( [filt , \";\".join(products), str(np.unique(image_tab[\"facility_name\"][sel].value)[0]), str(np.unique(image_tab[\"instrument_name\"][sel].value)[0])] )","key":"JjZQHLeyEC"},{"type":"output","id":"XH06FABQ2gOanVJ4GbK7V","data":[{"output_type":"stream","name":"stdout","text":"['science', 'auxiliary']\n['science', 'auxiliary']\n['science', 'auxiliary']\n['science', 'auxiliary']\n"}],"key":"Qf7ZzUYlxU"}],"key":"Dh07421LVw"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":224,"column":1},"end":{"line":224,"column":1}},"children":[{"type":"text","value":"Let’s check out the summary table that we have created. We see that we have all the 4 Euclid bands and what data products are available for each of them.","position":{"start":{"line":224,"column":1},"end":{"line":224,"column":1}},"key":"XjR6pxprRL"}],"key":"IjNqfQtjam"}],"key":"XfVXUMasHb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"summary_table","key":"r9xyMQyKL3"},{"type":"output","id":"IKiW_HVJ4otaqMmqMXMW9","data":[{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/plain":{"content":"<Table length=4>\nfilter      products     facility_name instrument_name\n str3        str17            str6           str4     \n------ ----------------- ------------- ---------------\n   VIS science;auxiliary        Euclid             VIS\n     Y science;auxiliary        Euclid            NISP\n     J science;auxiliary        Euclid            NISP\n     H science;auxiliary        Euclid            NISP","content_type":"text/plain"},"text/html":{"content":"<div><i>Table length=4</i>\n<table id=\"table140099197501072\" class=\"table-striped table-bordered table-condensed\">\n<thead><tr><th>filter</th><th>products</th><th>facility_name</th><th>instrument_name</th></tr></thead>\n<thead><tr><th>str3</th><th>str17</th><th>str6</th><th>str4</th></tr></thead>\n<tr><td>VIS</td><td>science;auxiliary</td><td>Euclid</td><td>VIS</td></tr>\n<tr><td>Y</td><td>science;auxiliary</td><td>Euclid</td><td>NISP</td></tr>\n<tr><td>J</td><td>science;auxiliary</td><td>Euclid</td><td>NISP</td></tr>\n<tr><td>H</td><td>science;auxiliary</td><td>Euclid</td><td>NISP</td></tr>\n</table></div>","content_type":"text/html"}}}],"key":"XSRYvo9feB"}],"key":"nOECUknzIh"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"children":[{"type":"text","value":"Create Cutout Images","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"LVjKGBqGJ6"}],"identifier":"create-cutout-images","label":"Create Cutout Images","html_id":"create-cutout-images","implicit":true,"key":"o03mi1q0bd"},{"type":"paragraph","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"children":[{"type":"text","value":"Now that we have a list of data products, we can create the cutouts. This is important as the full Euclid ERO images would be too large to run extraction and photometry software on them (they would simply fail due to memory issues).","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"g2CzpUndey"}],"key":"HvxazX9uNC"},{"type":"paragraph","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"children":[{"type":"text","value":"For each image, we create a cutout around the target of interest, using the ","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"KIFfH1knGB"},{"type":"inlineCode","value":"cutout_size","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"CjZPo6QwlJ"},{"type":"text","value":" defined above. The cutouts are then collected into HDUs. That way we can easily access the different data products. Note that we only use the ","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"F44fBrMbxa"},{"type":"emphasis","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"children":[{"type":"text","value":"science","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"YrLsLRAByS"}],"key":"jDk6hHHk9V"},{"type":"text","value":" products as the ","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"c9dEs0JAFn"},{"type":"emphasis","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"children":[{"type":"text","value":"ancillary","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"wWVXtuZTJy"}],"key":"DTP2DNhfE1"},{"type":"text","value":" products are not needed.","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"bkNcOA7K7w"}],"key":"k9fyWPb5JT"},{"type":"paragraph","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"children":[{"type":"text","value":"We save the HDU to disk as it will be later used when we visualize the Euclid ERO FITS images in ","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"key":"XokaNfnFSd"},{"type":"inlineCode","value":"Firefly","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"key":"VDb3J54BhI"},{"type":"text","value":".","position":{"start":{"line":236,"column":1},"end":{"line":236,"column":1}},"key":"XsfI4xijYu"}],"key":"vb7QWlRxy5"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"OwgoiOujJV"}],"key":"t6sui9qdlN"},{"type":"paragraph","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"You will notice that ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"OK2bFRkYGs"},{"type":"inlineCode","value":"Cutout2D","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"nxDmDiV4FC"},{"type":"text","value":" can be applied to an URL. That way, it we do not need to download the full image to create a cutout. This is a useful trick to keep in mind when analyzing large images. This makes creating cutout images very fast.","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"eFcPOLP9Zk"}],"key":"e8Mweg3hKS"}],"key":"bH32noxI2J"}],"key":"SArmE9DdO9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\nfor ii,filt in tqdm(enumerate(filters)):\n    products = summary_table[summary_table[\"filter\"] == filt][\"products\"][0].split(\";\")\n\n    for product in products:\n        sel = np.where( (image_tab[\"energy_bandpassname\"] == filt) & (image_tab[\"dataproduct_subtype\"] == product) )[0]\n\n        with fits.open(image_tab['access_url'][sel[0]], use_fsspec=True) as hdul:\n            tmp = Cutout2D(hdul[0].section, position=coord, size=cutout_size, wcs=WCS(hdul[0].header)) # create cutout\n\n\n            if (product == \"science\") & (ii == 0): # if science image, then create a new hdu.\n                hdu0 = fits.PrimaryHDU(data = tmp.data, header=hdul[0].header)\n                hdu0.header.update(tmp.wcs.to_header()) # update header with WCS info\n                hdu0.header[\"EXTNAME\"] = \"{}_{}\".format(filt,product.upper())\n                hdu0.header[\"PRODUCT\"] = product.upper()\n                hdu0.header[\"FILTER\"] = filt.upper()\n                hdulcutout = fits.HDUList([hdu0])\n            elif (product == \"science\") & (ii > 0):\n                hdu = fits.ImageHDU(data = tmp.data, header=hdul[0].header)\n                hdu.header.update(tmp.wcs.to_header()) # update header with WCS info\n                hdu.header[\"EXTNAME\"] = \"{}_{}\".format(filt,product.upper())\n                hdu.header[\"PRODUCT\"] = product.upper()\n                hdu.header[\"FILTER\"] = filt.upper()\n                hdulcutout.append(hdu)\n\n## Save the HDUL cube:\nhdulcutout.writeto(\"./data/euclid_images_test.fits\", overwrite=True)","key":"Ad77K2xgVD"},{"type":"output","id":"oQDCX5GsZHkgB7_G5hqI_","data":[{"output_type":"stream","name":"stderr","text":"\r0it [00:00, ?it/s]"},{"output_type":"stream","name":"stderr","text":"\r1it [00:17, 17.56s/it]"},{"output_type":"stream","name":"stderr","text":"\r2it [00:19,  8.38s/it]"},{"output_type":"stream","name":"stderr","text":"\r3it [00:22,  5.85s/it]"},{"output_type":"stream","name":"stderr","text":"\r4it [00:24,  4.25s/it]"},{"output_type":"stream","name":"stderr","text":"\r4it [00:24,  6.04s/it]"},{"output_type":"stream","name":"stdout","text":"CPU times: user 1.68 s, sys: 454 ms, total: 2.14 s\nWall time: 24.3 s\n"},{"output_type":"stream","name":"stderr","text":"\n"}],"key":"Qz8Xx52p2e"}],"key":"LEQt1q5Xoe"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":273,"column":1},"end":{"line":273,"column":1}},"children":[{"type":"text","value":"Let’s look at the HDU that we created to check what information we have. You see that all filters are collected in different extensions. Also note the different dimensions of the FITS layers as the pixel scale of VIS and NISP are different.","position":{"start":{"line":273,"column":1},"end":{"line":273,"column":1}},"key":"OzB7rS0spk"}],"key":"nzQV4OPL58"}],"key":"ETvzEcznHo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"hdulcutout.info()","key":"J2GoFF9M6z"},{"type":"output","id":"WPKKKx0Cj98hu2oVfNa0B","data":[{"output_type":"stream","name":"stdout","text":"Filename: (No file associated with this HDUList)\nNo.    Name      Ver    Type      Cards   Dimensions   Format\n  0  VIS_SCIENCE    1 PrimaryHDU     190   (900, 900)   float32   \n  1  Y_SCIENCE     1 ImageHDU       191   (300, 300)   float32   \n  2  J_SCIENCE     1 ImageHDU       191   (300, 300)   float32   \n  3  H_SCIENCE     1 ImageHDU       191   (300, 300)   float32   \n"}],"key":"DVMqRZa7Cm"}],"key":"PbuH4X40on"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"children":[{"type":"text","value":"We can now plot the image cutouts that we generated. The globular cluster is clearly visible.","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"Nx5OXgFpae"}],"key":"piPCLQ6ov9"}],"key":"id8Fgs17yg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"nimages = len(filters) # number of images\nncols = int(4) # number of columns\nnrows = int( nimages // ncols ) # number of rows\n\nfig = plt.figure(figsize = (5*ncols,5*nrows) )\naxs = [fig.add_subplot(nrows,ncols,ii+1) for ii in range(nimages)]\n\nfor ii,filt in enumerate(filters):\n    img = hdulcutout[\"{}_SCIENCE\".format(filt)].data\n    axs[ii].imshow(img , origin=\"lower\")\n    axs[ii].text(0.05,0.05 , \"{} ({}/{})\".format(summary_table[\"facility_name\"][ii],summary_table[\"instrument_name\"][ii],filt) , fontsize=14 , color=\"white\",\n                 va=\"bottom\", ha=\"left\" , transform=axs[ii].transAxes)\n\nplt.show()","key":"w1a4fSyP3v"},{"type":"output","id":"pRsSYaZdG6N91zVRzGI0l","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 2000x500 with 4 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"8a9efd35bd69fb89255c3f362485d5f6","path":"/irsa-tutorials/build/8a9efd35bd69fb89255c3f362485d5f6.png"}}}],"key":"kuxaqzYPkv"}],"key":"Cc2wmCizMZ"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"children":[{"type":"text","value":"Extract Sources and Measure their Photometry on the VIS Image","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"jI78MMrWXs"}],"identifier":"extract-sources-and-measure-their-photometry-on-the-vis-image","label":"Extract Sources and Measure their Photometry on the VIS Image","html_id":"extract-sources-and-measure-their-photometry-on-the-vis-image","implicit":true,"key":"Nx1N5ty1x7"},{"type":"paragraph","position":{"start":{"line":300,"column":1},"end":{"line":301,"column":1}},"children":[{"type":"text","value":"Now that we have the images in memory (and on disk - but we do not need them, yet), we can measure the fluxes of the individual stars.\nOur simple photometry pipeline has different parts:","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"LH7kolq4OE"}],"key":"gChhEoMhgM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":303,"column":1},"end":{"line":306,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"First, we are using the Python package ","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"vim3JsYuY7"},{"type":"inlineCode","value":"sep","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"kWc60IJDpI"},{"type":"text","value":" (similar to SExtractor) to extract the position of the sources. We do that on the VIS image, which provides the highest resolution.","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"PFDiSOGG3m"}],"key":"GVaNb77nhf"}],"key":"dj0SuFOKCK"},{"type":"listItem","spread":true,"position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Second, we use ","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"zgolLD9Jc2"},{"type":"inlineCode","value":"sep","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"AJwa8L56CO"},{"type":"text","value":" to perform aperture measurements of the photometry. We will use that to compare the obtained fluxes to our forced photometry method","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"Lw30qFftjx"}],"key":"WSc9ocSE4I"}],"key":"uRFoLSEhl5"},{"type":"listItem","spread":true,"position":{"start":{"line":305,"column":1},"end":{"line":306,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Third, we apply a PSF fitting technique (using the ","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"AtLg7DIrMN"},{"type":"inlineCode","value":"photutils","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"rNASbS20jc"},{"type":"text","value":" Python package) to improve the photometry measurement","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"vAXeW1qoZh"}],"key":"fPv5i8re4s"}],"key":"oxAGNWCsWu"}],"key":"rHjEmDeAcj"}],"key":"tzulfzNrMU"},{"type":"block","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"children":[{"type":"text","value":"We start by extracting the sources using ","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"key":"d4NI0tDJbx"},{"type":"inlineCode","value":"sep","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"key":"xedkuHdaWF"},{"type":"text","value":". We first isolate the data that we want to look at (the VIS image only).","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"key":"T7lddlbFTJ"}],"key":"gTjCl9DzmL"}],"key":"xUan9lIwiA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"## Get Data (this will be replaced later)\nimg = hdulcutout[\"VIS_SCIENCE\"].data\nhdr = hdulcutout[\"VIS_SCIENCE\"].header\nimg[img == 0] = np.nan","key":"vDUbvmgx1x"},{"type":"output","id":"K1_qsrcuIrHmCNP7kYLX5","data":[],"key":"XPglspvLkT"}],"key":"goSommZPbn"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":318,"column":1},"end":{"line":318,"column":1}},"children":[{"type":"text","value":"There are some NaN value on the image that we need to mask out. For this we create a mask image that we later feed to ","position":{"start":{"line":318,"column":1},"end":{"line":318,"column":1}},"key":"usqRI8p764"},{"type":"inlineCode","value":"sep","position":{"start":{"line":318,"column":1},"end":{"line":318,"column":1}},"key":"U1X9Vt5jdw"},{"type":"text","value":".","position":{"start":{"line":318,"column":1},"end":{"line":318,"column":1}},"key":"lGguF57dBf"}],"key":"TNmjnhvEbh"}],"key":"kUq5Ulwm9L"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"mask = np.isnan(img)","key":"aOWhSPThQ6"},{"type":"output","id":"dbyTElOggkBPJqJOAQB9s","data":[],"key":"L53Vh1KE2h"}],"key":"UAZYMbOALD"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":324,"column":1},"end":{"line":324,"column":1}},"children":[{"type":"text","value":"Next, we compute the background statistics what will be used by ","position":{"start":{"line":324,"column":1},"end":{"line":324,"column":1}},"key":"h4xWmP0gsJ"},{"type":"inlineCode","value":"sep","position":{"start":{"line":324,"column":1},"end":{"line":324,"column":1}},"key":"w7rFgAcves"},{"type":"text","value":" to extract the sources above a certain threshold.","position":{"start":{"line":324,"column":1},"end":{"line":324,"column":1}},"key":"igevEphWXC"}],"key":"kq0HrjGb9z"}],"key":"zpkNlf6Oye"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"mean, median, std = sigma_clipped_stats(img, sigma=3.0)\nprint(np.array((mean, median, std)))","key":"n87EOz2Xy4"},{"type":"output","id":"5vp9NLiCeR0nvoFkqAg90","data":[{"output_type":"stream","name":"stdout","text":"[135.95871  99.62191 100.63356]\n"},{"output_type":"stream","name":"stderr","text":"WARNING: Input data contains invalid values (NaNs or infs), which were automatically clipped. [astropy.stats.sigma_clipping]\n"}],"key":"EPJPbAnT5t"}],"key":"B4KCVpOLhf"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"children":[{"type":"text","value":"Finally, we perform object detection with ","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"OjOKkixIlj"},{"type":"inlineCode","value":"sep","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"Z7N9XBIaKf"},{"type":"text","value":". There are also modules in ","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"F8kpbrQOS2"},{"type":"inlineCode","value":"photutils","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"nQG9L67cfG"},{"type":"text","value":" to do that, however, we found that ","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"EC6WA68o2y"},{"type":"inlineCode","value":"sep","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"forebwsiKC"},{"type":"text","value":" works best here. We output the number of objects found on the image.","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"eXrvYN3sQU"}],"key":"fyMlZPiYMZ"}],"key":"C0pVuH6ORn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"objects = sep.extract(img-median, thresh=1.2, err=std, minarea=3, mask=mask, deblend_cont=0.0002, deblend_nthresh=64 )\nprint(\"Number of sources extracted: \", len(objects))","key":"XCCbXUCe9X"},{"type":"output","id":"Z59FHTzh8OJsQbdbd4FRl","data":[{"output_type":"stream","name":"stdout","text":"Number of sources extracted:  2759\n"}],"key":"z755xcpIFb"}],"key":"RbVg1uRyqG"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"children":[{"type":"text","value":"Next, we perform simple aperture photometry on the detected sources. Again, we use the ","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"UXiUiK5yQ4"},{"type":"inlineCode","value":"sep","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"jkqi4r2Sf8"},{"type":"text","value":" package for this. We will use these aperture photometry later to compare to the PSF photometry.","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"hopWJTCUll"}],"key":"FiqrjmsMmK"}],"key":"M7oZa9rQ0z"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"flux, fluxerr, flag = sep.sum_circle(img-median, objects['x'], objects['y'],r=3.0, err=std, gain=1.0)","key":"arEVrw09y9"},{"type":"output","id":"RjXaldFRtXapvjvxLWtoQ","data":[],"key":"dfmLKneeZv"}],"key":"JJjE8gzVbY"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"children":[{"type":"text","value":"Now, we use the ","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"key":"MWsb07LwIf"},{"type":"inlineCode","value":"photutils","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"key":"VICTtMAzs0"},{"type":"text","value":" Python package to perform PSF fitting. Here we assume a simple Gaussian with a FWHM given by ","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"key":"aqoJQE7knJ"},{"type":"inlineCode","value":"psf_fwhm","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"key":"bSSSh6DcIE"},{"type":"text","value":" as PSF.","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"key":"o95FTUQlki"}],"key":"o1YMl4jcbJ"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"dCZtyg9zJm"}],"key":"XVDojWOjE6"},{"type":"paragraph","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"children":[{"type":"text","value":"We use a Gaussian PSF here for simplicity. The photometry can be improved by using a pixelated PSF measured directly from the Euclid images (for example by stacking stars).","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"key":"mnbhGTTHtt"}],"key":"QjC7Nx3dZS"}],"key":"vFxQk2lZP8"}],"key":"iWMjKk1sZ5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"psf_fwhm = 0.16 # PSF FWHM in arcsec\npixscale = 0.1 # VIS pixel scale in arcsec/px\n\ninit_params = Table([objects[\"x\"],objects[\"y\"]] , names=[\"x\",\"y\"]) # initial positions\npsf_model = CircularGaussianSigmaPRF(flux=1, sigma=psf_fwhm/pixscale / 2.35)\npsf_model.x_0.fixed = True\npsf_model.y_0.fixed = True\npsf_model.sigma.fixed = False\nfit_shape = (5, 5)\npsfphot = PSFPhotometry(psf_model,\n                        fit_shape,\n                        finder = DAOStarFinder(fwhm=0.1, threshold=3.*std, exclude_border=True), # not needed because we are using fixed initial positions.\n                        aperture_radius = 4,\n                        progress_bar = True)","key":"KIhJCLUxj4"},{"type":"output","id":"xPAsZhF6z9N5xgpghIrbU","data":[],"key":"ybhjjxb85X"}],"key":"HEO74QcDMe"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"children":[{"type":"text","value":"After initiating the ","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"key":"oeJNmm23oM"},{"type":"inlineCode","value":"PSFPhotometry","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"key":"Q2FkURotQ4"},{"type":"text","value":" object, we can run the PSF photometry measurement. This can take a while (typically between 1 and 2 minutes).","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"key":"ju8rIOKmpT"}],"key":"NePQdF8vmE"}],"key":"mvlibJHqDC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"phot = psfphot(img-median, error=None, mask=mask, init_params=init_params)","key":"uzOz2g3QRx"},{"type":"output","id":"BsevhKRdVaRLy54cJFTTb","data":[{"output_type":"stream","name":"stderr","text":"\rFit source/group:   0%|          | 0/2759 [00:00<?, ?it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   0%|          | 11/2759 [00:00<00:25, 106.36it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   1%|          | 26/2759 [00:00<00:21, 126.46it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   1%|▏         | 39/2759 [00:00<00:21, 125.93it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   2%|▏         | 54/2759 [00:00<00:20, 131.59it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   3%|▎         | 70/2759 [00:00<00:19, 140.92it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   3%|▎         | 85/2759 [00:00<00:20, 128.03it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   4%|▎         | 101/2759 [00:00<00:19, 136.06it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   4%|▍         | 117/2759 [00:00<00:18, 141.60it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   5%|▍         | 132/2759 [00:00<00:18, 142.94it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   5%|▌         | 147/2759 [00:01<00:18, 142.86it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   6%|▌         | 162/2759 [00:01<00:18, 140.01it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   6%|▋         | 177/2759 [00:01<00:18, 139.05it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   7%|▋         | 192/2759 [00:01<00:18, 139.94it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   8%|▊         | 207/2759 [00:01<00:18, 141.44it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   8%|▊         | 222/2759 [00:01<00:17, 141.94it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   9%|▊         | 237/2759 [00:01<00:17, 143.26it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   9%|▉         | 253/2759 [00:01<00:17, 145.35it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  10%|▉         | 268/2759 [00:01<00:17, 142.24it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  10%|█         | 283/2759 [00:02<00:17, 141.30it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  11%|█         | 298/2759 [00:02<00:17, 140.54it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  11%|█▏        | 314/2759 [00:02<00:16, 144.40it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  12%|█▏        | 329/2759 [00:02<00:16, 144.19it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  13%|█▎        | 346/2759 [00:02<00:16, 148.43it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  13%|█▎        | 363/2759 [00:02<00:15, 153.29it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  14%|█▎        | 379/2759 [00:02<00:17, 133.13it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  14%|█▍        | 394/2759 [00:02<00:17, 134.66it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  15%|█▍        | 411/2759 [00:02<00:16, 142.87it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  16%|█▌        | 428/2759 [00:03<00:15, 148.79it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  16%|█▌        | 445/2759 [00:03<00:15, 153.73it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  17%|█▋        | 462/2759 [00:03<00:14, 156.64it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  17%|█▋        | 479/2759 [00:03<00:14, 158.20it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  18%|█▊        | 495/2759 [00:03<00:14, 157.62it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  19%|█▊        | 513/2759 [00:03<00:13, 161.95it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  19%|█▉        | 530/2759 [00:03<00:14, 158.29it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  20%|█▉        | 546/2759 [00:03<00:14, 156.64it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  20%|██        | 562/2759 [00:03<00:13, 156.95it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  21%|██        | 578/2759 [00:03<00:13, 157.71it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  22%|██▏       | 596/2759 [00:04<00:13, 162.87it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  22%|██▏       | 613/2759 [00:04<00:14, 153.15it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  23%|██▎       | 629/2759 [00:04<00:14, 148.92it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  23%|██▎       | 645/2759 [00:04<00:14, 150.79it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  24%|██▍       | 663/2759 [00:04<00:13, 157.53it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  25%|██▍       | 679/2759 [00:04<00:14, 143.19it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  25%|██▌       | 695/2759 [00:04<00:14, 145.93it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  26%|██▌       | 711/2759 [00:04<00:13, 148.58it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  26%|██▋       | 727/2759 [00:04<00:13, 148.31it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  27%|██▋       | 742/2759 [00:05<00:13, 148.12it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  27%|██▋       | 757/2759 [00:05<00:13, 146.87it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  28%|██▊       | 772/2759 [00:05<00:14, 141.90it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  29%|██▊       | 789/2759 [00:05<00:13, 149.73it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  29%|██▉       | 806/2759 [00:05<00:12, 154.62it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  30%|██▉       | 822/2759 [00:05<00:12, 153.10it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  30%|███       | 838/2759 [00:05<00:12, 153.79it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  31%|███       | 855/2759 [00:05<00:12, 156.72it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  32%|███▏      | 873/2759 [00:05<00:11, 161.33it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  32%|███▏      | 891/2759 [00:06<00:11, 164.30it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  33%|███▎      | 908/2759 [00:06<00:11, 161.41it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  34%|███▎      | 925/2759 [00:06<00:11, 163.05it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  34%|███▍      | 942/2759 [00:06<00:11, 158.65it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  35%|███▍      | 958/2759 [00:06<00:13, 138.30it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  35%|███▌      | 976/2759 [00:06<00:12, 148.28it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  36%|███▌      | 992/2759 [00:06<00:11, 148.34it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  37%|███▋      | 1008/2759 [00:06<00:11, 146.27it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  37%|███▋      | 1025/2759 [00:06<00:11, 149.17it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  38%|███▊      | 1042/2759 [00:07<00:11, 154.79it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  38%|███▊      | 1058/2759 [00:07<00:10, 154.76it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  39%|███▉      | 1076/2759 [00:07<00:10, 161.29it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  40%|███▉      | 1094/2759 [00:07<00:10, 166.33it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  40%|████      | 1112/2759 [00:07<00:09, 169.86it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  41%|████      | 1130/2759 [00:07<00:09, 172.10it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  42%|████▏     | 1148/2759 [00:07<00:09, 171.68it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  42%|████▏     | 1166/2759 [00:07<00:09, 173.62it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  43%|████▎     | 1184/2759 [00:07<00:09, 173.78it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  44%|████▎     | 1202/2759 [00:07<00:09, 167.14it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  44%|████▍     | 1219/2759 [00:08<00:09, 164.65it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  45%|████▍     | 1236/2759 [00:08<00:09, 162.56it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  45%|████▌     | 1254/2759 [00:08<00:09, 166.28it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  46%|████▌     | 1272/2759 [00:08<00:08, 167.98it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  47%|████▋     | 1289/2759 [00:08<00:08, 165.65it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  47%|████▋     | 1306/2759 [00:08<00:08, 165.36it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  48%|████▊     | 1323/2759 [00:08<00:08, 160.15it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  49%|████▊     | 1340/2759 [00:08<00:08, 158.44it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  49%|████▉     | 1356/2759 [00:08<00:09, 154.30it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  50%|████▉     | 1372/2759 [00:09<00:09, 152.32it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  50%|█████     | 1388/2759 [00:09<00:09, 142.58it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  51%|█████     | 1403/2759 [00:09<00:09, 137.88it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  51%|█████▏    | 1417/2759 [00:09<00:10, 132.36it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  52%|█████▏    | 1435/2759 [00:09<00:09, 143.24it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  53%|█████▎    | 1455/2759 [00:09<00:08, 156.97it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  53%|█████▎    | 1474/2759 [00:09<00:07, 163.43it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  54%|█████▍    | 1491/2759 [00:09<00:07, 162.79it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  55%|█████▍    | 1508/2759 [00:09<00:07, 162.69it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  55%|█████▌    | 1525/2759 [00:10<00:08, 143.58it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  56%|█████▌    | 1544/2759 [00:10<00:07, 154.42it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  57%|█████▋    | 1563/2759 [00:10<00:07, 161.81it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  57%|█████▋    | 1580/2759 [00:10<00:07, 162.43it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  58%|█████▊    | 1598/2759 [00:10<00:06, 165.94it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  59%|█████▊    | 1615/2759 [00:10<00:07, 156.38it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  59%|█████▉    | 1631/2759 [00:10<00:07, 156.08it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  60%|█████▉    | 1647/2759 [00:10<00:07, 153.01it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  60%|██████    | 1665/2759 [00:10<00:06, 157.23it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  61%|██████    | 1682/2759 [00:11<00:06, 157.60it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  62%|██████▏   | 1698/2759 [00:11<00:06, 153.94it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  62%|██████▏   | 1715/2759 [00:11<00:06, 157.13it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  63%|██████▎   | 1731/2759 [00:11<00:06, 154.14it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  63%|██████▎   | 1747/2759 [00:11<00:07, 142.30it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  64%|██████▍   | 1762/2759 [00:11<00:06, 142.83it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  64%|██████▍   | 1777/2759 [00:11<00:07, 137.16it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  65%|██████▌   | 1795/2759 [00:11<00:06, 148.03it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  66%|██████▌   | 1811/2759 [00:11<00:06, 150.09it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  66%|██████▌   | 1827/2759 [00:12<00:06, 148.86it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  67%|██████▋   | 1846/2759 [00:12<00:05, 158.22it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  67%|██████▋   | 1862/2759 [00:12<00:05, 158.50it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  68%|██████▊   | 1878/2759 [00:12<00:05, 156.97it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  69%|██████▊   | 1894/2759 [00:12<00:05, 157.70it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  69%|██████▉   | 1911/2759 [00:12<00:05, 159.09it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  70%|██████▉   | 1929/2759 [00:12<00:05, 163.17it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  71%|███████   | 1946/2759 [00:12<00:05, 161.30it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  71%|███████   | 1963/2759 [00:12<00:04, 160.58it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  72%|███████▏  | 1980/2759 [00:13<00:06, 125.38it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  72%|███████▏  | 1994/2759 [00:13<00:06, 123.82it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  73%|███████▎  | 2012/2759 [00:13<00:05, 133.36it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  74%|███████▎  | 2032/2759 [00:13<00:04, 149.12it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  74%|███████▍  | 2049/2759 [00:13<00:04, 152.76it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  75%|███████▍  | 2067/2759 [00:13<00:04, 159.35it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  76%|███████▌  | 2084/2759 [00:13<00:04, 139.55it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  76%|███████▌  | 2100/2759 [00:13<00:04, 143.99it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  77%|███████▋  | 2116/2759 [00:13<00:04, 148.19it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  77%|███████▋  | 2134/2759 [00:14<00:03, 156.58it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  78%|███████▊  | 2152/2759 [00:14<00:03, 161.03it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  79%|███████▊  | 2172/2759 [00:14<00:03, 169.45it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  79%|███████▉  | 2191/2759 [00:14<00:03, 173.65it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  80%|████████  | 2210/2759 [00:14<00:03, 178.35it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  81%|████████  | 2230/2759 [00:14<00:02, 183.74it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  82%|████████▏ | 2249/2759 [00:14<00:02, 182.56it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  82%|████████▏ | 2270/2759 [00:14<00:02, 189.72it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  83%|████████▎ | 2290/2759 [00:14<00:02, 184.69it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  84%|████████▎ | 2309/2759 [00:15<00:02, 184.63it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  84%|████████▍ | 2328/2759 [00:15<00:02, 179.53it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  85%|████████▌ | 2347/2759 [00:15<00:02, 177.07it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  86%|████████▌ | 2367/2759 [00:15<00:02, 182.71it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  86%|████████▋ | 2386/2759 [00:15<00:02, 181.08it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  87%|████████▋ | 2406/2759 [00:15<00:01, 183.12it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  88%|████████▊ | 2425/2759 [00:15<00:01, 184.87it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  89%|████████▊ | 2444/2759 [00:15<00:02, 155.15it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  89%|████████▉ | 2462/2759 [00:15<00:01, 160.76it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  90%|████████▉ | 2481/2759 [00:16<00:01, 166.99it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  91%|█████████ | 2499/2759 [00:16<00:02, 127.00it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  91%|█████████ | 2516/2759 [00:16<00:01, 135.46it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  92%|█████████▏| 2532/2759 [00:16<00:01, 113.50it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  92%|█████████▏| 2550/2759 [00:16<00:01, 127.24it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  93%|█████████▎| 2565/2759 [00:16<00:01, 121.85it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  93%|█████████▎| 2579/2759 [00:17<00:01, 103.91it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  94%|█████████▍| 2591/2759 [00:17<00:01, 92.45it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  94%|█████████▍| 2606/2759 [00:17<00:01, 94.83it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  95%|█████████▍| 2617/2759 [00:17<00:01, 86.10it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  95%|█████████▌| 2628/2759 [00:17<00:01, 85.88it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  96%|█████████▌| 2637/2759 [00:17<00:01, 85.68it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  96%|█████████▌| 2646/2759 [00:17<00:01, 85.02it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  96%|█████████▌| 2655/2759 [00:17<00:01, 84.69it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  97%|█████████▋| 2668/2759 [00:18<00:01, 88.33it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  97%|█████████▋| 2682/2759 [00:18<00:00, 100.46it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  98%|█████████▊| 2693/2759 [00:18<00:01, 65.18it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  98%|█████████▊| 2702/2759 [00:18<00:00, 69.09it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  98%|█████████▊| 2711/2759 [00:18<00:00, 72.96it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  99%|█████████▊| 2723/2759 [00:18<00:00, 73.19it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  99%|█████████▉| 2735/2759 [00:18<00:00, 82.94it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group: 100%|█████████▉| 2748/2759 [00:19<00:00, 92.64it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group: 100%|██████████| 2759/2759 [00:19<00:00, 143.91it/s]"},{"output_type":"stream","name":"stderr","text":"\n"},{"output_type":"stream","name":"stderr","text":"WARNING: One or more fit(s) may not have converged. Please check the \"flags\" column in the output table. [photutils.psf._components]\n"}],"key":"x7EO62FSOh"}],"key":"TZIAXELnOK"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"children":[{"type":"text","value":"Once this is done, we can create a residual image.","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"wE3O3Vd9az"}],"key":"ge728yQO2J"}],"key":"dAADFGoBb7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"resimage = psfphot.make_residual_image(data = img-median, psf_shape = (9, 9))","key":"w5GNkMONXJ"},{"type":"output","id":"CEy38QnR66YPzaBiOSF1Y","data":[{"output_type":"stream","name":"stderr","text":"\rAdd model sources:   0%|          | 0/2759 [00:00<?, ?it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources:  11%|█         | 294/2759 [00:00<00:00, 2932.57it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources:  21%|██▏       | 592/2759 [00:00<00:00, 2959.23it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources:  32%|███▏      | 888/2759 [00:00<00:00, 2949.16it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources:  43%|████▎     | 1187/2759 [00:00<00:00, 2963.45it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources:  54%|█████▍    | 1491/2759 [00:00<00:00, 2989.83it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources:  65%|██████▌   | 1794/2759 [00:00<00:00, 3000.38it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources:  76%|███████▌  | 2095/2759 [00:00<00:00, 2990.07it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources:  87%|████████▋ | 2399/2759 [00:00<00:00, 3003.46it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources:  98%|█████████▊| 2705/2759 [00:00<00:00, 3018.41it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources: 100%|██████████| 2759/2759 [00:00<00:00, 2989.09it/s]"},{"output_type":"stream","name":"stderr","text":"\n"}],"key":"mc3Cdmd2G4"}],"key":"jiF6CHjqyE"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"children":[{"type":"text","value":"We now want to add the best-fit coordinates (R.A. and Decl.) to the VIS photometry catalog. For this, we have to convert the image coordinates into sky coordinates using the WCS information. We will need these coordinates because we want to use them as positional priors for the photometry measurement on the NISP images.","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"ZZvUJN7EzU"}],"key":"xgvmexyV2s"}],"key":"MT9NxHIDi7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"## Add coordinates to catalog\nwcs1 = WCS(hdr) # VIS\nradec = wcs1.all_pix2world(phot[\"x_fit\"],phot[\"y_fit\"],0)\nphot[\"ra_fit\"] = radec[0]\nphot[\"dec_fit\"] = radec[1]","key":"Ho3EpXa5Et"},{"type":"output","id":"2owQGl39T_C_Y2J2bPP5c","data":[],"key":"FKc32Plk38"}],"key":"cogVCYVmWp"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"children":[{"type":"text","value":"Finally, we plot the VIS image and the residual with the extracted sources overlaid.","position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"key":"fwiwI2X6W5"}],"key":"Pt7dn8zFOv"}],"key":"blqyG1bzqx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(20,10))\nax1 = fig.add_subplot(1,2,1)\nax2 = fig.add_subplot(1,2,2)\nax1.imshow(np.log10(img), cmap=\"Greys\", origin=\"lower\")\nax1.plot(phot[\"x_fit\"], phot[\"y_fit\"] , \"o\", markersize=8 , markeredgecolor=\"red\", fillstyle=\"none\")\n\nax2.imshow(resimage,vmin=-5*std, vmax=5*std, cmap=\"RdBu\", origin=\"lower\")\nax2.plot(phot[\"x_fit\"], phot[\"y_fit\"] , \"o\", markersize=8 , markeredgecolor=\"red\", fillstyle=\"none\")\n\nplt.show()","key":"rLZx1CUcjB"},{"type":"output","id":"5ZYLZw8BNkheiTbLkQ6be","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 2000x1000 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"259d0a3dd736cf4fec47882dffdd7017","path":"/irsa-tutorials/build/259d0a3dd736cf4fec47882dffdd7017.png"}}}],"key":"pWup5YUKBX"}],"key":"Q0Od9huzcq"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"children":[{"type":"text","value":"As an additional check, we can compare the aperture photometry and the PSF photometry. We should find a good agreement between those two measurement methods. However, note that the PSF photometry should do a better job in deblending the fluxes of sources that are close by.","position":{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},"key":"Vx0tnrKLKe"}],"key":"EclAgqWIjW"}],"key":"JE2l4wZbT3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x = objects[\"flux\"]\ny = phot[\"flux_fit\"]\n\nfig = plt.figure(figsize=(6,5))\nax1 = fig.add_subplot(1,1,1)\n\nax1.plot(x , y , \"o\", markersize=2, alpha=0.5)\nminlim = np.nanmin(np.concatenate((x,y)))\nmaxlim = np.nanmax(np.concatenate((x,y)))\n\nax1.fill_between(np.asarray([minlim,maxlim]),np.asarray([minlim,maxlim])/1.5,np.asarray([minlim,maxlim])*1.5, color=\"gray\", alpha=0.2, linewidth=0)\nax1.fill_between(np.asarray([minlim,maxlim]),np.asarray([minlim,maxlim])/1.2,np.asarray([minlim,maxlim])*1.2, color=\"gray\", alpha=0.4, linewidth=0)\nax1.plot(np.asarray([minlim,maxlim]),np.asarray([minlim,maxlim]), \":\", color=\"gray\")\n\nax1.set_xlabel(\"Aperture Photometry [flux]\")\nax1.set_ylabel(\"PSF forced-photometry [flux]\")\nax1.set_xscale('log')\nax1.set_yscale('log')\nplt.show()","key":"e7gOK7Av7y"},{"type":"output","id":"5TEk_nttLabaRrENb4sz-","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 600x500 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"16fa53b792afdac5bc54cac1d8671dfe","path":"/irsa-tutorials/build/16fa53b792afdac5bc54cac1d8671dfe.png"}}}],"key":"lxa13xvQlK"}],"key":"ZNRuGQp6Rs"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":428,"column":1},"end":{"line":428,"column":1}},"children":[{"type":"text","value":"Measure the Photometry on the NISP Images","position":{"start":{"line":428,"column":1},"end":{"line":428,"column":1}},"key":"Hh63fx1ip9"}],"identifier":"measure-the-photometry-on-the-nisp-images","label":"Measure the Photometry on the NISP Images","html_id":"measure-the-photometry-on-the-nisp-images","implicit":true,"key":"SMb55yyS0m"},{"type":"paragraph","position":{"start":{"line":430,"column":1},"end":{"line":431,"column":1}},"children":[{"type":"text","value":"We now have the photometry and the position of sources on the VIS image. We can now proceed with similar steps on the NISP images. Because the NISP PSF and pixel scale are larger that those of the VIS images, we utilize the advantage of position prior-based forced photometry.\nFor this, we use the positions of the VIS measurements and perform PSF fitting on the NISP image using these priors.","position":{"start":{"line":430,"column":1},"end":{"line":430,"column":1}},"key":"nea3OG918F"}],"key":"yhSQ0YRsXD"},{"type":"paragraph","position":{"start":{"line":433,"column":1},"end":{"line":433,"column":1}},"children":[{"type":"text","value":"The steps below are almost identical to the ones applied to the VIS images.","position":{"start":{"line":433,"column":1},"end":{"line":433,"column":1}},"key":"fAlLZrqz8p"}],"key":"LABaux8IAJ"}],"key":"e5n3UYVRXE"},{"type":"block","position":{"start":{"line":435,"column":1},"end":{"line":435,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"children":[{"type":"text","value":"We first isolate the data, which is in this case the NISP ","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"wA6DgHk0s0"},{"type":"emphasis","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"children":[{"type":"text","value":"H","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"xBnGbIug2g"}],"key":"hbm51Z0ufm"},{"type":"text","value":"-band filter. Note that this is an arbitrary choice and you should be encouraged to try other filters as well!","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"AuyLBIxDUh"}],"key":"I0HedjGw02"}],"key":"q2kSvB2dGz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"img2 = hdulcutout[\"H_SCIENCE\"].data\nhdr2 = hdulcutout[\"H_SCIENCE\"].header\nimg2[img2 == 0] = np.nan","key":"izUV0Rjwij"},{"type":"output","id":"xfR1BRAyAiE50A1g-agGr","data":[],"key":"fJ97BNV9VM"}],"key":"EJgIBk6wPP"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":445,"column":1},"end":{"line":445,"column":1}},"children":[{"type":"text","value":"We again need to create a mask that will be fed to the PSF fitting module.","position":{"start":{"line":445,"column":1},"end":{"line":445,"column":1}},"key":"DL3vsfi9Wh"}],"key":"kwkHRow7ww"}],"key":"yteZ1XTaN5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"mask2 = np.isnan(img2)","key":"fs2Q7Ayf6b"},{"type":"output","id":"wuW2dly0h4tz91lSvg_sV","data":[],"key":"iryDORu4VC"}],"key":"R5umhUEyXx"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"children":[{"type":"text","value":"... and we also get some statistics on the sky background.","position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"key":"rdD22SiqBw"}],"key":"fxdR8cD0Gu"}],"key":"WiYXNKIMdL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"mean2, median2, std2 = sigma_clipped_stats(img2, sigma=3.0)\nprint(np.array((mean2, median2, std2)))","key":"fI3PCzWDOB"},{"type":"output","id":"QF-uOZUgEhIo9BcMtMncO","data":[{"output_type":"stream","name":"stdout","text":"[2626.3018 1889.8518 2043.9841]\n"}],"key":"epONGVUqBM"}],"key":"HIZJ8mBFUV"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":458,"column":1},"end":{"line":458,"column":1}},"children":[{"type":"text","value":"Now, we need to obtain the (x,y) image coordinates on the NISP image that correspond to the extracted sources on the VIS image. We use the WCS information from the NISP image for this case and apply it to the sky coordinates obtained on the VIS image.","position":{"start":{"line":458,"column":1},"end":{"line":458,"column":1}},"key":"PaMBgY2WEP"}],"key":"MtSeupuNwW"}],"key":"udvzCF00J2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"wcs = WCS(hdr) # VIS\nwcs2 = WCS(hdr2) # NISP\nradec = wcs.all_pix2world(objects[\"x\"],objects[\"y\"], 0)\nxy = wcs2.all_world2pix(radec[0],radec[1],0)","key":"rxfVEDo09O"},{"type":"output","id":"rOtx6OPFMPdU-qsd84Yln","data":[],"key":"NAmMMrVrhn"}],"key":"B8Vd2BqGb4"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":467,"column":1},"end":{"line":467,"column":1}},"children":[{"type":"text","value":"Having all this set up, we can now again perform the PSF photometry using ","position":{"start":{"line":467,"column":1},"end":{"line":467,"column":1}},"key":"j5qdtzw0d4"},{"type":"inlineCode","value":"PSFPhotometry()","position":{"start":{"line":467,"column":1},"end":{"line":467,"column":1}},"key":"lNyv3ERipC"},{"type":"text","value":" from the ","position":{"start":{"line":467,"column":1},"end":{"line":467,"column":1}},"key":"h9aT9083hN"},{"type":"inlineCode","value":"photutils","position":{"start":{"line":467,"column":1},"end":{"line":467,"column":1}},"key":"vAOZsUGpBk"},{"type":"text","value":" package. This again can take a while, typically 1 minute.","position":{"start":{"line":467,"column":1},"end":{"line":467,"column":1}},"key":"W6HuS9Rh5d"}],"key":"S8BTLQsEuR"}],"key":"JPNu6Awrly"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"psf_fwhm = 0.3 # arcsec\npixscale = 0.3 # arcsec/px\n\ninit_params = Table([xy[0],xy[1]] , names=[\"x\",\"y\"]) # initial positions\npsf_model = CircularGaussianSigmaPRF(flux=1, sigma=psf_fwhm/pixscale / 2.35)\npsf_model.x_0.fixed = True\npsf_model.y_0.fixed = True\npsf_model.sigma.fixed = False\nfit_shape = (3, 3)\npsfphot2 = PSFPhotometry(psf_model,\n                        fit_shape,\n                        finder = DAOStarFinder(fwhm=0.1, threshold=3.*std2, exclude_border=True), # not needed because we are using fixed initial positions.\n                        aperture_radius = 4,\n                        progress_bar = True)\nphot2 = psfphot2(img2-median2, error=None, mask=mask2, init_params=init_params)\nresimage2 = psfphot2.make_residual_image(data = img2-median2, psf_shape = (3, 3))","key":"XTawkmDUdN"},{"type":"output","id":"T2OECC8AOOCeNwsYXb0PU","data":[{"output_type":"stream","name":"stderr","text":"\rFit source/group:   0%|          | 0/2759 [00:00<?, ?it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   0%|          | 5/2759 [00:00<00:58, 47.37it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   0%|          | 12/2759 [00:00<00:46, 58.93it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   1%|          | 28/2759 [00:00<00:26, 102.08it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   1%|▏         | 41/2759 [00:00<00:26, 100.80it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   2%|▏         | 53/2759 [00:00<00:26, 101.90it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   2%|▏         | 64/2759 [00:00<00:27, 99.36it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   3%|▎         | 75/2759 [00:00<00:27, 95.94it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   3%|▎         | 85/2759 [00:00<00:32, 81.98it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   3%|▎         | 94/2759 [00:01<00:32, 82.90it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   4%|▎         | 103/2759 [00:01<00:31, 83.30it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   4%|▍         | 112/2759 [00:01<00:32, 82.45it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   4%|▍         | 121/2759 [00:01<00:31, 83.86it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   5%|▍         | 130/2759 [00:01<00:31, 84.11it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   5%|▌         | 140/2759 [00:01<00:33, 77.22it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   5%|▌         | 148/2759 [00:01<00:34, 76.55it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   6%|▌         | 157/2759 [00:01<00:32, 79.59it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   6%|▌         | 166/2759 [00:02<00:38, 67.89it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   6%|▋         | 175/2759 [00:02<00:35, 72.23it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   7%|▋         | 191/2759 [00:02<00:27, 93.56it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   7%|▋         | 201/2759 [00:02<00:27, 94.27it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   8%|▊         | 211/2759 [00:02<00:27, 92.86it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   8%|▊         | 227/2759 [00:02<00:22, 110.50it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   9%|▊         | 239/2759 [00:02<00:27, 92.45it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:   9%|▉         | 255/2759 [00:02<00:23, 106.90it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  10%|▉         | 267/2759 [00:03<00:25, 96.28it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  10%|█         | 278/2759 [00:03<00:25, 96.44it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  10%|█         | 289/2759 [00:03<00:25, 95.11it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  11%|█         | 301/2759 [00:03<00:25, 95.28it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  11%|█▏        | 311/2759 [00:03<00:37, 64.54it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  12%|█▏        | 319/2759 [00:03<00:41, 58.57it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  12%|█▏        | 332/2759 [00:03<00:33, 71.88it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  12%|█▏        | 344/2759 [00:04<00:29, 81.75it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  13%|█▎        | 358/2759 [00:04<00:25, 94.56it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  13%|█▎        | 369/2759 [00:04<00:31, 76.66it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  14%|█▍        | 386/2759 [00:04<00:24, 96.74it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  14%|█▍        | 398/2759 [00:04<00:26, 88.88it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  15%|█▌        | 415/2759 [00:04<00:22, 106.45it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  16%|█▌        | 433/2759 [00:04<00:18, 123.21it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  16%|█▌        | 447/2759 [00:04<00:19, 118.84it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  17%|█▋        | 460/2759 [00:05<00:22, 103.76it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  17%|█▋        | 472/2759 [00:05<00:24, 93.54it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  18%|█▊        | 488/2759 [00:05<00:20, 108.45it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  18%|█▊        | 502/2759 [00:05<00:21, 106.15it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  19%|█▊        | 514/2759 [00:05<00:21, 104.28it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  19%|█▉        | 528/2759 [00:05<00:21, 105.31it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  20%|█▉        | 539/2759 [00:05<00:24, 92.11it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  20%|█▉        | 549/2759 [00:06<00:26, 82.76it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  20%|██        | 560/2759 [00:06<00:25, 86.07it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  21%|██        | 570/2759 [00:06<00:25, 86.82it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  21%|██        | 579/2759 [00:06<00:24, 87.30it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  21%|██▏       | 588/2759 [00:06<00:25, 86.62it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  22%|██▏       | 597/2759 [00:06<00:25, 85.07it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  22%|██▏       | 606/2759 [00:06<00:28, 74.63it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  22%|██▏       | 614/2759 [00:07<00:34, 61.48it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  23%|██▎       | 629/2759 [00:07<00:26, 80.93it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  23%|██▎       | 639/2759 [00:07<00:25, 84.73it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  24%|██▍       | 657/2759 [00:07<00:19, 107.68it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  24%|██▍       | 669/2759 [00:07<00:22, 93.59it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  25%|██▍       | 680/2759 [00:07<00:21, 94.52it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  25%|██▌       | 691/2759 [00:07<00:21, 95.86it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  25%|██▌       | 702/2759 [00:07<00:25, 79.26it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  26%|██▌       | 711/2759 [00:08<00:27, 74.31it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  26%|██▌       | 720/2759 [00:08<00:28, 71.58it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  26%|██▋       | 730/2759 [00:08<00:26, 77.77it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  27%|██▋       | 746/2759 [00:08<00:22, 90.69it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  27%|██▋       | 756/2759 [00:08<00:27, 73.69it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  28%|██▊       | 773/2759 [00:08<00:21, 94.42it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  28%|██▊       | 784/2759 [00:08<00:21, 93.41it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  29%|██▉       | 796/2759 [00:08<00:20, 96.90it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  29%|██▉       | 813/2759 [00:09<00:16, 114.72it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  30%|██▉       | 826/2759 [00:09<00:19, 100.11it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  30%|███       | 837/2759 [00:09<00:19, 99.25it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  31%|███       | 848/2759 [00:09<00:19, 98.09it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  31%|███       | 859/2759 [00:09<00:19, 97.71it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  32%|███▏      | 870/2759 [00:09<00:21, 88.09it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  32%|███▏      | 881/2759 [00:09<00:20, 92.37it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  32%|███▏      | 891/2759 [00:09<00:20, 90.25it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  33%|███▎      | 904/2759 [00:10<00:20, 92.61it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  33%|███▎      | 914/2759 [00:10<00:19, 92.67it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  34%|███▎      | 926/2759 [00:10<00:19, 94.90it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  34%|███▍      | 942/2759 [00:10<00:16, 111.88it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  35%|███▍      | 954/2759 [00:10<00:21, 85.94it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  35%|███▌      | 968/2759 [00:10<00:19, 90.07it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  35%|███▌      | 978/2759 [00:10<00:22, 80.06it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  36%|███▌      | 987/2759 [00:11<00:24, 72.66it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  36%|███▌      | 995/2759 [00:11<00:27, 63.15it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  37%|███▋      | 1011/2759 [00:11<00:21, 82.44it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  37%|███▋      | 1025/2759 [00:11<00:19, 89.09it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  38%|███▊      | 1042/2759 [00:11<00:16, 105.23it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  38%|███▊      | 1054/2759 [00:11<00:19, 86.46it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  39%|███▊      | 1069/2759 [00:11<00:16, 100.15it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  39%|███▉      | 1081/2759 [00:12<00:18, 92.32it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  40%|███▉      | 1092/2759 [00:12<00:17, 94.04it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  40%|████      | 1108/2759 [00:12<00:15, 109.31it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  41%|████      | 1120/2759 [00:12<00:17, 94.15it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  41%|████      | 1131/2759 [00:12<00:20, 78.44it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  41%|████▏     | 1140/2759 [00:12<00:22, 72.75it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  42%|████▏     | 1149/2759 [00:12<00:21, 75.96it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  42%|████▏     | 1164/2759 [00:13<00:18, 85.97it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  43%|████▎     | 1181/2759 [00:13<00:15, 105.04it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  43%|████▎     | 1193/2759 [00:13<00:15, 99.92it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  44%|████▎     | 1204/2759 [00:13<00:19, 78.97it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  44%|████▍     | 1214/2759 [00:13<00:18, 82.98it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  44%|████▍     | 1224/2759 [00:13<00:19, 77.76it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  45%|████▍     | 1233/2759 [00:13<00:20, 74.30it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  45%|████▌     | 1242/2759 [00:14<00:19, 76.63it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  45%|████▌     | 1252/2759 [00:14<00:18, 82.00it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  46%|████▌     | 1267/2759 [00:14<00:15, 98.78it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  47%|████▋     | 1285/2759 [00:14<00:13, 106.61it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  47%|████▋     | 1296/2759 [00:14<00:14, 102.23it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  47%|████▋     | 1307/2759 [00:14<00:14, 99.96it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  48%|████▊     | 1318/2759 [00:14<00:15, 90.50it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  48%|████▊     | 1328/2759 [00:14<00:17, 81.79it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  48%|████▊     | 1337/2759 [00:15<00:19, 74.29it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  49%|████▉     | 1349/2759 [00:15<00:17, 81.19it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  49%|████▉     | 1358/2759 [00:15<00:19, 72.72it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  50%|████▉     | 1366/2759 [00:15<00:19, 70.88it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  50%|████▉     | 1374/2759 [00:15<00:19, 72.76it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  50%|█████     | 1382/2759 [00:15<00:22, 60.75it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  50%|█████     | 1393/2759 [00:15<00:20, 65.06it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  51%|█████     | 1407/2759 [00:16<00:18, 74.38it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  51%|█████▏    | 1415/2759 [00:16<00:21, 63.91it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  52%|█████▏    | 1433/2759 [00:16<00:15, 88.30it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  53%|█████▎    | 1449/2759 [00:16<00:12, 104.64it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  53%|█████▎    | 1461/2759 [00:16<00:12, 104.72it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  54%|█████▎    | 1479/2759 [00:16<00:10, 122.83it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  54%|█████▍    | 1493/2759 [00:16<00:10, 116.57it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  55%|█████▍    | 1506/2759 [00:16<00:10, 114.61it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  55%|█████▌    | 1518/2759 [00:17<00:12, 97.41it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  55%|█████▌    | 1529/2759 [00:17<00:14, 84.38it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  56%|█████▌    | 1539/2759 [00:17<00:14, 87.10it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  56%|█████▌    | 1549/2759 [00:17<00:15, 80.37it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  57%|█████▋    | 1565/2759 [00:17<00:13, 91.00it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  57%|█████▋    | 1575/2759 [00:17<00:13, 89.83it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  58%|█████▊    | 1587/2759 [00:17<00:12, 96.37it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  58%|█████▊    | 1598/2759 [00:18<00:11, 99.14it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  58%|█████▊    | 1609/2759 [00:18<00:14, 79.53it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  59%|█████▊    | 1618/2759 [00:18<00:15, 73.79it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  59%|█████▉    | 1626/2759 [00:18<00:15, 75.14it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  59%|█████▉    | 1635/2759 [00:18<00:14, 77.88it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  60%|█████▉    | 1644/2759 [00:18<00:15, 70.00it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  60%|█████▉    | 1652/2759 [00:18<00:15, 72.00it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  60%|██████    | 1661/2759 [00:18<00:14, 75.66it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  61%|██████    | 1671/2759 [00:19<00:13, 81.16it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  61%|██████    | 1680/2759 [00:19<00:12, 83.10it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  61%|██████▏   | 1690/2759 [00:19<00:12, 86.33it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  62%|██████▏   | 1706/2759 [00:19<00:09, 106.72it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  62%|██████▏   | 1717/2759 [00:19<00:11, 94.66it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  63%|██████▎   | 1728/2759 [00:19<00:10, 97.60it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  63%|██████▎   | 1739/2759 [00:19<00:11, 86.29it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  63%|██████▎   | 1751/2759 [00:19<00:10, 92.26it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  64%|██████▍   | 1761/2759 [00:20<00:11, 83.82it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  64%|██████▍   | 1771/2759 [00:20<00:12, 79.89it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  65%|██████▍   | 1780/2759 [00:20<00:14, 69.19it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  65%|██████▍   | 1790/2759 [00:20<00:12, 75.27it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  65%|██████▌   | 1801/2759 [00:20<00:11, 82.65it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  66%|██████▌   | 1812/2759 [00:20<00:10, 89.32it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  66%|██████▋   | 1829/2759 [00:20<00:09, 101.46it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  67%|██████▋   | 1840/2759 [00:20<00:09, 92.06it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  67%|██████▋   | 1852/2759 [00:21<00:09, 96.23it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  67%|██████▋   | 1862/2759 [00:21<00:09, 97.18it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  68%|██████▊   | 1872/2759 [00:21<00:11, 79.17it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  69%|██████▊   | 1891/2759 [00:21<00:08, 104.87it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  69%|██████▉   | 1903/2759 [00:21<00:08, 102.36it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  69%|██████▉   | 1914/2759 [00:21<00:09, 84.72it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  70%|██████▉   | 1924/2759 [00:21<00:10, 81.54it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  70%|███████   | 1936/2759 [00:22<00:09, 87.49it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  71%|███████   | 1946/2759 [00:22<00:09, 83.14it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  71%|███████   | 1955/2759 [00:22<00:10, 78.38it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  71%|███████▏  | 1972/2759 [00:22<00:07, 99.94it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  72%|███████▏  | 1983/2759 [00:22<00:09, 83.14it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  72%|███████▏  | 1993/2759 [00:22<00:09, 78.34it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  73%|███████▎  | 2003/2759 [00:22<00:09, 83.12it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  73%|███████▎  | 2012/2759 [00:22<00:09, 82.12it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  73%|███████▎  | 2021/2759 [00:23<00:09, 76.10it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  74%|███████▎  | 2031/2759 [00:23<00:09, 78.83it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  74%|███████▍  | 2046/2759 [00:23<00:08, 89.04it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  75%|███████▍  | 2056/2759 [00:23<00:07, 90.83it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  75%|███████▌  | 2071/2759 [00:23<00:06, 103.63it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  75%|███████▌  | 2082/2759 [00:23<00:08, 83.55it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  76%|███████▌  | 2097/2759 [00:23<00:07, 93.91it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  76%|███████▋  | 2108/2759 [00:23<00:06, 96.89it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  77%|███████▋  | 2119/2759 [00:24<00:06, 99.81it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  77%|███████▋  | 2132/2759 [00:24<00:06, 103.54it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  78%|███████▊  | 2143/2759 [00:24<00:06, 102.51it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  78%|███████▊  | 2154/2759 [00:24<00:06, 92.34it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  78%|███████▊  | 2164/2759 [00:24<00:06, 85.19it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  79%|███████▉  | 2175/2759 [00:24<00:06, 89.14it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  79%|███████▉  | 2186/2759 [00:24<00:06, 93.28it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  80%|███████▉  | 2197/2759 [00:24<00:05, 96.57it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  80%|████████  | 2210/2759 [00:25<00:05, 99.50it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  81%|████████  | 2221/2759 [00:25<00:06, 80.56it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  81%|████████  | 2233/2759 [00:25<00:06, 87.23it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  81%|████████▏ | 2243/2759 [00:25<00:06, 81.94it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  82%|████████▏ | 2253/2759 [00:25<00:05, 85.49it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  82%|████████▏ | 2264/2759 [00:25<00:05, 91.56it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  82%|████████▏ | 2274/2759 [00:25<00:05, 89.90it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  83%|████████▎ | 2285/2759 [00:25<00:04, 94.83it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  83%|████████▎ | 2296/2759 [00:26<00:04, 97.89it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  84%|████████▎ | 2310/2759 [00:26<00:04, 108.43it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  84%|████████▍ | 2322/2759 [00:26<00:04, 103.51it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  85%|████████▍ | 2338/2759 [00:26<00:03, 117.31it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  85%|████████▌ | 2350/2759 [00:26<00:04, 87.50it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  86%|████████▌ | 2360/2759 [00:26<00:05, 79.16it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  86%|████████▌ | 2369/2759 [00:26<00:05, 73.23it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  86%|████████▌ | 2377/2759 [00:27<00:05, 64.54it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  86%|████████▋ | 2385/2759 [00:27<00:05, 62.68it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  87%|████████▋ | 2396/2759 [00:27<00:05, 72.04it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  87%|████████▋ | 2405/2759 [00:27<00:04, 76.16it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  88%|████████▊ | 2416/2759 [00:27<00:04, 83.92it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  88%|████████▊ | 2426/2759 [00:27<00:03, 87.30it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  88%|████████▊ | 2436/2759 [00:27<00:04, 72.96it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  89%|████████▊ | 2445/2759 [00:27<00:04, 76.20it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  89%|████████▉ | 2454/2759 [00:28<00:03, 79.63it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  89%|████████▉ | 2463/2759 [00:28<00:03, 75.38it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  90%|████████▉ | 2473/2759 [00:28<00:03, 76.81it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  90%|█████████ | 2485/2759 [00:28<00:03, 83.64it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  90%|█████████ | 2494/2759 [00:28<00:04, 65.17it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  91%|█████████ | 2512/2759 [00:28<00:02, 90.13it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  91%|█████████▏| 2523/2759 [00:28<00:02, 93.16it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  92%|█████████▏| 2534/2759 [00:29<00:03, 68.61it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  92%|█████████▏| 2544/2759 [00:29<00:02, 73.84it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  93%|█████████▎| 2555/2759 [00:29<00:02, 80.99it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  93%|█████████▎| 2565/2759 [00:29<00:02, 82.81it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  93%|█████████▎| 2575/2759 [00:29<00:02, 86.73it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  94%|█████████▍| 2590/2759 [00:29<00:01, 96.36it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  94%|█████████▍| 2607/2759 [00:29<00:01, 114.43it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  95%|█████████▍| 2619/2759 [00:29<00:01, 109.73it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  96%|█████████▌| 2635/2759 [00:29<00:01, 122.99it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  96%|█████████▌| 2648/2759 [00:30<00:00, 114.19it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  97%|█████████▋| 2665/2759 [00:30<00:00, 128.58it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  97%|█████████▋| 2679/2759 [00:30<00:00, 124.38it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  98%|█████████▊| 2692/2759 [00:30<00:00, 120.56it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  98%|█████████▊| 2708/2759 [00:30<00:00, 119.40it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  99%|█████████▊| 2721/2759 [00:30<00:00, 80.68it/s] "},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  99%|█████████▉| 2734/2759 [00:30<00:00, 90.30it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group:  99%|█████████▉| 2745/2759 [00:31<00:00, 91.81it/s]"},{"output_type":"stream","name":"stderr","text":"\rFit source/group: 100%|██████████| 2759/2759 [00:31<00:00, 88.54it/s]"},{"output_type":"stream","name":"stderr","text":"\n"},{"output_type":"stream","name":"stderr","text":"WARNING: One or more fit(s) may not have converged. Please check the \"flags\" column in the output table. [photutils.psf._components]\n"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources:   0%|          | 0/2759 [00:00<?, ?it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources:  17%|█▋        | 462/2759 [00:00<00:00, 4611.35it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources:  35%|███▍      | 957/2759 [00:00<00:00, 4808.23it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources:  53%|█████▎    | 1457/2759 [00:00<00:00, 4894.62it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources:  71%|███████   | 1947/2759 [00:00<00:00, 4741.99it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources:  88%|████████▊ | 2428/2759 [00:00<00:00, 4764.59it/s]"},{"output_type":"stream","name":"stderr","text":"\rAdd model sources: 100%|██████████| 2759/2759 [00:00<00:00, 4760.30it/s]"},{"output_type":"stream","name":"stderr","text":"\n"}],"key":"Kt93lW47s6"}],"key":"VqG0RXIVhB"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"children":[{"type":"text","value":"Again, we convert the pixel coordinates to sky coordinates and add them to the catalog.","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"key":"k8VtmjIivV"}],"key":"wlEFKnuwRk"}],"key":"gBf68xB6qi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"wcs2 = WCS(hdr2) # NISP\nradec = wcs2.all_pix2world(phot2[\"x_fit\"],phot2[\"y_fit\"],0)\nphot2[\"ra_fit\"] = radec[0]\nphot2[\"dec_fit\"] = radec[1]","key":"X1AGJaKce6"},{"type":"output","id":"ldxyGwXSwiYz2VbYdyVGN","data":[],"key":"fFgAvaL5RX"}],"key":"wPV1TMSDSQ"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":497,"column":1},"end":{"line":497,"column":1}},"children":[{"type":"text","value":"Finally, we create the same figure as above, showing the NISP image and the residual with the (VIS-extracted) sources overlaid.","position":{"start":{"line":497,"column":1},"end":{"line":497,"column":1}},"key":"u4Kgcz6RTz"}],"key":"Ed2wqBJCbv"}],"key":"c5rWYY8AZx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(20,10))\nax1 = fig.add_subplot(1,2,1)\nax2 = fig.add_subplot(1,2,2)\nax1.imshow(np.log10(img2), cmap=\"Greys\", origin=\"lower\")\nax1.plot(phot2[\"x_fit\"], phot2[\"y_fit\"] , \"o\", markersize=8 , markeredgecolor=\"red\", fillstyle=\"none\")\n\nax2.imshow(resimage2,vmin=-20*std2, vmax=20*std2, cmap=\"RdBu\", origin=\"lower\")\nax2.plot(phot2[\"x_fit\"], phot2[\"y_fit\"] , \"o\", markersize=8 , markeredgecolor=\"red\", fillstyle=\"none\")\n\nplt.show()","key":"QjQfdNq85R"},{"type":"output","id":"C5PwrWpaYAAeHd1z3gN6h","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 2000x1000 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"17938692777de4260dc806d857fa1fae","path":"/irsa-tutorials/build/17938692777de4260dc806d857fa1fae.png"}}}],"key":"BVYUovDx9Q"}],"key":"ITifOqsBTV"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":512,"column":1},"end":{"line":512,"column":1}},"children":[{"type":"text","value":"Load Gaia Catalog","position":{"start":{"line":512,"column":1},"end":{"line":512,"column":1}},"key":"rPNZ1qyLXF"}],"identifier":"load-gaia-catalog","label":"Load Gaia Catalog","html_id":"load-gaia-catalog","implicit":true,"key":"giCOEmjBJe"},{"type":"paragraph","position":{"start":{"line":514,"column":1},"end":{"line":515,"column":1}},"children":[{"type":"text","value":"We now load the Gaia sources at the location of the globular clusters. The goal is to compare the photometry of Gaia to the one derived above for the Euclid VIS and NISP images. This is scientifically useful, for example we can compute the colors of the stars in the Gaia optical bands and the Euclid near-IR bands.\nTo search for Gaia sources, we use ","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"key":"HvvVQZqsWO"},{"type":"inlineCode","value":"astroquery","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"key":"xKYInnWnYS"},{"type":"text","value":" again.","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"key":"waLOevIvZa"}],"key":"RhGGUWBMs2"},{"type":"paragraph","position":{"start":{"line":517,"column":1},"end":{"line":517,"column":1}},"children":[{"type":"text","value":"We first have to elimiate the row limit for the Gaia query by setting","position":{"start":{"line":517,"column":1},"end":{"line":517,"column":1}},"key":"XXOsQ8MeNU"}],"key":"sZ3T0n1HnA"}],"key":"Yi2MtTTjI2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"Gaia.ROW_LIMIT = -1","key":"jRBEbcGYU5"},{"type":"output","id":"BROMhCs4PSdoG5khPLHcc","data":[],"key":"ZDOMKICNsz"}],"key":"vegik5gVH6"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"children":[{"type":"text","value":"Next, we request the Gaia catalog around the position of the globular cluster. We use the same size as the cutout size.","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"tV3ss8GCdi"}],"key":"yrzl4OyJj8"}],"key":"w8R2ExVNhW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"gaia_objects = Gaia.query_object_async(coordinate=coord, radius = cutout_size/2)\nprint(\"Number of Gaia stars found: {}\".format(len(gaia_objects)))","key":"i5lNLXL7Jt"},{"type":"output","id":"pciUEx4_snaRW2flBdpxp","data":[{"output_type":"stream","name":"stdout","text":"INFO: Query finished. [astroquery.utils.tap.core]\nNumber of Gaia stars found: 1202\n"}],"key":"fbauapr6jN"}],"key":"IU1PqAnseb"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"children":[{"type":"text","value":"We then convert the sky coordinates of the Gaia stars to (x,y) image coordinates for VIS and NISP images using the corresponding WCS. This makes it more easy to plot the Gaia sources later on the images.","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"key":"zOr8iWMwS0"}],"key":"d76kq5hrmw"}],"key":"hbKFH3Dvt4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"wcs = WCS(hdr) # VIS\nwcs2 = WCS(hdr2) # NISP\nxy = wcs.all_world2pix(gaia_objects[\"ra\"],gaia_objects[\"dec\"],0)\nxy2 = wcs2.all_world2pix(gaia_objects[\"ra\"],gaia_objects[\"dec\"],0)\n\ngaia_objects[\"x_vis\"] = xy[0]\ngaia_objects[\"y_vis\"] = xy[1]\ngaia_objects[\"x_nisp\"] = xy2[0]\ngaia_objects[\"y_nisp\"] = xy2[1]","key":"kB58WRr87v"},{"type":"output","id":"jPgMDhBdTZeQODs7rYhjc","data":[],"key":"s43MOludt3"}],"key":"zkTkXqW4B8"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"children":[{"type":"text","value":"We save the Gaia table to disk as we will later use it for the visualization in ","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"HveiQs8HZQ"},{"type":"inlineCode","value":"Firefly","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"mMLHwqb0Cj"},{"type":"text","value":".","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":1}},"key":"UrdTkOB5tM"}],"key":"eH3U1kHkNr"}],"key":"YmJKZWZDgk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"gaia_objects.write(\"./data/gaiatable.csv\", format=\"csv\", overwrite=True)","key":"Kzyxj1AI2h"},{"type":"output","id":"SsN0zQsFs73JdESYAGTqU","data":[],"key":"dsQlBSsPL6"}],"key":"cFI3GbaAT0"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":550,"column":1},"end":{"line":550,"column":1}},"children":[{"type":"text","value":"Now we can overlay the Gaia sources on the VIS and NISP images (here the x/y coordinates become handy).","position":{"start":{"line":550,"column":1},"end":{"line":550,"column":1}},"key":"JFAYrVLQhc"}],"key":"h9OQcYJZOA"}],"key":"ITryywcZMi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(20,10))\nax1 = fig.add_subplot(1,2,1)\nax2 = fig.add_subplot(1,2,2)\nax1.imshow(np.log10(img), cmap=\"Greys\", origin=\"lower\")\nax1.plot(gaia_objects[\"x_vis\"], gaia_objects[\"y_vis\"] , \"o\", markersize=8 , markeredgecolor=\"red\", fillstyle=\"none\")\nax1.set_title(\"VIS\")\n\nax2.imshow(np.log10(img2), cmap=\"Greys\", origin=\"lower\")\nax2.plot(gaia_objects[\"x_nisp\"], gaia_objects[\"y_nisp\"] , \"o\", markersize=8 , markeredgecolor=\"red\", fillstyle=\"none\")\nax2.set_title(\"NISP\")\n\nplt.show()","key":"p5WEcYDH6W"},{"type":"output","id":"BJd8ygS6mfkCNMXdsjW0d","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 2000x1000 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"3c8d9b314fb39e4efbb608f925a0d98c","path":"/irsa-tutorials/build/3c8d9b314fb39e4efbb608f925a0d98c.png"}}}],"key":"qBw637yFM1"}],"key":"hyvUTfSutx"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":567,"column":1},"end":{"line":567,"column":1}},"children":[{"type":"text","value":"Match the Gaia Catalog to the VIS and NISP Catalogs","position":{"start":{"line":567,"column":1},"end":{"line":567,"column":1}},"key":"RkIpoGQz7B"}],"identifier":"match-the-gaia-catalog-to-the-vis-and-nisp-catalogs","label":"Match the Gaia Catalog to the VIS and NISP Catalogs","html_id":"match-the-gaia-catalog-to-the-vis-and-nisp-catalogs","implicit":true,"key":"rPKnrCV8tF"},{"type":"paragraph","position":{"start":{"line":569,"column":1},"end":{"line":569,"column":1}},"children":[{"type":"text","value":"Now, we match the Gaia source positions to the extracted sources in the VIS and NISP images.","position":{"start":{"line":569,"column":1},"end":{"line":569,"column":1}},"key":"bKApD4X1WL"}],"key":"UO5Oacvo9n"},{"type":"paragraph","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"children":[{"type":"text","value":"We first define which Gaia columns to copy to the matched catalog as well as the matching distance.","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"key":"L4b4advHaI"}],"key":"csjYZj2afP"}],"key":"E8zRu7TfkV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"gaia_keys = [\"source_id\", \"phot_g_mean_mag\", \"phot_bp_mean_mag\", \"phot_rp_mean_mag\",\"ra\",\"dec\",\"pmra\",\"pmdec\"]\nmatching_distance = 0.6*u.arcsecond","key":"TdKK5edtb2"},{"type":"output","id":"Di_SznH-jfmilv0XLtKZM","data":[],"key":"Q0KX640aBU"}],"key":"nIxl2NuRqE"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"children":[{"type":"text","value":"First match to the VIS image. We use the ","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"key":"PykMhvOnrp"},{"type":"inlineCode","value":"astropy","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"key":"R4mvYwiVLW"},{"type":"text","value":" ","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"key":"qqWZAVBuKq"},{"type":"emphasis","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"children":[{"type":"text","value":"SkyCoord()","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"key":"j9QijOUhGh"}],"key":"QmR7bSJ5Iv"},{"type":"text","value":" function for matching in sky coordinates.","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"key":"lF0wn8hsit"}],"key":"zvGrOOLjdf"}],"key":"LdQnVFtt2V"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"c = SkyCoord(ra=phot[\"ra_fit\"]*u.degree, dec=phot[\"dec_fit\"]*u.degree )\ncatalog = SkyCoord(ra=gaia_objects[\"ra\"].data*u.degree, dec=gaia_objects[\"dec\"].data*u.degree)\nidx, d2d, d3d = c.match_to_catalog_sky(catalog)\n\nsel_matched = np.where(d2d.to(u.arcsecond) < (matching_distance))[0]\nprint(\"Gaia Sources matched to VIS: {}\".format( len(sel_matched) ) )\nphot[\"gaia_distance\"] = d2d.to(u.arcsecond)\n\nfor gaia_key in gaia_keys:\n    phot[\"gaia_{}\".format(gaia_key)] = 0.0\n    phot[\"gaia_{}\".format(gaia_key)][sel_matched] = gaia_objects[gaia_key][idx[sel_matched]]","key":"PFih3FmzPa"},{"type":"output","id":"PpJhPe4SYONohNATNrdop","data":[{"output_type":"stream","name":"stdout","text":"Gaia Sources matched to VIS: 1223\n"}],"key":"TNcmxHBSFK"}],"key":"mBH0KKx4tr"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":594,"column":1},"end":{"line":594,"column":1}},"children":[{"type":"text","value":"And then we add the NISP sources. Note that we do not have to perform matching here because by design the VIS and NISP sources are matched (spatial prior forced photometry).","position":{"start":{"line":594,"column":1},"end":{"line":594,"column":1}},"key":"JaOiZ6z0zz"}],"key":"Yv3br5qDon"}],"key":"V5i8TUJSxh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"phot2[\"gaia_distance\"] = d2d.to(u.arcsecond)\n\nfor gaia_key in gaia_keys:\n    phot2[\"gaia_{}\".format(gaia_key)] = 0.0\n    phot2[\"gaia_{}\".format(gaia_key)][sel_matched] = gaia_objects[gaia_key][idx[sel_matched]]","key":"KcskdZfzhX"},{"type":"output","id":"0tAl1uGqCHA7UUD04z9hZ","data":[],"key":"SDsq99U5Cx"}],"key":"HXppH74xiC"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":604,"column":1},"end":{"line":604,"column":1}},"children":[{"type":"text","value":"Once matched, we can now compare the Gaia and Euclid/NISP magnitudes of the stars.","position":{"start":{"line":604,"column":1},"end":{"line":604,"column":1}},"key":"TRZ6RIHs8X"}],"key":"i7nyshQgo8"}],"key":"ceYGHsQ4Fv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Data\nx = phot[\"gaia_phot_rp_mean_mag\"]\ny = -2.5*np.log10(phot[\"flux_fit\"]) + hdr[\"ZP_STACK\"]\n\n# selection\nsel_good = np.where(phot[\"gaia_source_id\"] > 0)[0]\nx = x[sel_good]\ny = y[sel_good]\n\nfig = plt.figure(figsize=(6,5))\nax1 = fig.add_subplot(1,1,1)\n\nax1.plot(x , y , \"o\", markersize=2)\nminlim = np.nanmin(np.concatenate((x,y)))\nmaxlim = np.nanmax(np.concatenate((x,y)))\n\nax1.fill_between(np.asarray([minlim,maxlim]),np.asarray([minlim,maxlim])/1.5,np.asarray([minlim,maxlim])*1.5, color=\"gray\", alpha=0.2, linewidth=0)\nax1.fill_between(np.asarray([minlim,maxlim]),np.asarray([minlim,maxlim])/1.2,np.asarray([minlim,maxlim])*1.2, color=\"gray\", alpha=0.4, linewidth=0)\nax1.plot(np.asarray([minlim,maxlim]),np.asarray([minlim,maxlim]), \":\", color=\"gray\")\n\nax1.set_xlabel(\"Gaia Rp [mag]\")\nax1.set_ylabel(\"I$_E$ [mag]\")\nplt.show()","key":"eXfycNThB6"},{"type":"output","id":"DtLIk9QPqj6e85zkeTWF3","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 600x500 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"dfaa3975ed0b422fbd63c8aff8ad5c89","path":"/irsa-tutorials/build/dfaa3975ed0b422fbd63c8aff8ad5c89.png"}}}],"key":"DHTbcZgf28"}],"key":"RKqYluZU93"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":632,"column":1},"end":{"line":632,"column":1}},"children":[{"type":"text","value":"Visualization with Firefly","position":{"start":{"line":632,"column":1},"end":{"line":632,"column":1}},"key":"fXoMxJPxN1"}],"identifier":"visualization-with-firefly","label":"Visualization with Firefly","html_id":"visualization-with-firefly","implicit":true,"key":"b69uY58iiF"},{"type":"paragraph","position":{"start":{"line":634,"column":1},"end":{"line":634,"column":1}},"children":[{"type":"text","value":"At the end of this Notebook, we demonstrate how we can visualize the images and catalogs created above in ","position":{"start":{"line":634,"column":1},"end":{"line":634,"column":1}},"key":"NH1yiNIaFR"},{"type":"inlineCode","value":"Firefly","position":{"start":{"line":634,"column":1},"end":{"line":634,"column":1}},"key":"KwqWC94Fo4"},{"type":"text","value":".","position":{"start":{"line":634,"column":1},"end":{"line":634,"column":1}},"key":"MGXLJdHYbU"}],"key":"ZhLpwwxhBl"},{"type":"paragraph","position":{"start":{"line":636,"column":1},"end":{"line":637,"column":1}},"children":[{"type":"text","value":"We start by initializing the Firefly client.\nThe following line will open a new ","position":{"start":{"line":636,"column":1},"end":{"line":636,"column":1}},"key":"A3lTu6Xxho"},{"type":"inlineCode","value":"Firefly","position":{"start":{"line":636,"column":1},"end":{"line":636,"column":1}},"key":"XJTlXAQsId"},{"type":"text","value":" GUI in a separate tab ","position":{"start":{"line":636,"column":1},"end":{"line":636,"column":1}},"key":"JGy38NQ4Y4"},{"type":"strong","position":{"start":{"line":636,"column":1},"end":{"line":636,"column":1}},"children":[{"type":"text","value":"inside","position":{"start":{"line":636,"column":1},"end":{"line":636,"column":1}},"key":"P5z1Y7IWEe"}],"key":"wMQx7KDo5F"},{"type":"text","value":" the Jupyter Notebook environment. The user can drag the tab onto the currently open tab to create a “split tab”. This the user to see the code and images side-by-side.","position":{"start":{"line":636,"column":1},"end":{"line":636,"column":1}},"key":"zb3lb4qPln"}],"key":"TTJurBxlf3"}],"key":"WoPRnxbFL8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Uncomment when using within Jupyter Lab with jupyter_firefly_extensions installed\n# fc = FireflyClient.make_lab_client()\n\n# Uncomment for contexts other than the above\nfc = FireflyClient.make_client(url=\"https://irsa.ipac.caltech.edu/irsaviewer\")","key":"O8TDCKDpbX"},{"type":"output","id":"tk5CgZ12cdkcTKv0gqWsU","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"},"text/html":{"content":"Open your web browser to <a href=\"https://irsa.ipac.caltech.edu/irsaviewer/?__wsch=MjAyNS0xMS0wNg\"\" target=\"_blank\">this link</a>","content_type":"text/html"}}}],"key":"Y3q03ea6wA"}],"key":"LmsGY3Soz5"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":647,"column":1},"end":{"line":648,"column":1}},"children":[{"type":"text","value":"In order to display in image or catalog in ","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"NYD7jPXD2Y"},{"type":"inlineCode","value":"Firefly","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"Y03wynIowP"},{"type":"text","value":", it needs to be uploaded to the ","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"mxfSWLitO6"},{"type":"inlineCode","value":"Firefly","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"uWdQXGxt8N"},{"type":"text","value":" server. We do this here using the ","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"S9lLSnEJHH"},{"type":"inlineCode","value":"upload_file()","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"Blj2MPx3Y4"},{"type":"text","value":" function.\nWe first upload the FITS image that we created above.","position":{"start":{"line":647,"column":1},"end":{"line":647,"column":1}},"key":"ujZsl2rjsx"}],"key":"puIio6PwvN"}],"key":"CQ2lcChmyT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fval = fc.upload_file('./data/euclid_images_test.fits')","key":"waBOcWjZKd"},{"type":"output","id":"rwu5GfLA99152QJ_gAYdU","data":[],"key":"zwm3R3nch3"}],"key":"GSnRerNJ8K"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":654,"column":1},"end":{"line":655,"column":1}},"children":[{"type":"text","value":"Once the image is uploaded we can use the ","position":{"start":{"line":654,"column":1},"end":{"line":654,"column":1}},"key":"DUrTst30Bz"},{"type":"inlineCode","value":"show_fits()","position":{"start":{"line":654,"column":1},"end":{"line":654,"column":1}},"key":"ZioWalhVOv"},{"type":"text","value":" function to display it.\nNote that our FITS image has multiple extensions (VIS, and NISP bands). We can open them separately in new ","position":{"start":{"line":654,"column":1},"end":{"line":654,"column":1}},"key":"YMguijUssc"},{"type":"inlineCode","value":"Firefly","position":{"start":{"line":654,"column":1},"end":{"line":654,"column":1}},"key":"bhkTem19CQ"},{"type":"text","value":" tabs by looping over the HDUs and specifying the plot ID by the extension’s name.","position":{"start":{"line":654,"column":1},"end":{"line":654,"column":1}},"key":"P0GzSQZ08Q"}],"key":"j5k3VB52hX"}],"key":"BupmpGwf6d"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"for hh,hdu in enumerate(hdulcutout):\n    fc.show_fits(fval, MultiImageIdx=hh, plot_id=hdu.header[\"EXTNAME\"] )","key":"GQ0739cqVU"},{"type":"output","id":"dBfw5UhLGm0Bl_ugzcT0n","data":[{"output_type":"stream","name":"stdout","text":"WARNING: show_fits() is deprecated. Use show_fits_image() instead.\nWARNING: show_fits() is deprecated. Use show_fits_image() instead.\nWARNING: show_fits() is deprecated. Use show_fits_image() instead.\n"},{"output_type":"stream","name":"stdout","text":"WARNING: show_fits() is deprecated. Use show_fits_image() instead.\n"}],"key":"D4maDlO1VI"}],"key":"ruF7SgB9v5"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":662,"column":1},"end":{"line":662,"column":1}},"children":[{"type":"text","value":"We can lock the WCS between the images (allowing the user to pan and zoom the images simultaneously) by running:","position":{"start":{"line":662,"column":1},"end":{"line":662,"column":1}},"key":"IxejvRLOrm"}],"key":"P4H1EPv4lx"}],"key":"NqPBs7Yl1H"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fc.align_images(lock_match=True)","key":"WNcPaN7jnz"},{"type":"output","id":"hnJvke2iAyalBApgFyd7e","data":[{"output_type":"execute_result","execution_count":45,"metadata":{},"data":{"text/plain":{"content":"{'success': True}","content_type":"text/plain"}}}],"key":"VkIw0mygCg"}],"key":"IWUKlk2o9c"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":668,"column":1},"end":{"line":668,"column":1}},"children":[{"type":"text","value":"In the same way, we can upload a table, in this case our Gaia table. We again use ","position":{"start":{"line":668,"column":1},"end":{"line":668,"column":1}},"key":"K16IWXoBWV"},{"type":"inlineCode","value":"upload_file()","position":{"start":{"line":668,"column":1},"end":{"line":668,"column":1}},"key":"ZfQmPuSWPm"},{"type":"text","value":" but in this case we use ","position":{"start":{"line":668,"column":1},"end":{"line":668,"column":1}},"key":"j7alox5JHn"},{"type":"inlineCode","value":"show_table()","position":{"start":{"line":668,"column":1},"end":{"line":668,"column":1}},"key":"Y5S4CIX5Q3"},{"type":"text","value":" to show it in ","position":{"start":{"line":668,"column":1},"end":{"line":668,"column":1}},"key":"Dy6Ek44KpI"},{"type":"inlineCode","value":"Firefly","position":{"start":{"line":668,"column":1},"end":{"line":668,"column":1}},"key":"nQjuaRi6y8"},{"type":"text","value":".","position":{"start":{"line":668,"column":1},"end":{"line":668,"column":1}},"key":"m4TdcQEOXf"}],"key":"yJjxNeVrgA"}],"key":"iZtSblKybS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"tval = fc.upload_file('./data/gaiatable.csv')\nfc.show_table(tval, tbl_id = \"gaiatable\")","key":"sussCkwL7Y"},{"type":"output","id":"dzKZ15B_v2283hv3PDJzQ","data":[{"output_type":"execute_result","execution_count":46,"metadata":{},"data":{"text/plain":{"content":"{'success': True}","content_type":"text/plain"}}}],"key":"pT60SIkyFr"}],"key":"FM0rf1P1lX"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":675,"column":1},"end":{"line":675,"column":1}},"children":[{"type":"text","value":"Now, check out the ","position":{"start":{"line":675,"column":1},"end":{"line":675,"column":1}},"key":"jQiun3W71N"},{"type":"inlineCode","value":"Firefly","position":{"start":{"line":675,"column":1},"end":{"line":675,"column":1}},"key":"D3Ls1oOPeI"},{"type":"text","value":" GUI. You can zoom the images, click on sources, filter the table, display different selection, and much more!","position":{"start":{"line":675,"column":1},"end":{"line":675,"column":1}},"key":"VDGY40Z4t7"}],"key":"lrvMPoOCZB"}],"key":"LZsZ8HnyEN"},{"type":"block","position":{"start":{"line":677,"column":1},"end":{"line":677,"column":1}},"children":[{"type":"thematicBreak","position":{"start":{"line":679,"column":1},"end":{"line":679,"column":1}},"key":"B4OpCBYNQR"},{"type":"heading","depth":2,"position":{"start":{"line":681,"column":1},"end":{"line":681,"column":1}},"children":[{"type":"text","value":"About this Notebook","position":{"start":{"line":681,"column":1},"end":{"line":681,"column":1}},"key":"KjNLZiqS34"}],"identifier":"about-this-notebook","label":"About this Notebook","html_id":"about-this-notebook","implicit":true,"key":"Vx0oK2DScz"},{"type":"paragraph","position":{"start":{"line":683,"column":1},"end":{"line":683,"column":1}},"children":[{"type":"strong","position":{"start":{"line":683,"column":1},"end":{"line":683,"column":1}},"children":[{"type":"text","value":"Author","position":{"start":{"line":683,"column":1},"end":{"line":683,"column":1}},"key":"w2XL0sk741"}],"key":"idfsSmvMUm"},{"type":"text","value":": Andreas Faisst (IPAC Scientist)","position":{"start":{"line":683,"column":1},"end":{"line":683,"column":1}},"key":"Pncvm96MTq"}],"key":"WQMg9smRau"},{"type":"paragraph","position":{"start":{"line":685,"column":1},"end":{"line":685,"column":1}},"children":[{"type":"strong","position":{"start":{"line":685,"column":1},"end":{"line":685,"column":1}},"children":[{"type":"text","value":"Updated","position":{"start":{"line":685,"column":1},"end":{"line":685,"column":1}},"key":"cqfFRQGBpE"}],"key":"b3BLQY4Zle"},{"type":"text","value":": 2025-03-17","position":{"start":{"line":685,"column":1},"end":{"line":685,"column":1}},"key":"ZWFKJ7f0gh"}],"key":"i53s3Q0oG4"},{"type":"paragraph","position":{"start":{"line":687,"column":1},"end":{"line":687,"column":1}},"children":[{"type":"strong","position":{"start":{"line":687,"column":1},"end":{"line":687,"column":1}},"children":[{"type":"text","value":"Contact","position":{"start":{"line":687,"column":1},"end":{"line":687,"column":1}},"key":"CDm7zMLw0b"}],"key":"SbrWNIQbnf"},{"type":"text","value":": the ","position":{"start":{"line":687,"column":1},"end":{"line":687,"column":1}},"key":"EJQMLrAhYw"},{"type":"link","url":"https://irsa.ipac.caltech.edu/docs/help_desk.html","position":{"start":{"line":687,"column":1},"end":{"line":687,"column":1}},"children":[{"type":"text","value":"IRSA Helpdesk","position":{"start":{"line":687,"column":1},"end":{"line":687,"column":1}},"key":"sN8AWxgBrU"}],"urlSource":"https://irsa.ipac.caltech.edu/docs/help_desk.html","key":"ToqaUV3uKO"},{"type":"text","value":" with questions or reporting problems.","position":{"start":{"line":687,"column":1},"end":{"line":687,"column":1}},"key":"zThJvffcDw"}],"key":"vnxqnO8GRQ"}],"key":"QH6m3Zl58h"}],"key":"hsvLfesgN9"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Understanding and Extracting the PSF Extension in a SPHEREx Cutout","url":"/spherex-psf","group":"SPHEREx"},"next":{"title":"Euclid Q1: MER mosaics","url":"/euclid-intro-mer-images","group":"Euclid Quick Release 1"}}},"domain":"http://localhost:3000"}