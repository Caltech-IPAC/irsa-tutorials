<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Number Density as a Function of Redshift - IRSA Tutorials</title><meta property="og:title" content="Number Density as a Function of Redshift - IRSA Tutorials"/><meta name="generator" content="mystmd"/><meta name="description" content="IRSA Python Notebook tutorials to demostrate accessing data served by the NASA/IPAC Infrared Science Archive (IRSA)"/><meta property="og:description" content="IRSA Python Notebook tutorials to demostrate accessing data served by the NASA/IPAC Infrared Science Archive (IRSA)"/><meta name="keywords" content="astronomy"/><link rel="stylesheet" href="/irsa-tutorials/build/_assets/app-5WKS5EPQ.css"/><link rel="stylesheet" href="/irsa-tutorials/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/irsa-tutorials/favicon.ico"/><link rel="stylesheet" href="/irsa-tutorials/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/irsa-tutorials/"><div class="p-1 mr-3 dark:bg-white dark:rounded"><img src="/irsa-tutorials/build/irsa_logo-4838d6221e15986e0fa2090441545420.png" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R74op:" data-state="closed" class="flex items-center h-10 aspect-square sm:w-64 text-left text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="hidden sm:block grow">Search</span><div aria-hidden="true" class="items-center hidden mx-1 font-mono text-sm text-gray-400 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">âŒ˜</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white"><a title="IRSA Tutorials" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/irsa-tutorials/">IRSA Tutorials</a><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="SPHEREx" class="block break-words rounded py-2 grow cursor-pointer">SPHEREx</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmp8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmp8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Euclid" class="block break-words rounded py-2 grow cursor-pointer">Euclid</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rup8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rup8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="WISE" class="block break-words rounded py-2 grow cursor-pointer">WISE</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16p8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16p8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Spitzer" class="block break-words rounded py-2 grow cursor-pointer">Spitzer</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1ep8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1ep8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2MASS" class="block break-words rounded py-2 grow cursor-pointer">2MASS</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1mp8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1mp8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="COSMOS" class="block break-words rounded py-2 grow cursor-pointer">COSMOS</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1up8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1up8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Simulated Data" class="block break-words rounded py-2 grow cursor-pointer">Simulated Data</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R26p8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R26p8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Special Topics" class="block break-words rounded py-2 grow cursor-pointer">Special Topics</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R2ep8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R2ep8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><article class="article content article-grid grid-gap"><main class="article-grid subgrid-gap col-screen"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="mb-8 pt-9"><div class="flex items-center h-6 mb-5 text-sm font-light"><div class="flex-none pr-2 smallcaps">IRSA Tutorials</div><div class="flex-grow"></div><a href="https://github.com/Caltech-IPAC/irsa-tutorials/" title="GitHub Repository: Caltech-IPAC/irsa-tutorials/" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><div class="inline-block mr-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block"><title>Jupyter Notebook</title><path d="M20.2 1.7c0 .8-.5 1.4-1.3 1.5-.8 0-1.4-.5-1.5-1.3 0-.8.5-1.4 1.3-1.5.8-.1 1.5.5 1.5 1.3zM12 17.9c-3.7 0-7-1.3-8.7-3.3 1.8 4.8 7.1 7.3 11.9 5.5 2.5-.9 4.5-2.9 5.5-5.5-1.7 2-4.9 3.3-8.7 3.3zM12 5.1c3.7 0 7 1.3 8.7 3.3-1.8-4.8-7.1-7.3-11.9-5.5-2.5.9-4.5 2.9-5.5 5.5 1.7-2 5-3.3 8.7-3.3zM6.9 21.8c.1 1-.7 1.8-1.7 1.9-1 .1-1.8-.7-1.9-1.7 0-1 .7-1.8 1.7-1.9 1-.1 1.8.7 1.9 1.7zM3.7 4.6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1c0 .5-.4 1-1 1z"></path></svg></div><a href="https://github.com/Caltech-IPAC/irsa-tutorials//blob/main/tutorials/roman_simulations/roman_hlss_number_density.md" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8top:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">Number Density as a Function of Redshift</h1><header class="mt-4 not-prose"><div><span class="font-semibold text-sm inline-block"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R78top:" data-state="closed">IRSA Scientists and Developers</button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><h2 id="learning-goals" class="relative group"><span class="heading-text">Learning Goals</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#learning-goals" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><ul><li>learn how to use the mock simulations for Roman Space Telescope <a target="_blank" rel="noreferrer" href="https://ui.adsabs.harvard.edu/abs/2021MNRAS.501.3490Z/abstract" class="">Zhai et al. 2021</a></li><li>modify code to reduce memory usage when using large catalogs</li><li>make a plot of number density of galaxies as a function of redshift (recreate figure 3 from <a target="_blank" rel="noreferrer" href="https://arxiv.org/pdf/2110.01829" class="">Wang et al., 2021</a>).</li></ul><h2 id="introduction" class="relative group"><span class="heading-text">Introduction</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#introduction" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><p>The Nancy Grace Roman Space Telescope will be a transformative tool for cosmology due to its unprecedented combination of wide field-of-view and high-resolution imaging. We choose to demonstrate the usefulness of the mock Roman suimulations in generating number density plots because they provide crucial insights into the large-scale structure of the universe and the distribution of matter over cosmic time. These plots illustrate how the number density of galaxies, quasars, or dark matter halos changes with redshift, revealing information about the processes of galaxy formation, evolution, and clustering. By analyzing number density plots, cosmologists can test theoretical models of structure formation, constrain cosmological parameters, and understand the influence of dark matter and dark energy on the evolution of the universe.</p><h3 id="instructions" class="relative group"><span class="heading-text">Instructions</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#instructions" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h3><p>Most of the notebook can be run with a single mock galaxy catalog file which easily fits in memory (3G). The final section uses all the data to make a final number density plot.  The dataset in its entirety does not fit into memory all at once(out of memory) so we have carefully designed this function to use the least possible amount of memory.  The dataset in its entirety also takes ~30 minutes to download and requires ~30G of space to store.  We suggest only running download_simulations with download_all= True if you are ready to wait for the download and have enough storage space.  Default is to work with only one catalog which is 10% of the dataset.</p><p>Techniques employed for working with out of memory datasets:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">- read in only some columns from the original dataset
- convert data from float64 to float32 where high precision is not necessary
- careful management of the code structure to not need to read in all datasets to one dataframe</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h3 id="input" class="relative group"><span class="heading-text">Input</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#input" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h3><ul><li>None, the location of the simulated dataset is hardcoded for convenience</li></ul><h3 id="output" class="relative group"><span class="heading-text">Output</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#output" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h3><ul><li>plots of number of galaxies per square degree as a function of redshift</li><li>optional numpy file with the counts saved for ease of working with the information later</li></ul><h2 id="imports" class="relative group"><span class="heading-text">Imports</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#imports" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><div id="npLC0k0JFH" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Uncomment the next line to install dependencies if needed.
# !pip install h5py pandas matplotlib numpy requests</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="-riBgRDh4NgoaIbjK5Mzr" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="MXH0lyEtW3" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import os
import matplotlib.pyplot as plt
import pandas as pd
import numpy as np
import concurrent.futures
import re
import h5py
import requests

%matplotlib inline</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="dactQql6bqzNPSc3epaRJ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-1-read-in-the-mock-catalogs-from-irsa" class="relative group"><span class="heading-text">1. Read in the mock catalogs from IRSA</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-read-in-the-mock-catalogs-from-irsa" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><ul><li>figure out how to get the files from IRSA</li><li>pull down one of them for testing</li><li>convert to a pandas df for ease of use</li><li>do some data exploration</li></ul><h3 id="id-1-1-download-the-files-from-irsa" class="relative group"><span class="heading-text">1.1 Download the files from IRSA</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-1-download-the-files-from-irsa" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h3><ul><li>This is about 30G of data in total</li></ul><div id="EDwkSRuBcd" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def download_file(file_url, save_path):
    &quot;&quot;&quot;
    Downloads a file from a given URL and saves it to a specified local path.
    The file is downloaded in chunks to reduce memory usage.

    Parameters:
    - file_url (str): The URL of the file to download.
    - save_path (str): The local path where the file will be saved.

    Returns:
    - str: The save_path if the download succeeds.

    Raises:
    - requests.HTTPError: If the HTTP request returned an unsuccessful status code.
    - OSError: If there is an issue creating directories or writing the file.
    &quot;&quot;&quot;
    response = requests.get(file_url, stream=True)
    response.raise_for_status()  # Raise an HTTPError for bad responses (4xx, 5xx)

    os.makedirs(os.path.dirname(save_path), exist_ok=True)
    with open(save_path, &#x27;wb&#x27;) as f:
        for chunk in response.iter_content(chunk_size=8192):  # 8KB chunks
            if chunk:  # Filter out keep-alive chunks
                f.write(chunk)

    print(f&quot;Downloaded: {save_path}&quot;)
    return save_path


def download_files_in_parallel(file_url_list, save_dir):
    &quot;&quot;&quot;
    Downloads multiple files in parallel using a ThreadPoolExecutor.

    Parameters:
    - file_url_list (list of str): List of file URLs to download.
    - save_dir (str): Directory where files will be saved.

    Returns:
    - list of str: List of paths where the files were successfully downloaded.
    &quot;&quot;&quot;
    downloaded_files = []
    #set to a reasonable number for efficiency and scalability
    max_workers = min(len(file_url_list), os.cpu_count() * 5, 32)  
    with concurrent.futures.ThreadPoolExecutor(max_workers=max_workers) as executor:
        future_to_url = {
            executor.submit(download_file, url, os.path.join(save_dir, os.path.basename(url))): url 
            for url in file_url_list
        }
        
        for future in concurrent.futures.as_completed(future_to_url):
            file_path = future.result()
            if file_path:
                downloaded_files.append(file_path)

    return downloaded_files

def download_simulations(download_dir, download_all=True):
    &quot;&quot;&quot;
    Download .hdf5 simulation files from the Roman Zhai2021 URL using the provided checksums.md5 file.

    This function reads the list of available .hdf5 files from the checksums.md5 file, filters them,
    and downloads the requested files to a specified directory. If a file already exists locally,
    it will be skipped.

    Parameters
    ----------
    download_dir : str
        Directory where the downloaded .hdf5 files will be stored. 
        The directory will be created if it does not already exist.

    download_all : bool, optional
        If True, download all .hdf5 files listed in the checksum file.
        If False, download only the first file. Default is True.

    Returns
    -------
    None
        This function does not return any value but prints the download status.

    Notes
    -----
    - Downloads are performed in parallel using a maximum of 4 workers.
    - Files that already exist locally are skipped.
    &quot;&quot;&quot;
    base_url = &#x27;https://irsa.ipac.caltech.edu/data/theory/Roman/Zhai2021&#x27;
    checksum_url = f&#x27;{base_url}/checksums.md5&#x27;

    # Read the checksums file to get the filenames
    df = pd.read_csv(checksum_url, sep=r&quot;\s+&quot;, names=[&quot;checksum&quot;, &quot;filename&quot;])
    hdf5_files = df[df[&quot;filename&quot;].str.endswith(&quot;.hdf5&quot;)][&quot;filename&quot;].tolist()

    if not download_all:
        hdf5_files = hdf5_files[:1]

    file_urls = [f&quot;{base_url}/{fname}&quot; for fname in hdf5_files]

    os.makedirs(download_dir, exist_ok=True)

    # Filter out files that already exist
    files_to_download = []
    for file_url in file_urls:
        filename = os.path.basename(file_url)
        file_path = os.path.join(download_dir, filename)
        if os.path.exists(file_path):
            print(f&quot;The file {filename} already exists. Skipping download.&quot;)
        else:
            files_to_download.append(file_url)

    if files_to_download:
        print(f&quot;Starting parallel download of {len(files_to_download)} files.&quot;)
        downloaded_files = download_files_in_parallel(files_to_download, download_dir)
        print(f&quot;Successfully downloaded {len(downloaded_files)} files.&quot;)
    else:
        print(&quot;All requested files are already downloaded.&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="FmaDEfEOCcmILQ2-HWSXp" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="BhfNWpHKdG" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Set download_all to True to download all files, or False to download only the first file
# only a single downloaded file is required to run the notebook in its entirety, 
# however section 4 will be more accuate with all 10 files

# Downloading 10 files, each 3GB in size, may take between 1 and 30 minutes,
# or even longer, depending on your proximity to the data.

download_dir = &#x27;downloaded_hdf5_files&#x27;
download_simulations(download_dir, download_all=False)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="nwx9gpdcwTak95xPnx6J1" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>Starting parallel download of 1 files.
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>Downloaded: downloaded_hdf5_files/Roman_small_V2_0.hdf5
Successfully downloaded 1 files.
</span></code></pre></div></div></div><h3 id="id-1-2-read-files-into-a-pandas-dataframe-so-we-can-work-with-them" class="relative group"><span class="heading-text">1.2 read files into a pandas dataframe so we can work with them</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-2-read-files-into-a-pandas-dataframe-so-we-can-work-with-them" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h3><div id="EDVigx16G9" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def fetch_column_names():
    &quot;&quot;&quot;
    Fetches column names from the Readme_small.txt file at the specified URL.

    Returns:
    - List of column names (str): A list of extracted column names, or an empty list if no column names are found.

    Raises:
    - HTTPError: If the HTTP request returns an unsuccessful status code.
    &quot;&quot;&quot;
    import requests
    import re

    url = &#x27;https://irsa.ipac.caltech.edu/data/theory/Roman/Zhai2021/Readme_small.txt&#x27;
    response = requests.get(url)
    response.raise_for_status()  # Raise an HTTPError for bad responses

    lines = response.text.splitlines()
    column_names = []

    for line in lines:
        if line.strip().lower().startswith(&#x27;column&#x27;):
            match = re.search(r&#x27;:\s*([^\s]+)&#x27;, line)
            if match:
                column_names.append(match.group(1))

    if column_names:
        return column_names
    else:
        print(&quot;No column names found in Readme_small.txt.&quot;)
        return []



def read_hdf5_to_pandas(file_path, columns_to_keep, columns_to_convert):
    &quot;&quot;&quot;
    Read selected columns from an HDF5 file into a pandas DataFrame.

    Parameters
    ----------
    file_path : str
        Path to the HDF5 file.
    columns_to_keep : list of str
        List of column names to extract from the dataset.
    columns_to_convert : list of str
        List of column names to convert to float32 for memory efficiency.

    Returns
    -------
    pandas.DataFrame
        A DataFrame containing the selected columns from the HDF5 file, 
        with specified columns cast to float32.
    &quot;&quot;&quot;
    # Map of column names to their corresponding index in the HDF5 dataset
    col_map = {
        &quot;RA&quot;: 0,
        &quot;DEC&quot;: 1,
        &quot;redshift_cosmological&quot;: 2,
        &quot;redshift_observed&quot;: 3,
        &quot;velocity&quot;: 4,
        &quot;stellar&quot;: 5,
        &quot;SFR&quot;: 6,
        &quot;halo&quot;: 7,
        &quot;flux_Halpha6563&quot;: 8,
        &quot;flux_OIII5007&quot;: 9,
        &quot;M_F158_Av1.6523&quot;: 10,
        &quot;nodeIsIsolated&quot;: 11
    }

    # Open the HDF5 file and extract only the requested columns
    with h5py.File(file_path, &quot;r&quot;) as file:
        dataset = file[&quot;data&quot;]
        data = {}
        for col in columns_to_keep:
            idx = col_map[col]
            data[col] = dataset[:, idx]

    # Create a DataFrame from the selected columns
    df = pd.DataFrame(data)

    # Convert specified columns to float32 to reduce memory usage
    conversion_map = {col: &quot;float32&quot; for col in columns_to_convert}
    df = df.astype(conversion_map)

    return df

def assign_redshift_bins(df, z_min, z_max, dz=0.1):
    &quot;&quot;&quot;
    Assign redshift bins to a DataFrame based on &#x27;redshift_observed&#x27;.

    Parameters
    ----------
    df : pandas.DataFrame
        The input DataFrame containing a &#x27;redshift_observed&#x27; column.
    z_min : float
        The minimum redshift for binning.
    z_max : float
        The maximum redshift for binning.
    dz : float, optional
        The redshift bin width (default is 0.1).

    Returns
    -------
    df : pandas.DataFrame
        The input DataFrame with a new &#x27;z_bin&#x27; categorical column.
    z_bins : numpy.ndarray
        The redshift bin edges used to define bins.
    z_bin_centers : list of float
        The central redshift value for each bin.
    &quot;&quot;&quot;
    z_bins = np.arange(z_min, z_max + dz, dz)
    df[&quot;z_bin&quot;] = pd.cut(df[&quot;redshift_observed&quot;], bins=z_bins, include_lowest=True, right=False)
    z_bin_centers = [np.mean([b.left, b.right]) for b in df[&quot;z_bin&quot;].cat.categories]
    z_bin_centers = sorted(z_bin_centers)
    return df, z_bins, z_bin_centers</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="2Tw3eL-P6S9tyeDF-tZrr" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Lqecg38uN1" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#don&#x27;t change this, the above code downloads the files to this directory
file_path = &#x27;downloaded_hdf5_files/Roman_small_V2_0.hdf5&#x27;

#out of consideration for the size of these files and the amount of memory required to work with them
# we only keep the columns that we are going to use and convert some to 32bit instead of 64 where 
# the higher precision is not necessary to the science
columns_to_keep = [&#x27;RA&#x27;, &#x27;DEC&#x27;, &#x27;redshift_observed&#x27;, &#x27;flux_Halpha6563&#x27;]
columns_to_convert = [&#x27;redshift_observed&#x27;, &#x27;flux_Halpha6563&#x27;]

df = read_hdf5_to_pandas(file_path, columns_to_keep, columns_to_convert)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="QZeGQRGmGF5l1W3urQADW" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-1-3-pre-process-dataset" class="relative group"><span class="heading-text">1.3 Pre-process dataset</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-3-pre-process-dataset" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h3><p>Add some value-added columns to the dataframe, and calculate some variables which are used by mulitple functions</p><div id="H311akqJ8x" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#add a binned redshift column and calculate the edges of the bins
z_min = 1.0
z_max = 3.0
dz = 0.1
df, z_bins, z_bin_centers = assign_redshift_bins(df, z_min=z_min, z_max=z_max, dz=dz)

#Shift RA values to continuous range for the entire DataFrame 
#This is necessary because the current range goes over 360 which appears to the code 
#as a non-contiguous section of the sky.  By shifting the RA values, we don&#x27;t have the 
#jump from RA = 360 to RA = 0.  
    
ra_min1=330
df[&#x27;RA_shifted&#x27;] = (df[&#x27;RA&#x27;] - ra_min1) % 360  # Shift RA to continuous range</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="kpcAJq2ybBKOhaLStwttY" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="yJnVfc9BTO" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#quick check to see what we&#x27;ve got:
df</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="0tsKMuETjRFO4vxWhThAp" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><h3 id="id-1-3-data-exploration" class="relative group"><span class="heading-text">1.3 Data Exploration</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-3-data-exploration" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h3><p>Letâ€™s explore the dataset a bit to see what we are working with.</p><p>This function prints the following information:</p><ul><li>First 5 rows of the DataFrame.</li><li>DataFrame info (data types, non-null counts).</li><li>Summary statistics for numeric columns.</li><li>Memory usage of the DataFrame and each column.</li><li>Column names.</li><li>Check for missing (NaN) values, including columns with NaNs and their counts.</li></ul><p>Note that quite a few of the z_bin values are NaN because they are outside the redshift range of interest for this plot (1 &lt; z &lt; 3)</p><div id="wLF0jLfDVQ" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Display the first 5 rows of the dataframe
df.head()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="BWX469sYFMX8eeaX63OQl" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="ioirH0hOgD" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Get general information about the dataframe (e.g., data types, non-null counts)
print(&quot;\nDataFrame info (Data Types, Non-null counts):&quot;)
df.info()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="0K1UJkLPzJ7c116tjwIKS" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>
DataFrame info (Data Types, Non-null counts):
&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;
RangeIndex: 29382943 entries, 0 to 29382942
Data columns (total 6 columns):
 #   Column             Dtype   
---  ------             -----   
 0   RA                 float64 
 1   DEC                float64 
 2   redshift_observed  float32 
 3   flux_Halpha6563    float32 
 4   z_bin              category
 5   RA_shifted         float64 
dtypes: category(1), float32(2), float64(3)
memory usage: 924.7 MB
</span></code></pre></div></div></div><div id="TvhAYGcUiF" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Display summary statistics for numeric columns
print(&quot;\nSummary statistics for numeric columns:&quot;)
df.describe()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="BdikQRDiMepB_9ZoyBK9D" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="DUrAfQiXzL" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Print memory usage of the DataFrame
print(&quot;\nMemory usage of the DataFrame:&quot;)
print(df.memory_usage(deep=True))  # Shows memory usage of each column
print(f&quot;Total memory usage: {df.memory_usage(deep=True).sum() / (1024**2):.2f} MB&quot;)  # Total memory usage in MB</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="uU5dkFo08ePFTgwrKVOdw" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>
Memory usage of the DataFrame:
Index                      132
RA                   235063544
DEC                  235063544
redshift_observed    117531772
flux_Halpha6563      117531772
z_bin                 29383819
RA_shifted           235063544
dtype: int64
Total memory usage: 924.72 MB
</span></code></pre></div></div></div><div id="tKBZz38ux7" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Check if there are any NaN (missing) values in the DataFrame
print(&quot;\nChecking for NaN (missing) values in the DataFrame:&quot;)
if df.isnull().any().any():
    print(&quot;There are NaN values in the DataFrame.&quot;)
    print(&quot;\nColumns with NaN values and the number of missing values in each:&quot;)
    print(df.isnull().sum())
else:
    print(&quot;There are no NaN values in the DataFrame.&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="embU-O8tmMwuftQiPeOYt" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>
Checking for NaN (missing) values in the DataFrame:
There are NaN values in the DataFrame.

Columns with NaN values and the number of missing values in each:
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>RA                          0
DEC                         0
redshift_observed           0
flux_Halpha6563             0
z_bin                14781902
RA_shifted                  0
dtype: int64
</span></code></pre></div></div></div><h2 id="id-2-0-make-some-helpful-histograms" class="relative group"><span class="heading-text">2.0 Make some helpful histograms</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-0-make-some-helpful-histograms" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><p>Do the numbers we are getting and their distributions make sense?</p><ul><li>plot of the number of galaxies as a function of dec bin</li><li>plot the number of galaxies per square degree as a function of dec bin</li></ul><div id="byTHra0WoX" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def get_bin_area(dec_edges, ra_width):
    &quot;&quot;&quot;
    Calculate the area of each Dec bin in square degrees, given the RA width.
    
    Parameters:
    - dec_edges: The edges of the Dec bins (1D array).
    - ra_width: The width of the RA bins in degrees.
    
    Returns:
    - areas: List of areas of the Dec bins in square degrees.
    &quot;&quot;&quot;
    dec_heights = np.diff(dec_edges)  # Heights of the Dec bins
    areas = []
    for i in range(len(dec_edges) - 1):
        dec_center = (dec_edges[i] + dec_edges[i+1]) / 2  # Center of the Dec bin
        area = ra_width * dec_heights[i] * np.cos(np.radians(dec_center))
        areas.append(area)

    return np.array(areas)
    
def calculate_counts_per_deg2(df):
    &quot;&quot;&quot;
    Computes galaxy number counts per square degree by binning data in declination.

    This function shifts Right Ascension (RA) values into a continuous range, 
    bins galaxies based on Declination (DEC), and calculates the number of galaxies 
    per square degree for each declination bin. It assumes a fixed declination range 
    and divides it into 10 equal bins. The function also computes bin areas to normalize 
    the galaxy counts.

    Parameters:
    - df (pd.DataFrame): A Pandas DataFrame containing at least the &#x27;RA&#x27; and &#x27;DEC&#x27; columns.

    Returns:
    - galaxy_counts (np.ndarray): An array containing the number of galaxies in each declination bin.
    - counts_per_deg2 (np.ndarray): An array of galaxy counts per square degree for each declination bin.
    - dec_bins (np.ndarray): The edges of the declination bins.

    &quot;&quot;&quot;
    
    # Compute RA edges based on the data
    ra_min = df[&#x27;RA_shifted&#x27;].min()
    ra_max = df[&#x27;RA_shifted&#x27;].max()
    ra_edges = np.linspace(ra_min, ra_max, 10 + 1)
    
    # Set up Declination bins for constant declination binning
    #manually fixing these here for this particular survey
    dec_min =  -20# df[&#x27;DEC&#x27;].min()
    dec_max =  20# df[&#x27;DEC&#x27;].max()
    dec_bins = np.linspace(dec_min, dec_max, 10 + 1)  # Create declination bins
    
    # Calculate bin areas for constant declination bins
    ra_width = np.diff(ra_edges)[0]  # Width of RA bins (all bins assumed equal width)
    bin_areas = get_bin_area(dec_bins, ra_width)

    df[&#x27;dec_bin&#x27;] = pd.cut(df[&#x27;DEC&#x27;], bins=dec_bins, include_lowest=True, right=False).astype(&#x27;category&#x27;)

    # Count galaxies in each Declination bin
    galaxy_counts = df.groupby(&#x27;dec_bin&#x27;, observed=False).size().values

    # Calculate galaxy counts per square degree
    counts_per_deg2 = galaxy_counts / bin_areas

    return galaxy_counts, counts_per_deg2, dec_bins

def plot_dec_bins(dec_bins, galaxy_counts):
    &quot;&quot;&quot;
    Plots a histogram of galaxy counts across declination bins.

    This function visualizes the number of galaxies in different declination (DEC) bins 
    using a bar plot. The y-axis is set to a logarithmic scale to enhance visibility of 
    variations in galaxy counts. The function assumes uniform bin sizes.

    Parameters:
    - dec_bins (np.ndarray): An array containing the edges of the declination bins.
    - galaxy_counts (np.ndarray): An array containing the number of galaxies in each declination bin.

     &quot;&quot;&quot;
    # Calculate the width of each bin (assumes uniform bin sizes)
    bin_width = dec_bins[1] - dec_bins[0]  
    
    
    # Plot the histogram for the DEC column with 10 bins
    plt.figure(figsize=(8, 6))
    plt.bar(dec_bins[:-1], galaxy_counts, width=bin_width, color=&#x27;skyblue&#x27;, edgecolor=&#x27;black&#x27;, align=&#x27;edge&#x27;)
    plt.xlabel(&#x27;Declination (DEC)&#x27;)
    plt.ylabel(&#x27;Number of Galaxies&#x27;)
    plt.title(&#x27;Galaxy counts as a function of declination&#x27;)
    plt.yscale(&#x27;log&#x27;)  # Set y-axis to logarithmic scale

    #plt.ylim(1e5, 1.6e5)  # Set y-axis range
    plt.grid(False)
    plt.show()
    plt.close()  # Explicitly close the plot

    
def plot_dec_bins_per_deg2(dec_bins, counts_per_deg2):
    &quot;&quot;&quot;
    Plots a histogram of galaxy number density across declination bins.

    This function visualizes the number of galaxies per square degree as a function 
    of declination using a bar plot. The y-axis is set to a logarithmic scale to 
    improve visibility of variations in galaxy density. The function assumes uniform 
    bin sizes.

    Parameters:
    - dec_bins (np.ndarray): An array containing the edges of the declination bins.
    - counts_per_deg2 (np.ndarray): An array containing the number of galaxies per square degree 
      for each declination bin.

    &quot;&quot;&quot;    # Calculate the width of each bin (assumes uniform bin sizes)
    bin_width = dec_bins[1] - dec_bins[0]  
    
    
    # Plot the histogram for the DEC column with 10 bins
    plt.figure(figsize=(8, 6))
    plt.bar(dec_bins[:-1], counts_per_deg2, width=bin_width, color=&#x27;skyblue&#x27;, edgecolor=&#x27;black&#x27;, align=&#x27;edge&#x27;)
    plt.xlabel(&#x27;Declination (DEC)&#x27;)
    plt.ylabel(&#x27;Number of galaxies per square degree&#x27;)
    plt.title(&#x27;Number density as a function of declination&#x27;)
    plt.yscale(&#x27;log&#x27;)  # Set y-axis to logarithmic scale
    #plt.ylim(1e5, 1.6e5)  # Set y-axis range
    plt.grid(False)
    plt.show()
    plt.close()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="eShAjPeenF2rsNmiRtRKp" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="y2AxZpXmXC" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">galaxy_counts, counts_per_deg2, dec_bins = calculate_counts_per_deg2(df)
plot_dec_bins(dec_bins, galaxy_counts)
plot_dec_bins_per_deg2(dec_bins, counts_per_deg2)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="6w1V1GRyl_erE5-FmDo4T" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/irsa-tutorials/build/823baca4641eeaed0ed8c67d841036db.png" alt="&lt;Figure size 800x600 with 1 Axes&gt;"/><img src="/irsa-tutorials/build/fe4d4169cef9fda443720e2ca31b282e.png" alt="&lt;Figure size 800x600 with 1 Axes&gt;"/></div></div><p>Figure Caption: Both plots have Declination on their X-axis.  The top panel shows the total number of galaxies.  The bottom panel shows the number of galaxies per square degree.  Note that they y-axis is displayed in a log scale, and shows a quite small range.  The goal of this plot is to explore the data a bit and see what variation we have as a function of declination bins.</p><h2 id="id-3-0-make-number-density-plot" class="relative group"><span class="heading-text">3.0 Make Number density plot</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-0-make-number-density-plot" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><p>This is a first pass at making a number density plot with just a single data file.  We divide the sample into 10 declination bins in order to do a jackknife sampling and obtain error bars for the plot. We choose to use constant dec bins instead of constant RA bins since area is function of cosine dec so we donâ€™t want to average over too much dec.</p><div id="IzBELmO00R" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def jackknife_galaxy_count(df, grid_cells=10):
    &quot;&quot;&quot;
    Calculate mean galaxy counts per square degree for each redshift bin, using jackknife resampling to estimate uncertainties.

    Parameters:
    df : pandas.DataFrame
        The DataFrame containing galaxy data, including &#x27;RA&#x27;, &#x27;DEC&#x27;, and &#x27;redshift_observed&#x27; columns.
    grid_cells : int, optional
        Number of bins to divide the declination range into for jackknife resampling (default: 10).
    
    Returns:
    - mean_counts: List of mean galaxy counts per square degree for each redshift bin.
    - std_dev_counts: List of jackknife uncertainties (standard deviations) for each redshift bin.
    - z_bin_centers: central values of the redshift bins
    &quot;&quot;&quot;
    original_galaxy_count = len(df)
    print(f&quot;Original galaxy count: {original_galaxy_count}&quot;)
    

 
    # compute RA edges based on the data
    #keeping this in here in case we make bins over RA in the future
    ra_min = df[&#x27;RA_shifted&#x27;].min()
    ra_max = df[&#x27;RA_shifted&#x27;].max()
    ra_edges = np.linspace(ra_min, ra_max, grid_cells + 1)
    
    # Set up Declination bins for constant declination binning
    #manually fixing these here for this particular survey
    dec_min =  -20# df[&#x27;DEC&#x27;].min()
    dec_max =  20# df[&#x27;DEC&#x27;].max()
    dec_bins = np.linspace(dec_min, dec_max, grid_cells + 1)  # Create declination bins
    
    # Calculate bin areas for constant declination bins
    ra_width = np.diff(ra_edges)[0]  # Width of RA bins (all bins assumed equal width)
    bin_areas = get_bin_area(dec_bins, ra_width)

    # Initialize lists 
    mean_counts = []
    std_dev_counts = []
    sum_counts = []
    
    # Loop over the redshift bins
    for z_bin in df[&#x27;z_bin&#x27;].cat.categories:
        # Step 8: Select galaxies within the current redshift bin
        df_z_bin = df[df[&#x27;z_bin&#x27;] == z_bin].copy()

        # Step 9: Bin galaxies into Declination bins using precomputed dec_bins
        # Explicitly cast the &#x27;ra_bin&#x27; column to &#x27;category&#x27; before assignment
        df_z_bin[&#x27;dec_bin&#x27;] = pd.cut(df_z_bin[&#x27;DEC&#x27;], bins=dec_bins, include_lowest=True, right=False).astype(&#x27;category&#x27;)

        #df_z_bin.loc[:, &#x27;dec_bin&#x27;] = pd.cut(df_z_bin[&#x27;DEC&#x27;], bins=dec_bins, include_lowest=True, right=False)
        #df_z_bin.loc[:, &#x27;dec_bin&#x27;] = df_z_bin[&#x27;dec_bin&#x27;].astype(&#x27;category&#x27;)  # Use .loc to avoid SettingWithCopyWarning

        # Step 10: Count galaxies in each Declination bin
        galaxy_counts = df_z_bin.groupby(&#x27;dec_bin&#x27;, observed=False).size().values

        # Step 11: Calculate mean galaxy counts per square degree
        counts_per_deg2 = galaxy_counts / bin_areas

        # Step 12: Compute jackknife resampling to estimate uncertainties
        jackknife_means = []
        for i in range(len(counts_per_deg2)):
            jackknife_sample = np.delete(counts_per_deg2, i)
            jackknife_means.append(np.mean(jackknife_sample))

        # Step 13: Calculate mean and standard deviation of galaxy counts per square degree
        mean_counts.append(np.mean(counts_per_deg2))
        std_dev_counts.append(np.std(jackknife_means))

    return mean_counts, std_dev_counts


def plot_galaxy_counts_vs_redshift_with_jackknife(counts, std_dev_counts, z_bin_centers):
    &quot;&quot;&quot;
    Plot the galaxy counts per square degree as a function of redshift with jackknife error bars.

    Parameters:
    - counts (numpy.ndarray): Array of galaxy counts per square degree for each redshift bin.
      Shape: (number of redshift bins,) or (1, number of redshift bins).
    - std_dev_counts (numpy.ndarray): Array of jackknife standard deviations for each redshift bin, 
      representing uncertainties. Shape: (number of redshift bins,).
    - z_bin_centers (numpy.ndarray): Array of central values of the redshift bins. 
      Shape: (number of redshift bins,).

    Notes:
    - The input arrays (`counts`, `std_dev_counts`, and `z_bin_centers`) must have the same length, 
      corresponding to the number of redshift bins.
    - The plot is designed specifically for redshifts in the range of 1.0 to 3.0 and may need adjustments 
      for datasets with different redshift ranges.
    &quot;&quot;&quot;
    # Ensure counts is a NumPy array
    if isinstance(counts, list):
        counts = np.array(counts)
    
    # Flatten counts if it has a shape of [1, N]
    if counts.ndim == 2 and counts.shape[0] == 1:
        counts = counts.flatten()

    # setup figure
    plt.figure(figsize=(10, 6))

    # Plot with error bars (with jackknife standard deviation as error bars)
    plt.errorbar(z_bin_centers, counts, yerr=std_dev_counts, fmt=&#x27;o&#x27;, color=&#x27;blue&#x27;, 
                 ecolor=&#x27;gray&#x27;, elinewidth=2, capsize=3, label=&#x27;Galaxy Counts per Square Degree (Jackknife)&#x27;)
    plt.yscale(&#x27;log&#x27;)

    # Set x-range to redshifts between 1 and 3
    plt.xlim(1, 3.0)
    plt.ylim(1E1, 3E5)

    # Add labels and title
    plt.xlabel(&#x27;Redshift&#x27;, fontsize=12)
    plt.ylabel(&#x27;Galaxy Count per Square Degree&#x27;, fontsize=12)
    plt.title(&#x27;Galaxy Counts per Square Degree vs Redshift with Jackknife Error Bars&#x27;, fontsize=14)

    # Show the plot
    plt.legend()
    plt.show()
    plt.close()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="R9LMoBPNWu8FZE25UDrXP" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="tBjCBdajMw" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time
#setup redshift binning here for consistency in the rest of the code
#these match our dataset, so only change if you want to reduce the range 
# or if you change the dataset

z_min = 1.0
z_max = 3.0
dz = 0.1

#do the counting
mean_counts, std_dev_counts = jackknife_galaxy_count(df, grid_cells=10)
#make the plot
plot_galaxy_counts_vs_redshift_with_jackknife(mean_counts, std_dev_counts, z_bin_centers)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="r62wLk5gqBRe84cDgnCuy" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>Original galaxy count: 29382943
</span></code></pre></div><img src="/irsa-tutorials/build/4ff0ee0ed91854c9eaf731031178c001.png" alt="&lt;Figure size 1000x600 with 1 Axes&gt;"/><div><pre class="text-sm font-thin font-system"><code><span>CPU times: user 2.57 s, sys: 59.5 ms, total: 2.63 s
Wall time: 2.65 s
</span></code></pre></div></div></div><p>Figure Caption: Number density plot.  Note that the jackknife error bars are displayed on the plot but they are smaller than the point size.  We see the expected shape of this plot, with a fall off toward higher redshift.</p><div id="pQY8UsJ71y" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#cleanup memory when done with this file:
del df</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="__3Dn5J1bWs8x7iCy8BLX" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-4-0-expand-to-out-of-memory-sized-catalogs" class="relative group"><span class="heading-text">4.0 Expand to out-of-memory sized catalogs</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-0-expand-to-out-of-memory-sized-catalogs" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><p>Originally this section attempted to use dask instead of pandas to hold the data and be able to do this work.  Dask is supposed to be able to do this sort of magic in the background with out of memory catalogs, but in reality, this does not seem to be possible, or at least not possible with a week or so of working on it.  Instead, we will read in the catalogs one at a time, store counts of mean and standard deviation per square degree and then move on to the next catalog.</p><div id="BnDDX1LyvI" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def calculate_area(df):
    &quot;&quot;&quot;
    Calculate the total survey area in square degrees based on DEC range and RA width.

    Parameters:
    - df: The DataFrame containing galaxy data.

    Returns:
    - area: Total survey area in square degrees.
    &quot;&quot;&quot;
    ra_min = df[&#x27;RA_shifted&#x27;].min()
    ra_max = df[&#x27;RA_shifted&#x27;].max()
    dec_min = df[&#x27;DEC&#x27;].min()
    dec_max = df[&#x27;DEC&#x27;].max()
     
    # Step 4: Calculate area
    ra_width = ra_max - ra_min 
    dec_height = dec_max - dec_min
 
    # Approximate area calculation
    dec_center = (dec_min + dec_max) / 2
    area = ra_width * dec_height * np.cos(np.radians(dec_center))

    return area</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="OgmKWui_JnkRtvsY1Vk4k" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="UfxGZ7oiZC" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def galaxy_counts_per_hdf5_binned(
    df,
    z_bins,
    z_bin_centers,
    find_halpha_bins=False,
    halpha_flux_thresholds=None,
):
    &quot;&quot;&quot;
    Calculate the galaxy counts per square degree for each redshift bin.
    Optionally calculate counts for Halpha flux bins.

    Parameters:
    - df (pandas.DataFrame): The input DataFrame containing galaxy data.
    - zbins (): edges of the redshift bins
    - z_bin_centers (numpy.ndarray): Array of central values of the redshift bins.
    - find_halpha_bins (bool, optional): Whether to calculate counts for Halpha bins (default: False).
    - halpha_flux_thresholds (list, optional): Custom thresholds for Halpha flux binning. If None, default thresholds are used.

    Returns:
    - counts_per_deg2 (numpy.ndarray): Array of galaxy counts per square degree for each redshift bin.
    - halpha_counts (numpy.ndarray): Counts for each Halpha bin (if `find_halpha_bins` is True).
    &quot;&quot;&quot;
    # Default Halpha flux thresholds if not provided
    if find_halpha_bins and halpha_flux_thresholds is None:
        halpha_flux_thresholds = [0.5e-16, 0.7e-16, 0.9e-16, 1.1e-16, 1.3e-16, 1.5e-16, 1.7e-16, 1.9e-16]
        
    # Calculate survey area
    area = calculate_area(df)

    # Initialize counts
    counts = np.zeros((1, len(z_bins) - 1))
    halpha_counts = None

    # Prepare for Halpha binning if requested
    if find_halpha_bins:
        halpha_counts = np.zeros((len(halpha_flux_thresholds), len(z_bins) - 1))

    # Group data by redshift bin
    grouped = df.groupby(&quot;z_bin&quot;, observed= False)

    for i, (z_bin, group) in enumerate(grouped):
        # Count galaxies in the redshift bin
        galaxy_count = len(group)
        counts[0, i] = galaxy_count

        if find_halpha_bins:
            # Count galaxies for each Halpha bin within the current redshift bin
            for j, threshold in enumerate(halpha_flux_thresholds):
                halpha_count = len(group[group[&quot;flux_Halpha6563&quot;] &gt; threshold])
                halpha_counts[j, i] = halpha_count
                #print(f&quot;redshift: {z_bin}, threshold: {threshold}, halpha_count: {halpha_count}, count: {galaxy_count}&quot;)


    # Sort results based on z_bin_centers
    sorted_indices = np.argsort(z_bin_centers)
    counts_per_deg2 = (counts / area)[:, sorted_indices]

    if find_halpha_bins:
        # Normalize Halpha counts to counts per square degree
        halpha_counts_per_deg2 = (halpha_counts / area)[:, sorted_indices]
    else:
        halpha_counts_per_deg2 = None

    return counts_per_deg2, halpha_counts_per_deg2
  
def plot_binned_galaxy_counts_vs_redshift_with_jackknife(
    counts_summary, z_bin_centers, halpha_flux_thresholds, halpha_summary,
    ):
    &quot;&quot;&quot;
    Plots galaxy counts per square degree as a function of redshift with jackknife error bars.

    This function visualizes the galaxy number density using binned redshift data. It includes 
    jackknife-based uncertainty estimates and optionally plots counts for HÎ± flux-selected bins.

    Parameters:
    - counts_summary (dict): A dictionary containing:
        - &#x27;sum_counts&#x27; (numpy.ndarray): Array of total galaxy counts per square degree for each redshift bin.
        - &#x27;std_dev_counts&#x27; (numpy.ndarray): Array of jackknife standard deviations for each redshift bin.
    - z_bin_centers (numpy.ndarray): Array of central values of the redshift bins.
    - halpha_flux_thresholds (list, optional): List of HÎ± flux threshold values (used for labeling the lines).
    - halpha_summary (dict, optional): A dictionary containing:
        - &#x27;halpha_sum_counts&#x27; (numpy.ndarray): Counts for each HÎ± flux-selected bin.
        - &#x27;halpha_std_dev_counts&#x27; (numpy.ndarray): Jackknife standard deviations for each HÎ± flux-selected bin.

    Notes:
    - The input arrays in `counts_summary` and `halpha_summary` must have the same length as `z_bin_centers`.
    - The function automatically sets the y-axis to a logarithmic scale (`plt.yscale(&quot;log&quot;)`).
    - The x-axis is limited to the redshift range [1, 3].
    - The function ensures proper memory management by explicitly closing the plot.
    &quot;&quot;&quot;
    # Unpack counts_summary
    counts = counts_summary[&quot;sum_counts&quot;]
    std_dev_counts = counts_summary[&quot;std_dev_counts&quot;]

    # Unpack halpha_summary if provided, otherwise set to None
    if halpha_summary is not None:
        halpha_counts = halpha_summary.get(&quot;halpha_sum_counts&quot;)
        halpha_std_dev_counts = halpha_summary.get(&quot;halpha_std_dev_counts&quot;)
    else:
        halpha_counts = None
        halpha_std_dev_counts = None

    # Ensure counts is a NumPy array
    if isinstance(counts, list):
        counts = np.array(counts)

    # Flatten counts if it has a shape of [1, N]
    if counts.ndim == 2 and counts.shape[0] == 1:
        counts = counts.flatten()

    # Setup figure
    plt.figure(figsize=(10, 6))

    # Plot the main counts with error bars
    jackknife_line = plt.errorbar(
        z_bin_centers, counts, yerr=std_dev_counts, fmt=&quot;o-&quot;, color=&quot;blue&quot;,
        ecolor=&quot;blue&quot;, elinewidth=2, capsize=3, label=&quot;All Galaxy Counts per Square Degree (Jackknife)&quot;
    )

    # Plot HÎ± bins if the data is present
    halpha_lines = []
    if halpha_flux_thresholds is not None and halpha_counts is not None:
        for i in range(len(halpha_flux_thresholds)):
            label = f&quot;Flux HÎ± &gt; {halpha_flux_thresholds[i]:.1e} erg/s/cmÂ²&quot;
            line, = plt.plot(z_bin_centers, halpha_counts[i], marker=&quot;o&quot;, label=label)
            halpha_lines.append(line)

    # Adjust legend order if HÎ± lines were added
    if halpha_lines:
        handles, labels = plt.gca().get_legend_handles_labels()
        new_order = [jackknife_line] + halpha_lines  
        plt.legend(new_order, [labels[handles.index(h)] for h in new_order])
    else:
        plt.legend()

    # Set log scale for y-axis and limit the x-axis
    plt.yscale(&quot;log&quot;)
    plt.xlim(1, 3.0)
    
    # Add labels and title
    plt.xlabel(&quot;Redshift&quot;, fontsize=12)
    plt.ylabel(&quot;Galaxy Count per Square Degree&quot;, fontsize=12)
    plt.title(&quot;Number Density with Jackknife Error Bars&quot;, fontsize=14)
    
    # Display the plot
    plt.show()
    plt.close()


def jackknife_wrapper(file_list,  halpha_flux_thresholds, find_halpha_bins=False):
    &quot;&quot;&quot;
    Performs jackknife resampling over multiple HDF5 files to estimate uncertainties 
    in galaxy counts per square degree for each redshift bin. Optionally calculates 
    counts for HÎ± flux-selected bins.

    Parameters:
    - file_list (list of str): List of file paths to HDF5 datasets to process.
    - halpha_flux_thresholds (list): List of HÎ± flux thresholds used for binning (if `find_halpha_bins` is True).
    - find_halpha_bins (bool, optional): Whether to calculate counts for HÎ± bins (default: False).

    Returns:
    - counts_summary (dict): A dictionary containing:
        - &#x27;sum_counts&#x27; (numpy.ndarray): Summed galaxy counts across all HDF5 files for each redshift bin.
          Shape: (number of redshift bins,).
        - &#x27;std_dev_counts&#x27; (numpy.ndarray): Jackknife standard deviations for galaxy counts per square degree.
          Shape: (number of redshift bins,).
       Shape: (number of redshift bins,).
    - halpha_summary (dict or None): A dictionary containing HÎ± bin statistics if `find_halpha_bins` is True, otherwise `None`. 
      When present, the dictionary includes:
        - &#x27;halpha_sum_counts&#x27; (numpy.ndarray): Summed counts for each HÎ± bin.
          Shape: (number of HÎ± bins, number of redshift bins).
        - &#x27;halpha_std_dev_counts&#x27; (numpy.ndarray): Jackknife standard deviations for HÎ± bins.
          Shape: (number of HÎ± bins, number of redshift bins).

    Notes:
    - The function loads multiple HDF5 files and extracts galaxy counts using `galaxy_counts_per_hdf5_binned()`.
    - Jackknife resampling is applied across files to compute standard deviations.
    - The function saves `all_counts` to a NumPy file for debugging purposes.
    - If `find_halpha_bins` is False, `halpha_summary` is returned as `None` to indicate that HÎ± binning was not performed.
    &quot;&quot;&quot;
    #fix these in case the above cells are not run
    ra_min1=330
    z_min = 1.0
    z_max = 3.0
    dz = 0.1
    columns_to_keep = [&#x27;RA&#x27;, &#x27;DEC&#x27;, &#x27;redshift_observed&#x27;, &#x27;flux_Halpha6563&#x27;]
    columns_to_convert = [&#x27;redshift_observed&#x27;, &#x27;flux_Halpha6563&#x27;]

    #setup to track counts
    all_counts = []
    all_halpha_counts = [] if find_halpha_bins else None

    for file in file_list:
        # Load data from the file
        df = read_hdf5_to_pandas(file, columns_to_keep, columns_to_convert)

        #pre-process dataset
        df, z_bins, z_bin_centers = assign_redshift_bins(df, z_min, z_max, dz)
        df[&#x27;RA_shifted&#x27;] = (df[&#x27;RA&#x27;] - ra_min1) % 360  # Shift RA to continuous range

        # Get counts (with or without Halpha binning)
        result = galaxy_counts_per_hdf5_binned(
            df, z_bins, z_bin_centers, find_halpha_bins=find_halpha_bins,
            halpha_flux_thresholds=halpha_flux_thresholds
        )
        
        counts_per_deg2, halpha_counts_per_deg2 = result 
        all_counts.append(counts_per_deg2.flatten())  #make sure shape is correct
        
        if find_halpha_bins:
            all_halpha_counts.append(halpha_counts_per_deg2)

        # Explicitly delete DataFrame for improved memory management
        del df

    # Save all_counts to a file for debugging or post-processing
    os.makedirs(&quot;output&quot;, exist_ok=True)
    np.save(&quot;output/all_counts.npy&quot;, all_counts)

    # Convert to NumPy array for easier manipulation
    all_counts = np.array(all_counts)

    #debugging
    print(&quot;all_counts shape:&quot;, all_counts.shape)
    print(&quot;all_counts sample:&quot;, all_counts[:3])  # preview first 3 entries
    print(&quot;all_counts variance:&quot;, np.var(all_counts, axis=0))
    print(&quot;all_counts dtype:&quot;, all_counts.dtype)
    
    if find_halpha_bins:
        all_halpha_counts = np.array(all_halpha_counts)

    # Compute sum counts
    sum_counts = np.sum(all_counts, axis=0)

    # Compute jackknife standard deviations for galaxy counts
    std_dev_counts = np.sqrt(
        (len(all_counts) - 1) * np.var(all_counts, axis=0, ddof=0)
    )

    # Create counts summary dictionary
    counts_summary = {
        &quot;sum_counts&quot;: sum_counts,
        &quot;std_dev_counts&quot;: std_dev_counts
    }

    # Compute jackknife standard deviations for Halpha counts (if applicable)
    if find_halpha_bins:
        halpha_sum_counts = np.sum(all_halpha_counts, axis=0)
        halpha_std_dev_counts = np.sqrt(
            (len(all_halpha_counts) - 1) * np.var(all_halpha_counts, axis=0, ddof=0)
        )
        # Create halpha counts summary dictionary
        halpha_summary = {
            &quot;halpha_sum_counts&quot;: halpha_sum_counts,
            &quot;halpha_std_dev_counts&quot;: halpha_std_dev_counts
        }
    else:
        halpha_summary = None  # No Halpha binning

    return counts_summary, halpha_summary</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Fo1sJR2KLobp8Xf2M1Rti" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="aXcN0ZzYRN" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time

# This uses data downloaded in section 1 above.  
# If you want to run this with more data, return to section 1 to get that downloaded.
download_dir = &#x27;downloaded_hdf5_files&#x27;
# Get all HDF5 files from the directory
file_paths = [os.path.join(download_dir, f) for f in os.listdir(download_dir) if f.endswith(&#x27;.hdf5&#x27;)]

#out of consideration for the size of these files and the amount of memory required to work with them
# we only keep the columns that we are going to use and convert some to 32bit instead of 64 where 
# the higher precision is not necessary to the science
columns_to_keep = [&#x27;RA&#x27;, &#x27;DEC&#x27;, &#x27;redshift_observed&#x27;, &#x27;flux_Halpha6563&#x27;]
columns_to_convert = [&#x27;redshift_observed&#x27;, &#x27;flux_Halpha6563&#x27;]

# Run jackknife with Halpha binning enabled
halpha_flux_thresholds=[0.5e-16, 0.7e-16, 0.9e-16, 1.1e-16, 1.3e-16, 1.5e-16, 1.7e-16, 1.9e-16]
results = jackknife_wrapper(
    file_paths, halpha_flux_thresholds, find_halpha_bins=True
)

# Unpack results
counts_summary, halpha_summary = results

# Plot the results
plot_binned_galaxy_counts_vs_redshift_with_jackknife(
    counts_summary, z_bin_centers, halpha_flux_thresholds, halpha_summary)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="JKDfPidwj9PbxmaRJoc1U" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>all_counts shape: (1, 20)
all_counts sample: [[908.19889809 747.2333674  794.9342837  676.17631576 655.19747312
  588.94982189 513.17670351 456.29600034 383.57721419 330.13751134
  267.43061388 217.22499701 175.30681804 144.16250588 112.40633963
   85.80426641  63.65060463  43.55867883  29.37146612  17.62327474]]
all_counts variance: [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]
all_counts dtype: float64
</span></code></pre></div><img src="/irsa-tutorials/build/63b0962c8fa364a02bdd6e4f049b146e.png" alt="&lt;Figure size 1000x600 with 1 Axes&gt;"/><div><pre class="text-sm font-thin font-system"><code><span>CPU times: user 5.53 s, sys: 10.1 s, total: 15.6 s
Wall time: 32.7 s
</span></code></pre></div></div></div><p>Figure Caption: Number Density plots color coded by Halpha flux.  Slight variations are noted in the shape of the curves as a function of Halpha flux, especially at higher redshifts.  This plot may be a factor of 10 below the section 3 number density plot if you have not let it download all 10 input files.  The 10 input files cover the same area on the sky, so the density will look smaller if fewer files are used.</p><h3 id="id-4-1-explore-jackknife-uncertainties" class="relative group"><span class="heading-text">4.1 Explore jackknife uncertainties</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-1-explore-jackknife-uncertainties" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h3><p>The uncertainties are plotted as error bars on the data points above.  There are no jackknife uncertainties if you are only using one file, so they will in that case not be visible on the plot.  This section is for the case where you are using more than one downloaded input file.  Here we explore and plot the jackknife uncertainties in a way that makes them visible.</p><div id="MbcUUb3Yxo" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def plot_jackknife_fractional_uncertainty(z_bin_centers, counts, std_dev_counts):
    &quot;&quot;&quot;
    Plots the fractional jackknife uncertainty (Ïƒ / N) as a function of redshift.
    
    Parameters
    ----------
    z_bin_centers : array-like
        The center of each redshift bin.
    counts : array-like
        The total galaxy counts per redshift bin.
    std_dev_counts : array-like
        The jackknife standard deviation per redshift bin.
    &quot;&quot;&quot;
    fractional_uncertainty = std_dev_counts / counts

    plt.figure(figsize=(8, 5))
    plt.plot(z_bin_centers, fractional_uncertainty, marker=&#x27;o&#x27;, linestyle=&#x27;-&#x27;, color=&#x27;purple&#x27;)
    #plt.ylim(0, 0.01)
    plt.xlabel(&#x27;Redshift&#x27;)
    plt.ylabel(&#x27;Fractional Uncertainty&#x27;)
    plt.title(&#x27;Jackknife Fractional Uncertainty vs. Redshift&#x27;)
    plt.grid(True)
    plt.tight_layout()
    plt.show()
    plt.close()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="wsEFAx_DTQWO_Iq-CwPlP" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="eq2htuWrRm" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#make fractional uncertainty plot
counts_per_deg2 = counts_summary[&quot;sum_counts&quot;].flatten()
std_dev_counts = counts_summary[&quot;std_dev_counts&quot;].flatten()
plot_jackknife_fractional_uncertainty(z_bin_centers, counts_per_deg2, std_dev_counts)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="2O6fnrnleSyC4J8afW_Zd" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/irsa-tutorials/build/5607e99ff2829fc0c30bebd4be6c8607.png" alt="&lt;Figure size 800x500 with 1 Axes&gt;"/></div></div><p>Figure Caption:  The fractional uncertainty is the standard deviation from jackknife sampling divided by the number of galaxies per square degree, here plotted as a function of redshift.  Note that if you are using only 1 downloaded file this will be a flat plot with no uncertainties.  However, if you are using all 10 input files, you will see the expected rise in uncertainty with increasing redshift.</p><h2 id="acknowledgements" class="relative group"><span class="heading-text">Acknowledgements</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#acknowledgements" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><ul><li><a target="_blank" rel="noreferrer" href="https://irsa.ipac.caltech.edu/" class="">IPAC-IRSA</a></li></ul><h2 id="about-this-notebook" class="relative group"><span class="heading-text">About this notebook</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#about-this-notebook" title="Link to this Section" aria-label="Link to this Section">Â¶</a></h2><p><strong>Authors</strong>: Jessica Krick in conjunction with the IPAC Science Platform Team</p><p><strong>Contact:</strong> <a target="_blank" rel="noreferrer" href="https://irsa.ipac.caltech.edu/docs/help_desk.html" class="">IRSA Helpdesk</a> with questions
or problems.</p><p><strong>Updated:</strong> 2025-04-01</p><p><strong>Runtime:</strong> As of the date above, running on the <a target="_blank" rel="noreferrer" href="https://pcos.gsfc.nasa.gov/Fornax/" class="">Fornax Science Platform</a>, this notebook takes about 9 minutes to run to completion on
a machine with 8GB RAM and 4 CPU.
This runtime inlcudes the notebook as is, using only one datafile out of 10.  Runtime will be greater than 30 min. longer if the code is allowed to download and work with all 10 datafiles.</p><div id="zwufBg4Q1B" class="relative group/block"><div class="flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"></code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="rXMUlKsEksguEnfsVf9Ib" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div></div><div class="flex pt-10 mb-10 space-x-4"><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/irsa-tutorials/sia-cosmos"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="text-xs text-gray-500 dark:text-gray-400">COSMOS</div>Searching for contributed COSMOS images</div></div></a><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/irsa-tutorials/openuniverse2024-roman-simulated-wideareasurvey"><div class="flex h-full align-middle"><div class="flex-grow"><div class="text-xs text-gray-500 dark:text-gray-400">OpenUniverse 2024</div>Analyzing cloud-hosted simulated Roman coadded images</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></main></article><script>((a,d)=>{if(!window.history.state||!window.history.state.key){let h=Math.random().toString(32).slice(2);window.history.replaceState({key:h},"")}try{let f=JSON.parse(sessionStorage.getItem(a)||"{}")[d||window.history.state.key];typeof f=="number"&&window.scrollTo(0,f)}catch(h){console.error(h),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/irsa-tutorials/build/entry.client-UNPC4GT3.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-OCTKKCIL.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-UAI5KRM7.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-JSE36H2O.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-HBJK6BW3.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-HYMQ7M2K.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-OHOXABTA.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-C7FW3E47.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-3CVK3PYF.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-ND43KHSX.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/irsa-tutorials/build/root-IB5726YR.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-NBON2RSI.js"/><link rel="modulepreload" href="/irsa-tutorials/build/routes/$-LXLHKVOR.js"/><script>window.__remixContext = {"url":"/roman-hlss-number-density","state":{"loaderData":{"root":{"config":{"version":2,"myst":"1.6.0","options":{"outline_maxdepth":1,"favicon":"/irsa-tutorials/build/irsa-favicon-f300551b94351526a1e53301ef5b12d8.ico","logo":"/irsa-tutorials/build/irsa_logo-4838d6221e15986e0fa2090441545420.png"},"nav":[],"actions":[],"projects":[{"subject":"IRSA Tutorials","settings":{"output_matplotlib_strings":"remove"},"title":"IRSA Tutorials","description":"IRSA Python Notebook tutorials to demostrate accessing data served by the NASA/IPAC Infrared Science Archive (IRSA)","authors":[{"id":"IRSA Scientists and Developers","name":"IRSA Scientists and Developers"}],"github":"https://github.com/Caltech-IPAC/irsa-tutorials/","keywords":["astronomy"],"toc":[{"file":"index.md","title":"IRSA Tutorials"},{"children":[{"file":"tutorials/spherex/spherex_intro.md"}],"title":"SPHEREx"},{"children":[{"children":[{"file":"tutorials/euclid_access/Euclid_ERO.md"}],"title":"Euclid Early Release Observations"},{"children":[{"file":"tutorials/euclid_access/1_Euclid_intro_MER_images.md"},{"file":"tutorials/euclid_access/2_Euclid_intro_MER_catalog.md"},{"file":"tutorials/euclid_access/3_Euclid_intro_1D_spectra.md"},{"file":"tutorials/euclid_access/4_Euclid_intro_PHZ_catalog.md"},{"file":"tutorials/euclid_access/5_Euclid_intro_SPE_catalog.md"},{"file":"tutorials/cloud_access/euclid-cloud-access.md"}],"title":"Euclid Quick Release 1"}],"title":"Euclid"},{"children":[{"children":[{"file":"tutorials/irsa-sia-examples/sia_allwise_atlas.md"},{"file":"tutorials/parquet-catalog-demos/wise-allwise-catalog-demo.md"}],"title":"AllWISE"},{"children":[{"file":"tutorials/firefly/NEOWISE_light_curve_demo.md"},{"file":"tutorials/parquet-catalog-demos/neowise-source-table-strategies.md"},{"file":"tutorials/parquet-catalog-demos/neowise-source-table-lightcurves.md"}],"title":"NEOWISE"}],"title":"WISE"},{"children":[{"file":"tutorials/irsa-sia-examples/siav2_seip.md"}],"title":"Spitzer"},{"children":[{"file":"tutorials/irsa-sia-examples/sia_2mass_allsky.md"}],"title":"2MASS"},{"children":[{"file":"tutorials/irsa-sia-examples/sia_cosmos.md"}],"title":"COSMOS"},{"children":[{"children":[{"file":"tutorials/roman_simulations/roman_hlss_number_density.md"}],"title":"Roman HLSS Galaxy Mock Catalog"},{"children":[{"file":"tutorials/openuniversesims/openuniverse2024_roman_simulated_wideareasurvey.md"},{"file":"tutorials/firefly/OpenUniverse2024Preview_Firefly.md"},{"file":"tutorials/openuniversesims/openuniverse2024_roman_simulated_timedomainsurvey.md"}],"title":"OpenUniverse 2024"},{"children":[{"file":"tutorials/cosmodc2/cosmoDC2_TAP_access.md"}],"title":"CosmoDC2"}],"title":"Simulated Data"},{"children":[{"file":"tutorials/cloud_access/cloud-access-intro.md"},{"file":"tutorials/firefly/SEDs_in_Firefly.md"},{"file":"tutorials/parallelize/Parallelize_Convolution.md"}],"title":"Special Topics"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"SPHEREx"},{"slug":"spherex-intro","title":"Introduction to SPHEREx Spectral Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Euclid"},{"level":2,"title":"Euclid Early Release Observations"},{"slug":"euclid-ero","title":"Exploring Star Clusters in the Euclid ERO Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":2,"title":"Euclid Quick Release 1"},{"slug":"euclid-intro-mer-images","title":"Euclid Q1: MER mosaics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-intro-mer-catalog","title":"Euclid Q1: MER catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-intro-1d-spectra","title":"Euclid Q1: 1D spectra","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-intro-phz-catalog","title":"Euclid Q1: PHZ catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-intro-spe-catalog","title":"Euclid Q1: SPE catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-cloud-access","title":"Euclid Q1: cloud access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"WISE"},{"level":2,"title":"AllWISE"},{"slug":"sia-allwise-atlas","title":"Searching for AllWISE Atlas Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"wise-allwise-catalog-demo","title":"Analyzing cloud-hosted AllWISE Source Catalog in Parquet format","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":2,"title":"NEOWISE"},{"slug":"neowise-light-curve-demo","title":"Using Firefly visualization tools to understand the light curves of Solar System objects","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"neowise-source-table-strategies","title":"Strategies to Efficiently Work with NEOWISE Single-exposure Source Table in Parquet","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"neowise-source-table-lightcurves","title":"Make Light Curves from NEOWISE Single-exposure Source Table","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Spitzer"},{"slug":"siav2-seip","title":"Searching for Spitzer Enhanced Imaging Products","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"2MASS"},{"slug":"sia-2mass-allsky","title":"Searching for 2MASS All-Sky Atlas Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"COSMOS"},{"slug":"sia-cosmos","title":"Searching for contributed COSMOS images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Simulated Data"},{"level":2,"title":"Roman HLSS Galaxy Mock Catalog"},{"slug":"roman-hlss-number-density","title":"Number Density as a Function of Redshift","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":2,"title":"OpenUniverse 2024"},{"slug":"openuniverse2024-roman-simulated-wideareasurvey","title":"Analyzing cloud-hosted simulated Roman coadded images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"openuniverse2024preview-firefly","title":"Using Firefly to Explore OpenUniverse2024 Data Preview Simulated Roman and Rubin Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"openuniverse2024-roman-simulated-timedomainsurvey","title":"Analyzing cloud-hosted simulated Roman Time Domain Survey images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":2,"title":"CosmoDC2"},{"slug":"cosmodc2-tap-access","title":"Querying CosmoDC2 Mock v1 catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Special Topics"},{"slug":"cloud-access-intro","title":"IRSA cloud access introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"seds-in-firefly","title":"Using Firefly visualization tools in Python to vet SEDs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"parallelize-convolution","title":"Parallelizing image convolution","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/irsa-tutorials"},"routes/$":{"config":{"version":2,"myst":"1.6.0","options":{"outline_maxdepth":1,"favicon":"/irsa-tutorials/build/irsa-favicon-f300551b94351526a1e53301ef5b12d8.ico","logo":"/irsa-tutorials/build/irsa_logo-4838d6221e15986e0fa2090441545420.png"},"nav":[],"actions":[],"projects":[{"subject":"IRSA Tutorials","settings":{"output_matplotlib_strings":"remove"},"title":"IRSA Tutorials","description":"IRSA Python Notebook tutorials to demostrate accessing data served by the NASA/IPAC Infrared Science Archive (IRSA)","authors":[{"id":"IRSA Scientists and Developers","name":"IRSA Scientists and Developers"}],"github":"https://github.com/Caltech-IPAC/irsa-tutorials/","keywords":["astronomy"],"toc":[{"file":"index.md","title":"IRSA Tutorials"},{"children":[{"file":"tutorials/spherex/spherex_intro.md"}],"title":"SPHEREx"},{"children":[{"children":[{"file":"tutorials/euclid_access/Euclid_ERO.md"}],"title":"Euclid Early Release Observations"},{"children":[{"file":"tutorials/euclid_access/1_Euclid_intro_MER_images.md"},{"file":"tutorials/euclid_access/2_Euclid_intro_MER_catalog.md"},{"file":"tutorials/euclid_access/3_Euclid_intro_1D_spectra.md"},{"file":"tutorials/euclid_access/4_Euclid_intro_PHZ_catalog.md"},{"file":"tutorials/euclid_access/5_Euclid_intro_SPE_catalog.md"},{"file":"tutorials/cloud_access/euclid-cloud-access.md"}],"title":"Euclid Quick Release 1"}],"title":"Euclid"},{"children":[{"children":[{"file":"tutorials/irsa-sia-examples/sia_allwise_atlas.md"},{"file":"tutorials/parquet-catalog-demos/wise-allwise-catalog-demo.md"}],"title":"AllWISE"},{"children":[{"file":"tutorials/firefly/NEOWISE_light_curve_demo.md"},{"file":"tutorials/parquet-catalog-demos/neowise-source-table-strategies.md"},{"file":"tutorials/parquet-catalog-demos/neowise-source-table-lightcurves.md"}],"title":"NEOWISE"}],"title":"WISE"},{"children":[{"file":"tutorials/irsa-sia-examples/siav2_seip.md"}],"title":"Spitzer"},{"children":[{"file":"tutorials/irsa-sia-examples/sia_2mass_allsky.md"}],"title":"2MASS"},{"children":[{"file":"tutorials/irsa-sia-examples/sia_cosmos.md"}],"title":"COSMOS"},{"children":[{"children":[{"file":"tutorials/roman_simulations/roman_hlss_number_density.md"}],"title":"Roman HLSS Galaxy Mock Catalog"},{"children":[{"file":"tutorials/openuniversesims/openuniverse2024_roman_simulated_wideareasurvey.md"},{"file":"tutorials/firefly/OpenUniverse2024Preview_Firefly.md"},{"file":"tutorials/openuniversesims/openuniverse2024_roman_simulated_timedomainsurvey.md"}],"title":"OpenUniverse 2024"},{"children":[{"file":"tutorials/cosmodc2/cosmoDC2_TAP_access.md"}],"title":"CosmoDC2"}],"title":"Simulated Data"},{"children":[{"file":"tutorials/cloud_access/cloud-access-intro.md"},{"file":"tutorials/firefly/SEDs_in_Firefly.md"},{"file":"tutorials/parallelize/Parallelize_Convolution.md"}],"title":"Special Topics"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"SPHEREx"},{"slug":"spherex-intro","title":"Introduction to SPHEREx Spectral Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Euclid"},{"level":2,"title":"Euclid Early Release Observations"},{"slug":"euclid-ero","title":"Exploring Star Clusters in the Euclid ERO Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":2,"title":"Euclid Quick Release 1"},{"slug":"euclid-intro-mer-images","title":"Euclid Q1: MER mosaics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-intro-mer-catalog","title":"Euclid Q1: MER catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-intro-1d-spectra","title":"Euclid Q1: 1D spectra","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-intro-phz-catalog","title":"Euclid Q1: PHZ catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-intro-spe-catalog","title":"Euclid Q1: SPE catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-cloud-access","title":"Euclid Q1: cloud access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"WISE"},{"level":2,"title":"AllWISE"},{"slug":"sia-allwise-atlas","title":"Searching for AllWISE Atlas Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"wise-allwise-catalog-demo","title":"Analyzing cloud-hosted AllWISE Source Catalog in Parquet format","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":2,"title":"NEOWISE"},{"slug":"neowise-light-curve-demo","title":"Using Firefly visualization tools to understand the light curves of Solar System objects","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"neowise-source-table-strategies","title":"Strategies to Efficiently Work with NEOWISE Single-exposure Source Table in Parquet","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"neowise-source-table-lightcurves","title":"Make Light Curves from NEOWISE Single-exposure Source Table","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Spitzer"},{"slug":"siav2-seip","title":"Searching for Spitzer Enhanced Imaging Products","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"2MASS"},{"slug":"sia-2mass-allsky","title":"Searching for 2MASS All-Sky Atlas Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"COSMOS"},{"slug":"sia-cosmos","title":"Searching for contributed COSMOS images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Simulated Data"},{"level":2,"title":"Roman HLSS Galaxy Mock Catalog"},{"slug":"roman-hlss-number-density","title":"Number Density as a Function of Redshift","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":2,"title":"OpenUniverse 2024"},{"slug":"openuniverse2024-roman-simulated-wideareasurvey","title":"Analyzing cloud-hosted simulated Roman coadded images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"openuniverse2024preview-firefly","title":"Using Firefly to Explore OpenUniverse2024 Data Preview Simulated Roman and Rubin Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"openuniverse2024-roman-simulated-timedomainsurvey","title":"Analyzing cloud-hosted simulated Roman Time Domain Survey images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":2,"title":"CosmoDC2"},{"slug":"cosmodc2-tap-access","title":"Querying CosmoDC2 Mock v1 catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Special Topics"},{"slug":"cloud-access-intro","title":"IRSA cloud access introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"seds-in-firefly","title":"Using Firefly visualization tools in Python to vet SEDs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"parallelize-convolution","title":"Parallelizing image convolution","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":2,"kind":"Notebook","sha256":"cacce51f714e41cc3f302b0723510b08f0f12758cd82f711995a58fd8b1a8acb","slug":"roman-hlss-number-density","location":"/tutorials/roman_simulations/roman_hlss_number_density.md","dependencies":[],"frontmatter":{"title":"Number Density as a Function of Redshift","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{"formats":"md:myst","text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.15.2"}},"content_includes_title":false,"authors":[{"id":"IRSA Scientists and Developers","name":"IRSA Scientists and Developers"}],"github":"https://github.com/Caltech-IPAC/irsa-tutorials/","subject":"IRSA Tutorials","keywords":["astronomy"],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":2}},"edit_url":"https://github.com/Caltech-IPAC/irsa-tutorials//blob/main/tutorials/roman_simulations/roman_hlss_number_density.md","exports":[{"format":"md","filename":"roman_hlss_number_density.md","url":"/irsa-tutorials/build/roman_hlss_number_de-acba9b8b39cfeb4247f9dd608965423a.md"}]},"mdast":{"type":"root","children":[{"type":"block","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Learning Goals","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"hrWMlPgPZw"}],"identifier":"learning-goals","label":"Learning Goals","html_id":"learning-goals","implicit":true,"key":"ELCiP7ud6j"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":20,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"learn how to use the mock simulations for Roman Space Telescope ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"YLvYFMTkCp"},{"type":"link","url":"https://ui.adsabs.harvard.edu/abs/2021MNRAS.501.3490Z/abstract","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Zhai et al. 2021","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"DSB6m3R6pY"}],"urlSource":"https://ui.adsabs.harvard.edu/abs/2021MNRAS.501.3490Z/abstract","key":"VcoBJbAC1V"}],"key":"Je9ZjUuCGd"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"modify code to reduce memory usage when using large catalogs","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"ZphVNMSSwu"}],"key":"UDliXxXIQX"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"make a plot of number density of galaxies as a function of redshift (recreate figure 3 from ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"k4WAXB6AgQ"},{"type":"link","url":"https://arxiv.org/pdf/2110.01829","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Wang et al., 2021","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"z0RGu4gR4W"}],"urlSource":"https://arxiv.org/pdf/2110.01829","key":"NsvkiWdBo9"},{"type":"text","value":").","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"ICjqHEGZDR"}],"key":"hZftrbqnUz"}],"key":"QPZ02TWZet"},{"type":"heading","depth":2,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"D9aQhDZSY9"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"AbVrvZnhw2"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"The Nancy Grace Roman Space Telescope will be a transformative tool for cosmology due to its unprecedented combination of wide field-of-view and high-resolution imaging. We choose to demonstrate the usefulness of the mock Roman suimulations in generating number density plots because they provide crucial insights into the large-scale structure of the universe and the distribution of matter over cosmic time. These plots illustrate how the number density of galaxies, quasars, or dark matter halos changes with redshift, revealing information about the processes of galaxy formation, evolution, and clustering. By analyzing number density plots, cosmologists can test theoretical models of structure formation, constrain cosmological parameters, and understand the influence of dark matter and dark energy on the evolution of the universe.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"LlAxGfsNXb"}],"key":"yVCtfTA4Et"},{"type":"heading","depth":3,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Instructions","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"EzwqdhsAYZ"}],"identifier":"instructions","label":"Instructions","html_id":"instructions","implicit":true,"key":"g6gl94j2zE"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Most of the notebook can be run with a single mock galaxy catalog file which easily fits in memory (3G). The final section uses all the data to make a final number density plot.  The dataset in its entirety does not fit into memory all at once(out of memory) so we have carefully designed this function to use the least possible amount of memory.  The dataset in its entirety also takes ~30 minutes to download and requires ~30G of space to store.  We suggest only running download_simulations with download_all= True if you are ready to wait for the download and have enough storage space.  Default is to work with only one catalog which is 10% of the dataset.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"wADUA4AVNB"}],"key":"cLpa6IZAo8"},{"type":"paragraph","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"Techniques employed for working with out of memory datasets:","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"RlEVxRXuAp"}],"key":"sAmppaDmzc"},{"type":"code","lang":"","value":"- read in only some columns from the original dataset\n- convert data from float64 to float32 where high precision is not necessary\n- careful management of the code structure to not need to read in all datasets to one dataframe","position":{"start":{"line":32,"column":1},"end":{"line":34,"column":1}},"key":"Zb5E4sPB89"},{"type":"heading","depth":3,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"Input","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"bYTx7lw0Yw"}],"identifier":"input","label":"Input","html_id":"input","implicit":true,"key":"s3Xk8qcgqQ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":37,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"None, the location of the simulated dataset is hardcoded for convenience","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"btJFEdfANY"}],"key":"oT5RE9lMne"}],"key":"EXxfa8YdGf"},{"type":"heading","depth":3,"position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"Output","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"CI1HA4eNkb"}],"identifier":"output","label":"Output","html_id":"output","implicit":true,"key":"RIy7hiqH1S"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":40,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"plots of number of galaxies per square degree as a function of redshift","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"pwczX831ho"}],"key":"SF2GxmJnja"},{"type":"listItem","spread":true,"position":{"start":{"line":41,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"optional numpy file with the counts saved for ease of working with the information later","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"ISFCoYXHcF"}],"key":"v9PFzZhuhg"}],"key":"AVXZLIDoKH"}],"key":"kja7hqiggu"},{"type":"block","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"mWfF38rlb1"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"rObZL0pIfC"}],"key":"VdAcBhit1f"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Uncomment the next line to install dependencies if needed.\n# !pip install h5py pandas matplotlib numpy requests","key":"QwgxvuVAgc"},{"type":"output","id":"-riBgRDh4NgoaIbjK5Mzr","data":[],"key":"F5eHmM2wQ5"}],"key":"npLC0k0JFH"},{"type":"block","children":[],"key":"aldJ6q7ZbD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport matplotlib.pyplot as plt\nimport pandas as pd\nimport numpy as np\nimport concurrent.futures\nimport re\nimport h5py\nimport requests\n\n%matplotlib inline","key":"eDxmaqwA0M"},{"type":"output","id":"dactQql6bqzNPSc3epaRJ","data":[],"key":"yEYRQMXkhY"}],"key":"MXH0lyEtW3"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"children":[{"type":"text","value":"1. Read in the mock catalogs from IRSA","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"yBbyH9nHU7"}],"identifier":"id-1-read-in-the-mock-catalogs-from-irsa","label":"1. Read in the mock catalogs from IRSA","html_id":"id-1-read-in-the-mock-catalogs-from-irsa","implicit":true,"key":"ADKgcsNV0v"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":66,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"figure out how to get the files from IRSA","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"cfIo3vQMY9"}],"key":"ckjmSkXkRS"},{"type":"listItem","spread":true,"position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"children":[{"type":"text","value":"pull down one of them for testing","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"key":"FjNT5dRb2B"}],"key":"vp4NHhG7KQ"},{"type":"listItem","spread":true,"position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"convert to a pandas df for ease of use","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"iAf7iPQ9xK"}],"key":"gxeKna1Y1w"},{"type":"listItem","spread":true,"position":{"start":{"line":69,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"do some data exploration","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"duQoexuGsE"}],"key":"PzoN1ENyZZ"}],"key":"G4tZ9n7Ki3"}],"key":"kAEDapiqh2"},{"type":"block","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"text","value":"1.1 Download the files from IRSA","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"JD0hhn5y4s"}],"identifier":"id-1-1-download-the-files-from-irsa","label":"1.1 Download the files from IRSA","html_id":"id-1-1-download-the-files-from-irsa","implicit":true,"key":"stN6pwoV9w"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":74,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":74,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"This is about 30G of data in total","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"rlsH1UMz36"}],"key":"TMxC8FIHWb"}],"key":"U6dA4b0U88"}],"key":"St92fpS6Xw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def download_file(file_url, save_path):\n    \"\"\"\n    Downloads a file from a given URL and saves it to a specified local path.\n    The file is downloaded in chunks to reduce memory usage.\n\n    Parameters:\n    - file_url (str): The URL of the file to download.\n    - save_path (str): The local path where the file will be saved.\n\n    Returns:\n    - str: The save_path if the download succeeds.\n\n    Raises:\n    - requests.HTTPError: If the HTTP request returned an unsuccessful status code.\n    - OSError: If there is an issue creating directories or writing the file.\n    \"\"\"\n    response = requests.get(file_url, stream=True)\n    response.raise_for_status()  # Raise an HTTPError for bad responses (4xx, 5xx)\n\n    os.makedirs(os.path.dirname(save_path), exist_ok=True)\n    with open(save_path, 'wb') as f:\n        for chunk in response.iter_content(chunk_size=8192):  # 8KB chunks\n            if chunk:  # Filter out keep-alive chunks\n                f.write(chunk)\n\n    print(f\"Downloaded: {save_path}\")\n    return save_path\n\n\ndef download_files_in_parallel(file_url_list, save_dir):\n    \"\"\"\n    Downloads multiple files in parallel using a ThreadPoolExecutor.\n\n    Parameters:\n    - file_url_list (list of str): List of file URLs to download.\n    - save_dir (str): Directory where files will be saved.\n\n    Returns:\n    - list of str: List of paths where the files were successfully downloaded.\n    \"\"\"\n    downloaded_files = []\n    #set to a reasonable number for efficiency and scalability\n    max_workers = min(len(file_url_list), os.cpu_count() * 5, 32)  \n    with concurrent.futures.ThreadPoolExecutor(max_workers=max_workers) as executor:\n        future_to_url = {\n            executor.submit(download_file, url, os.path.join(save_dir, os.path.basename(url))): url \n            for url in file_url_list\n        }\n        \n        for future in concurrent.futures.as_completed(future_to_url):\n            file_path = future.result()\n            if file_path:\n                downloaded_files.append(file_path)\n\n    return downloaded_files\n\ndef download_simulations(download_dir, download_all=True):\n    \"\"\"\n    Download .hdf5 simulation files from the Roman Zhai2021 URL using the provided checksums.md5 file.\n\n    This function reads the list of available .hdf5 files from the checksums.md5 file, filters them,\n    and downloads the requested files to a specified directory. If a file already exists locally,\n    it will be skipped.\n\n    Parameters\n    ----------\n    download_dir : str\n        Directory where the downloaded .hdf5 files will be stored. \n        The directory will be created if it does not already exist.\n\n    download_all : bool, optional\n        If True, download all .hdf5 files listed in the checksum file.\n        If False, download only the first file. Default is True.\n\n    Returns\n    -------\n    None\n        This function does not return any value but prints the download status.\n\n    Notes\n    -----\n    - Downloads are performed in parallel using a maximum of 4 workers.\n    - Files that already exist locally are skipped.\n    \"\"\"\n    base_url = 'https://irsa.ipac.caltech.edu/data/theory/Roman/Zhai2021'\n    checksum_url = f'{base_url}/checksums.md5'\n\n    # Read the checksums file to get the filenames\n    df = pd.read_csv(checksum_url, sep=r\"\\s+\", names=[\"checksum\", \"filename\"])\n    hdf5_files = df[df[\"filename\"].str.endswith(\".hdf5\")][\"filename\"].tolist()\n\n    if not download_all:\n        hdf5_files = hdf5_files[:1]\n\n    file_urls = [f\"{base_url}/{fname}\" for fname in hdf5_files]\n\n    os.makedirs(download_dir, exist_ok=True)\n\n    # Filter out files that already exist\n    files_to_download = []\n    for file_url in file_urls:\n        filename = os.path.basename(file_url)\n        file_path = os.path.join(download_dir, filename)\n        if os.path.exists(file_path):\n            print(f\"The file {filename} already exists. Skipping download.\")\n        else:\n            files_to_download.append(file_url)\n\n    if files_to_download:\n        print(f\"Starting parallel download of {len(files_to_download)} files.\")\n        downloaded_files = download_files_in_parallel(files_to_download, download_dir)\n        print(f\"Successfully downloaded {len(downloaded_files)} files.\")\n    else:\n        print(\"All requested files are already downloaded.\")","key":"rj2POAdIsB"},{"type":"output","id":"FmaDEfEOCcmILQ2-HWSXp","data":[],"key":"BAeVatGVNR"}],"key":"EDwkSRuBcd"},{"type":"block","children":[],"key":"NGiYD7QE3q"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set download_all to True to download all files, or False to download only the first file\n# only a single downloaded file is required to run the notebook in its entirety, \n# however section 4 will be more accuate with all 10 files\n\n# Downloading 10 files, each 3GB in size, may take between 1 and 30 minutes,\n# or even longer, depending on your proximity to the data.\n\ndownload_dir = 'downloaded_hdf5_files'\ndownload_simulations(download_dir, download_all=False)","key":"ErcJx4ayqu"},{"type":"output","id":"nwx9gpdcwTak95xPnx6J1","data":[{"output_type":"stream","name":"stdout","text":"Starting parallel download of 1 files.\n"},{"output_type":"stream","name":"stdout","text":"Downloaded: downloaded_hdf5_files/Roman_small_V2_0.hdf5\nSuccessfully downloaded 1 files.\n"}],"key":"OUixfBrGLz"}],"key":"BhfNWpHKdG"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"children":[{"type":"text","value":"1.2 read files into a pandas dataframe so we can work with them","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"uSgSaSPhV7"}],"identifier":"id-1-2-read-files-into-a-pandas-dataframe-so-we-can-work-with-them","label":"1.2 read files into a pandas dataframe so we can work with them","html_id":"id-1-2-read-files-into-a-pandas-dataframe-so-we-can-work-with-them","implicit":true,"key":"g06IedYlnR"}],"key":"jhtbUywhVR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def fetch_column_names():\n    \"\"\"\n    Fetches column names from the Readme_small.txt file at the specified URL.\n\n    Returns:\n    - List of column names (str): A list of extracted column names, or an empty list if no column names are found.\n\n    Raises:\n    - HTTPError: If the HTTP request returns an unsuccessful status code.\n    \"\"\"\n    import requests\n    import re\n\n    url = 'https://irsa.ipac.caltech.edu/data/theory/Roman/Zhai2021/Readme_small.txt'\n    response = requests.get(url)\n    response.raise_for_status()  # Raise an HTTPError for bad responses\n\n    lines = response.text.splitlines()\n    column_names = []\n\n    for line in lines:\n        if line.strip().lower().startswith('column'):\n            match = re.search(r':\\s*([^\\s]+)', line)\n            if match:\n                column_names.append(match.group(1))\n\n    if column_names:\n        return column_names\n    else:\n        print(\"No column names found in Readme_small.txt.\")\n        return []\n\n\n\ndef read_hdf5_to_pandas(file_path, columns_to_keep, columns_to_convert):\n    \"\"\"\n    Read selected columns from an HDF5 file into a pandas DataFrame.\n\n    Parameters\n    ----------\n    file_path : str\n        Path to the HDF5 file.\n    columns_to_keep : list of str\n        List of column names to extract from the dataset.\n    columns_to_convert : list of str\n        List of column names to convert to float32 for memory efficiency.\n\n    Returns\n    -------\n    pandas.DataFrame\n        A DataFrame containing the selected columns from the HDF5 file, \n        with specified columns cast to float32.\n    \"\"\"\n    # Map of column names to their corresponding index in the HDF5 dataset\n    col_map = {\n        \"RA\": 0,\n        \"DEC\": 1,\n        \"redshift_cosmological\": 2,\n        \"redshift_observed\": 3,\n        \"velocity\": 4,\n        \"stellar\": 5,\n        \"SFR\": 6,\n        \"halo\": 7,\n        \"flux_Halpha6563\": 8,\n        \"flux_OIII5007\": 9,\n        \"M_F158_Av1.6523\": 10,\n        \"nodeIsIsolated\": 11\n    }\n\n    # Open the HDF5 file and extract only the requested columns\n    with h5py.File(file_path, \"r\") as file:\n        dataset = file[\"data\"]\n        data = {}\n        for col in columns_to_keep:\n            idx = col_map[col]\n            data[col] = dataset[:, idx]\n\n    # Create a DataFrame from the selected columns\n    df = pd.DataFrame(data)\n\n    # Convert specified columns to float32 to reduce memory usage\n    conversion_map = {col: \"float32\" for col in columns_to_convert}\n    df = df.astype(conversion_map)\n\n    return df\n\ndef assign_redshift_bins(df, z_min, z_max, dz=0.1):\n    \"\"\"\n    Assign redshift bins to a DataFrame based on 'redshift_observed'.\n\n    Parameters\n    ----------\n    df : pandas.DataFrame\n        The input DataFrame containing a 'redshift_observed' column.\n    z_min : float\n        The minimum redshift for binning.\n    z_max : float\n        The maximum redshift for binning.\n    dz : float, optional\n        The redshift bin width (default is 0.1).\n\n    Returns\n    -------\n    df : pandas.DataFrame\n        The input DataFrame with a new 'z_bin' categorical column.\n    z_bins : numpy.ndarray\n        The redshift bin edges used to define bins.\n    z_bin_centers : list of float\n        The central redshift value for each bin.\n    \"\"\"\n    z_bins = np.arange(z_min, z_max + dz, dz)\n    df[\"z_bin\"] = pd.cut(df[\"redshift_observed\"], bins=z_bins, include_lowest=True, right=False)\n    z_bin_centers = [np.mean([b.left, b.right]) for b in df[\"z_bin\"].cat.categories]\n    z_bin_centers = sorted(z_bin_centers)\n    return df, z_bins, z_bin_centers","key":"NEFoSigFwx"},{"type":"output","id":"2Tw3eL-P6S9tyeDF-tZrr","data":[],"key":"NJrCbRQsTb"}],"key":"EDVigx16G9"},{"type":"block","children":[],"key":"NRA12SLSEV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#don't change this, the above code downloads the files to this directory\nfile_path = 'downloaded_hdf5_files/Roman_small_V2_0.hdf5'\n\n#out of consideration for the size of these files and the amount of memory required to work with them\n# we only keep the columns that we are going to use and convert some to 32bit instead of 64 where \n# the higher precision is not necessary to the science\ncolumns_to_keep = ['RA', 'DEC', 'redshift_observed', 'flux_Halpha6563']\ncolumns_to_convert = ['redshift_observed', 'flux_Halpha6563']\n\ndf = read_hdf5_to_pandas(file_path, columns_to_keep, columns_to_convert)","key":"hsNWK3Mgq5"},{"type":"output","id":"QZeGQRGmGF5l1W3urQADW","data":[],"key":"MfUgu2w7x7"}],"key":"Lqecg38uN1"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"children":[{"type":"text","value":"1.3 Pre-process dataset","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"Wt1nUA8xdi"}],"identifier":"id-1-3-pre-process-dataset","label":"1.3 Pre-process dataset","html_id":"id-1-3-pre-process-dataset","implicit":true,"key":"Oq5unCfMNH"},{"type":"paragraph","position":{"start":{"line":339,"column":1},"end":{"line":339,"column":1}},"children":[{"type":"text","value":"Add some value-added columns to the dataframe, and calculate some variables which are used by mulitple functions","position":{"start":{"line":339,"column":1},"end":{"line":339,"column":1}},"key":"jjS4D9dqke"}],"key":"vONZc9V6pv"}],"key":"KBIUb6I0S9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#add a binned redshift column and calculate the edges of the bins\nz_min = 1.0\nz_max = 3.0\ndz = 0.1\ndf, z_bins, z_bin_centers = assign_redshift_bins(df, z_min=z_min, z_max=z_max, dz=dz)\n\n#Shift RA values to continuous range for the entire DataFrame \n#This is necessary because the current range goes over 360 which appears to the code \n#as a non-contiguous section of the sky.  By shifting the RA values, we don't have the \n#jump from RA = 360 to RA = 0.  \n    \nra_min1=330\ndf['RA_shifted'] = (df['RA'] - ra_min1) % 360  # Shift RA to continuous range","key":"aq1cuBQAxy"},{"type":"output","id":"kpcAJq2ybBKOhaLStwttY","data":[],"key":"BgmiuuRtv9"}],"key":"H311akqJ8x"},{"type":"block","children":[],"key":"JktJqp4ERU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#quick check to see what we've got:\ndf","key":"wKlDi9DNar"},{"type":"output","id":"0tsKMuETjRFO4vxWhThAp","data":[{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"                  RA        DEC  redshift_observed  flux_Halpha6563 z_bin  \\\n0         341.509710   7.693022           4.090425     2.438628e-16   NaN   \n1         357.329659  -4.205828           4.200562     2.290115e-16   NaN   \n2         348.470261  19.136800           3.704146     3.427580e-16   NaN   \n3           5.120387   6.377602           3.750228     3.328315e-16   NaN   \n4          21.632080   2.866344           3.677756     3.486357e-16   NaN   \n...              ...        ...                ...              ...   ...   \n29382938  338.240811  16.178767           0.067884     1.876826e-15   NaN   \n29382939  346.041731   4.151812           0.059724     2.956311e-15   NaN   \n29382940   13.633021 -18.561325           0.080929     4.737627e-14   NaN   \n29382941    4.662985   4.162972           0.050005     4.001319e-15   NaN   \n29382942   20.088851  18.854207           0.030603     2.113698e-14   NaN   \n\n          RA_shifted  \n0          11.509710  \n1          27.329659  \n2          18.470261  \n3          35.120387  \n4          51.632080  \n...              ...  \n29382938    8.240811  \n29382939   16.041731  \n29382940   43.633021  \n29382941   34.662985  \n29382942   50.088851  \n\n[29382943 rows x 6 columns]","content_type":"text/plain"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eRA\u003c/th\u003e\n      \u003cth\u003eDEC\u003c/th\u003e\n      \u003cth\u003eredshift_observed\u003c/th\u003e\n      \u003cth\u003eflux_Halpha6563\u003c/th\u003e\n      \u003cth\u003ez_bin\u003c/th\u003e\n      \u003cth\u003eRA_shifted\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e0\u003c/th\u003e\n      \u003ctd\u003e341.509710\u003c/td\u003e\n      \u003ctd\u003e7.693022\u003c/td\u003e\n      \u003ctd\u003e4.090425\u003c/td\u003e\n      \u003ctd\u003e2.438628e-16\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e11.509710\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e357.329659\u003c/td\u003e\n      \u003ctd\u003e-4.205828\u003c/td\u003e\n      \u003ctd\u003e4.200562\u003c/td\u003e\n      \u003ctd\u003e2.290115e-16\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e27.329659\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e348.470261\u003c/td\u003e\n      \u003ctd\u003e19.136800\u003c/td\u003e\n      \u003ctd\u003e3.704146\u003c/td\u003e\n      \u003ctd\u003e3.427580e-16\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e18.470261\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e3\u003c/th\u003e\n      \u003ctd\u003e5.120387\u003c/td\u003e\n      \u003ctd\u003e6.377602\u003c/td\u003e\n      \u003ctd\u003e3.750228\u003c/td\u003e\n      \u003ctd\u003e3.328315e-16\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e35.120387\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003ctd\u003e21.632080\u003c/td\u003e\n      \u003ctd\u003e2.866344\u003c/td\u003e\n      \u003ctd\u003e3.677756\u003c/td\u003e\n      \u003ctd\u003e3.486357e-16\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e51.632080\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e29382938\u003c/th\u003e\n      \u003ctd\u003e338.240811\u003c/td\u003e\n      \u003ctd\u003e16.178767\u003c/td\u003e\n      \u003ctd\u003e0.067884\u003c/td\u003e\n      \u003ctd\u003e1.876826e-15\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e8.240811\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e29382939\u003c/th\u003e\n      \u003ctd\u003e346.041731\u003c/td\u003e\n      \u003ctd\u003e4.151812\u003c/td\u003e\n      \u003ctd\u003e0.059724\u003c/td\u003e\n      \u003ctd\u003e2.956311e-15\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e16.041731\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e29382940\u003c/th\u003e\n      \u003ctd\u003e13.633021\u003c/td\u003e\n      \u003ctd\u003e-18.561325\u003c/td\u003e\n      \u003ctd\u003e0.080929\u003c/td\u003e\n      \u003ctd\u003e4.737627e-14\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e43.633021\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e29382941\u003c/th\u003e\n      \u003ctd\u003e4.662985\u003c/td\u003e\n      \u003ctd\u003e4.162972\u003c/td\u003e\n      \u003ctd\u003e0.050005\u003c/td\u003e\n      \u003ctd\u003e4.001319e-15\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e34.662985\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e29382942\u003c/th\u003e\n      \u003ctd\u003e20.088851\u003c/td\u003e\n      \u003ctd\u003e18.854207\u003c/td\u003e\n      \u003ctd\u003e0.030603\u003c/td\u003e\n      \u003ctd\u003e2.113698e-14\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e50.088851\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e29382943 rows Ã— 6 columns\u003c/p\u003e\n\u003c/div\u003e","content_type":"text/html"}}}],"key":"uqmt2VOjpJ"}],"key":"yJnVfc9BTO"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"children":[{"type":"text","value":"1.3 Data Exploration","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"key":"oYXfKOGGHs"}],"identifier":"id-1-3-data-exploration","label":"1.3 Data Exploration","html_id":"id-1-3-data-exploration","implicit":true,"key":"mvJIvR4VdE"},{"type":"paragraph","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"children":[{"type":"text","value":"Letâ€™s explore the dataset a bit to see what we are working with.","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"key":"XAIJ3XFg9P"}],"key":"NiWqGKZCPJ"},{"type":"paragraph","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"children":[{"type":"text","value":"This function prints the following information:","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"key":"OJc87Oj9a4"}],"key":"KAAdvrmg8T"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":366,"column":1},"end":{"line":372,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":366,"column":1},"end":{"line":366,"column":1}},"children":[{"type":"text","value":"First 5 rows of the DataFrame.","position":{"start":{"line":366,"column":1},"end":{"line":366,"column":1}},"key":"GIlZjg1UgM"}],"key":"JOKwiTRqvO"},{"type":"listItem","spread":true,"position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"children":[{"type":"text","value":"DataFrame info (data types, non-null counts).","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"key":"z7pHaf1lGj"}],"key":"zp58IJUqWP"},{"type":"listItem","spread":true,"position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"children":[{"type":"text","value":"Summary statistics for numeric columns.","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"JKYDt1oo3r"}],"key":"DjJPV9QWpU"},{"type":"listItem","spread":true,"position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"children":[{"type":"text","value":"Memory usage of the DataFrame and each column.","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"key":"QT9R7troVg"}],"key":"vFcYwOI1n6"},{"type":"listItem","spread":true,"position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"children":[{"type":"text","value":"Column names.","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"DNcRjSFzw1"}],"key":"F5UXIYpIZx"},{"type":"listItem","spread":true,"position":{"start":{"line":371,"column":1},"end":{"line":372,"column":1}},"children":[{"type":"text","value":"Check for missing (NaN) values, including columns with NaNs and their counts.","position":{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},"key":"Pyrx2cCruD"}],"key":"fTBuqIrn7G"}],"key":"MJkZxBTYqY"},{"type":"paragraph","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"children":[{"type":"text","value":"Note that quite a few of the z_bin values are NaN because they are outside the redshift range of interest for this plot (1 \u003c z \u003c 3)","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"kgQX986ML5"}],"key":"CxmJvzukY6"}],"key":"bPSL5rlB15"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Display the first 5 rows of the dataframe\ndf.head()","key":"lQlPzzph56"},{"type":"output","id":"BWX469sYFMX8eeaX63OQl","data":[{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"           RA        DEC  redshift_observed  flux_Halpha6563 z_bin  RA_shifted\n0  341.509710   7.693022           4.090425     2.438628e-16   NaN   11.509710\n1  357.329659  -4.205828           4.200562     2.290115e-16   NaN   27.329659\n2  348.470261  19.136800           3.704146     3.427580e-16   NaN   18.470261\n3    5.120387   6.377602           3.750228     3.328315e-16   NaN   35.120387\n4   21.632080   2.866344           3.677756     3.486357e-16   NaN   51.632080","content_type":"text/plain"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eRA\u003c/th\u003e\n      \u003cth\u003eDEC\u003c/th\u003e\n      \u003cth\u003eredshift_observed\u003c/th\u003e\n      \u003cth\u003eflux_Halpha6563\u003c/th\u003e\n      \u003cth\u003ez_bin\u003c/th\u003e\n      \u003cth\u003eRA_shifted\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e0\u003c/th\u003e\n      \u003ctd\u003e341.509710\u003c/td\u003e\n      \u003ctd\u003e7.693022\u003c/td\u003e\n      \u003ctd\u003e4.090425\u003c/td\u003e\n      \u003ctd\u003e2.438628e-16\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e11.509710\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e1\u003c/th\u003e\n      \u003ctd\u003e357.329659\u003c/td\u003e\n      \u003ctd\u003e-4.205828\u003c/td\u003e\n      \u003ctd\u003e4.200562\u003c/td\u003e\n      \u003ctd\u003e2.290115e-16\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e27.329659\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e2\u003c/th\u003e\n      \u003ctd\u003e348.470261\u003c/td\u003e\n      \u003ctd\u003e19.136800\u003c/td\u003e\n      \u003ctd\u003e3.704146\u003c/td\u003e\n      \u003ctd\u003e3.427580e-16\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e18.470261\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e3\u003c/th\u003e\n      \u003ctd\u003e5.120387\u003c/td\u003e\n      \u003ctd\u003e6.377602\u003c/td\u003e\n      \u003ctd\u003e3.750228\u003c/td\u003e\n      \u003ctd\u003e3.328315e-16\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e35.120387\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e4\u003c/th\u003e\n      \u003ctd\u003e21.632080\u003c/td\u003e\n      \u003ctd\u003e2.866344\u003c/td\u003e\n      \u003ctd\u003e3.677756\u003c/td\u003e\n      \u003ctd\u003e3.486357e-16\u003c/td\u003e\n      \u003ctd\u003eNaN\u003c/td\u003e\n      \u003ctd\u003e51.632080\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e","content_type":"text/html"}}}],"key":"sAYQ2P8OWl"}],"key":"wLF0jLfDVQ"},{"type":"block","children":[],"key":"zAZxQAXOq0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Get general information about the dataframe (e.g., data types, non-null counts)\nprint(\"\\nDataFrame info (Data Types, Non-null counts):\")\ndf.info()","key":"EruAPjO9cA"},{"type":"output","id":"0K1UJkLPzJ7c116tjwIKS","data":[{"output_type":"stream","name":"stdout","text":"\nDataFrame info (Data Types, Non-null counts):\n\u003cclass 'pandas.core.frame.DataFrame'\u003e\nRangeIndex: 29382943 entries, 0 to 29382942\nData columns (total 6 columns):\n #   Column             Dtype   \n---  ------             -----   \n 0   RA                 float64 \n 1   DEC                float64 \n 2   redshift_observed  float32 \n 3   flux_Halpha6563    float32 \n 4   z_bin              category\n 5   RA_shifted         float64 \ndtypes: category(1), float32(2), float64(3)\nmemory usage: 924.7 MB\n"}],"key":"pUnmflRL5c"}],"key":"ioirH0hOgD"},{"type":"block","children":[],"key":"UaSX7tC1Ml"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Display summary statistics for numeric columns\nprint(\"\\nSummary statistics for numeric columns:\")\ndf.describe()","key":"uaTrgr7EIn"},{"type":"output","id":"BdikQRDiMepB_9ZoyBK9D","data":[{"output_type":"stream","name":"stdout","text":"\nSummary statistics for numeric columns:\n"},{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/plain":{"content":"                 RA           DEC  redshift_observed  flux_Halpha6563  \\\ncount  2.938294e+07  2.938294e+07       2.938294e+07     2.938294e+07   \nmean   1.802166e+02 -2.749608e-03       1.096546e+00     2.976948e-16   \nstd    1.689970e+02  1.257703e+01       5.805780e-01     4.253355e-15   \nmin    1.164220e-06 -2.249985e+01       3.921282e-03     1.660502e-18   \n25%    1.105467e+01 -1.078845e+01       6.446358e-01     5.264885e-17   \n50%    3.375331e+02  2.420867e-02       9.980963e-01     1.034983e-16   \n75%    3.489236e+02  1.077922e+01       1.473502e+00     2.202762e-16   \nmax    3.600000e+02  2.249999e+01       5.055577e+00     8.686074e-12   \n\n         RA_shifted  \ncount  2.938294e+07  \nmean   2.996636e+01  \nstd    1.287226e+01  \nmin    7.500002e+00  \n25%    1.889303e+01  \n50%    2.997017e+01  \n75%    4.102419e+01  \nmax    5.250000e+01  ","content_type":"text/plain"},"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003eRA\u003c/th\u003e\n      \u003cth\u003eDEC\u003c/th\u003e\n      \u003cth\u003eredshift_observed\u003c/th\u003e\n      \u003cth\u003eflux_Halpha6563\u003c/th\u003e\n      \u003cth\u003eRA_shifted\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003ecount\u003c/th\u003e\n      \u003ctd\u003e2.938294e+07\u003c/td\u003e\n      \u003ctd\u003e2.938294e+07\u003c/td\u003e\n      \u003ctd\u003e2.938294e+07\u003c/td\u003e\n      \u003ctd\u003e2.938294e+07\u003c/td\u003e\n      \u003ctd\u003e2.938294e+07\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003emean\u003c/th\u003e\n      \u003ctd\u003e1.802166e+02\u003c/td\u003e\n      \u003ctd\u003e-2.749608e-03\u003c/td\u003e\n      \u003ctd\u003e1.096546e+00\u003c/td\u003e\n      \u003ctd\u003e2.976948e-16\u003c/td\u003e\n      \u003ctd\u003e2.996636e+01\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003estd\u003c/th\u003e\n      \u003ctd\u003e1.689970e+02\u003c/td\u003e\n      \u003ctd\u003e1.257703e+01\u003c/td\u003e\n      \u003ctd\u003e5.805780e-01\u003c/td\u003e\n      \u003ctd\u003e4.253355e-15\u003c/td\u003e\n      \u003ctd\u003e1.287226e+01\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003emin\u003c/th\u003e\n      \u003ctd\u003e1.164220e-06\u003c/td\u003e\n      \u003ctd\u003e-2.249985e+01\u003c/td\u003e\n      \u003ctd\u003e3.921282e-03\u003c/td\u003e\n      \u003ctd\u003e1.660502e-18\u003c/td\u003e\n      \u003ctd\u003e7.500002e+00\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e25%\u003c/th\u003e\n      \u003ctd\u003e1.105467e+01\u003c/td\u003e\n      \u003ctd\u003e-1.078845e+01\u003c/td\u003e\n      \u003ctd\u003e6.446358e-01\u003c/td\u003e\n      \u003ctd\u003e5.264885e-17\u003c/td\u003e\n      \u003ctd\u003e1.889303e+01\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e50%\u003c/th\u003e\n      \u003ctd\u003e3.375331e+02\u003c/td\u003e\n      \u003ctd\u003e2.420867e-02\u003c/td\u003e\n      \u003ctd\u003e9.980963e-01\u003c/td\u003e\n      \u003ctd\u003e1.034983e-16\u003c/td\u003e\n      \u003ctd\u003e2.997017e+01\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e75%\u003c/th\u003e\n      \u003ctd\u003e3.489236e+02\u003c/td\u003e\n      \u003ctd\u003e1.077922e+01\u003c/td\u003e\n      \u003ctd\u003e1.473502e+00\u003c/td\u003e\n      \u003ctd\u003e2.202762e-16\u003c/td\u003e\n      \u003ctd\u003e4.102419e+01\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003emax\u003c/th\u003e\n      \u003ctd\u003e3.600000e+02\u003c/td\u003e\n      \u003ctd\u003e2.249999e+01\u003c/td\u003e\n      \u003ctd\u003e5.055577e+00\u003c/td\u003e\n      \u003ctd\u003e8.686074e-12\u003c/td\u003e\n      \u003ctd\u003e5.250000e+01\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/div\u003e","content_type":"text/html"}}}],"key":"sTPuqmlN62"}],"key":"TvhAYGcUiF"},{"type":"block","children":[],"key":"bIqJ3NJfvX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Print memory usage of the DataFrame\nprint(\"\\nMemory usage of the DataFrame:\")\nprint(df.memory_usage(deep=True))  # Shows memory usage of each column\nprint(f\"Total memory usage: {df.memory_usage(deep=True).sum() / (1024**2):.2f} MB\")  # Total memory usage in MB","key":"Ph8f9eG6op"},{"type":"output","id":"uU5dkFo08ePFTgwrKVOdw","data":[{"output_type":"stream","name":"stdout","text":"\nMemory usage of the DataFrame:\nIndex                      132\nRA                   235063544\nDEC                  235063544\nredshift_observed    117531772\nflux_Halpha6563      117531772\nz_bin                 29383819\nRA_shifted           235063544\ndtype: int64\nTotal memory usage: 924.72 MB\n"}],"key":"y0LYyIhDlg"}],"key":"DUrAfQiXzL"},{"type":"block","children":[],"key":"WXkXHTY16C"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Check if there are any NaN (missing) values in the DataFrame\nprint(\"\\nChecking for NaN (missing) values in the DataFrame:\")\nif df.isnull().any().any():\n    print(\"There are NaN values in the DataFrame.\")\n    print(\"\\nColumns with NaN values and the number of missing values in each:\")\n    print(df.isnull().sum())\nelse:\n    print(\"There are no NaN values in the DataFrame.\")","key":"Ooc3FTr8qD"},{"type":"output","id":"embU-O8tmMwuftQiPeOYt","data":[{"output_type":"stream","name":"stdout","text":"\nChecking for NaN (missing) values in the DataFrame:\nThere are NaN values in the DataFrame.\n\nColumns with NaN values and the number of missing values in each:\n"},{"output_type":"stream","name":"stdout","text":"RA                          0\nDEC                         0\nredshift_observed           0\nflux_Halpha6563             0\nz_bin                14781902\nRA_shifted                  0\ndtype: int64\n"}],"key":"qcJt5GXnXj"}],"key":"tKBZz38ux7"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":410,"column":1},"end":{"line":410,"column":1}},"children":[{"type":"text","value":"2.0 Make some helpful histograms","position":{"start":{"line":410,"column":1},"end":{"line":410,"column":1}},"key":"zs6VhUpAkP"}],"identifier":"id-2-0-make-some-helpful-histograms","label":"2.0 Make some helpful histograms","html_id":"id-2-0-make-some-helpful-histograms","implicit":true,"key":"xtuEAm0b9j"},{"type":"paragraph","position":{"start":{"line":411,"column":1},"end":{"line":411,"column":1}},"children":[{"type":"text","value":"Do the numbers we are getting and their distributions make sense?","position":{"start":{"line":411,"column":1},"end":{"line":411,"column":1}},"key":"ayt3mJxZAx"}],"key":"jwcq5ZuGXK"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":412,"column":1},"end":{"line":414,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":412,"column":1},"end":{"line":412,"column":1}},"children":[{"type":"text","value":"plot of the number of galaxies as a function of dec bin","position":{"start":{"line":412,"column":1},"end":{"line":412,"column":1}},"key":"v1kbTD66FG"}],"key":"q7QHwTanyI"},{"type":"listItem","spread":true,"position":{"start":{"line":413,"column":1},"end":{"line":414,"column":1}},"children":[{"type":"text","value":"plot the number of galaxies per square degree as a function of dec bin","position":{"start":{"line":413,"column":1},"end":{"line":413,"column":1}},"key":"h5J679qbLN"}],"key":"jXQb5iB9F0"}],"key":"ty98xXLwcP"}],"key":"KMB4d6V9IG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def get_bin_area(dec_edges, ra_width):\n    \"\"\"\n    Calculate the area of each Dec bin in square degrees, given the RA width.\n    \n    Parameters:\n    - dec_edges: The edges of the Dec bins (1D array).\n    - ra_width: The width of the RA bins in degrees.\n    \n    Returns:\n    - areas: List of areas of the Dec bins in square degrees.\n    \"\"\"\n    dec_heights = np.diff(dec_edges)  # Heights of the Dec bins\n    areas = []\n    for i in range(len(dec_edges) - 1):\n        dec_center = (dec_edges[i] + dec_edges[i+1]) / 2  # Center of the Dec bin\n        area = ra_width * dec_heights[i] * np.cos(np.radians(dec_center))\n        areas.append(area)\n\n    return np.array(areas)\n    \ndef calculate_counts_per_deg2(df):\n    \"\"\"\n    Computes galaxy number counts per square degree by binning data in declination.\n\n    This function shifts Right Ascension (RA) values into a continuous range, \n    bins galaxies based on Declination (DEC), and calculates the number of galaxies \n    per square degree for each declination bin. It assumes a fixed declination range \n    and divides it into 10 equal bins. The function also computes bin areas to normalize \n    the galaxy counts.\n\n    Parameters:\n    - df (pd.DataFrame): A Pandas DataFrame containing at least the 'RA' and 'DEC' columns.\n\n    Returns:\n    - galaxy_counts (np.ndarray): An array containing the number of galaxies in each declination bin.\n    - counts_per_deg2 (np.ndarray): An array of galaxy counts per square degree for each declination bin.\n    - dec_bins (np.ndarray): The edges of the declination bins.\n\n    \"\"\"\n    \n    # Compute RA edges based on the data\n    ra_min = df['RA_shifted'].min()\n    ra_max = df['RA_shifted'].max()\n    ra_edges = np.linspace(ra_min, ra_max, 10 + 1)\n    \n    # Set up Declination bins for constant declination binning\n    #manually fixing these here for this particular survey\n    dec_min =  -20# df['DEC'].min()\n    dec_max =  20# df['DEC'].max()\n    dec_bins = np.linspace(dec_min, dec_max, 10 + 1)  # Create declination bins\n    \n    # Calculate bin areas for constant declination bins\n    ra_width = np.diff(ra_edges)[0]  # Width of RA bins (all bins assumed equal width)\n    bin_areas = get_bin_area(dec_bins, ra_width)\n\n    df['dec_bin'] = pd.cut(df['DEC'], bins=dec_bins, include_lowest=True, right=False).astype('category')\n\n    # Count galaxies in each Declination bin\n    galaxy_counts = df.groupby('dec_bin', observed=False).size().values\n\n    # Calculate galaxy counts per square degree\n    counts_per_deg2 = galaxy_counts / bin_areas\n\n    return galaxy_counts, counts_per_deg2, dec_bins\n\ndef plot_dec_bins(dec_bins, galaxy_counts):\n    \"\"\"\n    Plots a histogram of galaxy counts across declination bins.\n\n    This function visualizes the number of galaxies in different declination (DEC) bins \n    using a bar plot. The y-axis is set to a logarithmic scale to enhance visibility of \n    variations in galaxy counts. The function assumes uniform bin sizes.\n\n    Parameters:\n    - dec_bins (np.ndarray): An array containing the edges of the declination bins.\n    - galaxy_counts (np.ndarray): An array containing the number of galaxies in each declination bin.\n\n     \"\"\"\n    # Calculate the width of each bin (assumes uniform bin sizes)\n    bin_width = dec_bins[1] - dec_bins[0]  \n    \n    \n    # Plot the histogram for the DEC column with 10 bins\n    plt.figure(figsize=(8, 6))\n    plt.bar(dec_bins[:-1], galaxy_counts, width=bin_width, color='skyblue', edgecolor='black', align='edge')\n    plt.xlabel('Declination (DEC)')\n    plt.ylabel('Number of Galaxies')\n    plt.title('Galaxy counts as a function of declination')\n    plt.yscale('log')  # Set y-axis to logarithmic scale\n\n    #plt.ylim(1e5, 1.6e5)  # Set y-axis range\n    plt.grid(False)\n    plt.show()\n    plt.close()  # Explicitly close the plot\n\n    \ndef plot_dec_bins_per_deg2(dec_bins, counts_per_deg2):\n    \"\"\"\n    Plots a histogram of galaxy number density across declination bins.\n\n    This function visualizes the number of galaxies per square degree as a function \n    of declination using a bar plot. The y-axis is set to a logarithmic scale to \n    improve visibility of variations in galaxy density. The function assumes uniform \n    bin sizes.\n\n    Parameters:\n    - dec_bins (np.ndarray): An array containing the edges of the declination bins.\n    - counts_per_deg2 (np.ndarray): An array containing the number of galaxies per square degree \n      for each declination bin.\n\n    \"\"\"    # Calculate the width of each bin (assumes uniform bin sizes)\n    bin_width = dec_bins[1] - dec_bins[0]  \n    \n    \n    # Plot the histogram for the DEC column with 10 bins\n    plt.figure(figsize=(8, 6))\n    plt.bar(dec_bins[:-1], counts_per_deg2, width=bin_width, color='skyblue', edgecolor='black', align='edge')\n    plt.xlabel('Declination (DEC)')\n    plt.ylabel('Number of galaxies per square degree')\n    plt.title('Number density as a function of declination')\n    plt.yscale('log')  # Set y-axis to logarithmic scale\n    #plt.ylim(1e5, 1.6e5)  # Set y-axis range\n    plt.grid(False)\n    plt.show()\n    plt.close()","key":"gHaeM6j96L"},{"type":"output","id":"eShAjPeenF2rsNmiRtRKp","data":[],"key":"Ly7D1zyB3U"}],"key":"byTHra0WoX"},{"type":"block","children":[],"key":"Ot6B0wgjS3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"galaxy_counts, counts_per_deg2, dec_bins = calculate_counts_per_deg2(df)\nplot_dec_bins(dec_bins, galaxy_counts)\nplot_dec_bins_per_deg2(dec_bins, counts_per_deg2)","key":"IaFbg85IxL"},{"type":"output","id":"6w1V1GRyl_erE5-FmDo4T","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 800x600 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"823baca4641eeaed0ed8c67d841036db","path":"/irsa-tutorials/build/823baca4641eeaed0ed8c67d841036db.png"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 800x600 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"fe4d4169cef9fda443720e2ca31b282e","path":"/irsa-tutorials/build/fe4d4169cef9fda443720e2ca31b282e.png"}}}],"key":"ooedKfeaGv"}],"key":"y2AxZpXmXC"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":549,"column":1},"end":{"line":549,"column":1}},"children":[{"type":"text","value":"Figure Caption: Both plots have Declination on their X-axis.  The top panel shows the total number of galaxies.  The bottom panel shows the number of galaxies per square degree.  Note that they y-axis is displayed in a log scale, and shows a quite small range.  The goal of this plot is to explore the data a bit and see what variation we have as a function of declination bins.","position":{"start":{"line":549,"column":1},"end":{"line":549,"column":1}},"key":"ItFfRvTxzG"}],"key":"GhaTA0Erbo"}],"key":"imI0bZQGPl"},{"type":"block","position":{"start":{"line":551,"column":1},"end":{"line":551,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":553,"column":1},"end":{"line":553,"column":1}},"children":[{"type":"text","value":"3.0 Make Number density plot","position":{"start":{"line":553,"column":1},"end":{"line":553,"column":1}},"key":"MpSgf4fBhL"}],"identifier":"id-3-0-make-number-density-plot","label":"3.0 Make Number density plot","html_id":"id-3-0-make-number-density-plot","implicit":true,"key":"B1hm2CkJbR"},{"type":"paragraph","position":{"start":{"line":554,"column":1},"end":{"line":554,"column":1}},"children":[{"type":"text","value":"This is a first pass at making a number density plot with just a single data file.  We divide the sample into 10 declination bins in order to do a jackknife sampling and obtain error bars for the plot. We choose to use constant dec bins instead of constant RA bins since area is function of cosine dec so we donâ€™t want to average over too much dec.","position":{"start":{"line":554,"column":1},"end":{"line":554,"column":1}},"key":"G6WSVXk6nI"}],"key":"euAEgib3PF"}],"key":"tnnsdNaUHA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def jackknife_galaxy_count(df, grid_cells=10):\n    \"\"\"\n    Calculate mean galaxy counts per square degree for each redshift bin, using jackknife resampling to estimate uncertainties.\n\n    Parameters:\n    df : pandas.DataFrame\n        The DataFrame containing galaxy data, including 'RA', 'DEC', and 'redshift_observed' columns.\n    grid_cells : int, optional\n        Number of bins to divide the declination range into for jackknife resampling (default: 10).\n    \n    Returns:\n    - mean_counts: List of mean galaxy counts per square degree for each redshift bin.\n    - std_dev_counts: List of jackknife uncertainties (standard deviations) for each redshift bin.\n    - z_bin_centers: central values of the redshift bins\n    \"\"\"\n    original_galaxy_count = len(df)\n    print(f\"Original galaxy count: {original_galaxy_count}\")\n    \n\n \n    # compute RA edges based on the data\n    #keeping this in here in case we make bins over RA in the future\n    ra_min = df['RA_shifted'].min()\n    ra_max = df['RA_shifted'].max()\n    ra_edges = np.linspace(ra_min, ra_max, grid_cells + 1)\n    \n    # Set up Declination bins for constant declination binning\n    #manually fixing these here for this particular survey\n    dec_min =  -20# df['DEC'].min()\n    dec_max =  20# df['DEC'].max()\n    dec_bins = np.linspace(dec_min, dec_max, grid_cells + 1)  # Create declination bins\n    \n    # Calculate bin areas for constant declination bins\n    ra_width = np.diff(ra_edges)[0]  # Width of RA bins (all bins assumed equal width)\n    bin_areas = get_bin_area(dec_bins, ra_width)\n\n    # Initialize lists \n    mean_counts = []\n    std_dev_counts = []\n    sum_counts = []\n    \n    # Loop over the redshift bins\n    for z_bin in df['z_bin'].cat.categories:\n        # Step 8: Select galaxies within the current redshift bin\n        df_z_bin = df[df['z_bin'] == z_bin].copy()\n\n        # Step 9: Bin galaxies into Declination bins using precomputed dec_bins\n        # Explicitly cast the 'ra_bin' column to 'category' before assignment\n        df_z_bin['dec_bin'] = pd.cut(df_z_bin['DEC'], bins=dec_bins, include_lowest=True, right=False).astype('category')\n\n        #df_z_bin.loc[:, 'dec_bin'] = pd.cut(df_z_bin['DEC'], bins=dec_bins, include_lowest=True, right=False)\n        #df_z_bin.loc[:, 'dec_bin'] = df_z_bin['dec_bin'].astype('category')  # Use .loc to avoid SettingWithCopyWarning\n\n        # Step 10: Count galaxies in each Declination bin\n        galaxy_counts = df_z_bin.groupby('dec_bin', observed=False).size().values\n\n        # Step 11: Calculate mean galaxy counts per square degree\n        counts_per_deg2 = galaxy_counts / bin_areas\n\n        # Step 12: Compute jackknife resampling to estimate uncertainties\n        jackknife_means = []\n        for i in range(len(counts_per_deg2)):\n            jackknife_sample = np.delete(counts_per_deg2, i)\n            jackknife_means.append(np.mean(jackknife_sample))\n\n        # Step 13: Calculate mean and standard deviation of galaxy counts per square degree\n        mean_counts.append(np.mean(counts_per_deg2))\n        std_dev_counts.append(np.std(jackknife_means))\n\n    return mean_counts, std_dev_counts\n\n\ndef plot_galaxy_counts_vs_redshift_with_jackknife(counts, std_dev_counts, z_bin_centers):\n    \"\"\"\n    Plot the galaxy counts per square degree as a function of redshift with jackknife error bars.\n\n    Parameters:\n    - counts (numpy.ndarray): Array of galaxy counts per square degree for each redshift bin.\n      Shape: (number of redshift bins,) or (1, number of redshift bins).\n    - std_dev_counts (numpy.ndarray): Array of jackknife standard deviations for each redshift bin, \n      representing uncertainties. Shape: (number of redshift bins,).\n    - z_bin_centers (numpy.ndarray): Array of central values of the redshift bins. \n      Shape: (number of redshift bins,).\n\n    Notes:\n    - The input arrays (`counts`, `std_dev_counts`, and `z_bin_centers`) must have the same length, \n      corresponding to the number of redshift bins.\n    - The plot is designed specifically for redshifts in the range of 1.0 to 3.0 and may need adjustments \n      for datasets with different redshift ranges.\n    \"\"\"\n    # Ensure counts is a NumPy array\n    if isinstance(counts, list):\n        counts = np.array(counts)\n    \n    # Flatten counts if it has a shape of [1, N]\n    if counts.ndim == 2 and counts.shape[0] == 1:\n        counts = counts.flatten()\n\n    # setup figure\n    plt.figure(figsize=(10, 6))\n\n    # Plot with error bars (with jackknife standard deviation as error bars)\n    plt.errorbar(z_bin_centers, counts, yerr=std_dev_counts, fmt='o', color='blue', \n                 ecolor='gray', elinewidth=2, capsize=3, label='Galaxy Counts per Square Degree (Jackknife)')\n    plt.yscale('log')\n\n    # Set x-range to redshifts between 1 and 3\n    plt.xlim(1, 3.0)\n    plt.ylim(1E1, 3E5)\n\n    # Add labels and title\n    plt.xlabel('Redshift', fontsize=12)\n    plt.ylabel('Galaxy Count per Square Degree', fontsize=12)\n    plt.title('Galaxy Counts per Square Degree vs Redshift with Jackknife Error Bars', fontsize=14)\n\n    # Show the plot\n    plt.legend()\n    plt.show()\n    plt.close()","key":"ziQhMfSsbS"},{"type":"output","id":"R9LMoBPNWu8FZE25UDrXP","data":[],"key":"QL7aVOqgF1"}],"key":"IzBELmO00R"},{"type":"block","children":[],"key":"Gmqqv8pDvf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n#setup redshift binning here for consistency in the rest of the code\n#these match our dataset, so only change if you want to reduce the range \n# or if you change the dataset\n\nz_min = 1.0\nz_max = 3.0\ndz = 0.1\n\n#do the counting\nmean_counts, std_dev_counts = jackknife_galaxy_count(df, grid_cells=10)\n#make the plot\nplot_galaxy_counts_vs_redshift_with_jackknife(mean_counts, std_dev_counts, z_bin_centers)","key":"DNcZJRG1JK"},{"type":"output","id":"r62wLk5gqBRe84cDgnCuy","data":[{"output_type":"stream","name":"stdout","text":"Original galaxy count: 29382943\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1000x600 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"4ff0ee0ed91854c9eaf731031178c001","path":"/irsa-tutorials/build/4ff0ee0ed91854c9eaf731031178c001.png"}}},{"output_type":"stream","name":"stdout","text":"CPU times: user 2.57 s, sys: 59.5 ms, total: 2.63 s\nWall time: 2.65 s\n"}],"key":"jV4eSe9lMx"}],"key":"tBjCBdajMw"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":694,"column":1},"end":{"line":694,"column":1}},"children":[{"type":"text","value":"Figure Caption: Number density plot.  Note that the jackknife error bars are displayed on the plot but they are smaller than the point size.  We see the expected shape of this plot, with a fall off toward higher redshift.","position":{"start":{"line":694,"column":1},"end":{"line":694,"column":1}},"key":"FqcnjvAPkL"}],"key":"B3dauSWRZW"}],"key":"Xp6E32Wmhm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#cleanup memory when done with this file:\ndel df","key":"cMcOsrU9yk"},{"type":"output","id":"__3Dn5J1bWs8x7iCy8BLX","data":[],"key":"f2cJJujV8D"}],"key":"pQY8UsJ71y"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":701,"column":1},"end":{"line":701,"column":1}},"children":[{"type":"text","value":"4.0 Expand to out-of-memory sized catalogs","position":{"start":{"line":701,"column":1},"end":{"line":701,"column":1}},"key":"bm5E5ggHwk"}],"identifier":"id-4-0-expand-to-out-of-memory-sized-catalogs","label":"4.0 Expand to out-of-memory sized catalogs","html_id":"id-4-0-expand-to-out-of-memory-sized-catalogs","implicit":true,"key":"vzYqu4286b"},{"type":"paragraph","position":{"start":{"line":702,"column":1},"end":{"line":702,"column":1}},"children":[{"type":"text","value":"Originally this section attempted to use dask instead of pandas to hold the data and be able to do this work.  Dask is supposed to be able to do this sort of magic in the background with out of memory catalogs, but in reality, this does not seem to be possible, or at least not possible with a week or so of working on it.  Instead, we will read in the catalogs one at a time, store counts of mean and standard deviation per square degree and then move on to the next catalog.","position":{"start":{"line":702,"column":1},"end":{"line":702,"column":1}},"key":"vRiUrgpdEK"}],"key":"qBjugFJnQU"}],"key":"dHApPyKIRf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def calculate_area(df):\n    \"\"\"\n    Calculate the total survey area in square degrees based on DEC range and RA width.\n\n    Parameters:\n    - df: The DataFrame containing galaxy data.\n\n    Returns:\n    - area: Total survey area in square degrees.\n    \"\"\"\n    ra_min = df['RA_shifted'].min()\n    ra_max = df['RA_shifted'].max()\n    dec_min = df['DEC'].min()\n    dec_max = df['DEC'].max()\n     \n    # Step 4: Calculate area\n    ra_width = ra_max - ra_min \n    dec_height = dec_max - dec_min\n \n    # Approximate area calculation\n    dec_center = (dec_min + dec_max) / 2\n    area = ra_width * dec_height * np.cos(np.radians(dec_center))\n\n    return area","key":"XH0dF3NTcP"},{"type":"output","id":"OgmKWui_JnkRtvsY1Vk4k","data":[],"key":"k9zbBhlTQ3"}],"key":"BnDDX1LyvI"},{"type":"block","children":[],"key":"CXDhiNkaA0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def galaxy_counts_per_hdf5_binned(\n    df,\n    z_bins,\n    z_bin_centers,\n    find_halpha_bins=False,\n    halpha_flux_thresholds=None,\n):\n    \"\"\"\n    Calculate the galaxy counts per square degree for each redshift bin.\n    Optionally calculate counts for Halpha flux bins.\n\n    Parameters:\n    - df (pandas.DataFrame): The input DataFrame containing galaxy data.\n    - zbins (): edges of the redshift bins\n    - z_bin_centers (numpy.ndarray): Array of central values of the redshift bins.\n    - find_halpha_bins (bool, optional): Whether to calculate counts for Halpha bins (default: False).\n    - halpha_flux_thresholds (list, optional): Custom thresholds for Halpha flux binning. If None, default thresholds are used.\n\n    Returns:\n    - counts_per_deg2 (numpy.ndarray): Array of galaxy counts per square degree for each redshift bin.\n    - halpha_counts (numpy.ndarray): Counts for each Halpha bin (if `find_halpha_bins` is True).\n    \"\"\"\n    # Default Halpha flux thresholds if not provided\n    if find_halpha_bins and halpha_flux_thresholds is None:\n        halpha_flux_thresholds = [0.5e-16, 0.7e-16, 0.9e-16, 1.1e-16, 1.3e-16, 1.5e-16, 1.7e-16, 1.9e-16]\n        \n    # Calculate survey area\n    area = calculate_area(df)\n\n    # Initialize counts\n    counts = np.zeros((1, len(z_bins) - 1))\n    halpha_counts = None\n\n    # Prepare for Halpha binning if requested\n    if find_halpha_bins:\n        halpha_counts = np.zeros((len(halpha_flux_thresholds), len(z_bins) - 1))\n\n    # Group data by redshift bin\n    grouped = df.groupby(\"z_bin\", observed= False)\n\n    for i, (z_bin, group) in enumerate(grouped):\n        # Count galaxies in the redshift bin\n        galaxy_count = len(group)\n        counts[0, i] = galaxy_count\n\n        if find_halpha_bins:\n            # Count galaxies for each Halpha bin within the current redshift bin\n            for j, threshold in enumerate(halpha_flux_thresholds):\n                halpha_count = len(group[group[\"flux_Halpha6563\"] \u003e threshold])\n                halpha_counts[j, i] = halpha_count\n                #print(f\"redshift: {z_bin}, threshold: {threshold}, halpha_count: {halpha_count}, count: {galaxy_count}\")\n\n\n    # Sort results based on z_bin_centers\n    sorted_indices = np.argsort(z_bin_centers)\n    counts_per_deg2 = (counts / area)[:, sorted_indices]\n\n    if find_halpha_bins:\n        # Normalize Halpha counts to counts per square degree\n        halpha_counts_per_deg2 = (halpha_counts / area)[:, sorted_indices]\n    else:\n        halpha_counts_per_deg2 = None\n\n    return counts_per_deg2, halpha_counts_per_deg2\n  \ndef plot_binned_galaxy_counts_vs_redshift_with_jackknife(\n    counts_summary, z_bin_centers, halpha_flux_thresholds, halpha_summary,\n    ):\n    \"\"\"\n    Plots galaxy counts per square degree as a function of redshift with jackknife error bars.\n\n    This function visualizes the galaxy number density using binned redshift data. It includes \n    jackknife-based uncertainty estimates and optionally plots counts for HÎ± flux-selected bins.\n\n    Parameters:\n    - counts_summary (dict): A dictionary containing:\n        - 'sum_counts' (numpy.ndarray): Array of total galaxy counts per square degree for each redshift bin.\n        - 'std_dev_counts' (numpy.ndarray): Array of jackknife standard deviations for each redshift bin.\n    - z_bin_centers (numpy.ndarray): Array of central values of the redshift bins.\n    - halpha_flux_thresholds (list, optional): List of HÎ± flux threshold values (used for labeling the lines).\n    - halpha_summary (dict, optional): A dictionary containing:\n        - 'halpha_sum_counts' (numpy.ndarray): Counts for each HÎ± flux-selected bin.\n        - 'halpha_std_dev_counts' (numpy.ndarray): Jackknife standard deviations for each HÎ± flux-selected bin.\n\n    Notes:\n    - The input arrays in `counts_summary` and `halpha_summary` must have the same length as `z_bin_centers`.\n    - The function automatically sets the y-axis to a logarithmic scale (`plt.yscale(\"log\")`).\n    - The x-axis is limited to the redshift range [1, 3].\n    - The function ensures proper memory management by explicitly closing the plot.\n    \"\"\"\n    # Unpack counts_summary\n    counts = counts_summary[\"sum_counts\"]\n    std_dev_counts = counts_summary[\"std_dev_counts\"]\n\n    # Unpack halpha_summary if provided, otherwise set to None\n    if halpha_summary is not None:\n        halpha_counts = halpha_summary.get(\"halpha_sum_counts\")\n        halpha_std_dev_counts = halpha_summary.get(\"halpha_std_dev_counts\")\n    else:\n        halpha_counts = None\n        halpha_std_dev_counts = None\n\n    # Ensure counts is a NumPy array\n    if isinstance(counts, list):\n        counts = np.array(counts)\n\n    # Flatten counts if it has a shape of [1, N]\n    if counts.ndim == 2 and counts.shape[0] == 1:\n        counts = counts.flatten()\n\n    # Setup figure\n    plt.figure(figsize=(10, 6))\n\n    # Plot the main counts with error bars\n    jackknife_line = plt.errorbar(\n        z_bin_centers, counts, yerr=std_dev_counts, fmt=\"o-\", color=\"blue\",\n        ecolor=\"blue\", elinewidth=2, capsize=3, label=\"All Galaxy Counts per Square Degree (Jackknife)\"\n    )\n\n    # Plot HÎ± bins if the data is present\n    halpha_lines = []\n    if halpha_flux_thresholds is not None and halpha_counts is not None:\n        for i in range(len(halpha_flux_thresholds)):\n            label = f\"Flux HÎ± \u003e {halpha_flux_thresholds[i]:.1e} erg/s/cmÂ²\"\n            line, = plt.plot(z_bin_centers, halpha_counts[i], marker=\"o\", label=label)\n            halpha_lines.append(line)\n\n    # Adjust legend order if HÎ± lines were added\n    if halpha_lines:\n        handles, labels = plt.gca().get_legend_handles_labels()\n        new_order = [jackknife_line] + halpha_lines  \n        plt.legend(new_order, [labels[handles.index(h)] for h in new_order])\n    else:\n        plt.legend()\n\n    # Set log scale for y-axis and limit the x-axis\n    plt.yscale(\"log\")\n    plt.xlim(1, 3.0)\n    \n    # Add labels and title\n    plt.xlabel(\"Redshift\", fontsize=12)\n    plt.ylabel(\"Galaxy Count per Square Degree\", fontsize=12)\n    plt.title(\"Number Density with Jackknife Error Bars\", fontsize=14)\n    \n    # Display the plot\n    plt.show()\n    plt.close()\n\n\ndef jackknife_wrapper(file_list,  halpha_flux_thresholds, find_halpha_bins=False):\n    \"\"\"\n    Performs jackknife resampling over multiple HDF5 files to estimate uncertainties \n    in galaxy counts per square degree for each redshift bin. Optionally calculates \n    counts for HÎ± flux-selected bins.\n\n    Parameters:\n    - file_list (list of str): List of file paths to HDF5 datasets to process.\n    - halpha_flux_thresholds (list): List of HÎ± flux thresholds used for binning (if `find_halpha_bins` is True).\n    - find_halpha_bins (bool, optional): Whether to calculate counts for HÎ± bins (default: False).\n\n    Returns:\n    - counts_summary (dict): A dictionary containing:\n        - 'sum_counts' (numpy.ndarray): Summed galaxy counts across all HDF5 files for each redshift bin.\n          Shape: (number of redshift bins,).\n        - 'std_dev_counts' (numpy.ndarray): Jackknife standard deviations for galaxy counts per square degree.\n          Shape: (number of redshift bins,).\n       Shape: (number of redshift bins,).\n    - halpha_summary (dict or None): A dictionary containing HÎ± bin statistics if `find_halpha_bins` is True, otherwise `None`. \n      When present, the dictionary includes:\n        - 'halpha_sum_counts' (numpy.ndarray): Summed counts for each HÎ± bin.\n          Shape: (number of HÎ± bins, number of redshift bins).\n        - 'halpha_std_dev_counts' (numpy.ndarray): Jackknife standard deviations for HÎ± bins.\n          Shape: (number of HÎ± bins, number of redshift bins).\n\n    Notes:\n    - The function loads multiple HDF5 files and extracts galaxy counts using `galaxy_counts_per_hdf5_binned()`.\n    - Jackknife resampling is applied across files to compute standard deviations.\n    - The function saves `all_counts` to a NumPy file for debugging purposes.\n    - If `find_halpha_bins` is False, `halpha_summary` is returned as `None` to indicate that HÎ± binning was not performed.\n    \"\"\"\n    #fix these in case the above cells are not run\n    ra_min1=330\n    z_min = 1.0\n    z_max = 3.0\n    dz = 0.1\n    columns_to_keep = ['RA', 'DEC', 'redshift_observed', 'flux_Halpha6563']\n    columns_to_convert = ['redshift_observed', 'flux_Halpha6563']\n\n    #setup to track counts\n    all_counts = []\n    all_halpha_counts = [] if find_halpha_bins else None\n\n    for file in file_list:\n        # Load data from the file\n        df = read_hdf5_to_pandas(file, columns_to_keep, columns_to_convert)\n\n        #pre-process dataset\n        df, z_bins, z_bin_centers = assign_redshift_bins(df, z_min, z_max, dz)\n        df['RA_shifted'] = (df['RA'] - ra_min1) % 360  # Shift RA to continuous range\n\n        # Get counts (with or without Halpha binning)\n        result = galaxy_counts_per_hdf5_binned(\n            df, z_bins, z_bin_centers, find_halpha_bins=find_halpha_bins,\n            halpha_flux_thresholds=halpha_flux_thresholds\n        )\n        \n        counts_per_deg2, halpha_counts_per_deg2 = result \n        all_counts.append(counts_per_deg2.flatten())  #make sure shape is correct\n        \n        if find_halpha_bins:\n            all_halpha_counts.append(halpha_counts_per_deg2)\n\n        # Explicitly delete DataFrame for improved memory management\n        del df\n\n    # Save all_counts to a file for debugging or post-processing\n    os.makedirs(\"output\", exist_ok=True)\n    np.save(\"output/all_counts.npy\", all_counts)\n\n    # Convert to NumPy array for easier manipulation\n    all_counts = np.array(all_counts)\n\n    #debugging\n    print(\"all_counts shape:\", all_counts.shape)\n    print(\"all_counts sample:\", all_counts[:3])  # preview first 3 entries\n    print(\"all_counts variance:\", np.var(all_counts, axis=0))\n    print(\"all_counts dtype:\", all_counts.dtype)\n    \n    if find_halpha_bins:\n        all_halpha_counts = np.array(all_halpha_counts)\n\n    # Compute sum counts\n    sum_counts = np.sum(all_counts, axis=0)\n\n    # Compute jackknife standard deviations for galaxy counts\n    std_dev_counts = np.sqrt(\n        (len(all_counts) - 1) * np.var(all_counts, axis=0, ddof=0)\n    )\n\n    # Create counts summary dictionary\n    counts_summary = {\n        \"sum_counts\": sum_counts,\n        \"std_dev_counts\": std_dev_counts\n    }\n\n    # Compute jackknife standard deviations for Halpha counts (if applicable)\n    if find_halpha_bins:\n        halpha_sum_counts = np.sum(all_halpha_counts, axis=0)\n        halpha_std_dev_counts = np.sqrt(\n            (len(all_halpha_counts) - 1) * np.var(all_halpha_counts, axis=0, ddof=0)\n        )\n        # Create halpha counts summary dictionary\n        halpha_summary = {\n            \"halpha_sum_counts\": halpha_sum_counts,\n            \"halpha_std_dev_counts\": halpha_std_dev_counts\n        }\n    else:\n        halpha_summary = None  # No Halpha binning\n\n    return counts_summary, halpha_summary","key":"YPz2q3cIkf"},{"type":"output","id":"Fo1sJR2KLobp8Xf2M1Rti","data":[],"key":"fbLchhWQaP"}],"key":"UfxGZ7oiZC"},{"type":"block","children":[],"key":"x0G7joZbLd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n\n# This uses data downloaded in section 1 above.  \n# If you want to run this with more data, return to section 1 to get that downloaded.\ndownload_dir = 'downloaded_hdf5_files'\n# Get all HDF5 files from the directory\nfile_paths = [os.path.join(download_dir, f) for f in os.listdir(download_dir) if f.endswith('.hdf5')]\n\n#out of consideration for the size of these files and the amount of memory required to work with them\n# we only keep the columns that we are going to use and convert some to 32bit instead of 64 where \n# the higher precision is not necessary to the science\ncolumns_to_keep = ['RA', 'DEC', 'redshift_observed', 'flux_Halpha6563']\ncolumns_to_convert = ['redshift_observed', 'flux_Halpha6563']\n\n# Run jackknife with Halpha binning enabled\nhalpha_flux_thresholds=[0.5e-16, 0.7e-16, 0.9e-16, 1.1e-16, 1.3e-16, 1.5e-16, 1.7e-16, 1.9e-16]\nresults = jackknife_wrapper(\n    file_paths, halpha_flux_thresholds, find_halpha_bins=True\n)\n\n# Unpack results\ncounts_summary, halpha_summary = results\n\n# Plot the results\nplot_binned_galaxy_counts_vs_redshift_with_jackknife(\n    counts_summary, z_bin_centers, halpha_flux_thresholds, halpha_summary)","key":"T5L7wCDk5Q"},{"type":"output","id":"JKDfPidwj9PbxmaRJoc1U","data":[{"output_type":"stream","name":"stdout","text":"all_counts shape: (1, 20)\nall_counts sample: [[908.19889809 747.2333674  794.9342837  676.17631576 655.19747312\n  588.94982189 513.17670351 456.29600034 383.57721419 330.13751134\n  267.43061388 217.22499701 175.30681804 144.16250588 112.40633963\n   85.80426641  63.65060463  43.55867883  29.37146612  17.62327474]]\nall_counts variance: [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]\nall_counts dtype: float64\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 1000x600 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"63b0962c8fa364a02bdd6e4f049b146e","path":"/irsa-tutorials/build/63b0962c8fa364a02bdd6e4f049b146e.png"}}},{"output_type":"stream","name":"stdout","text":"CPU times: user 5.53 s, sys: 10.1 s, total: 15.6 s\nWall time: 32.7 s\n"}],"key":"uowiGWAYZX"}],"key":"aXcN0ZzYRN"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1023,"column":1},"end":{"line":1023,"column":1}},"children":[{"type":"text","value":"Figure Caption: Number Density plots color coded by Halpha flux.  Slight variations are noted in the shape of the curves as a function of Halpha flux, especially at higher redshifts.  This plot may be a factor of 10 below the section 3 number density plot if you have not let it download all 10 input files.  The 10 input files cover the same area on the sky, so the density will look smaller if fewer files are used.","position":{"start":{"line":1023,"column":1},"end":{"line":1023,"column":1}},"key":"XXRmrbNgOM"}],"key":"BvsFMnis9z"}],"key":"ToicZaaqtf"},{"type":"block","position":{"start":{"line":1025,"column":1},"end":{"line":1025,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1027,"column":1},"end":{"line":1027,"column":1}},"children":[{"type":"text","value":"4.1 Explore jackknife uncertainties","position":{"start":{"line":1027,"column":1},"end":{"line":1027,"column":1}},"key":"uIQ1Vn6RpZ"}],"identifier":"id-4-1-explore-jackknife-uncertainties","label":"4.1 Explore jackknife uncertainties","html_id":"id-4-1-explore-jackknife-uncertainties","implicit":true,"key":"h2aDyr1MyZ"},{"type":"paragraph","position":{"start":{"line":1028,"column":1},"end":{"line":1028,"column":1}},"children":[{"type":"text","value":"The uncertainties are plotted as error bars on the data points above.  There are no jackknife uncertainties if you are only using one file, so they will in that case not be visible on the plot.  This section is for the case where you are using more than one downloaded input file.  Here we explore and plot the jackknife uncertainties in a way that makes them visible.","position":{"start":{"line":1028,"column":1},"end":{"line":1028,"column":1}},"key":"c36ONaQvSs"}],"key":"HTe3vc6szR"}],"key":"HZCJeoOExs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def plot_jackknife_fractional_uncertainty(z_bin_centers, counts, std_dev_counts):\n    \"\"\"\n    Plots the fractional jackknife uncertainty (Ïƒ / N) as a function of redshift.\n    \n    Parameters\n    ----------\n    z_bin_centers : array-like\n        The center of each redshift bin.\n    counts : array-like\n        The total galaxy counts per redshift bin.\n    std_dev_counts : array-like\n        The jackknife standard deviation per redshift bin.\n    \"\"\"\n    fractional_uncertainty = std_dev_counts / counts\n\n    plt.figure(figsize=(8, 5))\n    plt.plot(z_bin_centers, fractional_uncertainty, marker='o', linestyle='-', color='purple')\n    #plt.ylim(0, 0.01)\n    plt.xlabel('Redshift')\n    plt.ylabel('Fractional Uncertainty')\n    plt.title('Jackknife Fractional Uncertainty vs. Redshift')\n    plt.grid(True)\n    plt.tight_layout()\n    plt.show()\n    plt.close()","key":"R6HjLGAiFI"},{"type":"output","id":"wsEFAx_DTQWO_Iq-CwPlP","data":[],"key":"ubaNToWhAn"}],"key":"MbcUUb3Yxo"},{"type":"block","children":[],"key":"xjvjKgegfd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#make fractional uncertainty plot\ncounts_per_deg2 = counts_summary[\"sum_counts\"].flatten()\nstd_dev_counts = counts_summary[\"std_dev_counts\"].flatten()\nplot_jackknife_fractional_uncertainty(z_bin_centers, counts_per_deg2, std_dev_counts)","key":"V0WPzzR0r8"},{"type":"output","id":"2O6fnrnleSyC4J8afW_Zd","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"\u003cFigure size 800x500 with 1 Axes\u003e","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"5607e99ff2829fc0c30bebd4be6c8607","path":"/irsa-tutorials/build/5607e99ff2829fc0c30bebd4be6c8607.png"}}}],"key":"dotrj6N33P"}],"key":"eq2htuWrRm"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":1065,"column":1},"end":{"line":1065,"column":1}},"children":[{"type":"text","value":"Figure Caption:  The fractional uncertainty is the standard deviation from jackknife sampling divided by the number of galaxies per square degree, here plotted as a function of redshift.  Note that if you are using only 1 downloaded file this will be a flat plot with no uncertainties.  However, if you are using all 10 input files, you will see the expected rise in uncertainty with increasing redshift.","position":{"start":{"line":1065,"column":1},"end":{"line":1065,"column":1}},"key":"f6ZPf4mHYB"}],"key":"ltqXnR9xuf"}],"key":"LIj67NWK8N"},{"type":"block","position":{"start":{"line":1067,"column":1},"end":{"line":1067,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1069,"column":1},"end":{"line":1069,"column":1}},"children":[{"type":"text","value":"Acknowledgements","position":{"start":{"line":1069,"column":1},"end":{"line":1069,"column":1}},"key":"yBCmTiIHFg"}],"identifier":"acknowledgements","label":"Acknowledgements","html_id":"acknowledgements","implicit":true,"key":"e1yAL1GImD"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1071,"column":1},"end":{"line":1072,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1071,"column":1},"end":{"line":1072,"column":1}},"children":[{"type":"link","url":"https://irsa.ipac.caltech.edu/","position":{"start":{"line":1071,"column":1},"end":{"line":1071,"column":1}},"children":[{"type":"text","value":"IPAC-IRSA","position":{"start":{"line":1071,"column":1},"end":{"line":1071,"column":1}},"key":"VeMJZg2YS6"}],"urlSource":"https://irsa.ipac.caltech.edu/","key":"BWrFkcc9WV"}],"key":"Y5ourYnTNF"}],"key":"wbvJ1nSid4"}],"key":"Lq31WSjjVM"},{"type":"block","position":{"start":{"line":1073,"column":1},"end":{"line":1073,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1075,"column":1},"end":{"line":1075,"column":1}},"children":[{"type":"text","value":"About this notebook","position":{"start":{"line":1075,"column":1},"end":{"line":1075,"column":1}},"key":"s8ni7KG2wD"}],"identifier":"about-this-notebook","label":"About this notebook","html_id":"about-this-notebook","implicit":true,"key":"p8lDBhPMRg"},{"type":"paragraph","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"children":[{"type":"text","value":"Authors","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"key":"z8pCVViT23"}],"key":"gmuU6AOlwT"},{"type":"text","value":": Jessica Krick in conjunction with the IPAC Science Platform Team","position":{"start":{"line":1076,"column":1},"end":{"line":1076,"column":1}},"key":"bvVW8aCTkm"}],"key":"ynCQ0ekG3r"},{"type":"paragraph","position":{"start":{"line":1078,"column":1},"end":{"line":1079,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1078,"column":1},"end":{"line":1078,"column":1}},"children":[{"type":"text","value":"Contact:","position":{"start":{"line":1078,"column":1},"end":{"line":1078,"column":1}},"key":"ZeGUz7lYkj"}],"key":"AZBNF3Yrlg"},{"type":"text","value":" ","position":{"start":{"line":1078,"column":1},"end":{"line":1078,"column":1}},"key":"lK99Rd0Xae"},{"type":"link","url":"https://irsa.ipac.caltech.edu/docs/help_desk.html","position":{"start":{"line":1078,"column":1},"end":{"line":1078,"column":1}},"children":[{"type":"text","value":"IRSA Helpdesk","position":{"start":{"line":1078,"column":1},"end":{"line":1078,"column":1}},"key":"Kc3RakjshP"}],"urlSource":"https://irsa.ipac.caltech.edu/docs/help_desk.html","key":"QSHR0Z026j"},{"type":"text","value":" with questions\nor problems.","position":{"start":{"line":1078,"column":1},"end":{"line":1078,"column":1}},"key":"BoQg3rFXM5"}],"key":"wssOjOMBPa"},{"type":"paragraph","position":{"start":{"line":1081,"column":1},"end":{"line":1081,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1081,"column":1},"end":{"line":1081,"column":1}},"children":[{"type":"text","value":"Updated:","position":{"start":{"line":1081,"column":1},"end":{"line":1081,"column":1}},"key":"A0VKt4c7eh"}],"key":"o9ESRmQla0"},{"type":"text","value":" 2025-04-01","position":{"start":{"line":1081,"column":1},"end":{"line":1081,"column":1}},"key":"suiH9fY5B2"}],"key":"kWz2ThacGY"},{"type":"paragraph","position":{"start":{"line":1083,"column":1},"end":{"line":1085,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"children":[{"type":"text","value":"Runtime:","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"key":"CvKPUMdaDD"}],"key":"HbOYWCtyJl"},{"type":"text","value":" As of the date above, running on the ","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"key":"lq7Wzu3ume"},{"type":"link","url":"https://pcos.gsfc.nasa.gov/Fornax/","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"children":[{"type":"text","value":"Fornax Science Platform","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"key":"fbrYIO8YfJ"}],"urlSource":"https://pcos.gsfc.nasa.gov/Fornax/","key":"WjSLTUvCNP"},{"type":"text","value":", this notebook takes about 9 minutes to run to completion on\na machine with 8GB RAM and 4 CPU.\nThis runtime inlcudes the notebook as is, using only one datafile out of 10.  Runtime will be greater than 30 min. longer if the code is allowed to download and work with all 10 datafiles.","position":{"start":{"line":1083,"column":1},"end":{"line":1083,"column":1}},"key":"GrmAnBwMDc"}],"key":"gNH3a9OoaA"}],"key":"OqFBxA2QFq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"NZg3lR71RZ"},{"type":"output","id":"rXMUlKsEksguEnfsVf9Ib","data":[],"key":"zP7KX3oZcT"}],"key":"zwufBg4Q1B"}],"key":"A0iEbKINnJ"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Searching for contributed COSMOS images","url":"/sia-cosmos","group":"COSMOS"},"next":{"title":"Analyzing cloud-hosted simulated Roman coadded images","url":"/openuniverse2024-roman-simulated-wideareasurvey","group":"OpenUniverse 2024"}}},"domain":"http://localhost:3000"},"project":{"subject":"IRSA Tutorials","settings":{"output_matplotlib_strings":"remove"},"title":"IRSA Tutorials","description":"IRSA Python Notebook tutorials to demostrate accessing data served by the NASA/IPAC Infrared Science Archive (IRSA)","authors":[{"id":"IRSA Scientists and Developers","name":"IRSA Scientists and Developers"}],"github":"https://github.com/Caltech-IPAC/irsa-tutorials/","keywords":["astronomy"],"toc":[{"file":"index.md","title":"IRSA Tutorials"},{"children":[{"file":"tutorials/spherex/spherex_intro.md"}],"title":"SPHEREx"},{"children":[{"children":[{"file":"tutorials/euclid_access/Euclid_ERO.md"}],"title":"Euclid Early Release Observations"},{"children":[{"file":"tutorials/euclid_access/1_Euclid_intro_MER_images.md"},{"file":"tutorials/euclid_access/2_Euclid_intro_MER_catalog.md"},{"file":"tutorials/euclid_access/3_Euclid_intro_1D_spectra.md"},{"file":"tutorials/euclid_access/4_Euclid_intro_PHZ_catalog.md"},{"file":"tutorials/euclid_access/5_Euclid_intro_SPE_catalog.md"},{"file":"tutorials/cloud_access/euclid-cloud-access.md"}],"title":"Euclid Quick Release 1"}],"title":"Euclid"},{"children":[{"children":[{"file":"tutorials/irsa-sia-examples/sia_allwise_atlas.md"},{"file":"tutorials/parquet-catalog-demos/wise-allwise-catalog-demo.md"}],"title":"AllWISE"},{"children":[{"file":"tutorials/firefly/NEOWISE_light_curve_demo.md"},{"file":"tutorials/parquet-catalog-demos/neowise-source-table-strategies.md"},{"file":"tutorials/parquet-catalog-demos/neowise-source-table-lightcurves.md"}],"title":"NEOWISE"}],"title":"WISE"},{"children":[{"file":"tutorials/irsa-sia-examples/siav2_seip.md"}],"title":"Spitzer"},{"children":[{"file":"tutorials/irsa-sia-examples/sia_2mass_allsky.md"}],"title":"2MASS"},{"children":[{"file":"tutorials/irsa-sia-examples/sia_cosmos.md"}],"title":"COSMOS"},{"children":[{"children":[{"file":"tutorials/roman_simulations/roman_hlss_number_density.md"}],"title":"Roman HLSS Galaxy Mock Catalog"},{"children":[{"file":"tutorials/openuniversesims/openuniverse2024_roman_simulated_wideareasurvey.md"},{"file":"tutorials/firefly/OpenUniverse2024Preview_Firefly.md"},{"file":"tutorials/openuniversesims/openuniverse2024_roman_simulated_timedomainsurvey.md"}],"title":"OpenUniverse 2024"},{"children":[{"file":"tutorials/cosmodc2/cosmoDC2_TAP_access.md"}],"title":"CosmoDC2"}],"title":"Simulated Data"},{"children":[{"file":"tutorials/cloud_access/cloud-access-intro.md"},{"file":"tutorials/firefly/SEDs_in_Firefly.md"},{"file":"tutorials/parallelize/Parallelize_Convolution.md"}],"title":"Special Topics"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"SPHEREx"},{"slug":"spherex-intro","title":"Introduction to SPHEREx Spectral Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Euclid"},{"level":2,"title":"Euclid Early Release Observations"},{"slug":"euclid-ero","title":"Exploring Star Clusters in the Euclid ERO Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":2,"title":"Euclid Quick Release 1"},{"slug":"euclid-intro-mer-images","title":"Euclid Q1: MER mosaics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-intro-mer-catalog","title":"Euclid Q1: MER catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-intro-1d-spectra","title":"Euclid Q1: 1D spectra","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-intro-phz-catalog","title":"Euclid Q1: PHZ catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-intro-spe-catalog","title":"Euclid Q1: SPE catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-cloud-access","title":"Euclid Q1: cloud access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"WISE"},{"level":2,"title":"AllWISE"},{"slug":"sia-allwise-atlas","title":"Searching for AllWISE Atlas Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"wise-allwise-catalog-demo","title":"Analyzing cloud-hosted AllWISE Source Catalog in Parquet format","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":2,"title":"NEOWISE"},{"slug":"neowise-light-curve-demo","title":"Using Firefly visualization tools to understand the light curves of Solar System objects","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"neowise-source-table-strategies","title":"Strategies to Efficiently Work with NEOWISE Single-exposure Source Table in Parquet","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"neowise-source-table-lightcurves","title":"Make Light Curves from NEOWISE Single-exposure Source Table","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Spitzer"},{"slug":"siav2-seip","title":"Searching for Spitzer Enhanced Imaging Products","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"2MASS"},{"slug":"sia-2mass-allsky","title":"Searching for 2MASS All-Sky Atlas Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"COSMOS"},{"slug":"sia-cosmos","title":"Searching for contributed COSMOS images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Simulated Data"},{"level":2,"title":"Roman HLSS Galaxy Mock Catalog"},{"slug":"roman-hlss-number-density","title":"Number Density as a Function of Redshift","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":2,"title":"OpenUniverse 2024"},{"slug":"openuniverse2024-roman-simulated-wideareasurvey","title":"Analyzing cloud-hosted simulated Roman coadded images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"openuniverse2024preview-firefly","title":"Using Firefly to Explore OpenUniverse2024 Data Preview Simulated Roman and Rubin Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"openuniverse2024-roman-simulated-timedomainsurvey","title":"Analyzing cloud-hosted simulated Roman Time Domain Survey images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":2,"title":"CosmoDC2"},{"slug":"cosmodc2-tap-access","title":"Querying CosmoDC2 Mock v1 catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"level":1,"title":"Special Topics"},{"slug":"cloud-access-intro","title":"IRSA cloud access introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"seds-in-firefly","title":"Using Firefly visualization tools in Python to vet SEDs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"parallelize-convolution","title":"Parallelizing image convolution","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/irsa-tutorials/build/manifest-B2B2E6A5.js";
import * as route0 from "/irsa-tutorials/build/root-IB5726YR.js";
import * as route1 from "/irsa-tutorials/build/routes/$-LXLHKVOR.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/irsa-tutorials/build/entry.client-UNPC4GT3.js");</script></body></html>