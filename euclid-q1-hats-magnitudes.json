{"version":3,"kind":"Notebook","sha256":"d86c9e3cdc72fea0eb3403836c9c2969c75cf0d1c39d3e2090045cf26de2b115","slug":"euclid-q1-hats-magnitudes","location":"/tutorials/parquet-catalog-demos/euclid-q1-hats/4-euclid-q1-hats-magnitudes.md","dependencies":[],"frontmatter":{"title":"Euclid Q1 Merged Objects HATS Catalog: Magnitudes","short_title":"Magnitudes","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.18.1"}},"content_includes_title":false,"authors":[{"id":"IRSA Scientists and Developers","name":"IRSA Scientists and Developers"}],"github":"https://github.com/Caltech-IPAC/irsa-tutorials/","subject":"IRSA Tutorials","keywords":["astronomy"],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":2}},"source_url":"https://github.com/Caltech-IPAC/irsa-tutorials//blob/main/tutorials/parquet-catalog-demos/euclid-q1-hats/4-euclid-q1-hats-magnitudes.md","edit_url":"https://github.com/Caltech-IPAC/irsa-tutorials//edit/main/tutorials/parquet-catalog-demos/euclid-q1-hats/4-euclid-q1-hats-magnitudes.md","exports":[{"format":"md","filename":"4-euclid-q1-hats-magnitudes.md","url":"/irsa-tutorials/build/4-euclid-q1-hats-mag-a0c6b937a1c64cc0cc8755cb1200e870.md"}]},"mdast":{"type":"root","children":[{"type":"block","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"This tutorial explores Euclid photometry measurements.\nIt assumes you are familiar with the ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"dLZ6NXYRAk"},{"type":"link","url":"/euclid-q1-hats-intro","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"first tutorial","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"VJfjKI2etn"}],"urlSource":"1-euclid-q1-hats-intro.md","dataUrl":"/euclid-q1-hats-intro.json","internal":true,"protocol":"file","key":"Ll8EebLvXg"},{"type":"text","value":" in this series, which covers the Euclid Q1 Merged Objects HATS Catalog content, format, and basic access.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"WCCNEqyy2X"}],"key":"u02te76cKV"}],"key":"PBDI8KdlxZ"},{"type":"block","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Learning Goals","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"sPH7ObErIF"}],"identifier":"learning-goals","label":"Learning Goals","html_id":"learning-goals","implicit":true,"key":"HFjmy0dNC5"},{"type":"paragraph","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"By the end of this tutorial, you will be able to:","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"RDRP4vkcSw"}],"key":"UkeMamJLn1"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":29,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Understand the different Euclid Q1 flux measurements and their intended use cases.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"uq0QGMDklK"}],"key":"JXnBnDZrXx"}],"key":"Lum0lPJAQm"},{"type":"listItem","spread":true,"position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Load aperture and template-fit magnitudes for Euclid I, Y, J, and H bands from the Euclid Q1 Merged Objects HATS Catalog.","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"sg9qQrfmrJ"}],"key":"RszfJwBjz6"}],"key":"oZcvupeOoa"},{"type":"listItem","spread":true,"position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Visualize and understand the template-fit magnitude distributions as a function of object classification.","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"WTGK1HhrJ4"}],"key":"GmRJ4qr1Hx"}],"key":"xRFpK2kJfN"},{"type":"listItem","spread":true,"position":{"start":{"line":32,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Compare aperture and template-fit magnitudes to understand their differences.","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"IZT0jWgrFT"}],"key":"B3jH75ua2D"}],"key":"exTipriR2q"}],"key":"SbKsxwr0aQ"}],"key":"gNa7RNrr4t"},{"type":"block","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"1. Introduction","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"SYCRQJ5C97"}],"identifier":"id-1-introduction","label":"1. Introduction","html_id":"id-1-introduction","implicit":true,"key":"g6KyXY4sr2"},{"type":"paragraph","position":{"start":{"line":38,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"JfRy2BX9e2"},{"type":"link","url":"https://irsa.ipac.caltech.edu/data/Euclid/docs/overview_q1.html","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"Euclid Q1","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"eF02vZL30N"}],"urlSource":"https://irsa.ipac.caltech.edu/data/Euclid/docs/overview_q1.html","key":"wGGYOfdjsd"},{"type":"text","value":" data release contains photometry from Euclid as well as from external surveys.\nThere are several flux measurements per band.\nThe measurements are described in ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"PMbyrXl3tj"},{"type":"link","url":"https://arxiv.org/pdf/2503.15305","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"Euclid Collaboration: Romelli et al., 2025","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"pwxABWDzRC"}],"urlSource":"https://arxiv.org/pdf/2503.15305","key":"cuIXBLlrtD"},{"type":"text","value":" (hereafter, Romelli), especially sections 6 and 8.","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"jTQEtUmsgZ"}],"key":"YUwlvmhWWy"},{"type":"paragraph","position":{"start":{"line":42,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"text","value":"In this tutorial, we will look at aperture and template-fit photometry measurements in the four Euclid bands: I (from the VIS instrument), Y, J, and H (from the NISP instrument).\n","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"eZSJrvHsy7"},{"type":"strong","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"Aperture fluxes","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"lnxZsnseOv"}],"key":"irIUWuVYX1"},{"type":"text","value":" are generally more accurate for point-like sources, especially bright stars in the NIR bands, likely due to better handling of PSF-related effects.\n","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"xE4vjwrAwu"},{"type":"strong","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"Template-fit fluxes","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"ickUp5QjBT"}],"key":"cnbxyEfhcY"},{"type":"text","value":" are expected to be more accurate for extended sources because the templates do a better job of excluding contamination from nearby sources.\nAdditional photometry measurements that we won’t cover here include: ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"kx6iVFZGTA"},{"type":"strong","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"Sérsic-fit fluxes","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"htmNC0QdkJ"}],"key":"EOffLSCrQz"},{"type":"text","value":" (computed for parametric morphology), ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"CXzn5jlybH"},{"type":"strong","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"PSF-fit fluxes","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"NAT4te4BGU"}],"key":"AJCIcas0XF"},{"type":"text","value":" (VIS only), and ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"zurK9mhAJE"},{"type":"strong","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"class-corrected fluxes","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"cW31x6BfHB"}],"key":"XYQu9aQIec"},{"type":"text","value":" that were corrected based on the PHZ (photometric) classifications.","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"xuUbhcbXXe"}],"key":"t3Be1iyLWx"},{"type":"paragraph","position":{"start":{"line":47,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"text","value":"The best-estimate flux in the detection band is given by the column ","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"jOkQYYTOYJ"},{"type":"inlineCode","value":"mer_flux_detection_total","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"W0leOM2OrR"},{"type":"text","value":".\nThis can also be used to color-correct flux measurements in non-detection bands, as we will demonstrate.\nThe object detection process is described in Romelli.\nThe ","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"yGRTYo6nXM"},{"type":"link","url":"http://st-dm.pages.euclid-sgs.uk/data-product-doc/dmq1/merdpd/merphotometrycookbook.html","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"text","value":"MER Photometry Cookbook","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"hmiYCj1ZSR"}],"urlSource":"http://st-dm.pages.euclid-sgs.uk/data-product-doc/dmq1/merdpd/merphotometrycookbook.html","key":"udUkjxI3HU"},{"type":"text","value":" describes the color corrections and how to convert from flux to magnitude.\nIn this tutorial, we will restrict to objects detected in VIS (I band) because it simplifies the calculations.","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"dNpgMbb3jy"}],"key":"Qx7oP05D0Y"}],"key":"YgvNLSJvcK"},{"type":"block","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"2. Imports and Paths","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"PsQGzBVXyC"}],"identifier":"id-2-imports-and-paths","label":"2. Imports and Paths","html_id":"id-2-imports-and-paths","implicit":true,"key":"cU6ntepBlZ"}],"key":"XZR6VDByp6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# # Uncomment the next line to install dependencies if needed.\n# %pip install hpgeom matplotlib pandas pyarrow","key":"zeHj6D0ZbF"},{"type":"outputs","id":"laX65zHnH3vhReL5VEQyu","children":[],"key":"p2AscFORkB"}],"key":"hDgd2sQ9SX"},{"type":"block","children":[],"key":"UGLeVciL3Q"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import hpgeom  # Find HEALPix indexes from RA and Dec\nimport matplotlib.pyplot as plt  # Create figures\nimport pyarrow.compute as pc  # Filter dataset\nimport pyarrow.dataset  # Load the dataset\nimport pyarrow.fs  # Simple S3 filesystem pointer\nimport pyarrow.parquet  # Load the schema","key":"bOUswQAzXA"},{"type":"outputs","id":"EAYnU_2iVGBKW92dC0qDV","children":[],"key":"qNMhczAoE1"}],"key":"cxU7YYh8dZ"},{"type":"block","children":[],"key":"ukO9sMuKZQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# AWS S3 paths.\ns3_bucket = \"nasa-irsa-euclid-q1\"\ndataset_prefix = \"contributed/q1/merged_objects/hats/euclid_q1_merged_objects-hats/dataset\"\ndataset_path = f\"{s3_bucket}/{dataset_prefix}\"\n\n# S3 pointer. Use `anonymous=True` to access without credentials.\ns3 = pyarrow.fs.S3FileSystem(anonymous=True)","key":"CKEa4MsBay"},{"type":"outputs","id":"VWsLGmiKYyjekzgWk01YC","children":[],"key":"bTFMd9sTxd"}],"key":"guwDzbgEoP"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"3. Load Template-fit and Aperture Magnitudes","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"zAylgzS3ME"}],"identifier":"id-3-load-template-fit-and-aperture-magnitudes","label":"3. Load Template-fit and Aperture Magnitudes","html_id":"id-3-load-template-fit-and-aperture-magnitudes","implicit":true,"key":"nOG3BadUOH"},{"type":"paragraph","position":{"start":{"line":83,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"text","value":"The following columns will be important.\nDescriptions come from Romelli.","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"oSVBkRfgVN"}],"key":"yD4qRoRHP5"}],"key":"yfTVTRKSTW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Whether the source was detected in VIS mosaic (1) or only in NIR-stack mosaic (0).\nVIS_DET = \"mer_vis_det\"\n\n# Best estimate of the total flux in the detection band.\n# From aperture photometry within a Kron radius.\n# Detection band is VIS if `VIS_DET == 1`. Otherwise, this is a\n# non-physical NIR-stack flux and there was no VIS detection (aka, NIR-only).\n# We will only deal with VIS-detected objects in this notebook.\nFLUX_DET_TOTAL = \"mer_flux_detection_total\"\n\n# Peak surface brightness minus the magnitude used for `mer_point_like_prob`.\n# This is a measure of compactness.\nMUMAX_MINUS_MAG = \"mer_mumax_minus_mag\"\n\n# Whether the detection has a >50% probability of being spurious (1=Yes, 0=No).\nSPURIOUS_FLAG = \"mer_spurious_flag\"\n\n# PHZ classification: 1=Star, 2=Galaxy, 4=QSO.\n# Combinations (3, 5, 6, and 7) indicate multiple probability thresholds were exceeded.\nPHZ_CLASS = \"phz_phz_classification\"","key":"d4xH5Qo9RG"},{"type":"outputs","id":"jSUJ3yZIW36QPvKkv4ndm","children":[],"key":"jt1T2aNqjZ"}],"key":"YnJRAN98Mv"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":109,"column":1},"end":{"line":111,"column":1}},"children":[{"type":"text","value":"We’ll convert the catalog fluxes to magnitudes following the ","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"VzC76zd2BT"},{"type":"link","url":"http://st-dm.pages.euclid-sgs.uk/data-product-doc/dmq1/merdpd/merphotometrycookbook.html","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"children":[{"type":"text","value":"MER Photometry Cookbook","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"rTV24KzLkc"}],"urlSource":"http://st-dm.pages.euclid-sgs.uk/data-product-doc/dmq1/merdpd/merphotometrycookbook.html","key":"fsCUopnJdO"},{"type":"text","value":".\nPyArrow can do the conversion during the read operation and return only the magnitudes.\nTo do this, we’ll use the following function to define the magnitudes as ","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"dxgnlI48MJ"},{"type":"inlineCode","value":"pyarrow.compute","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"KyHmuEpmqx"},{"type":"text","value":" (","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"L794Dhs3MA"},{"type":"inlineCode","value":"pc","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"HaN2rfKvnZ"},{"type":"text","value":") functions, which are described at ","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"wqXLf5S2dt"},{"type":"link","url":"https://arrow.apache.org/docs/python/api/compute.html","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"children":[{"type":"text","value":"Compute Functions","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"uDJ8pJzLHe"}],"urlSource":"https://arrow.apache.org/docs/python/api/compute.html","key":"vBi46xvHdv"},{"type":"text","value":".","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"Z0Z0LacBHZ"}],"key":"YfEPlymAEt"}],"key":"sp9qgbJmXt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def flux_to_magnitude(flux_col_name: str) -> pc.Expression:\n    \"\"\"Convert catalog fluxes to magnitudes following the MER Photometry Cookbook.\n\n    Parameters\n    ----------\n    flux_col_name : str\n        The name of the flux column to convert to magnitude.\n\n    Returns\n    -------\n    pyarrow.compute.Expression\n        An expression for the magnitude. It can be used in the `filter` and `columns`\n        keyword arguments when loading data from a PyArrow dataset.\n    \"\"\"\n    # We expect to be dealing with VIS_DET == 1 objects, so FLUX_DET_TOTAL == VIS flux.\n    vis_flux = pc.field(FLUX_DET_TOTAL)\n    band_flux = pc.field(flux_col_name)\n\n    if flux_col_name == FLUX_DET_TOTAL:\n        # Best-estimate flux in VIS is FLUX_DET_TOTAL.\n        best_flux = vis_flux\n    elif flux_col_name.endswith(\"_templfit\"):\n        # Best-estimate template-fit flux is the band flux scaled by a color correction.\n        band = flux_col_name.split(\"_\")[-2]  # y, j, or h\n        color_scale = pc.divide(vis_flux, pc.field(f\"mer_flux_vis_to_{band}_templfit\"))\n        best_flux = pc.multiply(band_flux, color_scale)\n    elif flux_col_name.endswith(\"aper\"):\n        # Best-estimate aperture flux is the band flux scaled by a color correction.\n        nfwhm = flux_col_name.split(\"_\")[-2]  # e.g., 2fwhm\n        color_scale = pc.divide(vis_flux, pc.field(f\"mer_flux_vis_{nfwhm}_aper\"))\n        best_flux = pc.multiply(band_flux, color_scale)\n\n    # magnitude = -2.5 * log10(flux) + 23.9.\n    scale = pc.scalar(-2.5)\n    log10_flux = pc.log10(best_flux)\n    zeropoint = pc.scalar(23.9)\n    mag_expression = pc.add(pc.multiply(scale, log10_flux), zeropoint)\n    return mag_expression","key":"AvIPnBvZMI"},{"type":"outputs","id":"-nQT265fdELLwzC2I0378","children":[],"key":"Qhmf4jl2mv"}],"key":"FCx8OnDFs2"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":154,"column":1},"end":{"line":157,"column":1}},"children":[{"type":"text","value":"Define the columns we want to load.\nThis needs to be a dictionary (rather than a simple list of column names) because we’re asking PyArrow to compute the magnitudes dynamically from the catalog fluxes.\nThe dictionary keys will be the column names in the resultant table.\nThe values must be ","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"key":"f2zAbsqQEW"},{"type":"inlineCode","value":"pyarrow.compute","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"key":"qQArDW6ZTC"},{"type":"text","value":" expressions (described above).","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"key":"OEXBv4iSsA"}],"key":"T4q3w67YFt"}],"key":"x4CKb2uigE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"I_MAG = \"I (mag)\"\ncolumns = {\n    PHZ_CLASS: pc.field(PHZ_CLASS),\n    I_MAG: flux_to_magnitude(FLUX_DET_TOTAL),\n    \"Y aperture (mag)\": flux_to_magnitude(\"mer_flux_y_2fwhm_aper\"),\n    \"J aperture (mag)\": flux_to_magnitude(\"mer_flux_j_2fwhm_aper\"),\n    \"H aperture (mag)\": flux_to_magnitude(\"mer_flux_h_2fwhm_aper\"),\n    \"Y templfit (mag)\": flux_to_magnitude(\"mer_flux_y_templfit\"),\n    \"J templfit (mag)\": flux_to_magnitude(\"mer_flux_j_templfit\"),\n    \"H templfit (mag)\": flux_to_magnitude(\"mer_flux_h_templfit\"),\n    MUMAX_MINUS_MAG: pc.field(MUMAX_MINUS_MAG),\n}\n# Let's see what one of these looks like.\ncolumns[\"Y aperture (mag)\"]","key":"SV4Z50x76G"},{"type":"outputs","id":"AJP-A8VLes4bmjXEQ3YRe","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"<pyarrow.compute.Expression add(multiply(-2.5, log10(multiply(mer_flux_y_2fwhm_aper, divide(mer_flux_detection_total, mer_flux_vis_2fwhm_aper)))), 23.9)>","content_type":"text/plain"}}},"key":"yfpm5ePr2E"}],"key":"hwsiWyGiWp"}],"key":"vY3UtFABOC"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":176,"column":1},"end":{"line":177,"column":1}},"children":[{"type":"text","value":"We’ll restrict to the Euclid Deep Field - Fornax (EDF-F) to reduce the amount of data loaded.\nCompute the HEALPix order 9 pixel indexes, following the ","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"xrzrI5p9C5"},{"type":"link","url":"/euclid-q1-hats-intro","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"children":[{"type":"text","value":"introductory tutorial","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"B0Y1lvpsPh"}],"urlSource":"1-euclid-q1-hats-intro.md","dataUrl":"/euclid-q1-hats-intro.json","internal":true,"protocol":"file","key":"ABUBOk8JC5"},{"type":"text","value":".","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"GCWKGxapwd"}],"key":"kjLJuN2cXW"}],"key":"UZnAm3oKKz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ra, dec, radius = 52.932, -28.088, 3  # 10 sq deg\nedff_k9_pixels = hpgeom.query_circle(hpgeom.order_to_nside(9), ra, dec, radius, inclusive=True)","key":"GLMHJ6Kija"},{"type":"outputs","id":"aafzqy4LD7XWS8eYg7Wy_","children":[],"key":"sVFxrCRL76"}],"key":"egsmSEDPLv"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"Construct the row filter.","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"SVtAnO93ss"}],"key":"qfLFmxGfDw"}],"key":"SlBUxhaQV8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"row_filter = (\n    # Stars, Galaxies, QSOs, and mixed classes.\n    pc.field(PHZ_CLASS).isin([1, 2, 3, 4, 5, 6, 7])\n    # Basic quality cut.\n    & (pc.field(SPURIOUS_FLAG) == 0)\n    # VIS-detected objects. (If you want to include NIR-only objects, alter flux_to_magnitude()\n    # following MER Photometry Cookbook and also comment out the next line.)\n    & (pc.field(VIS_DET) == 1)\n    # EDF-F region. (Comment out the next line to do an all-sky search.)\n    & pc.field(\"_healpix_9\").isin(edff_k9_pixels)\n)","key":"BYyQl6nlhE"},{"type":"outputs","id":"JMGn6Z_DC0eY6ta0Jjv-I","children":[],"key":"YilHdv00Ku"}],"key":"IVjexDTBje"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"children":[{"type":"text","value":"Load the data.","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"key":"QplysP0wN2"}],"key":"mR938RUK7G"}],"key":"W3cBXnXml7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Load the catalog as a PyArrow dataset. Include partitioning=\"hive\"\n# so PyArrow understands the file naming scheme and can navigate the partitions.\nschema = pyarrow.parquet.read_schema(f\"{dataset_path}/_common_metadata\", filesystem=s3)\ndataset = pyarrow.dataset.dataset(dataset_path, partitioning=\"hive\", filesystem=s3, schema=schema)\n\nmags_df = dataset.to_table(columns=columns, filter=row_filter).to_pandas()\nmags_df","key":"To2zX90Ead"},{"type":"outputs","id":"PsDEnxi0gNHPDHMCrOpHY","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"         phz_phz_classification    I (mag)  Y aperture (mag)  \\\n0                             2  21.130836         20.246357   \n1                             2  23.530122         20.404094   \n2                             2  25.603993         21.344415   \n3                             2  25.896114         24.694210   \n4                             2  25.146416         23.833867   \n...                         ...        ...               ...   \n3498996                       2  24.066025         24.704767   \n3498997                       2  24.372916         23.401461   \n3498998                       2  23.682455         23.030631   \n3498999                       2  23.257301         22.340015   \n3499000                       2  19.420445         24.079663   \n\n         J aperture (mag)  H aperture (mag)  Y templfit (mag)  \\\n0               19.660702         19.518608         20.328621   \n1               20.915967         20.605527         22.824030   \n2               22.156335         20.702953         32.709300   \n3               24.528586         24.726851         25.301338   \n4               24.412396         23.194615         27.318547   \n...                   ...               ...               ...   \n3498996         23.426418         23.251519         23.694467   \n3498997         25.628531         23.528569         23.455045   \n3498998               NaN         23.019727         23.157976   \n3498999         22.342694         22.132900         22.572963   \n3499000         26.476873               NaN               NaN   \n\n         J templfit (mag)  H templfit (mag)  mer_mumax_minus_mag  \n0               20.037912         19.567936            -1.081560  \n1               23.206607         23.420897            -1.182308  \n2               31.160601         32.235024            -2.167992  \n3               24.629402         25.307131            -1.992109  \n4               26.941532               NaN            -1.763762  \n...                   ...               ...                  ...  \n3498996         23.526109         23.461376            -1.640509  \n3498997         23.588801         23.409819            -2.022856  \n3498998         23.637121         22.932438            -1.608324  \n3498999         22.269022         22.126816            -0.928865  \n3499000         28.360588               NaN            -3.214653  \n\n[3499001 rows x 9 columns]","content_type":"text/plain"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>phz_phz_classification</th>\n      <th>I (mag)</th>\n      <th>Y aperture (mag)</th>\n      <th>J aperture (mag)</th>\n      <th>H aperture (mag)</th>\n      <th>Y templfit (mag)</th>\n      <th>J templfit (mag)</th>\n      <th>H templfit (mag)</th>\n      <th>mer_mumax_minus_mag</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2</td>\n      <td>21.130836</td>\n      <td>20.246357</td>\n      <td>19.660702</td>\n      <td>19.518608</td>\n      <td>20.328621</td>\n      <td>20.037912</td>\n      <td>19.567936</td>\n      <td>-1.081560</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>23.530122</td>\n      <td>20.404094</td>\n      <td>20.915967</td>\n      <td>20.605527</td>\n      <td>22.824030</td>\n      <td>23.206607</td>\n      <td>23.420897</td>\n      <td>-1.182308</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2</td>\n      <td>25.603993</td>\n      <td>21.344415</td>\n      <td>22.156335</td>\n      <td>20.702953</td>\n      <td>32.709300</td>\n      <td>31.160601</td>\n      <td>32.235024</td>\n      <td>-2.167992</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2</td>\n      <td>25.896114</td>\n      <td>24.694210</td>\n      <td>24.528586</td>\n      <td>24.726851</td>\n      <td>25.301338</td>\n      <td>24.629402</td>\n      <td>25.307131</td>\n      <td>-1.992109</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2</td>\n      <td>25.146416</td>\n      <td>23.833867</td>\n      <td>24.412396</td>\n      <td>23.194615</td>\n      <td>27.318547</td>\n      <td>26.941532</td>\n      <td>NaN</td>\n      <td>-1.763762</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>3498996</th>\n      <td>2</td>\n      <td>24.066025</td>\n      <td>24.704767</td>\n      <td>23.426418</td>\n      <td>23.251519</td>\n      <td>23.694467</td>\n      <td>23.526109</td>\n      <td>23.461376</td>\n      <td>-1.640509</td>\n    </tr>\n    <tr>\n      <th>3498997</th>\n      <td>2</td>\n      <td>24.372916</td>\n      <td>23.401461</td>\n      <td>25.628531</td>\n      <td>23.528569</td>\n      <td>23.455045</td>\n      <td>23.588801</td>\n      <td>23.409819</td>\n      <td>-2.022856</td>\n    </tr>\n    <tr>\n      <th>3498998</th>\n      <td>2</td>\n      <td>23.682455</td>\n      <td>23.030631</td>\n      <td>NaN</td>\n      <td>23.019727</td>\n      <td>23.157976</td>\n      <td>23.637121</td>\n      <td>22.932438</td>\n      <td>-1.608324</td>\n    </tr>\n    <tr>\n      <th>3498999</th>\n      <td>2</td>\n      <td>23.257301</td>\n      <td>22.340015</td>\n      <td>22.342694</td>\n      <td>22.132900</td>\n      <td>22.572963</td>\n      <td>22.269022</td>\n      <td>22.126816</td>\n      <td>-0.928865</td>\n    </tr>\n    <tr>\n      <th>3499000</th>\n      <td>2</td>\n      <td>19.420445</td>\n      <td>24.079663</td>\n      <td>26.476873</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>28.360588</td>\n      <td>NaN</td>\n      <td>-3.214653</td>\n    </tr>\n  </tbody>\n</table>\n<p>3499001 rows × 9 columns</p>\n</div>","content_type":"text/html"}}},"key":"sNR8qewdbJ"}],"key":"znuswLsB3i"}],"key":"mn5wXpypee"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"children":[{"type":"text","value":"4. Magnitude Distributions of Galaxies, Stars, and QSOs","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"key":"lAFeQNboef"}],"identifier":"id-4-magnitude-distributions-of-galaxies-stars-and-qsos","label":"4. Magnitude Distributions of Galaxies, Stars, and QSOs","html_id":"id-4-magnitude-distributions-of-galaxies-stars-and-qsos","implicit":true,"key":"JLcEE2IX2L"}],"key":"NkrHUVgCQK"},{"type":"block","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":216,"column":1},"end":{"line":218,"column":1}},"children":[{"type":"text","value":"Let’s visualize the template-fit magnitude distributions as a function of PHZ classification.\nSince the template-fit photometry is recommended for extended objects, we’ll separate the point-like objects.\n","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"alOBNKNNc3"},{"type":"link","url":"https://arxiv.org/pdf/2503.15306","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"children":[{"type":"text","value":"Euclid Collaboration: Tucci et al., 2025","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"hbhHllsIS8"}],"urlSource":"https://arxiv.org/pdf/2503.15306","key":"ZexpoHAkRh"},{"type":"text","value":" defines point-like objects as having ","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"xMRrk75BVW"},{"type":"inlineCode","value":"MUMAX_MINUS_MAG < -2.5","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"xezdpbNloX"},{"type":"text","value":".","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"IjP1mY5Uok"}],"key":"szN7Pg60wh"}],"key":"FeHoQSaXPW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"iLqkd6w5kf"},{"type":"outputs","id":"LZFmSbY1xhNXGxzlLnjJf","children":[],"key":"u686oLbri3"}],"key":"fW4aONrXeX"},{"type":"block","children":[],"key":"jcK36WdvcW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Galaxy + any. Star + galaxy. QSO + galaxy.\nclasses = {\"Galaxy\": (2, 3, 6, 7), \"Star\": (1, 3), \"QSO\": (4, 6)}\nclass_colors = [\"tab:green\", \"tab:blue\", \"tab:orange\"]\n\nbands = [I_MAG, \"Y templfit (mag)\", \"J templfit (mag)\", \"H templfit (mag)\"]\nmag_limits = (14, 28)  # Excluding all magnitudes outside this range.\nhist_kwargs = dict(bins=20, range=mag_limits, histtype=\"step\")\n\nfig, axes = plt.subplots(3, 4, figsize=(18, 12), sharey=\"row\", sharex=True)\nfor (class_name, class_ids), class_color in zip(classes.items(), class_colors):\n    hist_kwargs[\"color\"] = class_color\n\n    # Get the objects that are in this class only.\n    class_df = mags_df.loc[mags_df[PHZ_CLASS] == class_ids[0]]\n    # Plot histograms for each band. Galaxies on top row, then stars, then QSOs.\n    axs = axes[0] if class_name == \"Galaxy\" else (axes[1] if class_name == \"Star\" else axes[2])\n    for ax, band in zip(axs, bands):\n        ax.hist(class_df[band], label=class_name, **hist_kwargs)\n\n    # Get the objects that were accepted as multiple classes.\n    class_df = mags_df.loc[mags_df[PHZ_CLASS].isin(class_ids)]\n    label = \"+Galaxy\" if class_name != \"Galaxy\" else \"+any\"\n    # Of those objects, restrict to the ones that are point-like.\n    classpt_df = class_df.loc[class_df[MUMAX_MINUS_MAG] < -2.5]\n    pt_label = f\"{label} and point-like\"\n    # Plot histograms for both sets of objects.\n    for ax, band in zip(axs, bands):\n        ax.hist(class_df[band], label=label, linestyle=\":\", **hist_kwargs)\n        ax.hist(classpt_df[band], linestyle=\"-.\", label=pt_label, **hist_kwargs)\n\n# Add axis labels, etc.\nfor ax in axes[:, 0]:\n    ax.set_ylabel(\"Counts\")\n    ax.legend(framealpha=0.2, loc=2)\nfor axs, band in zip(axes.transpose(), bands):\n    axs[0].set_title(band.split()[0])\n    axs[-1].set_xlabel(band)\nplt.title(\"Magnitude Distributions by Object Type\")\nplt.tight_layout()","key":"mDAqnt0pfx"},{"type":"outputs","id":"wW1GPtstRczYQdiyndv6t","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1800x1200 with 12 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"e2eb90fe5ac5fcc88416feba612927a1","path":"/irsa-tutorials/build/e2eb90fe5ac5fcc88416feba612927a1.png"}}},"key":"xEA2LrxsiX"}],"key":"bCeuRIajPO"}],"key":"JWu7qgFl4Q"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":270,"column":1},"end":{"line":270,"column":1}},"children":[{"type":"text","value":"The Euclid instruments are tuned to detect galaxies for cosmology studies, so it’s no surprise that there are many more galaxies than other object types.","position":{"start":{"line":270,"column":1},"end":{"line":270,"column":1}},"key":"zr2p42NMn7"}],"key":"OGRm4dXG2i"},{"type":"paragraph","position":{"start":{"line":272,"column":1},"end":{"line":273,"column":1}},"children":[{"type":"text","value":"The green lines (top row) show the magnitude distributions of objects classified as galaxy only (solid) and those classified as galaxy plus possibly other types (dot and dash-dot).\nThe dash-dot line highlights the population of point-like “galaxies”, which are likely misclassified stars or QSOs and mostly appear at faint magnitudes.","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"B7tjIuMLDc"}],"key":"PujMqAjYSG"},{"type":"paragraph","position":{"start":{"line":275,"column":1},"end":{"line":278,"column":1}},"children":[{"type":"text","value":"The star distributions (middle row, blue) are broader and peak at brighter magnitudes than the galaxy distributions, as expected.\nAdding objects classified as both star and galaxy (dotted line) adds significant numbers, especially near the peak and toward the faint end where confusion is more likely.\nRestricting these to point-like objects (dash-dot line) shows that many bright objects surpassing both probability thresholds are likely to be stars, not galaxies.\nHowever, this doesn’t hold at the faint end where even some star-only classified objects fail the point-like cut.","position":{"start":{"line":275,"column":1},"end":{"line":275,"column":1}},"key":"xPpZbBq0Dk"}],"key":"TKd4XGh6zy"},{"type":"paragraph","position":{"start":{"line":280,"column":1},"end":{"line":283,"column":1}},"children":[{"type":"text","value":"The bottom row (orange) is the same as the middle row but for QSOs instead of stars.\nThere are very few point-like QSOs, reminding us that most QSO classifications in Q1 should be treated with skepticism (as discussed in the Classifications tutorial).\nBy default, this figure only includes objects in the EDF-F region.\nHigh-confidence QSOs are more concentrated in the EDF-N region where advantageous external photometry (particularly u-band from UNIONS) was available.","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"key":"d47UQH5EQB"}],"key":"bnuZHNudK3"}],"key":"OducHDBVVp"},{"type":"block","position":{"start":{"line":285,"column":1},"end":{"line":285,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"children":[{"type":"text","value":"5. Template-fit vs. Aperture Magnitudes","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"key":"F9KwyXQMlw"}],"identifier":"id-5-template-fit-vs-aperture-magnitudes","label":"5. Template-fit vs. Aperture Magnitudes","html_id":"id-5-template-fit-vs-aperture-magnitudes","implicit":true,"key":"vzhCApl5ia"}],"key":"t4xl5j1dsY"},{"type":"block","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":291,"column":1},"end":{"line":292,"column":1}},"children":[{"type":"text","value":"Now let’s compare template-fit and aperture magnitudes by plotting their differences.\nThis comparison reveals systematic offsets that depend on factors including morphology (extended vs. point-like) and brightness.","position":{"start":{"line":291,"column":1},"end":{"line":291,"column":1}},"key":"Gp8icw9sNh"}],"key":"Cv1FPIuhtw"},{"type":"paragraph","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"children":[{"type":"text","value":"This figure is inspired by Romelli Fig. 6 (top panel).","position":{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},"key":"C9W29mb9WN"}],"key":"OxXYK0bluA"}],"key":"u2PxJO9zpM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"AtfnolY7O0"},{"type":"outputs","id":"YU3gbOTqxMTuW34bSI42v","children":[],"key":"LTFTFlrWJi"}],"key":"eWE00j6L9p"},{"type":"block","children":[],"key":"VGBQy6jBWF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Only consider objects within these mag and mag difference limits.\nmag_limits, mag_diff_limits = (16, 24), (-1, 1)\nmag_limited_df = mags_df.loc[(mags_df[I_MAG] > mag_limits[0]) & (mags_df[I_MAG] < mag_limits[1])]\n\nbands = [\n    (\"Y templfit (mag)\", \"Y aperture (mag)\"),\n    (\"J templfit (mag)\", \"J aperture (mag)\"),\n    (\"H templfit (mag)\", \"H aperture (mag)\"),\n]\nhexbin_kwargs = dict(\n    cmap=\"YlGnBu\", bins=\"log\", extent=(*mag_limits, *mag_diff_limits), gridsize=25\n)\nannotate_kwargs = dict(\n    xycoords=\"axes fraction\", ha=\"left\", fontweight=\"bold\", bbox=dict(facecolor=\"white\", alpha=0.8)\n)\n\n# Plot\nfig, axes = plt.subplots(2, 3, figsize=(18, 9), sharey=True, sharex=True)\nfor axs, (ref_band, aper_band) in zip(axes.transpose(), bands):\n    # Extended objects, top row.\n    ax = axs[0]\n    extended = mags_df.loc[mags_df[MUMAX_MINUS_MAG] >= -2.5, [I_MAG, ref_band, aper_band]]\n    extended[\"mag_diff\"] = extended[ref_band] - extended[aper_band]\n    extended = extended.dropna(subset=\"mag_diff\")\n    cb = ax.hexbin(extended[I_MAG], extended[\"mag_diff\"], **hexbin_kwargs)\n    plt.colorbar(cb)\n    ax.set_ylabel(f\"{ref_band} - {aper_band}\")\n    # Annotate top (bottom) with the fraction of objects having a magnitude difference greater (less) than 0.\n    frac_tmpl_greater = len(extended.loc[extended[\"mag_diff\"] > 0]) / len(extended)\n    ax.annotate(f\"{frac_tmpl_greater:.3f}\", xy=(0.01, 0.99), va=\"top\", **annotate_kwargs)\n    frac_tmpl_less = len(extended.loc[extended[\"mag_diff\"] < 0]) / len(extended)\n    ax.annotate(f\"{frac_tmpl_less:.3f}\", xy=(0.01, 0.01), va=\"bottom\", **annotate_kwargs)\n\n    # Point-like objects, bottom row.\n    ax = axs[1]\n    pointlike = mags_df.loc[mags_df[MUMAX_MINUS_MAG] < -2.5, [I_MAG, ref_band, aper_band]]\n    pointlike[\"mag_diff\"] = pointlike[ref_band] - pointlike[aper_band]\n    pointlike = pointlike.dropna(subset=\"mag_diff\")\n    cb = ax.hexbin(pointlike[I_MAG], pointlike[\"mag_diff\"], **hexbin_kwargs)\n    plt.colorbar(cb)\n    ax.set_ylabel(f\"{ref_band} - {aper_band}\")\n    # Annotate top (bottom) with the fraction of objects having a magnitude difference greater (less) than 0.\n    frac_tmpl_greater = len(pointlike.loc[pointlike[\"mag_diff\"] > 0]) / len(pointlike)\n    ax.annotate(f\"{frac_tmpl_greater:.3f}\", xy=(0.01, 0.99), va=\"top\", **annotate_kwargs)\n    frac_tmpl_less = len(pointlike.loc[pointlike[\"mag_diff\"] < 0]) / len(pointlike)\n    ax.annotate(f\"{frac_tmpl_less:.3f}\", xy=(0.01, 0.01), va=\"bottom\", **annotate_kwargs)\n\n# Add axis labels, etc.\nfor i, ax in enumerate(axes.flatten()):\n    ax.axhline(0, color=\"gray\", linewidth=1)\n    if i == 1:\n        ax.set_title(\"Extended objects\")\n    if i == 4:\n        ax.set_title(\"Point-like objects\")\n    if i > 2:\n        ax.set_xlabel(I_MAG)\nplt.title(\"Magnitude Differences: Template-fit - Aperture\")\nplt.tight_layout()","key":"WyaSVOVlml"},{"type":"outputs","id":"Q0b5DSyz4WaoaM02oia51","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1800x900 with 12 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"ce54059f928aefb3ce92e76864838970","path":"/irsa-tutorials/build/ce54059f928aefb3ce92e76864838970.png"}}},"key":"lsaePsLQKH"}],"key":"CIMrOd0U3P"}],"key":"RfzL509sS0"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":365,"column":1},"end":{"line":368,"column":1}},"children":[{"type":"text","value":"The panel annotations give the fraction of objects with magnitude differences that are positive (top number) and negative (bottom number).\nThe magnitude difference is fairly tightly clustered around 0 for extended objects (top row), but with asymmetric outliers.\nThere is a positive offset, indicating fainter template-fit magnitudes, as expected: templates better exclude contaminating light from nearby sources.\nThe offset is more pronounced for point-like objects (bottom row), likely due to the PSF handling mentioned above, and we are reminded that aperture magnitudes are more reliable here.","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"key":"ab8393XnsM"}],"key":"MEFHS2U9Kg"}],"key":"mG4HZgWWZl"},{"type":"block","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"children":[{"type":"text","value":"About this notebook","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"sskn6tuRD6"}],"identifier":"about-this-notebook","label":"About this notebook","html_id":"about-this-notebook","implicit":true,"key":"DHIBrTllY5"},{"type":"paragraph","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"children":[{"type":"strong","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"children":[{"type":"text","value":"Authors:","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"key":"oQKXwvxKUD"}],"key":"kBBkV4PyGW"},{"type":"text","value":" Troy Raen, Vandana Desai, Andreas Faisst, Shoubaneh Hemmati, Jaladh Singhal, Brigitta Sipőcz, Jessica Krick, the IRSA Data Science Team, and the Euclid NASA Science Center at IPAC (ENSCI).","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"key":"ZVQ3S6Tt9a"}],"key":"zxpQxnUgzG"},{"type":"paragraph","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"children":[{"type":"strong","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"children":[{"type":"text","value":"Updated:","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"GwkpN91CzS"}],"key":"K6uWhd1PKO"},{"type":"text","value":" 2025-12-23","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"QnbesLTNqU"}],"key":"e0x74rS1ZR"},{"type":"paragraph","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"children":[{"type":"strong","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"children":[{"type":"text","value":"Contact:","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"key":"Zy8JgkbVHM"}],"key":"bCR9gyxRIc"},{"type":"text","value":" ","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"key":"M6EvtYVOAl"},{"type":"link","url":"https://irsa.ipac.caltech.edu/docs/help_desk.html","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"children":[{"type":"text","value":"IRSA Helpdesk","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"key":"yEeHYo9lYF"}],"urlSource":"https://irsa.ipac.caltech.edu/docs/help_desk.html","key":"Ubj2qWoJde"}],"key":"Tvim6HHh8u"}],"key":"ooiRQTmhrI"}],"key":"YXPkgg5TM5"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Euclid Q1 Merged Objects HATS Catalog: Introduction","short_title":"Introduction","url":"/euclid-q1-hats-intro","group":"Merged Objects HATS Catalog"},"next":{"title":"Euclid Q1: Cloud Access","short_title":"Cloud Access","url":"/euclid-cloud-access","group":"Merged Objects HATS Catalog"}}},"domain":"http://localhost:3000"}