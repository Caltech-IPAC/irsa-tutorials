{"version":3,"kind":"Notebook","sha256":"f6390d0836b171181c395edfc95e305bf9f9056406d3d668cff2c69cca4f630a","slug":"wise-allwise-catalog-demo","location":"/tutorials/wise/wise-allwise-catalog-demo.md","dependencies":[],"frontmatter":{"title":"Analyzing cloud-hosted AllWISE Source Catalog in Parquet format","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.16.7"}},"execute":{"skip":true},"content_includes_title":false,"authors":[{"id":"IRSA Scientists and Developers","name":"IRSA Scientists and Developers"}],"license":{"content":{"id":"BSD-3-Clause","url":"https://github.com/Caltech-IPAC/irsa-tutorials/blob/main/LICENSE","name":"BSD 3-Clause \"New\" or \"Revised\" License","free":true,"osi":true}},"github":"https://github.com/Caltech-IPAC/irsa-tutorials/","subject":"IRSA Tutorials","keywords":["astronomy"],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":1}},"source_url":"https://github.com/Caltech-IPAC/irsa-tutorials//blob/main/tutorials/wise/wise-allwise-catalog-demo.md","edit_url":"https://github.com/Caltech-IPAC/irsa-tutorials//edit/main/tutorials/wise/wise-allwise-catalog-demo.md","exports":[{"format":"md","filename":"wise-allwise-catalog-demo.md","url":"/irsa-tutorials/build/wise-allwise-catalog-3c444e400d41b831322ee8fc6f49d2dd.md"}]},"mdast":{"type":"root","children":[{"type":"block","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Learning Goals","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"RrLDBj3EsU"}],"identifier":"learning-goals","label":"Learning Goals","html_id":"learning-goals","implicit":true,"key":"YoIihEXjrs"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":23,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Learn how to load data from the AllWISE parquet catalog that is partitioned by HEALPix pixel index at order 5.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"IrrRKId3Lk"}],"key":"H09VOB5t08"}],"key":"QAjlBZ4gPh"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Learn efficient methods for performing common types of searches. This includes:","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"TjQ1zyt06h"}],"key":"XhG1rwusme"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":27,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"query/load using pandas, applying basic filters","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"NU6ClbkCfG"}],"key":"LByqTY1HRP"}],"key":"K06RGVHdB7"},{"type":"listItem","spread":true,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"query/load using pyarrow, applying advanced filters that combine and/or compare columns","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"GvMGqAg4th"}],"key":"P6EaZpHZts"}],"key":"cXI76L7sPC"},{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"perform nearest neighbor searches using pyarrow and astropy","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"yPuXAHGeAM"}],"key":"fTbOiLyfej"}],"key":"ygR4lcxX1x"}],"key":"wpAgzyh4fG"}],"key":"GMw4NMFlrg"}],"key":"sL4r9vyyA2"}],"key":"JNFh7R7dpH"},{"type":"block","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"ewu0dGonLY"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"U1eV8ZXVRp"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"This notebook demonstrates access to the ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"NMoO445txO"},{"type":"link","url":"https://ui.adsabs.harvard.edu/abs/2005ApJ...622..759G/abstract","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"HEALPix","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"c5Dm6QgMP4"}],"urlSource":"https://ui.adsabs.harvard.edu/abs/2005ApJ...622..759G/abstract","key":"owBZHw4GhQ"},{"type":"text","value":"-partitioned (order 5), ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"Ucz69UN1is"},{"type":"link","url":"https://parquet.apache.org/","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"Apache Parquet","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"qRZBOIUv0x"}],"urlSource":"https://parquet.apache.org/","key":"p2emcGIqwl"},{"type":"text","value":" version of the ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"UrG9vjXpnj"},{"type":"link","url":"https://wise2.ipac.caltech.edu/docs/release/allwise/expsup/sec1_3.html#src_cat","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"AllWISE Source Catalog","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"amqLqtLQyT"}],"urlSource":"https://wise2.ipac.caltech.edu/docs/release/allwise/expsup/sec1_3.html#src_cat","key":"IECsGvmKCj"},{"type":"text","value":".\nThe catalog is available through the ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"tvGW9JRGo3"},{"type":"link","url":"https://registry.opendata.aws/wise-allwise/","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"AWS Open Data","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"J6dxEzluxG"}],"urlSource":"https://registry.opendata.aws/wise-allwise/","key":"oNmZ4rnMhn"},{"type":"text","value":" program, as part of the ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"x2hbjvprg0"},{"type":"link","url":"https://science.nasa.gov/open-science-overview","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"NASA Open-Source Science Initiative","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"UtG8k3kG92"}],"urlSource":"https://science.nasa.gov/open-science-overview","key":"gJvulbNPLl"},{"type":"text","value":".\nAccess is free and no special permissions or credentials are required.","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"e4umwuItTq"}],"key":"jPzMSmlFiZ"},{"type":"paragraph","position":{"start":{"line":39,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"Parquet is convenient for large astronomical catalogs in part because the storage format supports efficient database-style queries on the files themselves, without having to load the catalog into a database (or into memory) first.\nThe AllWISE catalog is fairly large at 340 GB.\nThe examples below demonstrate different methods that can be used to query the catalog, filtering the data and loading only the results.\nEach method accesses the parquet files a bit differently and is useful for different types of queries.","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"w3D6FUd1Zq"}],"key":"OyhAQYiXKv"}],"key":"o7t8Z6riys"},{"type":"block","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"B8CYDvnzsA"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"wYLyGoGHNs"}],"key":"kJxYzLSStj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Uncomment the next line to install dependencies if needed.\n# !pip install 'pandas>=1.5.2' 'pyarrow>=10.0.1' matplotlib hpgeom astropy","key":"wXLYtGiZc7"},{"type":"outputs","id":"E-JPsL28V0sb1K19Ix3fV","children":[],"key":"ZGNseFiqHY"}],"key":"iKkyB0D957"},{"type":"block","children":[],"key":"N5bbAxfgKs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import sys\n\nimport hpgeom as hp\nimport pandas as pd\nimport pyarrow.compute as pc\nimport pyarrow.dataset as ds\nfrom astropy import units as u\nfrom astropy.coordinates import SkyCoord\nfrom matplotlib import colors\nfrom matplotlib import pyplot as plt\nfrom pyarrow.fs import S3FileSystem","key":"uX3hdv4fDh"},{"type":"outputs","id":"VIjNoy8viug0b-4XLrN26","children":[],"key":"nUehOCKblD"}],"key":"nXs6jYUbvw"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"children":[{"type":"text","value":"Setup catalog paths and query filters","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"key":"wLMoxunJUA"}],"identifier":"setup-catalog-paths-and-query-filters","label":"Setup catalog paths and query filters","html_id":"setup-catalog-paths-and-query-filters","implicit":true,"key":"TCZn3ifjnk"}],"key":"yOIrakaAH1"},{"type":"block","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":71,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"This AllWISE catalog is stored in an ","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"OQQPtvpjyE"},{"type":"link","url":"https://aws.amazon.com/s3/","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"text","value":"AWS S3","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"gvwPICmKw3"}],"urlSource":"https://aws.amazon.com/s3/","key":"qsLdjKWSVv"},{"type":"text","value":" cloud storage bucket.\nTo connect to an S3 bucket we just need to point the reader at S3 instead of the local filesystem.\n(Here, a “reader” is a python library that reads parquet files.)\nWe’ll use ","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"eIsCr01XaN"},{"type":"link","url":"https://arrow.apache.org/docs/python/generated/pyarrow.fs.S3FileSystem.html","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"text","value":"pyarrow​.fs​.S3FileSystem","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"KJFVXAC2uW"}],"urlSource":"https://arrow.apache.org/docs/python/generated/pyarrow.fs.S3FileSystem.html","key":"PxSeZnZ9bM"},{"type":"text","value":" for this because it is recognized by every reader in examples below, and we’re already using pyarrow.\n(","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"BB5ysZYxyz"},{"type":"link","url":"https://s3fs.readthedocs.io/en/latest/index.html","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"text","value":"s3fs","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"e7MTXZB4bC"}],"urlSource":"https://s3fs.readthedocs.io/en/latest/index.html","key":"EqjGrUeDyq"},{"type":"text","value":" is another common option.)\nTo access without credentials, we’ll use the keyword argument ","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"QV28DO4j0H"},{"type":"inlineCode","value":"anonymous=True","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"uy6bX8Mr3u"},{"type":"text","value":".\nMore information about accessing S3 buckets can be found at ","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"kfZJ0Co5t0"},{"type":"link","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"text","value":"IRSA cloud access introduction","key":"tYaXXfklBu"}],"identifier":"cloud-access-intro","label":"cloud-access-intro","url":"/cloud-access-intro","internal":true,"dataUrl":"/cloud-access-intro.json","key":"uFKx3eL1IA"},{"type":"text","value":".","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"z8RiaYbsmw"}],"key":"VcdgUFBM9L"}],"key":"ms9cmVTTwP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bucket = \"nasa-irsa-wise\"\nfolder = \"wise/allwise/catalogs/p3as_psd/healpix_k5\"\nparquet_root = f\"{bucket}/{folder}/wise-allwise.parquet\"\n\nfs = S3FileSystem(region=\"us-west-2\", anonymous=True)  # the bucket is in region us-west-2","key":"sykNwF77j5"},{"type":"outputs","id":"1e-F2SwxdB4NBl7Wqy5mS","children":[],"key":"KGZMyFrRpk"}],"key":"DE9MN5D5ML"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":87,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"text","value":"These limits will be used to query the catalog using specific filters created in examples below.\nThe Schema Access section (below) shows how to access column names and other schema information.","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"om84gCmCiJ"}],"key":"XKHsSLb9FV"}],"key":"idG5Lk6aLV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"w1mpro_min = 10.0\nra_min, ra_max = 15, 25  # deg\ndec_min, dec_max = 62, 72  # deg\npolygon_corners = [(ra_min, dec_min), (ra_min, dec_max), (ra_max, dec_max), (ra_max, dec_min)]\nradius = 5 * u.arcmin.to(u.deg)","key":"kHihdVcNlv"},{"type":"outputs","id":"T1ItY7riT2kqU4B_KFYb9","children":[],"key":"h4OwNi6Aks"}],"key":"AYZNzMMaJS"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":98,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"text","value":"The catalog is partitioned by HEALPix pixel index at order 5.\nQueries can be most efficient when a filter on the partition column is included, since the reader can skip those partitions entirely.\nThus, for queries that include ra/dec constraints, we can usually speed up load times significantly by including a constraint on the HEALPix order 5 pixel index.\nThe required pixel indexes can be calculated using ","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"PCUfFgLMie"},{"type":"link","url":"https://hpgeom.readthedocs.io/en/latest/index.html","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"text","value":"hpgeom","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"H1lTGI7C8Z"}],"urlSource":"https://hpgeom.readthedocs.io/en/latest/index.html","key":"dVrZbWDhpB"},{"type":"text","value":", as demonstrated here.","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"jBT2qBxiJo"}],"key":"dINTgBC1hA"}],"key":"dUwRYnTQZu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"order = 5  # the catalog is partitioned by HEALPix pixel index at order 5\nnside = hp.order_to_nside(order)  # number of order 5 pixels along one side of a base pixel","key":"In9USGhrhJ"},{"type":"outputs","id":"8_9lncjZHmYgYNtQIb4Bp","children":[],"key":"dYsMLTVCx8"}],"key":"rQugo0AIdd"},{"type":"block","children":[],"key":"UlsYALkWUQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# polygon search: get the set of pixel indexes that overlap the ra/dec polygon\npolygon_pixels = hp.query_polygon(\n    nside=nside,\n    a=[corner[0] for corner in polygon_corners],  # ra values\n    b=[corner[1] for corner in polygon_corners],  # dec values\n    nest=True,  # catalog uses nested ordering scheme for pixel index\n    inclusive=True,  # return all pixels that overlap with the polygon, and maybe a few more\n)\n\nprint(f\"polygon_pixels contains {len(polygon_pixels)} of a possible {hp.nside_to_npixel(nside)} pixels\")","key":"zeULS2mqrX"},{"type":"outputs","id":"hOrovB4XFiBfw_Aa9c_zS","children":[],"key":"SgmDfAhJbU"}],"key":"jnFTtk79im"},{"type":"block","children":[],"key":"tNl2G7adTY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# cone search: get the set of pixel indexes that overlap a 5' circle around the ra/dec min\ncone_pixels = hp.query_circle(\n    nside=nside,\n    a=ra_min,\n    b=dec_min,\n    radius=radius,\n    nest=True,  # catalog uses nested ordering scheme for pixel index\n    inclusive=True,  # return all pixels that overlap with the disk, and maybe a few more\n)\n\n# this can reduce the number of partitions the reader needs to look at from 12288 down to 2\nprint(f\"cone_pixels contains {len(cone_pixels)} of a possible {hp.nside_to_npixel(nside)} pixels\")","key":"en2wJgmVZs"},{"type":"outputs","id":"RHdHQ0Pnrd-7YB8JhwXEv","children":[],"key":"Ue4u8SEtcQ"}],"key":"UPH4UuIJB2"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"children":[{"type":"text","value":"Example 1:  Pandas with basic filters (magnitude limit and ra/dec polygon)","position":{"start":{"line":136,"column":1},"end":{"line":136,"column":1}},"key":"RXdjOGXVyr"}],"identifier":"example-1-pandas-with-basic-filters-magnitude-limit-and-ra-dec-polygon","label":"Example 1:  Pandas with basic filters (magnitude limit and ra/dec polygon)","html_id":"example-1-pandas-with-basic-filters-magnitude-limit-and-ra-dec-polygon","implicit":true,"key":"UIxwsj60lD"}],"key":"G0bw2dlR7p"},{"type":"block","position":{"start":{"line":138,"column":1},"end":{"line":138,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":140,"column":1},"end":{"line":141,"column":1}},"children":[{"type":"text","value":"Load using ","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"p6lwmebr47"},{"type":"link","url":"https://pandas.pydata.org/docs/reference/api/pandas.read_parquet.html","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"children":[{"type":"text","value":"pandas.read_parquet","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"bFAosfSEK7"}],"urlSource":"https://pandas.pydata.org/docs/reference/api/pandas.read_parquet.html","key":"h55eqh7YY9"},{"type":"text","value":".\nFilter for magnitudes above our w1mpro limit and a sky-area limited to the ra/dec polygon.","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"nV9oiDzK3u"}],"key":"ei0GguBR7I"},{"type":"paragraph","position":{"start":{"line":143,"column":1},"end":{"line":145,"column":1}},"children":[{"type":"text","value":"Pandas actually uses either pyarrow or fastparquet to interact with parquet files.\nWe’ll choose pyarrow (the default).\nFor filter options, see the ","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"key":"XIosNoH8ia"},{"type":"inlineCode","value":"filters","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"key":"wwfzR9uLFP"},{"type":"text","value":" arg description in ","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"key":"uV3Nr8jLKL"},{"type":"link","url":"https://arrow.apache.org/docs/python/generated/pyarrow.parquet.ParquetDataset.html#pyarrow.parquet.ParquetDataset","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"children":[{"type":"text","value":"ParquetDataset","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"key":"bmmecn880C"}],"urlSource":"https://arrow.apache.org/docs/python/generated/pyarrow.parquet.ParquetDataset.html#pyarrow.parquet.ParquetDataset","key":"FgcsfbvXHv"},{"type":"text","value":".","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"key":"di4xFrF4lf"}],"key":"nZr9FNNNfP"}],"key":"Oud1dn6RLE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# expect this to take 40-90 seconds\npandas_df = pd.read_parquet(\n    parquet_root,\n    filesystem=fs,\n    # columns to be returned. similar to a SQL SELECT clause.\n    columns=[\"designation\", \"ra\", \"dec\", \"w1mpro\", \"healpix_k5\"],\n    # row filters. similar to a SQL WHERE clause.\n    # tuple conditions are joined by AND (for OR, use a list of lists)\n    # supported operators: ==, !=, <, >, <=, >=, in, not in\n    filters=[\n        (\"w1mpro\", \">\", w1mpro_min),\n        (\"ra\", \">\", ra_min),\n        (\"ra\", \"<\", ra_max),\n        (\"dec\", \">\", dec_min),\n        (\"dec\", \"<\", dec_max),\n        # include filter on partition column for most efficient loading\n        (\"healpix_k5\", \"in\", polygon_pixels),\n    ],\n)\n\npandas_df.describe()","key":"n9uC17Ktzo"},{"type":"outputs","id":"WW6H_i-kmMfUODG4K7BtC","children":[],"key":"ibvqvVARvW"}],"key":"waliVOpgn5"},{"type":"block","children":[],"key":"IT78cg0Cks"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Delete pandas_df to save memory. This is useful when running on a machine with a small amount of RAM.\ndel pandas_df","key":"q0F89d8vKa"},{"type":"outputs","id":"8V2GpLyx4NByqpYnrb3aE","children":[],"key":"gMVVPR1JkS"}],"key":"RDCG15cu0t"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"children":[{"type":"text","value":"Example 2:  Pyarrow with advanced filters (color-color cuts for AGN)","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"mganx6gbM1"}],"identifier":"example-2-pyarrow-with-advanced-filters-color-color-cuts-for-agn","label":"Example 2:  Pyarrow with advanced filters (color-color cuts for AGN)","html_id":"example-2-pyarrow-with-advanced-filters-color-color-cuts-for-agn","implicit":true,"key":"mzw4jofJZ1"}],"key":"iJg4HhFZ8v"},{"type":"block","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":180,"column":1},"end":{"line":181,"column":1}},"children":[{"type":"text","value":"Load using ","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"QskeUjtuYL"},{"type":"link","url":"https://arrow.apache.org/docs/python/generated/pyarrow.dataset.parquet_dataset.html","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"children":[{"type":"text","value":"pyarrow​.dataset​.parquet​_dataset","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"YplnKxgoGq"}],"urlSource":"https://arrow.apache.org/docs/python/generated/pyarrow.dataset.parquet_dataset.html","key":"BfnmSXWqul"},{"type":"text","value":" and convert to pandas.\nUseful for:","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"v0D0PBCMks"}],"key":"Bngi6vTTD5"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":183,"column":1},"end":{"line":185,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"advanced filters that combine, compare, and/or create new columns. (this example)","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"q9EEfbb5es"}],"key":"YfoXYojvwX"}],"key":"O2mpbk6wah"},{"type":"listItem","spread":true,"position":{"start":{"line":184,"column":1},"end":{"line":185,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"speed. This method is more efficient at “discovering” the dataset than pandas. It also provides a persistent dataset object that can be reused for future queries, where pandas must re-discover the dataset every time. (this example and Example 3)","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"VCilhfp4Zx"}],"key":"OTNIHqJZuO"}],"key":"ECLDXARkiB"}],"key":"H8S5hrsLKS"},{"type":"paragraph","position":{"start":{"line":186,"column":1},"end":{"line":187,"column":1}},"children":[{"type":"text","value":"This example filters the catalog for AGN by making cuts in color-color space using the selection limits from ","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"key":"VXGUfH8gmO"},{"type":"link","url":"https://arxiv.org/pdf/1208.2530.pdf","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"children":[{"type":"text","value":"Mateos et al. (2012)","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"key":"hfXcdFplUi"}],"urlSource":"https://arxiv.org/pdf/1208.2530.pdf","key":"vZM7CZvmMM"},{"type":"text","value":".\nThis is a more complicated filter than in Example 1 (it requires both constructing new columns and comparing values between columns) but this load is generally faster, demonstrating the efficiency of this method.","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"key":"j485hjmUoh"}],"key":"EiG7pcLBcT"},{"type":"paragraph","position":{"start":{"line":189,"column":1},"end":{"line":193,"column":1}},"children":[{"type":"text","value":"For basic info about the ","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"CWuvq2U44i"},{"type":"inlineCode","value":"columns","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"IR001ZhGpG"},{"type":"text","value":" and ","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"NWcgQRFqeX"},{"type":"inlineCode","value":"filter","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"BL2grJHKMt"},{"type":"text","value":" arguments, see ","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"Ab1ISnmLvI"},{"type":"link","url":"https://arrow.apache.org/docs/python/generated/pyarrow.dataset.Scanner.html#pyarrow.dataset.Scanner.from_dataset","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"children":[{"type":"text","value":"Scanner","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"ltuALkPms9"}],"urlSource":"https://arrow.apache.org/docs/python/generated/pyarrow.dataset.Scanner.html#pyarrow.dataset.Scanner.from_dataset","key":"SfUAFzLdhR"},{"type":"text","value":".\nThe construction of columns/filters is more involved than before because they must be passed as ","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"lC99X51oA8"},{"type":"link","url":"https://arrow.apache.org/docs/python/generated/pyarrow.dataset.Expression.html#pyarrow.dataset.Expression","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"children":[{"type":"text","value":"Expressions","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"iqcuIKg5pq"}],"urlSource":"https://arrow.apache.org/docs/python/generated/pyarrow.dataset.Expression.html#pyarrow.dataset.Expression","key":"aTwBuXxKV7"},{"type":"text","value":", and all operations must be done using pyarrow.compute ","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"mfTaoDhDx1"},{"type":"link","url":"https://arrow.apache.org/docs/python/api/compute.html","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"children":[{"type":"text","value":"functions","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"VkeiL66hmZ"}],"urlSource":"https://arrow.apache.org/docs/python/api/compute.html","key":"dovYLk3Ga0"},{"type":"text","value":" and ","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"geCN54rORT"},{"type":"inlineCode","value":"field","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"PnZn1QJ0p8"},{"type":"text","value":"s.\nThis is demonstrated below.\nNote that the catalog uses a file naming scheme called “hive”, which the reader uses to identify partitions.\nIn other examples this is recognized automatically, but here we must pass it explicitly.","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"HHvv4KaPdk"}],"key":"bWLmHE79kI"}],"key":"LK9LpTlYpY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# define new columns for colors W1-W2 and W3-W4\nw1w2 = pc.subtract(pc.field(\"w1mpro\"), pc.field(\"w2mpro\"))\nw3w4 = pc.subtract(pc.field(\"w3mpro\"), pc.field(\"w4mpro\"))\n\n# define the AGN locus, as in Mateos et al., 2012\nlocus = pc.multiply(pc.scalar(0.5), w3w4)","key":"v26V3dfnzd"},{"type":"outputs","id":"rtlFzOHY1c8rbMGQ4VON8","children":[],"key":"VTOsQbgqGD"}],"key":"UuJZFtgDpj"},{"type":"block","children":[],"key":"mFgOf8yI1J"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# expect this to take 20-60 seconds.\n# notice this is generally faster than example 1 using pandas even though\n# this filter is much more complicated, highlighting the efficiency of this method.\n\n# load catalog metadata as a pyarrow dataset\npyarrow_ds = ds.parquet_dataset(f\"{parquet_root}/_metadata\", filesystem=fs, partitioning=\"hive\")\n\n# query for AGN using selection limits from Mateos et al., 2012\npyarrow_df = pyarrow_ds.to_table(\n    # column filter. similar to a SQL SELECT clause.\n    columns={\n        \"w1w2\": w1w2,\n        \"w3w4\": w3w4,\n        \"cntr\": pc.field(\"cntr\"),\n        \"ra\": pc.field(\"ra\"),\n        \"dec\": pc.field(\"dec\"),\n        \"healpix_k5\": pc.field(\"healpix_k5\"),\n    },\n    # row filter. similar to a SQL WHERE clause.\n    filter=(\n        # color-color cuts\n        (w1w2 < pc.add(locus, pc.scalar(0.979)))\n        & (w1w2 > pc.subtract(locus, pc.scalar(0.405)))\n        & (w3w4 > pc.scalar(1.76))\n        # to do an all-sky search, comment out the rest of the filter. expect it to take 30-60 min\n        # same ra/dec polygon as before\n        & (pc.field(\"ra\") > ra_min)\n        & (pc.field(\"ra\") < ra_max)\n        & (pc.field(\"dec\") > dec_min)\n        & (pc.field(\"dec\") < dec_max)\n        # same partition-column filter as before\n        & (pc.field(\"healpix_k5\").isin(polygon_pixels))\n    ),\n).to_pandas()","key":"FFJrKWnxwk"},{"type":"outputs","id":"eb0VnRlH-vbXvKSQnr4Ig","children":[],"key":"oJ80G4gy2l"}],"key":"OdGvkKqY8Q"},{"type":"block","children":[],"key":"vndvzqDtnW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"len(pyarrow_df.index)","key":"vud1cTuDbh"},{"type":"outputs","id":"l_gwqzGr2_aptl0PUgUQE","children":[],"key":"cTXLFb6PsX"}],"key":"ymqaJuURjw"},{"type":"block","children":[],"key":"xKGEb0Qo9Q"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"colorbar_norm = colors.LogNorm(vmin=1, vmax=10)  # for an all-sky search, use vmax=100_000\npyarrow_df.plot.hexbin(\"w3w4\", \"w1w2\", norm=colorbar_norm)","key":"yiPfIMDDWE"},{"type":"outputs","id":"kVZUyjLZTI4oVEB17F1rW","children":[],"key":"yGCr7Ouw34"}],"key":"rscd5jDjGy"},{"type":"block","children":[],"key":"aEGumSXV7G"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Delete variables to save memory. This is useful when running on a machine with a small amount of RAM.\ndel pyarrow_ds\ndel pyarrow_df","key":"kuEc7JFZRn"},{"type":"outputs","id":"cEkj0lKtiE_a2VfWcC8Ns","children":[],"key":"gVjqqkEgXx"}],"key":"DJFrvfqSAd"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":256,"column":1},"end":{"line":256,"column":1}},"children":[{"type":"text","value":"Example 3:  Nearest-neighbor search (using pyarrow and astropy)","position":{"start":{"line":256,"column":1},"end":{"line":256,"column":1}},"key":"YoF2n1pzZ9"}],"identifier":"example-3-nearest-neighbor-search-using-pyarrow-and-astropy","label":"Example 3:  Nearest-neighbor search (using pyarrow and astropy)","html_id":"example-3-nearest-neighbor-search-using-pyarrow-and-astropy","implicit":true,"key":"VEVnr65qDW"}],"key":"XrGGsUIJAh"},{"type":"block","position":{"start":{"line":258,"column":1},"end":{"line":258,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":260,"column":1},"end":{"line":262,"column":1}},"children":[{"type":"text","value":"Nearest-neighbor searches and cone searches generally use the on-sky separation distance to determine the matches.\nIt would be cumbersome to construct the new column and filter on it using the methods shown above because the separation distance is a fairly complicated function of ra and dec.\nHowever, we can get pretty fast results by filtering down to the HEALPix pixels that cover the region, loading all the data in those partitions, and then using astropy to compute the separations and find the matches.","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"FNjrGvFbFJ"}],"key":"cZ4KjluRRg"},{"type":"paragraph","position":{"start":{"line":264,"column":1},"end":{"line":267,"column":1}},"children":[{"type":"text","value":"Here, we’ll search for the 3 nearest neighbors to each of the 4 corners of our ra/dec polygon.\nWe’ll load the data with pyarrow because because it makes this query significantly faster than with pandas (see explanation in Example 2).\n(Note that astropy can also read parquet, but it can only read a single file at a time and so is less convenient.)\nWe’ll use ","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"ZluSkagMS8"},{"type":"link","url":"https://docs.astropy.org/en/stable/api/astropy.coordinates.SkyCoord.html#astropy.coordinates.SkyCoord.match_to_catalog_sky","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"children":[{"type":"text","value":"astropy​.coordinates​.SkyCoord​.match​_to​_catalog​_sky","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"vOPpYbRsJh"}],"urlSource":"https://docs.astropy.org/en/stable/api/astropy.coordinates.SkyCoord.html#astropy.coordinates.SkyCoord.match_to_catalog_sky","key":"cxEpQ4HzQi"},{"type":"text","value":" to do the actual nearest neighbor search.","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"JfdQMAsK8g"}],"key":"JXMjWLIfiO"}],"key":"RyoJ1RLgkl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# construct dictionary of pixels covering a cone around each polygon corner\n# we did this once before but now we want all 4 corners\ncorner_cone_pixels = {\n    (ra, dec): hp.query_circle(nside=nside, a=ra, b=dec, radius=radius, nest=True, inclusive=True)\n    for (ra, dec) in polygon_corners\n}\ncorner_cone_pixels","key":"daYthsdB6Y"},{"type":"outputs","id":"A-TdCOn5MfEPceOR6Ahf_","children":[],"key":"IM2V9fNCcP"}],"key":"enkS7mb5C3"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"children":[{"type":"text","value":"Find the 3 nearest neighbors of each corner:","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"NNg1WL3scN"}],"key":"HbEvwO3XNQ"}],"key":"TSdkB0DjeM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# expect this to take 30-60 seconds\nidcol = \"cntr\"\nneighbor_ids = []  # store the allwise source id (cntr) of each neighbor\ncorner_neighbors = {}  # record neighbor info for each corner (for reference. not actually used)\n\n# use same pyarrow dataset as before, but get it again to include the load time in this cell\npyarrow_ds = ds.parquet_dataset(f\"{parquet_root}/_metadata\", filesystem=fs, partitioning=\"hive\")\n\nfor (ra, dec), cone_pixels in corner_cone_pixels.items():\n\n    # load data from all pixels/partitions/files covering this corner\n    src_tbl = pyarrow_ds.to_table(\n        columns=[idcol, \"ra\", \"dec\"], filter=(pc.field(\"healpix_k5\").isin(cone_pixels))\n    )\n\n    # get list of 3 nearest neighbors to this corner\n    corner = SkyCoord(ra=ra * u.degree, dec=dec * u.degree)\n    allwise_sources = SkyCoord(ra=src_tbl[\"ra\"] * u.degree, dec=src_tbl[\"dec\"] * u.degree)\n    neighbors = [corner.match_to_catalog_sky(allwise_sources, nthneighbor=i) for i in range(1, 4)]\n\n    # get the allwise source ids. record/report some info\n    corner_neighbors[(ra, dec)] = []\n    for n, (idx, sep, _) in enumerate(neighbors):\n        srcid = src_tbl[idcol][idx.item()].as_py()\n        neighbor_ids.append(srcid)\n        corner_neighbors[(ra, dec)].append((srcid, sep))\n        print(f\"neighbor {n+1}, corner ({ra}, {dec}): {srcid} at on-sky dist {sep.to('arcsec')}\")\n\nneighbor_ids","key":"BrPLoTsfvK"},{"type":"outputs","id":"9XWjQoltuocDohTixBNU8","children":[],"key":"gQQ3dsc6Y8"}],"key":"ZxLuj2Kcpc"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":313,"column":1},"end":{"line":313,"column":1}},"children":[{"type":"text","value":"Load all the data (all columns) for all nearest neighbors:","position":{"start":{"line":313,"column":1},"end":{"line":313,"column":1}},"key":"KycNOIL7Gh"}],"key":"yR3AWRMO7D"}],"key":"rFQxIa3awP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# expect this to take 15-25 seconds\ncone_pixels = [pixel for cone_pixels in corner_cone_pixels.values() for pixel in cone_pixels]\nneighbors_df = pyarrow_ds.to_table(\n    filter=((pc.field(idcol).isin(neighbor_ids)) & (pc.field(\"healpix_k5\").isin(cone_pixels)))\n).to_pandas()\n\nneighbors_df","key":"mIJ8YVObAx"},{"type":"outputs","id":"cYhYAoPGg9fghQC0D-2If","children":[],"key":"M7Xx4GDGqO"}],"key":"gV40g2Lg7h"},{"type":"block","children":[],"key":"SmwvBt54Ts"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Delete variables to save memory. This is useful when running on a machine with a small amount of RAM.\ndel pyarrow_ds\ndel neighbors_df","key":"TTvfwqAzv8"},{"type":"outputs","id":"_VSodwbOFBds_QyZdGNXQ","children":[],"key":"yEfyBxRrM9"}],"key":"mt0s7QSAQX"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"children":[{"type":"text","value":"Schema Access","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"KsPLWEuNj6"}],"identifier":"schema-access","label":"Schema Access","html_id":"schema-access","implicit":true,"key":"o5cjlXk3Va"}],"key":"LItEOl3bf4"},{"type":"block","position":{"start":{"line":333,"column":1},"end":{"line":333,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":335,"column":1},"end":{"line":338,"column":1}},"children":[{"type":"text","value":"The schema can be viewed ","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"key":"N2M1udONpr"},{"type":"link","url":"http://wise2.ipac.caltech.edu/docs/release/allwise/expsup/sec2_1a.html","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"children":[{"type":"text","value":"online","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"key":"DSw2UIZKWY"}],"urlSource":"http://wise2.ipac.caltech.edu/docs/release/allwise/expsup/sec2_1a.html","key":"VpH1HWDbC6"},{"type":"text","value":" and also accessed from the parquet catalog itself.\nThe example below loads it using the ","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"key":"vluvLBQ3ts"},{"type":"inlineCode","value":"_common_metadata","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"key":"jsfX82FNQJ"},{"type":"text","value":" file and ","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"key":"gKjVd6TObo"},{"type":"link","url":"https://arrow.apache.org/docs/python/generated/pyarrow.dataset.parquet_dataset.html","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"children":[{"type":"text","value":"pyarrow​.dataset​.parquet​_dataset","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"key":"LmQ4H0TG9j"}],"urlSource":"https://arrow.apache.org/docs/python/generated/pyarrow.dataset.parquet_dataset.html","key":"Q2a0TaVB8s"},{"type":"text","value":".\nNote that the schema can also be accessed from the metadata in the footer of each Parquet file and from the ","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"key":"VE1ocF5dUS"},{"type":"inlineCode","value":"_metadata","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"key":"JoWrZ7rPi6"},{"type":"text","value":" file, but the method used here is generally faster and easier.\nIn addition, this ","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"key":"nz98OSRUqw"},{"type":"inlineCode","value":"_common_metadata","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"key":"LhUfE5XOQW"},{"type":"text","value":" file has extra information (units and descriptions) stored in the custom metadata of each column.","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"key":"Rpz8dVPjXg"}],"key":"dHzOwrlts5"}],"key":"IAqKD8BVrd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"schema = ds.parquet_dataset(f\"{parquet_root}/_common_metadata\", filesystem=fs).schema","key":"tbMmUZ6fmD"},{"type":"outputs","id":"V1IFL0BiQhaT9m-WXhFUu","children":[],"key":"l6l9Jqd4Dr"}],"key":"GoRg4cZESd"},{"type":"block","children":[],"key":"X75yuNEvkB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# access individual columns by name or index\nfld = schema.field(1)  # equivalently: fld = schema.field(\"ra\")\n\n# basic column information\nprint(fld.name)\nprint(fld.type)\nprint(fld.nullable)\n\n# units and descriptions are in the `metadata` attribute, always as bytestrings\nprint(fld.metadata)\nprint(fld.metadata[b\"units\"].decode())  # use decode to get a regular string\nprint(fld.metadata[b\"description\"].decode())","key":"EGIPhUL6aJ"},{"type":"outputs","id":"US3zLyC0MQxTEENQXhmxz","children":[],"key":"hQLv8yeRPb"}],"key":"KrWN06eTZu"},{"type":"block","children":[],"key":"fXjncBUNDh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# full list of column names\nschema.names","key":"Q6h6djwvgF"},{"type":"outputs","id":"Nr2U3qYss3pus2tfiX7yN","children":[],"key":"SpODPjlvdw"}],"key":"IBtTSaEoNn"},{"type":"block","children":[{"type":"thematicBreak","position":{"start":{"line":364,"column":1},"end":{"line":364,"column":1}},"key":"nEORW8AK9O"},{"type":"heading","depth":2,"position":{"start":{"line":366,"column":1},"end":{"line":366,"column":1}},"children":[{"type":"text","value":"About this notebook","position":{"start":{"line":366,"column":1},"end":{"line":366,"column":1}},"key":"PhQaRS7BMG"}],"identifier":"about-this-notebook","label":"About this notebook","html_id":"about-this-notebook","implicit":true,"key":"IzBSsEmfHC"},{"type":"paragraph","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"children":[{"type":"strong","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"children":[{"type":"text","value":"Author:","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"ZHM2fHb4vV"}],"key":"l3m6yVlwZn"},{"type":"text","value":" Troy Raen (IRSA Developer) in conjunction with David Shupe, Jessica Krick and the IPAC Science Platform team","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"HX6HY1dfrf"}],"key":"Qve3d7ZF5k"},{"type":"paragraph","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"children":[{"type":"strong","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"children":[{"type":"text","value":"Updated:","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"I4b4EJ1qvc"}],"key":"ux3OEYZpx9"},{"type":"text","value":" 2023-07-27","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"naVx8CM5kO"}],"key":"Vvmns98lJe"},{"type":"paragraph","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"children":[{"type":"strong","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"children":[{"type":"text","value":"Contact:","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"Nc1GqM0ipy"}],"key":"R4OFZs6mE8"},{"type":"text","value":" ","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"Z5mpKucHP1"},{"type":"link","url":"https://irsa.ipac.caltech.edu/docs/help_desk.html","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"children":[{"type":"text","value":"the IRSA Helpdesk","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"x5Ow5rFza3"}],"urlSource":"https://irsa.ipac.caltech.edu/docs/help_desk.html","key":"N7rO9SdBjw"},{"type":"text","value":" with questions or reporting problems.","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"PCQqiDgTSq"}],"key":"Eu6gJH04tT"}],"key":"DlY4KfPh8t"}],"key":"Nn0NtDREtu"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Searching for AllWISE Atlas Images","short_title":"AllWISE Images","url":"/sia-allwise-atlas","group":"Merged Objects HATS Catalog"},"next":{"title":"Using Firefly visualization tools to understand the light curves of Solar System objects","short_title":"NEOWISE Firefly","url":"/neowise-light-curve-demo","group":"Merged Objects HATS Catalog"}}},"domain":"http://localhost:3000"}