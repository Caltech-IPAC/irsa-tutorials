{"version":3,"kind":"Notebook","sha256":"1101d0ae1e07d309e06a625f5dca00915a25665a7d77fb9aeaefdb52b378467c","slug":"irsa-hats-with-lsdb","location":"/tutorials/parquet-catalog-demos/irsa-hats-with-lsdb.md","dependencies":[],"frontmatter":{"title":"Access HATS Collections Using LSDB: Euclid Q1 and ZTF DR23","kernelspec":{"name":"python3","display_name":"irsa-tutorials","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.17.2"}},"content_includes_title":false,"authors":[{"id":"IRSA Scientists and Developers","name":"IRSA Scientists and Developers"}],"github":"https://github.com/Caltech-IPAC/irsa-tutorials/","subject":"IRSA Tutorials","keywords":["astronomy"],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":1}},"source_url":"https://github.com/Caltech-IPAC/irsa-tutorials//blob/main/tutorials/parquet-catalog-demos/irsa-hats-with-lsdb.md","edit_url":"https://github.com/Caltech-IPAC/irsa-tutorials//edit/main/tutorials/parquet-catalog-demos/irsa-hats-with-lsdb.md","exports":[{"format":"md","filename":"irsa-hats-with-lsdb.md","url":"/irsa-tutorials/build/irsa-hats-with-lsdb-6cb507a850b4cc01d1b873a151d48c27.md"}]},"mdast":{"type":"root","children":[{"type":"block","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Learning Goals","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"r3IMHiHMc0"}],"identifier":"learning-goals","label":"Learning Goals","html_id":"learning-goals","implicit":true,"key":"HFzhq0Qoc9"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"By the end of this tutorial, you will learn how to:","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"a4pxVnMOhK"}],"key":"NwqyP6BC9M"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":23,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Use the ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"PCPozMlPx8"},{"type":"inlineCode","value":"lsdb","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"PDwIK6ifom"},{"type":"text","value":" library to access IRSA HATS Collections from the cloud.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"Kwqb0rzBhd"}],"key":"lWYxyyLy4y"}],"key":"ahWAoYUici"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Define spatial, column, and row filters to read only a portion of large HATS catalogs.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"o6baqVvQqL"}],"key":"i2mhGbc6Pl"}],"key":"fh0x1eaFfJ"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Crossmatch catalogs using ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"NGqZBU151U"},{"type":"inlineCode","value":"lsdb","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"ge4QpznLO2"},{"type":"text","value":" and visualize the results.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"uY4Kj236r6"}],"key":"zpmZ3Dxzzp"}],"key":"qqC0EQauev"},{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Perform index searches on HATS catalogs using ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"PO7KMtm099"},{"type":"inlineCode","value":"lsdb","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"guPJ6PPjIG"},{"type":"text","value":".","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"dJQ06SSkAl"}],"key":"Bxfpf7z2oP"}],"key":"NsyUOlcWRc"}],"key":"AdVTDRnpbr"}],"key":"UOaVBY5bO8"},{"type":"block","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"BUMWT9VMOR"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"uezlECAtsb"},{"type":"paragraph","position":{"start":{"line":32,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"IRSA provides several astronomical catalogs in spatially partitioned ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"i5cFseuGaS"},{"type":"link","url":"https://parquet.apache.org/","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"Parquet format","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"iv87wtxBsr"}],"urlSource":"https://parquet.apache.org/","key":"Tp7Mfoio0q"},{"type":"text","value":", enabling efficient access and scalable analysis of large datasets.\nAmong these are the ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"XXg4bcN8Zj"},{"type":"link","url":"https://irsa.ipac.caltech.edu/docs/parquet_catalogs/#hats","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"HATS","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"mbDD29heqT"}],"urlSource":"https://irsa.ipac.caltech.edu/docs/parquet_catalogs/#hats","key":"sSaLPgyLso"},{"type":"text","value":" (Hierarchical Adaptive Tiling Scheme) collections, which organize catalog data using adaptive ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"J8BcjcGRuZ"},{"type":"link","url":"https://irsa.ipac.caltech.edu/healpix/","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"HEALPix","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"wBFqQUV32c"}],"urlSource":"https://irsa.ipac.caltech.edu/healpix/","key":"QRxGCzBSgU"},{"type":"text","value":"-based partitioning for parallelizable queries and crossmatching.","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"zYz0oyAQma"}],"key":"FhhbAJ9GOF"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"For more details on HATS collections, partitioning, and schema organization, see the IRSA documentation on ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"Lz44bSgLBf"},{"type":"link","url":"https://irsa.ipac.caltech.edu/docs/parquet_catalogs/","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"Parquet catalogs","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"PJI04ZtoRQ"}],"urlSource":"https://irsa.ipac.caltech.edu/docs/parquet_catalogs/","key":"KPkw8u7hMu"},{"type":"text","value":".","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"yfYRbyIAMz"}],"key":"ry5avqFFNu"},{"type":"paragraph","position":{"start":{"line":37,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"This notebook demonstrates how to access and analyze HATS collections using the ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"PWWMSRMCge"},{"type":"link","url":"https://docs.lsdb.io/en/latest/index.html","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"lsdb","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"VpqoMMMtQr"}],"urlSource":"https://docs.lsdb.io/en/latest/index.html","key":"Axshz7aJBB"},{"type":"text","value":" Python library, which makes it convenient to work with these large datasets.\nWe will explore the following IRSA HATS collections in this tutorial:","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"uc25PC8vk8"}],"key":"ZEFZ15Tiln"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":40,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Euclid Q1 Merged Objects: 14 Euclid Q1 tables, including MER (multi-wavelength mosaics) final catalog, photometric redshift catalogs, and spectroscopic catalogs joined on MER Object ID.","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"Y94McTRciS"}],"key":"kH4lpIG0D2"}],"key":"eW8tG1RN61"},{"type":"listItem","spread":true,"position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ZTF DR23 Objects Table: catalog of PSF-fit photometry detections extracted from ZTF reference images, including “collapsed-lightcurve” metrics.","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"wJrvRqLdDE"}],"key":"nVYEs37ZCz"}],"key":"c607im2adY"},{"type":"listItem","spread":true,"position":{"start":{"line":42,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ZTF DR23 Lightcurves: catalog of PSF-fit photometry detections extracted from single-exposure images at the locations of Objects Table detections.","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"ekmgKwvn4T"}],"key":"VKTgZ6vOzK"}],"key":"VcjEyNl9lJ"}],"key":"P8YyGml0WY"},{"type":"paragraph","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"We will use lsdb to leverage HATS partitioning for performing fast spatial queries on a relatively large area of sky and for crossmatching sources between Euclid and ZTF to identify variable galaxy candidates and visualize their light curves.","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"QoyzCvVzrA"}],"key":"hRmdJX1YJu"}],"key":"OZOBtm5oKI"},{"type":"block","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"LGGeUtPHKk"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"ZZXXEfnOKF"}],"key":"J5egb6WE0p"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Uncomment the next line to install dependencies if needed.\n# !pip install s3fs \"lsdb>=0.6.6,<0.8\" pyarrow pandas numpy astropy dask matplotlib","key":"rNYCkcisCj"},{"type":"outputs","id":"AWf37zAgeNV38yVpVmaje","children":[],"key":"jU39Njh8dX"}],"key":"amTkgkHnGD"},{"type":"block","children":[],"key":"gx7BvscnTU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import s3fs\nimport lsdb\nimport pyarrow.parquet as pq\nimport numpy as np\nimport pandas as pd\nfrom astropy import units as u\nfrom astropy.coordinates import SkyCoord\nimport os\nimport matplotlib.pyplot as plt\nfrom dask.distributed import Client","key":"GnI41C885H"},{"type":"outputs","id":"89eTP2SnsbKQP2ABEKRhB","children":[],"key":"hYc5t3Q00B"}],"key":"ZPSj5z4QBf"},{"type":"block","children":[],"key":"rBMQdn9Fxu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pd.set_option(\"display.max_colwidth\", None) # schema descriptions can be long\npd.set_option(\"display.min_rows\", 18) # to show more rows when truncated view","key":"u5oKUgmhKm"},{"type":"outputs","id":"LVHQb-zEmTHB7ZGo2rlzr","children":[],"key":"VBDCkIGevw"}],"key":"iVw2hMn7Xm"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"text","value":"1. Locate HATS collections in the cloud","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"S24YZ8FTix"}],"identifier":"id-1-locate-hats-collections-in-the-cloud","label":"1. Locate HATS collections in the cloud","html_id":"id-1-locate-hats-collections-in-the-cloud","implicit":true,"key":"A6lY0fwQx7"},{"type":"paragraph","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"From IRSA’s ","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"oyj4SjfAiy"},{"type":"link","url":"https://irsa.ipac.caltech.edu/cloud_access/","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"cloud data access page","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"uoMl0sWJDo"}],"urlSource":"https://irsa.ipac.caltech.edu/cloud_access/","key":"dPmZnawBS7"},{"type":"text","value":", let’s identify the bucket and path prefix for the HATS Collections for Euclid Q1 and ZTF DR23:","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"uDn7TKxZ17"}],"key":"II82rflekc"}],"key":"pNzZbbbkDr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_q1_bucket = \"nasa-irsa-euclid-q1\"\neuclid_q1_hats_prefix = \"contributed/q1/merged_objects/hats\"\n\nztf_bucket = \"ipac-irsa-ztf\"\nztf_hats_prefix = \"contributed/dr23/objects/hats\"\nztf_lc_hats_prefix = \"contributed/dr23/lc/hats\"","key":"Iv1dqke2TB"},{"type":"outputs","id":"8JKdzOq-BwQexGOAYtry9","children":[],"key":"HoPNapj4dS"}],"key":"Khv5RESH1a"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":86,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"link","url":"https://s3fs.readthedocs.io/en/latest/","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"children":[{"type":"text","value":"s3fs","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"giLLHkyBa4"}],"urlSource":"https://s3fs.readthedocs.io/en/latest/","key":"IOQki2joSg"},{"type":"text","value":" provides a filesystem-like Python interface for AWS S3 buckets.\nFirst, we create an S3 client:","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"M9a6aGepA2"}],"key":"qMfipccNQr"}],"key":"KXzPB7tH1u"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"s3 = s3fs.S3FileSystem(anon=True)","key":"YtQmQkIxyf"},{"type":"outputs","id":"j4L6o5XP42Q8_V1g9FcQ8","children":[],"key":"arRfdTBJ8v"}],"key":"uF4NBrB1xG"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"Using the S3 client, we can now list the contents of the Euclid Q1 HATS ","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"ZQDnOYYWGP"},{"type":"strong","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"collection","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"ORTwBMpRRZ"}],"key":"ExdZX22duO"},{"type":"text","value":":","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"It3XgIF7e2"}],"key":"Z34ulZKQ21"}],"key":"G75DoG8Zbo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"s3.ls(f\"{euclid_q1_bucket}/{euclid_q1_hats_prefix}\")","key":"AEjBsYbZtN"},{"type":"outputs","id":"uZgCSX690-8wX8cNgdexc","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"['nasa-irsa-euclid-q1/contributed/q1/merged_objects/hats/collection.properties',\n 'nasa-irsa-euclid-q1/contributed/q1/merged_objects/hats/euclid_q1_merged_objects-hats',\n 'nasa-irsa-euclid-q1/contributed/q1/merged_objects/hats/euclid_q1_merged_objects-hats_index_object_id',\n 'nasa-irsa-euclid-q1/contributed/q1/merged_objects/hats/euclid_q1_merged_objects-hats_margin_10arcsec']","content_type":"text/plain"}}},"key":"xavI6uTAJi"}],"key":"zMfwOn2CrV"}],"key":"c2YDbJnZli"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"In this collection, you can see collection properties, catalog, index table, and margin cache in order.\nYou can explore more directories to see how this HATS collection follows the directory structure described in IRSA’s documentation on ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"gfDVxcYSQf"},{"type":"link","url":"https://irsa.ipac.caltech.edu/docs/parquet_catalogs/#hats","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"HATS partitioning and HATS Collections","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"SqWbGNQf2i"}],"urlSource":"https://irsa.ipac.caltech.edu/docs/parquet_catalogs/#hats","key":"ISeMGDBpuz"},{"type":"text","value":".","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"mqgPFrFPFA"}],"key":"n1YERiNaz1"},{"type":"paragraph","position":{"start":{"line":102,"column":1},"end":{"line":104,"column":1}},"children":[{"type":"text","value":"As per the documentation, the Parquet file containing the schema for this ","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"xizIz0zukJ"},{"type":"inlineCode","value":"euclid_q1_merged_objects-hats","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"DfGmydho2x"},{"type":"text","value":" catalog is stored in ","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"yrakZLNPYo"},{"type":"inlineCode","value":"dataset/_common_metadata","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"aWU1zbs7s0"},{"type":"text","value":" directory.\nYou can find the catalog schema through other sources as well but we use the ","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"rqNN8Lxm7z"},{"type":"inlineCode","value":"_common_metadata","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"j9WsIeOIIC"},{"type":"text","value":" file here because it contains column metadata (units and descriptions) which the other schemas don’t have.\nLet’s save its path for later use:","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"y68AGlMqF0"}],"key":"HRmgltRi9E"}],"key":"wf196QJYee"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_q1_schema_path = \"euclid_q1_merged_objects-hats/dataset/_common_metadata\" # euclid_q1_merged_objects-hats is the catalog name we identified above","key":"icJQeQj30q"},{"type":"outputs","id":"wT0SJ7zwLlVCs3A9YzVzF","children":[],"key":"fDQWtkeRhD"}],"key":"YyCIuqPanI"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"Similarly, we can list the contents of the ZTF DR23 Objects HATS collection and save the path to its schema file:","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"UQD4WFC2tx"}],"key":"RT5OHuid4n"}],"key":"YqlGGiA13J"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"s3.ls(f\"{ztf_bucket}/{ztf_hats_prefix}\")","key":"S7fKvswmpT"},{"type":"outputs","id":"TQVZNudVKZUFOesqChPIV","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"['ipac-irsa-ztf/contributed/dr23/objects/hats/collection.properties',\n 'ipac-irsa-ztf/contributed/dr23/objects/hats/ztf_dr23_objects-hats',\n 'ipac-irsa-ztf/contributed/dr23/objects/hats/ztf_dr23_objects-hats_index_oid',\n 'ipac-irsa-ztf/contributed/dr23/objects/hats/ztf_dr23_objects-hats_margin_10arcsec']","content_type":"text/plain"}}},"key":"L6FhzI6yIe"}],"key":"Xepei3UExR"}],"key":"b9yLxsv1qT"},{"type":"block","children":[],"key":"RDh6ns9PKo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ztf_schema_path = \"ztf_dr23_objects-hats/dataset/_common_metadata\" # ztf_dr23_objects-hats is the catalog name we identified above","key":"JRurXXFX1L"},{"type":"outputs","id":"yGXbWWFBwn6KGhOBKAGRB","children":[],"key":"rWMpMJzs7w"}],"key":"EaL78xwA6Q"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"children":[{"type":"text","value":"2. Open the HATS catalogs","position":{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},"key":"ljCzom3HQQ"}],"identifier":"id-2-open-the-hats-catalogs","label":"2. Open the HATS catalogs","html_id":"id-2-open-the-hats-catalogs","implicit":true,"key":"C7nok593oa"},{"type":"paragraph","position":{"start":{"line":122,"column":1},"end":{"line":124,"column":1}},"children":[{"type":"text","value":"Now we can use ","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"key":"uBxgnNXavC"},{"type":"link","url":"https://docs.lsdb.io/en/latest/index.html","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"children":[{"type":"text","value":"lsdb","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"key":"DvztXYeVd3"}],"urlSource":"https://docs.lsdb.io/en/latest/index.html","key":"jTKMkrbee8"},{"type":"text","value":" to open the HATS catalogs we identified above, starting with the Euclid Q1 catalog.\nNote that we can simply pass the HATS collection path and it will automatically identify the catalog inside it and make use of the ancillary data (index table and margin cache) when needed.\nAlso, we prefix the path with ","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"key":"kiIhescQom"},{"type":"inlineCode","value":"s3://","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"key":"XU0rDVTWWV"},{"type":"text","value":" to indicate that it is an S3 path.","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"key":"aiMvWOVu26"}],"key":"lwwwyZfXwj"}],"key":"PZLrbFVMwH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_catalog = lsdb.open_catalog(f\"s3://{euclid_q1_bucket}/{euclid_q1_hats_prefix}\")\neuclid_catalog","key":"xm5VlH4pFH"},{"type":"outputs","id":"0m7GX1fVqraOfwgHuacmO","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/plain":{"content":"Dask NestedFrame Structure:\n                          object_id               ra              dec mer_flux_h_templfit mer_fluxerr_h_templfit  phz_phz_median class_phz_classification\nnpartitions=114                                                                                                                                          \n718306548379549696   int64[pyarrow]  double[pyarrow]  double[pyarrow]      float[pyarrow]         float[pyarrow]  float[pyarrow]           int32[pyarrow]\n719784292007280640              ...              ...              ...                 ...                    ...             ...                      ...\n...                             ...              ...              ...                 ...                    ...             ...                      ...\n2542493095883177984             ...              ...              ...                 ...                    ...             ...                      ...\n2542510688069222400             ...              ...              ...                 ...                    ...             ...                      ...\nDask Name: nestedframe, 3 expressions\nExpr=MapPartitions(NestedFrame)","content_type":"text/plain"},"text/html":{"content":"<div><strong>lsdb Catalog Euclid_Q1_Merged_Objects:</strong></div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>object_id</th>\n      <th>ra</th>\n      <th>dec</th>\n      <th>mer_flux_h_templfit</th>\n      <th>mer_fluxerr_h_templfit</th>\n      <th>phz_phz_median</th>\n      <th>class_phz_classification</th>\n    </tr>\n    <tr>\n      <th>npartitions=114</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Order: 7, Pixel: 40831</th>\n      <td>int64[pyarrow]</td>\n      <td>double[pyarrow]</td>\n      <td>double[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>int32[pyarrow]</td>\n    </tr>\n    <tr>\n      <th>Order: 7, Pixel: 40915</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>Order: 6, Pixel: 36130</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>Order: 7, Pixel: 144524</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n  </tbody>\n</table>\n</div><div>7 out of 1593 available columns in the catalog have been loaded <strong>lazily</strong>, meaning no data has been read, only the catalog schema</div>","content_type":"text/html"}}},"key":"TweQF1nSTR"}],"key":"elg44pOZQu"}],"key":"C33iBbJGot"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":131,"column":1},"end":{"line":131,"column":1}},"children":[{"type":"text","value":"Few things to note here:","position":{"start":{"line":131,"column":1},"end":{"line":131,"column":1}},"key":"db2LFTJSbJ"}],"key":"w2oIgMg8lD"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":133,"column":1},"end":{"line":136,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This catalog is opened ","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"nkv8IgPPUI"},{"type":"link","url":"https://docs.lsdb.io/en/latest/tutorials/lazy_operations.html","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"children":[{"type":"text","value":"lazily","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"xWWV5skZZ0"}],"urlSource":"https://docs.lsdb.io/en/latest/tutorials/lazy_operations.html","key":"L8qbOM5nqK"},{"type":"text","value":", i.e., no data is read from the S3 bucket into memory yet.","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"e3XKYi2Wby"}],"key":"ASPFBmBbWy"}],"key":"tZU3rZAzIK"},{"type":"listItem","spread":true,"position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Since we did not specify any columns to select from this very wide catalog, we get 7 default columns out of 1593 available columns!","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"eLbeLns7id"}],"key":"sDaIYQwfp7"}],"key":"tGz1iL2auA"},{"type":"listItem","spread":true,"position":{"start":{"line":135,"column":1},"end":{"line":136,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We see some of the HEALPix orders and pixels at which this catalog is partitioned.","position":{"start":{"line":135,"column":1},"end":{"line":135,"column":1}},"key":"CgoZqVqamW"}],"key":"Zk2WgPsd2q"}],"key":"hdcQ64whfL"}],"key":"waFRfBT0kK"},{"type":"paragraph","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"children":[{"type":"text","value":"Let’s plot the sky coverage of this catalog:","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"ln2WeZn9k3"}],"key":"wKgHzjUoQQ"}],"key":"WYNxJYaQwD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_catalog.plot_pixels()","key":"I25s8KqdoV"},{"type":"outputs","id":"ZO7nRN2Ec5I3ctOo204Zo","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/plain":{"content":"(<Figure size 1000x500 with 2 Axes>,\n <WCSAxes: title={'center': 'Catalog pixel map - Euclid_Q1_Merged_Objects'}>)","content_type":"text/plain"}}},"key":"TwUGiIiArU"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1000x500 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"1d94a974c6009490f4b7ad748bbf8068","path":"/irsa-tutorials/build/1d94a974c6009490f4b7ad748bbf8068.png"}}},"key":"wDl0hfBCe7"}],"key":"I2UAJjbv0u"}],"key":"y6FzBUVAe2"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"children":[{"type":"text","value":"Since HATS uses adaptive tile-based partitioning, we see higher order HEALPix tiles in regions with higher source density and lower order tiles in regions with lower source density.","position":{"start":{"line":143,"column":1},"end":{"line":143,"column":1}},"key":"b5WmSWioPm"}],"key":"cv0h69a8oH"},{"type":"paragraph","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"children":[{"type":"text","value":"Now let’s open the ZTF DR23 Objects catalog in a similar manner and view its sky coverage:","position":{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},"key":"iKuRGK1BtY"}],"key":"QHpB4yOkVg"}],"key":"SClqjy8swH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ztf_catalog = lsdb.open_catalog(f\"s3://{ztf_bucket}/{ztf_hats_prefix}\")\nztf_catalog","key":"qCfxIndtrO"},{"type":"outputs","id":"tvJIuJjrnjkwubEoWZKrR","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/plain":{"content":"Dask NestedFrame Structure:\n                                oid               ra              dec       filtercode       medianmag       medmagerr\nnpartitions=1791                                                                                                      \n0                    int64[pyarrow]  double[pyarrow]  double[pyarrow]  string[pyarrow]  float[pyarrow]  float[pyarrow]\n4503599627370496                ...              ...              ...              ...             ...             ...\n...                             ...              ...              ...              ...             ...             ...\n3457638613913698304             ...              ...              ...              ...             ...             ...\n3458764513820540928             ...              ...              ...              ...             ...             ...\nDask Name: nestedframe, 3 expressions\nExpr=MapPartitions(NestedFrame)","content_type":"text/plain"},"text/html":{"content":"<div><strong>lsdb Catalog ZTF_DR23_Objects:</strong></div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>oid</th>\n      <th>ra</th>\n      <th>dec</th>\n      <th>filtercode</th>\n      <th>medianmag</th>\n      <th>medmagerr</th>\n    </tr>\n    <tr>\n      <th>npartitions=1791</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Order: 3, Pixel: 0</th>\n      <td>int64[pyarrow]</td>\n      <td>double[pyarrow]</td>\n      <td>double[pyarrow]</td>\n      <td>string[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>float[pyarrow]</td>\n    </tr>\n    <tr>\n      <th>Order: 3, Pixel: 1</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>Order: 4, Pixel: 3070</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>Order: 4, Pixel: 3071</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n  </tbody>\n</table>\n</div><div>6 out of 76 available columns in the catalog have been loaded <strong>lazily</strong>, meaning no data has been read, only the catalog schema</div>","content_type":"text/html"}}},"key":"ABln9BxHW4"}],"key":"AnqCAXJ8nQ"}],"key":"S8IhfWAZhg"},{"type":"block","children":[],"key":"datcu4RKS7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ztf_catalog.plot_pixels()","key":"iY2uau55rH"},{"type":"outputs","id":"89__ow6WBnbunwCqlkvLU","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":13,"metadata":{},"data":{"text/plain":{"content":"(<Figure size 1000x500 with 2 Axes>,\n <WCSAxes: title={'center': 'Catalog pixel map - ZTF_DR23_Objects'}>)","content_type":"text/plain"}}},"key":"dT4zL8yfVd"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1000x500 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"3da08252ab85aa448644f225222bdb12","path":"/irsa-tutorials/build/3da08252ab85aa448644f225222bdb12.png"}}},"key":"RVQJ3XXrJm"}],"key":"wyHGH7Gdvr"}],"key":"Ii3RFu8QIz"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"text","value":"3. Define filters for querying Euclid Q1 catalog","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"KKgjbox0e9"}],"identifier":"id-3-define-filters-for-querying-euclid-q1-catalog","label":"3. Define filters for querying Euclid Q1 catalog","html_id":"id-3-define-filters-for-querying-euclid-q1-catalog","implicit":true,"key":"iAnWfG95wH"},{"type":"heading","depth":3,"position":{"start":{"line":158,"column":1},"end":{"line":158,"column":1}},"children":[{"type":"text","value":"3.1 Define a spatial filter","position":{"start":{"line":158,"column":1},"end":{"line":158,"column":1}},"key":"HSftvMLowd"}],"identifier":"id-3-1-define-a-spatial-filter","label":"3.1 Define a spatial filter","html_id":"id-3-1-define-a-spatial-filter","implicit":true,"key":"pAobYKT9vf"},{"type":"paragraph","position":{"start":{"line":160,"column":1},"end":{"line":162,"column":1}},"children":[{"type":"text","value":"From the above two plots, it’s clear that the ZTF DR23 Objects catalog covers a much larger area of the sky compared to the Euclid Q1 catalog.\nSo for cross-matching, we can safely pick the Euclid Deep Field North (EDF-N) region that is covered by both catalogs.\nFrom the ","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"fHPxXfcuos"},{"type":"link","url":"https://irsa.ipac.caltech.edu/data/Euclid/docs/euclid_archive_at_irsa_user_guide.pdf","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"children":[{"type":"text","value":"Euclid user guide at IRSA","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"qAL7DhIefl"}],"urlSource":"https://irsa.ipac.caltech.edu/data/Euclid/docs/euclid_archive_at_irsa_user_guide.pdf","key":"SiNsZIpRXf"},{"type":"text","value":" Table 1, we identify the following for the EDF-N region:","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"RdQ0DCA5tz"}],"key":"o9oqWpdfOP"}],"key":"eijIOY6NsP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_DF_N_center = SkyCoord('17:58:55.9 +66:01:03.7', unit=('hourangle', 'deg'))\neuclid_DF_N_center","key":"ksNApLclPJ"},{"type":"outputs","id":"x1ynWYIGzHpAdepy-ao52","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/plain":{"content":"<SkyCoord (ICRS): (ra, dec) in deg\n    (269.73291667, 66.01769444)>","content_type":"text/plain"}}},"key":"GKd3nXPZ5z"}],"key":"RwmPY7FvlE"}],"key":"GCzkDmTCBq"},{"type":"block","children":[],"key":"j504fvsZtN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# euclid_DF_N_radius = 3 * u.deg  # ceil(sqrt(22.9 / pi)) approximate radius to cover almost entire EDF-N\neuclid_DF_N_radius = 0.5 * u.deg  # smaller radius to reduce execution time for this tutorial\neuclid_DF_N_radius","key":"rUTGPhzJSo"},{"type":"outputs","id":"KY7Ds1p8b9KEVFKsi-MYq","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":15,"metadata":{},"data":{"text/plain":{"content":"<Quantity 0.5 deg>","content_type":"text/plain"},"text/latex":{"content":"$0.5\\mathrm{{}^{\\circ}}$","content_type":"text/latex"}}},"key":"KtgJkIEwJ0"}],"key":"XlbaYnaSaf"}],"key":"qzp4h42UfG"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"children":[{"type":"text","value":"Now, using lsdb, we define a cone ","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"key":"keMI2gVKXF"},{"type":"link","url":"https://docs.lsdb.io/en/latest/tutorials/region_selection.html#4.-The-Search-object","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"children":[{"type":"text","value":"search object","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"key":"jerW9PqzDW"}],"urlSource":"https://docs.lsdb.io/en/latest/tutorials/region_selection.html#4.-The-Search-object","key":"b3zHW20Xpg"},{"type":"text","value":" for this region that can be passed as a spatial filter when querying the catalogs:","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"key":"H1LPgRaPgA"}],"key":"NEeNZYeb8L"}],"key":"Sw1mfYVRZ8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"spatial_filter = lsdb.ConeSearch(\n    ra=euclid_DF_N_center.ra.deg,\n    dec=euclid_DF_N_center.dec.deg,\n    radius_arcsec=euclid_DF_N_radius.to(u.arcsec).value\n)","key":"pYPHjmy2XW"},{"type":"outputs","id":"n6k8mKvhWKnTWTlEzTnjz","children":[],"key":"jyxprVJmRE"}],"key":"Bq54vzs0Hb"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"children":[{"type":"text","value":"We can overplot this spatial filter on the Euclid catalog’s sky coverage to verify (note we limited the field of view so that we can see the cone better):","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"MeKO8A2IVF"}],"key":"MHqKllcPa1"}],"key":"ZkubJqMLoW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_catalog.plot_pixels(fov=(8 * u.deg, 6 * u.deg), center=euclid_DF_N_center)\nspatial_filter.plot(fc=\"#00000000\", ec=\"red\");","key":"OUmeXPD6Nr"},{"type":"outputs","id":"qtN5FKqs83JfWIzMZv6By","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1000x500 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"87fefe40fe7e0edb91f6024d998913bc","path":"/irsa-tutorials/build/87fefe40fe7e0edb91f6024d998913bc.png"}}},"key":"D4JJUQMPdF"}],"key":"Mbukeh8USy"}],"key":"mNuTtIorAP"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"children":[{"type":"text","value":"3.2 Identify columns of interest from the schema","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"fyfEbpVMVK"}],"identifier":"id-3-2-identify-columns-of-interest-from-the-schema","label":"3.2 Identify columns of interest from the schema","html_id":"id-3-2-identify-columns-of-interest-from-the-schema","implicit":true,"key":"hVcXnRGBxe"},{"type":"paragraph","position":{"start":{"line":194,"column":1},"end":{"line":195,"column":1}},"children":[{"type":"text","value":"Before we can define column and row filters for querying any HATS catalog, we need to know what columns are available in that catalog.\nSo let’s inspect the schema of the Euclid Q1 catalog.","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"nQb8d7V3mV"}],"key":"xadk2RxOSJ"},{"type":"paragraph","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"children":[{"type":"text","value":"Using pyarrow parquet, we can ","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"UCc3cOCxW3"},{"type":"link","url":"https://arrow.apache.org/docs/python/generated/pyarrow.parquet.read_schema.html#pyarrow.parquet.read_schema","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"children":[{"type":"text","value":"read the schema","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"pF3BbV5xsd"}],"urlSource":"https://arrow.apache.org/docs/python/generated/pyarrow.parquet.read_schema.html#pyarrow.parquet.read_schema","key":"bzx7RV2oOI"},{"type":"text","value":" from the ","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"SxPU4lXpRt"},{"type":"inlineCode","value":"_common_metadata","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"VnwXYZQAps"},{"type":"text","value":" parquet file we identified above (note that we again prefixed the path with ","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"z8gT1OAnyh"},{"type":"inlineCode","value":"s3://","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"LLOqLB3cSQ"},{"type":"text","value":" to indicate that it is an S3 path):","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"C2nSVBOzxL"}],"key":"oRQT3uA6P5"}],"key":"C1PTKbazkP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_schema = pq.read_schema(\n    f\"s3://{euclid_q1_bucket}/{euclid_q1_hats_prefix}/{euclid_q1_schema_path}\",\n    filesystem=s3\n)\ntype(euclid_schema)","key":"nu0jJbJGQI"},{"type":"outputs","id":"icqPy7b9MBeMK2ruKXO9i","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":18,"metadata":{},"data":{"text/plain":{"content":"pyarrow.lib.Schema","content_type":"text/plain"}}},"key":"vZDk6quZ5L"}],"key":"RYF2tBM0BA"}],"key":"U7LIkBRy6P"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":1}},"children":[{"type":"text","value":"Since the schema of this catalog is a pyarrow object, let’s convert it to a pandas DataFrame for easier inspection:","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":1}},"key":"NKFX2bKZwd"}],"key":"xPBcnaBvwr"}],"key":"lxjYOw5Bm9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def pq_schema_to_df(schema):\n    \"\"\"Convert a PyArrow schema to a Pandas DataFrame.\"\"\"\n    return pd.DataFrame(\n        [\n            (\n                field.name,\n                str(field.type),\n                field.metadata.get(b\"unit\", b\"\").decode(),\n                field.metadata.get(b\"description\", b\"\").decode()\n            )\n            for field in schema # schema is an iterable of pyarrow fields\n        ],\n        columns=[\"name\", \"type\", \"unit\", \"description\"]\n    )\n\neuclid_schema_df = pq_schema_to_df(euclid_schema)\nlen(euclid_schema_df)","key":"aDwAm1CU5c"},{"type":"outputs","id":"9-kMF9X0OP1ScBDFg8qLl","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":19,"metadata":{},"data":{"text/plain":{"content":"1594","content_type":"text/plain"}}},"key":"IW1q7tJdgf"}],"key":"Nwc57Qb0te"}],"key":"dnnxY9VEpv"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"children":[{"type":"text","value":"As we saw above, the Euclid HATS catalog contains 1594 columns in its schema!","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"LkxRJrSddc"}],"key":"KxmlJtGtcx"},{"type":"paragraph","position":{"start":{"line":231,"column":1},"end":{"line":232,"column":1}},"children":[{"type":"text","value":"The columns at the beginning of this schema (such as “tileid”, “objectid”, “ra”, “dec”) define positions and IDs.\nThese can be useful for our ","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"key":"KVygQkYTXS"},{"type":"strong","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"children":[{"type":"text","value":"column filters","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"key":"mvj5vSfpmx"}],"key":"JJQGWDt7KN"},{"type":"text","value":" — the columns we want to SELECT when querying the catalog.","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"key":"t4UnqY8T8z"}],"key":"dqFJ9ap07I"},{"type":"paragraph","position":{"start":{"line":234,"column":1},"end":{"line":235,"column":1}},"children":[{"type":"text","value":"We can also filter the schema DataFrame by name, unit, type, etc., to identify columns most relevant for our ","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"lzGGtwrPX6"},{"type":"strong","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"children":[{"type":"text","value":"row filters","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"rxWxYwOpTs"}],"key":"gEFdoX0PmB"},{"type":"text","value":" — WHERE rows satisfy conditions on column values for our query.\nFor example, let’s explore the columns that are part of the PHZ (photometric redshift) catalog to identify photometric redshifts and source types:","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"AE9BjlXtNj"}],"key":"yK5jd8lsnW"}],"key":"Sg2RjSR7Ro"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_schema_df[\n    euclid_schema_df[\"name\"].str.startswith(\"phz_\") # phz_ prefix is for PHZ catalog columns in this merged catalog\n    & euclid_schema_df[\"type\"].str.contains(\"int\") # to see flag type columns\n]","key":"NCFtYQJ5v9"},{"type":"outputs","id":"r4fiO3D8qOGJVvMLDRmHT","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":20,"metadata":{},"data":{"text/plain":{"content":"                       name   type unit  \\\n728             phz_bias_id  int32        \n729          phz_tom_bin_id  int32        \n730      phz_alt_tom_bin_id  int32        \n731      phz_pos_tom_bin_id  int32        \n773  phz_photometric_system  int32        \n774  phz_phz_classification  int32        \n775           phz_phz_flags  int32        \n\n                                                                                                                                                                      description  \n728                                                                               The identifier to be used for retrieving the bias correction shift from the bias correction map  \n729                                                                                              The identifier of the tomographic bin the source belongs to (Equipopulated-bins)  \n730                                                                                      The identifier of the alternate tomographic bin the source belongs to (Equidistant-bins)  \n731                                                                       The identifier of the photometric clustering tomographic bin the source belongs to (Equipopulated-bins)  \n773                                                                                     Encode the Photometric band configuration (indicating also the number of missing columns)  \n774  Classification flag: |1 if the source is accepted as star, |2 if it is accepted as a galaxy |4 if it is accepted as a QSO |8 if the source is accepted as a globular Cluster  \n775                An integer containing the flags of the PHZ processing. Meaning: 0 => OK, 1 => NNPZ flag: no close neighbor, 10 not VIS detected, 11 missing band, 12 too faint  ","content_type":"text/plain"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>name</th>\n      <th>type</th>\n      <th>unit</th>\n      <th>description</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>728</th>\n      <td>phz_bias_id</td>\n      <td>int32</td>\n      <td></td>\n      <td>The identifier to be used for retrieving the bias correction shift from the bias correction map</td>\n    </tr>\n    <tr>\n      <th>729</th>\n      <td>phz_tom_bin_id</td>\n      <td>int32</td>\n      <td></td>\n      <td>The identifier of the tomographic bin the source belongs to (Equipopulated-bins)</td>\n    </tr>\n    <tr>\n      <th>730</th>\n      <td>phz_alt_tom_bin_id</td>\n      <td>int32</td>\n      <td></td>\n      <td>The identifier of the alternate tomographic bin the source belongs to (Equidistant-bins)</td>\n    </tr>\n    <tr>\n      <th>731</th>\n      <td>phz_pos_tom_bin_id</td>\n      <td>int32</td>\n      <td></td>\n      <td>The identifier of the photometric clustering tomographic bin the source belongs to (Equipopulated-bins)</td>\n    </tr>\n    <tr>\n      <th>773</th>\n      <td>phz_photometric_system</td>\n      <td>int32</td>\n      <td></td>\n      <td>Encode the Photometric band configuration (indicating also the number of missing columns)</td>\n    </tr>\n    <tr>\n      <th>774</th>\n      <td>phz_phz_classification</td>\n      <td>int32</td>\n      <td></td>\n      <td>Classification flag: |1 if the source is accepted as star, |2 if it is accepted as a galaxy |4 if it is accepted as a QSO |8 if the source is accepted as a globular Cluster</td>\n    </tr>\n    <tr>\n      <th>775</th>\n      <td>phz_phz_flags</td>\n      <td>int32</td>\n      <td></td>\n      <td>An integer containing the flags of the PHZ processing. Meaning: 0 =&gt; OK, 1 =&gt; NNPZ flag: no close neighbor, 10 not VIS detected, 11 missing band, 12 too faint</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"}}},"key":"ox262JZgHT"}],"key":"UxqN7yh98B"}],"key":"VxNLH3eRwR"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":244,"column":1},"end":{"line":244,"column":1}},"children":[{"type":"text","value":"“phz_phz_median” gives us the median photometric redshift of sources, while “phz_phz_classification” can be used to filter the Euclid catalog to only galaxy-type sources.","position":{"start":{"line":244,"column":1},"end":{"line":244,"column":1}},"key":"ruFg3UONli"}],"key":"EFzlAv5v3F"},{"type":"paragraph","position":{"start":{"line":246,"column":1},"end":{"line":247,"column":1}},"children":[{"type":"text","value":"You can explore the schema DataFrame further to identify any other columns of interest.\nIt is also useful to go through the description of Euclid Q1 data products and papers that contain different PHZ, MER, etc. catalog tables that are merged in this HATS catalog, which are linked in the ","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"key":"UTsZ6y3V1W"},{"type":"link","url":"/euclid-q1-hats-intro","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"children":[{"type":"text","value":"Euclid Q1 Merged Objects HATS Catalog: Introduction","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"key":"cSCh8cBNOa"}],"urlSource":"euclid-q1-hats/1-euclid-q1-hats-intro.md","dataUrl":"/euclid-q1-hats-intro.json","internal":true,"protocol":"file","key":"xhq4RNlV3P"},{"type":"text","value":".","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"key":"Bon5NmtZ76"}],"key":"T0QytOT6T5"}],"key":"PHqVRpUrWk"},{"type":"block","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":251,"column":1},"end":{"line":251,"column":1}},"children":[{"type":"text","value":"3.3 Define column filters","position":{"start":{"line":251,"column":1},"end":{"line":251,"column":1}},"key":"CrANsVTLVb"}],"identifier":"id-3-3-define-column-filters","label":"3.3 Define column filters","html_id":"id-3-3-define-column-filters","implicit":true,"key":"Brdsg7FB8W"}],"key":"eTszSApfTb"},{"type":"block","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"children":[{"type":"text","value":"For this tutorial, the following columns are most relevant to us:","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"PPg23EW5ue"}],"key":"nniyEj7DkS"}],"key":"DfVSUgZQYj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_columns = euclid_schema_df['name'].iloc[:7].tolist() # the positional and ID columns\neuclid_columns.extend([\n    'phz_phz_median', # median of the photometric redshift PDF\n])","key":"HEt8Tp4OlT"},{"type":"outputs","id":"_j6xE2QA4EKnTszu9Nnsl","children":[],"key":"nvsiKre7lX"}],"key":"hWeGgthQhn"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"children":[{"type":"text","value":"The selected columns with their metadata are:","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"G2WtWn0rcM"}],"key":"be4vENZ2BJ"}],"key":"g1oQhjvmEa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_schema_df[euclid_schema_df[\"name\"].isin(euclid_columns)]","key":"QQut3bbXJi"},{"type":"outputs","id":"LKP_7N1pq9vA0njVoC4aE","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":22,"metadata":{},"data":{"text/plain":{"content":"               name    type unit  \\\n0       _healpix_29   int64        \n1       _healpix_19   int64        \n2        _healpix_9   int32        \n3            tileid   int64        \n4         object_id   int64  nan   \n5                ra  double  deg   \n6               dec  double  deg   \n720  phz_phz_median   float        \n\n                                                                   description  \n0                                                HEALPix order 29 pixel index.  \n1                                                HEALPix order 19 pixel index.  \n2                                                 HEALPix order 9 pixel index.  \n3                                                       Euclid MER tile index.  \n4                         Unique ID of the object in the survey, as set by MER  \n5     Source barycenter RA coordinate (SExtractor ALPHA_J2000) decimal degrees  \n6    Source barycenter DEC coordinate (SExtractor DELTA_J2000) decimal degrees  \n720                                                  The median of the PHZ PDF  ","content_type":"text/plain"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>name</th>\n      <th>type</th>\n      <th>unit</th>\n      <th>description</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>_healpix_29</td>\n      <td>int64</td>\n      <td></td>\n      <td>HEALPix order 29 pixel index.</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>_healpix_19</td>\n      <td>int64</td>\n      <td></td>\n      <td>HEALPix order 19 pixel index.</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>_healpix_9</td>\n      <td>int32</td>\n      <td></td>\n      <td>HEALPix order 9 pixel index.</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>tileid</td>\n      <td>int64</td>\n      <td></td>\n      <td>Euclid MER tile index.</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>object_id</td>\n      <td>int64</td>\n      <td>nan</td>\n      <td>Unique ID of the object in the survey, as set by MER</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>ra</td>\n      <td>double</td>\n      <td>deg</td>\n      <td>Source barycenter RA coordinate (SExtractor ALPHA_J2000) decimal degrees</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>dec</td>\n      <td>double</td>\n      <td>deg</td>\n      <td>Source barycenter DEC coordinate (SExtractor DELTA_J2000) decimal degrees</td>\n    </tr>\n    <tr>\n      <th>720</th>\n      <td>phz_phz_median</td>\n      <td>float</td>\n      <td></td>\n      <td>The median of the PHZ PDF</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"}}},"key":"wpviJs00jj"}],"key":"NzJ2KbOflS"}],"key":"CmJiIwzRF6"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":270,"column":1},"end":{"line":270,"column":1}},"children":[{"type":"text","value":"3.4 Define row filters","position":{"start":{"line":270,"column":1},"end":{"line":270,"column":1}},"key":"YkLT1DKhsP"}],"identifier":"id-3-4-define-row-filters","label":"3.4 Define row filters","html_id":"id-3-4-define-row-filters","implicit":true,"key":"oGAfAX01cf"}],"key":"hs9mUYTxCA"},{"type":"block","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"children":[{"type":"text","value":"To identify the galaxies with quality redshifts in this catalog, the following filters can be applied to the rows (from ","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"key":"yCLmSMvOCB"},{"type":"link","url":"https://arxiv.org/pdf/2503.15306","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"children":[{"type":"text","value":"Tucci et al. 2025","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"key":"OaahZhVENA"}],"urlSource":"https://arxiv.org/pdf/2503.15306","key":"dcnkT3s7um"},{"type":"text","value":" section 5.3):","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"key":"sL3DNa9YBY"}],"key":"MlvMnRgkQz"},{"type":"paragraph","position":{"start":{"line":276,"column":1},"end":{"line":277,"column":1}},"children":[{"type":"text","value":"Note that these filters are defined as lists of lists, where each inner list represents a single condition in the format ","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"key":"v1700SKH39"},{"type":"inlineCode","value":"[column_name, operator, value]","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"key":"L4K6GspdSa"},{"type":"text","value":" and the conditions are combined using logical AND.\nMore on filters that lsdb supports can be found in its ","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"key":"UFiXiYiweS"},{"type":"link","url":"https://docs.lsdb.io/en/latest/getting-started.html#performing-filters","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"children":[{"type":"text","value":"documentation","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"key":"KUamldwhXx"}],"urlSource":"https://docs.lsdb.io/en/latest/getting-started.html#performing-filters","key":"zw7VmyjCSJ"},{"type":"text","value":".","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"key":"ar3KsXdu6R"}],"key":"o693BsG6Fi"}],"key":"WJaDu1HOHa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def magnitude_to_flux(magnitude: float) -> float:\n    \"\"\"Convert magnitude to flux following the MER Photometry Cookbook.\"\"\"\n    zeropoint = 23.9\n    flux = 10 ** ((magnitude - zeropoint) / -2.5)\n    return flux\n\ngalaxy_filters = [\n    ['phz_phz_classification', '==', 2], # 2 is for galaxies\n    ['mer_vis_det', '==', 1], # No NIR-only objects\n    ['mer_spurious_flag', '==', 0], # not spurious\n    ['mer_flux_detection_total', '>', magnitude_to_flux(24.5)],  # I < 24.5\n    # lsdb doesn't support column arithmetic in filters yet, so can rather apply the S/N > 5 filter after loading the data\n    # ['mer_flux_detection_total', '/', 'mer_flux_detection_error_total', '>', 5], # I band S/N > 5\n]","key":"qlgVYiT4pY"},{"type":"outputs","id":"c3KNot8pS_XJoLlbwc4cJ","children":[],"key":"mNGLUWIbzu"}],"key":"F23DJsn3ey"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"children":[{"type":"text","value":"4. Define filters for querying ZTF DR23 Objects catalog","position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"key":"gzJV7lhkpI"}],"identifier":"id-4-define-filters-for-querying-ztf-dr23-objects-catalog","label":"4. Define filters for querying ZTF DR23 Objects catalog","html_id":"id-4-define-filters-for-querying-ztf-dr23-objects-catalog","implicit":true,"key":"micpQYBzi1"},{"type":"paragraph","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"children":[{"type":"text","value":"Since we are interested in cross-matching ZTF DR23 Objects with the Euclid Q1 catalog, we will use the same spatial filter defined above.","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"C0MLgzzePS"}],"key":"mJEAyX0V3g"},{"type":"paragraph","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"children":[{"type":"text","value":"We can define column and row filters for the ZTF catalog based on its schema, similar to the previous section:","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"mXeCqfu2BU"}],"key":"KfSa1njNu9"}],"key":"D48RjAkmXv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ztf_schema = pq.read_schema(\n    f\"s3://{ztf_bucket}/{ztf_hats_prefix}/{ztf_schema_path}\",\n    filesystem=s3\n)\nztf_schema_df = pq_schema_to_df(ztf_schema)","key":"BpYmgzNxvF"},{"type":"outputs","id":"CiYWbxhk_ar9UzUrZl4lw","children":[],"key":"b4DamzTs0o"}],"key":"XO5U5MyYF9"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":310,"column":1},"end":{"line":311,"column":1}},"children":[{"type":"text","value":"You can filter the schema further by units, type, etc. to identify other columns of interest.\nIt’s also useful to go through the ","position":{"start":{"line":310,"column":1},"end":{"line":310,"column":1}},"key":"yW14EMAmUB"},{"type":"link","url":"https://irsa.ipac.caltech.edu/data/ZTF/docs/releases/ztf_release_notes_latest","position":{"start":{"line":310,"column":1},"end":{"line":310,"column":1}},"children":[{"type":"text","value":"ZTF DR23 release notes","position":{"start":{"line":310,"column":1},"end":{"line":310,"column":1}},"key":"I6SyFCTpYi"}],"urlSource":"https://irsa.ipac.caltech.edu/data/ZTF/docs/releases/ztf_release_notes_latest","key":"Drl3as1RwZ"},{"type":"text","value":" and ","position":{"start":{"line":310,"column":1},"end":{"line":310,"column":1}},"key":"ZgCR4JeWYi"},{"type":"link","url":"https://irsa.ipac.caltech.edu/data/ZTF/docs/ztf_explanatory_supplement.pdf","position":{"start":{"line":310,"column":1},"end":{"line":310,"column":1}},"children":[{"type":"text","value":"explanatory supplement","position":{"start":{"line":310,"column":1},"end":{"line":310,"column":1}},"key":"aCm82RLt0Y"}],"urlSource":"https://irsa.ipac.caltech.edu/data/ZTF/docs/ztf_explanatory_supplement.pdf","key":"CNhDuCFlwm"},{"type":"text","value":" at IRSA for more details on column selections and caveats.","position":{"start":{"line":310,"column":1},"end":{"line":310,"column":1}},"key":"JJGGeAKbHt"}],"key":"EjQYdBbhPG"},{"type":"paragraph","position":{"start":{"line":313,"column":1},"end":{"line":313,"column":1}},"children":[{"type":"text","value":"For this tutorial, the following columns are most relevant to us:","position":{"start":{"line":313,"column":1},"end":{"line":313,"column":1}},"key":"INCSroCkpa"}],"key":"uSA1YMqjfs"}],"key":"vxN8TwCQ7j"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ztf_columns = ztf_schema_df[\"name\"].tolist()[:6]\nztf_columns.extend([\n    'fid', 'filtercode',\n    'ngoodobsrel',\n    'chisq', 'magrms', 'meanmag', 'medianabsdev'\n])","key":"sZw4RQeYCQ"},{"type":"outputs","id":"feGvKjlth-gQcXB6HaHcR","children":[],"key":"WudiLIqgGq"}],"key":"Da6U2U8Z1c"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":324,"column":1},"end":{"line":324,"column":1}},"children":[{"type":"text","value":"The rationale for selecting these columns is as follows:","position":{"start":{"line":324,"column":1},"end":{"line":324,"column":1}},"key":"AKxaMsAlk3"}],"key":"CjBf60pXdp"}],"key":"owrzWt0p5o"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ztf_schema_df[ztf_schema_df.name.isin(ztf_columns)]","key":"oFC4ODLc44"},{"type":"outputs","id":"PZWwBtAexe4aRokN4wUJG","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":26,"metadata":{},"data":{"text/plain":{"content":"            name    type unit  \\\n0    _healpix_29   int64        \n1    _healpix_19   int64        \n2     _healpix_9   int32        \n3            oid   int64        \n4             ra  double  deg   \n5            dec  double  deg   \n10           fid    int8        \n11    filtercode  string        \n17         chisq   float        \n20        magrms   float  mag   \n23       meanmag   float  mag   \n24  medianabsdev   float  mag   \n44   ngoodobsrel   int32        \n\n                                                                    description  \n0                                                 HEALPix order 29 pixel index.  \n1                                                 HEALPix order 19 pixel index.  \n2                                                  HEALPix order 9 pixel index.  \n3                                                      Unique object identifier  \n4                                                        Object Right Ascension  \n5                                                            Object Declination  \n10                                   Filter identifier (1 = zg; 2 = zr; 3 = zi)  \n11                                                     Filter code (zg, zr, zi)  \n17                                      Chi-square metric using nobs detections  \n20                             Root Mean Squared deviation over nobs magnitudes  \n23                                          Mean magnitude over nobs detections  \n24                 Median absolute deviation in magnitudes over nobs detections  \n44  Number of epochal detections in this release not associated with bad pixels  ","content_type":"text/plain"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>name</th>\n      <th>type</th>\n      <th>unit</th>\n      <th>description</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>_healpix_29</td>\n      <td>int64</td>\n      <td></td>\n      <td>HEALPix order 29 pixel index.</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>_healpix_19</td>\n      <td>int64</td>\n      <td></td>\n      <td>HEALPix order 19 pixel index.</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>_healpix_9</td>\n      <td>int32</td>\n      <td></td>\n      <td>HEALPix order 9 pixel index.</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>oid</td>\n      <td>int64</td>\n      <td></td>\n      <td>Unique object identifier</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>ra</td>\n      <td>double</td>\n      <td>deg</td>\n      <td>Object Right Ascension</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>dec</td>\n      <td>double</td>\n      <td>deg</td>\n      <td>Object Declination</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>fid</td>\n      <td>int8</td>\n      <td></td>\n      <td>Filter identifier (1 = zg; 2 = zr; 3 = zi)</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>filtercode</td>\n      <td>string</td>\n      <td></td>\n      <td>Filter code (zg, zr, zi)</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>chisq</td>\n      <td>float</td>\n      <td></td>\n      <td>Chi-square metric using nobs detections</td>\n    </tr>\n    <tr>\n      <th>20</th>\n      <td>magrms</td>\n      <td>float</td>\n      <td>mag</td>\n      <td>Root Mean Squared deviation over nobs magnitudes</td>\n    </tr>\n    <tr>\n      <th>23</th>\n      <td>meanmag</td>\n      <td>float</td>\n      <td>mag</td>\n      <td>Mean magnitude over nobs detections</td>\n    </tr>\n    <tr>\n      <th>24</th>\n      <td>medianabsdev</td>\n      <td>float</td>\n      <td>mag</td>\n      <td>Median absolute deviation in magnitudes over nobs detections</td>\n    </tr>\n    <tr>\n      <th>44</th>\n      <td>ngoodobsrel</td>\n      <td>int32</td>\n      <td></td>\n      <td>Number of epochal detections in this release not associated with bad pixels</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"}}},"key":"kiPai33oIP"}],"key":"LH0XHXFUKg"}],"key":"fPaZZDIflV"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"children":[{"type":"text","value":"For a quality cut, we apply the following filter on the number of good epochs (from ","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"gHTgv20mtb"},{"type":"cite","kind":"narrative","label":"Coughlin_2021","identifier":"doi.org/10.1093/mnras/stab1502","children":[{"type":"text","value":"Coughlin ","key":"MWRqI8FW9z"},{"type":"emphasis","children":[{"type":"text","value":"et al.","key":"YrWSLWQyeD"}],"key":"I2Ibk1SIZo"},{"type":"text","value":" (2021)","key":"QW32kTLeKA"}],"enumerator":"1","key":"wQj2WhVMyp"},{"type":"text","value":") section 2):","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"huHn7oIJUn"}],"key":"atQFRUGdQ0"}],"key":"qRX2vhTZu5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"quality_filters = [\n    [\"ngoodobsrel\", \">\", 50]\n]","key":"l65jwvfvgh"},{"type":"outputs","id":"r5sNbEkNfiOIwaCGdDyYO","children":[],"key":"mKxbZm4SF1"}],"key":"EIeuD46OJU"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"children":[{"type":"text","value":"5. Crossmatch: Euclid Q1 x ZTF DR23 Objects","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"h0PpZ4Brc5"}],"identifier":"id-5-crossmatch-euclid-q1-x-ztf-dr23-objects","label":"5. Crossmatch: Euclid Q1 x ZTF DR23 Objects","html_id":"id-5-crossmatch-euclid-q1-x-ztf-dr23-objects","implicit":true,"key":"qwbPb0UB5T"},{"type":"paragraph","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"children":[{"type":"text","value":"Now that we have defined the spatial, column, and row filters for both catalogs, we can use lsdb to perform the crossmatch.","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"qIE0FyrCVV"}],"key":"IHMsy0qxIF"}],"key":"rpsMhMIzUN"},{"type":"block","position":{"start":{"line":342,"column":1},"end":{"line":342,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"children":[{"type":"text","value":"5.1 Create crossmatch query using the filters","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"key":"g7ZywENmJX"}],"identifier":"id-5-1-create-crossmatch-query-using-the-filters","label":"5.1 Create crossmatch query using the filters","html_id":"id-5-1-create-crossmatch-query-using-the-filters","implicit":true,"key":"unKdLrKwSn"},{"type":"paragraph","position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"children":[{"type":"text","value":"Following lsdb’s documentation on ","position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"key":"mvJbLkWxLr"},{"type":"link","url":"https://docs.lsdb.io/en/latest/getting-started.html#performing-filters","position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"children":[{"type":"text","value":"performing filters","position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"key":"UDf37W4GUQ"}],"urlSource":"https://docs.lsdb.io/en/latest/getting-started.html#performing-filters","key":"CQ3ztAxpQj"},{"type":"text","value":", we open the Euclid Q1 catalog with the defined spatial, column, and row filters:","position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"key":"ZDLK07JOmA"}],"key":"dSWzuQRRQJ"}],"key":"cUfWPrmVPq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_cone = lsdb.open_catalog(\n    f\"s3://{euclid_q1_bucket}/{euclid_q1_hats_prefix}\",\n    columns=euclid_columns,\n    search_filter=spatial_filter,\n    filters=galaxy_filters\n)\neuclid_cone","key":"CFBJdCIftH"},{"type":"outputs","id":"hdqobj6lE7jbbMTHSU8Ul","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":28,"metadata":{},"data":{"text/plain":{"content":"Dask NestedFrame Structure:\n                        _healpix_19      _healpix_9          tileid       object_id               ra              dec  phz_phz_median\nnpartitions=6                                                                                                                        \n720364834146746368   int64[pyarrow]  int32[pyarrow]  int64[pyarrow]  int64[pyarrow]  double[pyarrow]  double[pyarrow]  float[pyarrow]\n720505571635101696              ...             ...             ...             ...              ...              ...             ...\n...                             ...             ...             ...             ...              ...              ...             ...\n1128855394098085888             ...             ...             ...             ...              ...              ...             ...\n1128925762842263552             ...             ...             ...             ...              ...              ...             ...\nDask Name: search_points, 5 expressions\nExpr=MapPartitions(search_points)","content_type":"text/plain"},"text/html":{"content":"<div><strong>lsdb Catalog Euclid_Q1_Merged_Objects:</strong></div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>_healpix_19</th>\n      <th>_healpix_9</th>\n      <th>tileid</th>\n      <th>object_id</th>\n      <th>ra</th>\n      <th>dec</th>\n      <th>phz_phz_median</th>\n    </tr>\n    <tr>\n      <th>npartitions=6</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Order: 6, Pixel: 10237</th>\n      <td>int64[pyarrow]</td>\n      <td>int32[pyarrow]</td>\n      <td>int64[pyarrow]</td>\n      <td>int64[pyarrow]</td>\n      <td>double[pyarrow]</td>\n      <td>double[pyarrow]</td>\n      <td>float[pyarrow]</td>\n    </tr>\n    <tr>\n      <th>Order: 6, Pixel: 10239</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>Order: 6, Pixel: 15359</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>Order: 6, Pixel: 16042</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n  </tbody>\n</table>\n</div><div>7 out of 1593 available columns in the catalog have been loaded <strong>lazily</strong>, meaning no data has been read, only the catalog schema</div>","content_type":"text/html"}}},"key":"MhHuCL80hY"}],"key":"iKvTfDVg4P"}],"key":"eOVyDRMolk"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":358,"column":1},"end":{"line":360,"column":1}},"children":[{"type":"text","value":"Notice how the number of partitions reduced from 114 (in section 2) to only a few partitions that are within the spatial filter.\nThis allows LSDB to avoid loading unused parts of the catalog.\nAlso, we see only the columns we selected in the column filters.","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"key":"d7bzubdkwU"}],"key":"i2A0eiOYlq"},{"type":"paragraph","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"children":[{"type":"text","value":"Now, similarly, we open the ZTF DR23 Objects catalog with its defined filters:","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"key":"hwS8zmk2GM"}],"key":"FiLQMcfONE"}],"key":"DFIjhSw8hd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ztf_cone = lsdb.open_catalog(\n    f\"s3://{ztf_bucket}/{ztf_hats_prefix}\",\n    columns=ztf_columns,\n    search_filter=spatial_filter,\n    filters=quality_filters\n)\nztf_cone","key":"frGJ41bEGW"},{"type":"outputs","id":"q0HIfTpU2WHyDFT-f6Izq","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":29,"metadata":{},"data":{"text/plain":{"content":"Dask NestedFrame Structure:\n                        _healpix_19      _healpix_9             oid               ra              dec            fid       filtercode     ngoodobsrel           chisq          magrms         meanmag    medianabsdev\nnpartitions=4                                                                                                                                                                                                        \n719450040472436736   int64[pyarrow]  int32[pyarrow]  int64[pyarrow]  double[pyarrow]  double[pyarrow]  int8[pyarrow]  string[pyarrow]  int32[pyarrow]  float[pyarrow]  float[pyarrow]  float[pyarrow]  float[pyarrow]\n816277432460902400              ...             ...             ...              ...              ...            ...              ...             ...             ...             ...             ...             ...\n1079738010662076416             ...             ...             ...              ...              ...            ...              ...             ...             ...             ...             ...             ...\n1128151706656309248             ...             ...             ...              ...              ...            ...              ...             ...             ...             ...             ...             ...\n1129277606563151872             ...             ...             ...              ...              ...            ...              ...             ...             ...             ...             ...             ...\nDask Name: search_points, 5 expressions\nExpr=MapPartitions(search_points)","content_type":"text/plain"},"text/html":{"content":"<div><strong>lsdb Catalog ZTF_DR23_Objects:</strong></div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>_healpix_19</th>\n      <th>_healpix_9</th>\n      <th>oid</th>\n      <th>ra</th>\n      <th>dec</th>\n      <th>fid</th>\n      <th>filtercode</th>\n      <th>ngoodobsrel</th>\n      <th>chisq</th>\n      <th>magrms</th>\n      <th>meanmag</th>\n      <th>medianabsdev</th>\n    </tr>\n    <tr>\n      <th>npartitions=4</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Order: 4, Pixel: 639</th>\n      <td>int64[pyarrow]</td>\n      <td>int32[pyarrow]</td>\n      <td>int64[pyarrow]</td>\n      <td>double[pyarrow]</td>\n      <td>double[pyarrow]</td>\n      <td>int8[pyarrow]</td>\n      <td>string[pyarrow]</td>\n      <td>int32[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>float[pyarrow]</td>\n    </tr>\n    <tr>\n      <th>Order: 4, Pixel: 725</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>Order: 4, Pixel: 959</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>Order: 4, Pixel: 1002</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n  </tbody>\n</table>\n</div><div>12 out of 76 available columns in the catalog have been loaded <strong>lazily</strong>, meaning no data has been read, only the catalog schema</div>","content_type":"text/html"}}},"key":"fJviiwPAUF"}],"key":"ha5zjLaHBG"}],"key":"YHFlZHIz7g"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"children":[{"type":"text","value":"We see a similar reduction in the number of partitions for this catalog as well, and our column selection is applied.","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"key":"jbT7IgoSRN"}],"key":"aTAOXjDRRx"},{"type":"paragraph","position":{"start":{"line":376,"column":1},"end":{"line":379,"column":1}},"children":[{"type":"text","value":"Now we can use lsdb’s ","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"ZejD1EI8T3"},{"type":"link","url":"https://docs.lsdb.io/en/latest/tutorials/pre_executed/crossmatching.html#2.-Perform-the-crossmatch-on-the-small-catalogs","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"children":[{"type":"text","value":"crossmatch functionality","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"ukaD7FUQP1"}],"urlSource":"https://docs.lsdb.io/en/latest/tutorials/pre_executed/crossmatching.html#2.-Perform-the-crossmatch-on-the-small-catalogs","key":"Dsu3awmhMJ"},{"type":"text","value":" to plan a crossmatch between these two filtered catalogs.\nNote that the order of crossmatch matters: lsdb’s algorithm takes each object in the left catalog and finds the closest spatial match from the right catalog.\nSince Euclid is denser than ZTF, we put it on the left side of the crossmatch to maximize the number of matches.\nFor more details on the parameters, refer to the documentation linked.","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"XBYYUkvygK"}],"key":"Ls9q8fY3ka"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"U8WYuLfdN5"}],"key":"FWZ35qbTnj"},{"type":"paragraph","position":{"start":{"line":382,"column":1},"end":{"line":382,"column":1}},"children":[{"type":"text","value":"Since ZTF objects are defined per band, setting ","position":{"start":{"line":382,"column":1},"end":{"line":382,"column":1}},"key":"d1rEiAOueV"},{"type":"inlineCode","value":"n_neighbors=1","position":{"start":{"line":382,"column":1},"end":{"line":382,"column":1}},"key":"daGXTWMS2o"},{"type":"text","value":" means this is only going to return data in one ZTF band for each Euclid object. This is done for simplicity of analysing the crossmatched results in subsequent sections but you can increase ","position":{"start":{"line":382,"column":1},"end":{"line":382,"column":1}},"key":"sWRMIEFDPI"},{"type":"inlineCode","value":"n_neighbors","position":{"start":{"line":382,"column":1},"end":{"line":382,"column":1}},"key":"nyn55jIhSQ"},{"type":"text","value":" to get data in multiple ZTF bands.","position":{"start":{"line":382,"column":1},"end":{"line":382,"column":1}},"key":"n9XUJdw4lG"}],"key":"a0vpI0wMMi"}],"key":"YeWJHDy8AY"}],"key":"EAiqMdaDR9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_x_ztf = euclid_cone.crossmatch(\n    ztf_cone,\n    suffixes=(\"_euclid\", \"_ztf\"), # to distinguish columns from the two catalogs\n    n_neighbors=1, # default is 1 too, can be tweaked\n    radius_arcsec=1  # default is 1 arcsec too, can be tweaked\n)\neuclid_x_ztf","key":"cWLHNyeeKJ"},{"type":"outputs","id":"BsDWIjT6IZoOZ_8lnj20p","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stderr","text":"/home/runner/work/irsa-tutorials/irsa-tutorials/.tox/py312-buildhtml/lib/python3.12/site-packages/lsdb/catalog/catalog.py:307: FutureWarning: The default suffix behavior will change from applying suffixes to all columns to only applying suffixes to overlapping columns in a future release.To maintain the current behavior, explicitly set `suffix_method='all_columns'`. To change to the new behavior, set `suffix_method='overlapping_columns'`.\n  warnings.warn(\n"},"key":"boqXckEVfO"},{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":30,"metadata":{},"data":{"text/plain":{"content":"Dask NestedFrame Structure:\n                    _healpix_19_euclid _healpix_9_euclid   tileid_euclid object_id_euclid        ra_euclid       dec_euclid phz_phz_median_euclid _healpix_19_ztf  _healpix_9_ztf         oid_ztf           ra_ztf          dec_ztf        fid_ztf   filtercode_ztf ngoodobsrel_ztf       chisq_ztf      magrms_ztf     meanmag_ztf medianabsdev_ztf     _dist_arcsec\nnpartitions=6                                                                                                                                                                                                                                                                                                                                                        \n720364834146746368      int64[pyarrow]    int32[pyarrow]  int64[pyarrow]   int64[pyarrow]  double[pyarrow]  double[pyarrow]        float[pyarrow]  int64[pyarrow]  int32[pyarrow]  int64[pyarrow]  double[pyarrow]  double[pyarrow]  int8[pyarrow]  string[pyarrow]  int32[pyarrow]  float[pyarrow]  float[pyarrow]  float[pyarrow]   float[pyarrow]  double[pyarrow]\n720505571635101696                 ...               ...             ...              ...              ...              ...                   ...             ...             ...             ...              ...              ...            ...              ...             ...             ...             ...             ...              ...              ...\n...                                ...               ...             ...              ...              ...              ...                   ...             ...             ...             ...              ...              ...            ...              ...             ...             ...             ...             ...              ...              ...\n1128855394098085888                ...               ...             ...              ...              ...              ...                   ...             ...             ...             ...              ...              ...            ...              ...             ...             ...             ...             ...              ...              ...\n1128925762842263552                ...               ...             ...              ...              ...              ...                   ...             ...             ...             ...              ...              ...            ...              ...             ...             ...             ...             ...              ...              ...\nDask Name: nestedframe, 3 expressions\nExpr=MapPartitions(NestedFrame)","content_type":"text/plain"},"text/html":{"content":"<div><strong>lsdb Catalog Euclid_Q1_Merged_Objects_x_ZTF_DR23_Objects:</strong></div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>_healpix_19_euclid</th>\n      <th>_healpix_9_euclid</th>\n      <th>tileid_euclid</th>\n      <th>object_id_euclid</th>\n      <th>ra_euclid</th>\n      <th>dec_euclid</th>\n      <th>phz_phz_median_euclid</th>\n      <th>_healpix_19_ztf</th>\n      <th>_healpix_9_ztf</th>\n      <th>oid_ztf</th>\n      <th>ra_ztf</th>\n      <th>dec_ztf</th>\n      <th>fid_ztf</th>\n      <th>filtercode_ztf</th>\n      <th>ngoodobsrel_ztf</th>\n      <th>chisq_ztf</th>\n      <th>magrms_ztf</th>\n      <th>meanmag_ztf</th>\n      <th>medianabsdev_ztf</th>\n      <th>_dist_arcsec</th>\n    </tr>\n    <tr>\n      <th>npartitions=6</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Order: 6, Pixel: 10237</th>\n      <td>int64[pyarrow]</td>\n      <td>int32[pyarrow]</td>\n      <td>int64[pyarrow]</td>\n      <td>int64[pyarrow]</td>\n      <td>double[pyarrow]</td>\n      <td>double[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>int64[pyarrow]</td>\n      <td>int32[pyarrow]</td>\n      <td>int64[pyarrow]</td>\n      <td>double[pyarrow]</td>\n      <td>double[pyarrow]</td>\n      <td>int8[pyarrow]</td>\n      <td>string[pyarrow]</td>\n      <td>int32[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>double[pyarrow]</td>\n    </tr>\n    <tr>\n      <th>Order: 6, Pixel: 10239</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>Order: 6, Pixel: 15359</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>Order: 6, Pixel: 16042</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n  </tbody>\n</table>\n</div><div>20 out of 20 available columns in the catalog have been loaded <strong>lazily</strong>, meaning no data has been read, only the catalog schema</div>","content_type":"text/html"}}},"key":"DRuOkerOZ0"}],"key":"QyDtSpWIfU"}],"key":"GNwoeVfWb6"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":395,"column":1},"end":{"line":396,"column":1}},"children":[{"type":"text","value":"Note how the resulting crossmatched catalog contains columns from both catalogs with the suffixes we passed.\nAs we noticed when opening the catalog, this created a crossmatch catalog object lazily but did not execute the crossmatch.","position":{"start":{"line":395,"column":1},"end":{"line":395,"column":1}},"key":"xw9dzMgfoI"}],"key":"ID7HHwbMo0"}],"key":"gH14ngLZhW"},{"type":"block","position":{"start":{"line":398,"column":1},"end":{"line":398,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":400,"column":1},"end":{"line":400,"column":1}},"children":[{"type":"text","value":"5.2 Execute the query and load data","position":{"start":{"line":400,"column":1},"end":{"line":400,"column":1}},"key":"efLswO3UJJ"}],"identifier":"id-5-2-execute-the-query-and-load-data","label":"5.2 Execute the query and load data","html_id":"id-5-2-execute-the-query-and-load-data","implicit":true,"key":"srCUEcSuQp"},{"type":"paragraph","position":{"start":{"line":402,"column":1},"end":{"line":403,"column":1}},"children":[{"type":"text","value":"Now we can run the crossmatch query we have been planning so far by using the ","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"Rgwn4GdYVB"},{"type":"inlineCode","value":"compute()","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"cxAlLAE8OR"},{"type":"text","value":" method of the crossmatch catalog object, which will perform all the tasks and return the result as a DataFrame.\nlsdb utilizes ","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"QITQZ4l2HX"},{"type":"link","url":"https://docs.dask.org/en/stable/","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"children":[{"type":"text","value":"Dask","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"m0ZGrOjqSU"}],"urlSource":"https://docs.dask.org/en/stable/","key":"vKJ6MsvSfD"},{"type":"text","value":" to parallelize the tasks on different partitions, so we need to create a Dask client to manage the resources (and track progress) for the scope of this computation:","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"PZkNIuIQAp"}],"key":"cN3V1VNS2U"}],"key":"qCr3jJGRyq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def get_nworkers(catalog):\n    return min(os.cpu_count(), catalog.npartitions + 1)\n\nwith Client(n_workers=get_nworkers(euclid_x_ztf),\n            threads_per_worker=2,\n            memory_limit='auto') as client:\n    print(f\"This may take more than a few minutes to complete. You can monitor progress in Dask dashboard at {client.dashboard_link}\")\n    euclid_x_ztf_df = euclid_x_ztf.compute() # this will load the data into memory finally","key":"vOFX0RZHaD"},{"type":"outputs","id":"hKh2PfFFgeojeHcx9vV9t","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"This may take more than a few minutes to complete. You can monitor progress in Dask dashboard at http://127.0.0.1:8787/status\n"},"key":"xwbcPL7Esj"}],"key":"er93hZQKbS"}],"key":"uyuqzM0wtb"},{"type":"block","children":[],"key":"YEkJDAtseO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_x_ztf_df","key":"n9PnM8c7Sw"},{"type":"outputs","id":"8DKK94E5ImMGgM_Ll8sMq","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":32,"metadata":{},"data":{"text/plain":{"content":"                     _healpix_19_euclid  _healpix_9_euclid  tileid_euclid  \\\n_healpix_29                                                                 \n720434593244322473         687059968227             655231      102158891   \n720432428583862814         687057903846             655229      102158891   \n720434481587813232         687059861743             655231      102158891   \n720432832290153985         687058288850             655229      102158891   \n720432970313122903         687058420479             655229      102158891   \n720434484456996712         687059864480             655231      102158891   \n720432835157060433         687058291585             655229      102158891   \n720432420190003514         687057895841             655229      102158891   \n720435031368747437         687060386055             655231      102158891   \n...                                 ...                ...            ...   \n1128893524233377784       1076596760018            1026722      102159487   \n1128893589791736967       1076596822540            1026722      102159487   \n1128893569383796065       1076596803077            1026722      102159487   \n1128893542038473039       1076596776998            1026722      102159487   \n1128893540953147706       1076596775963            1026722      102159487   \n1128893538206451784       1076596773344            1026722      102159487   \n1128893376581602470       1076596619207            1026722      102159193   \n1128893337709122935       1076596582135            1026722      102159193   \n1128893340254188261       1076596584562            1026722      102159193   \n\n                        object_id_euclid   ra_euclid  dec_euclid  \\\n_healpix_29                                                        \n720434593244322473   2699181571656108156  269.918157   65.610816   \n720432428583862814   2699187793655290965  269.918779   65.529097   \n720434481587813232   2699189269655936829  269.918927   65.593683   \n720432832290153985   2699194755655464972  269.919476   65.546497   \n720432970313122903   2699203905655721348  269.920391   65.572135   \n720434484456996712   2699204552655981362  269.920455   65.598136   \n720432835157060433   2699209485655511218  269.920949   65.551122   \n720432420190003514   2699210741655237953  269.921074   65.523795   \n720435031368747437   2699214091656398506  269.921409   65.639851   \n...                                  ...         ...         ...   \n1128893524233377784  2707275041662719928  270.727504   66.271993   \n1128893589791736967  2707360491662878475  270.736049   66.287848   \n1128893569383796065  2707361465662732069  270.736147   66.273207   \n1128893542038473039  2707612776662634595  270.761278    66.26346   \n1128893540953147706  2707730517662693744  270.773052   66.269374   \n1128893538206451784  2707809557662660563  270.780956   66.266056   \n1128893376581602470  2707976353662411561  270.797635   66.241156   \n1128893337709122935  2708392307662229925  270.839231   66.222993   \n1128893340254188261  2708472558662234858  270.847256   66.223486   \n\n                     phz_phz_median_euclid  _healpix_19_ztf  _healpix_9_ztf  \\\n_healpix_29                                                                   \n720434593244322473                     0.2     687059968227          655231   \n720432428583862814                    0.27     687057903846          655229   \n720434481587813232                    0.73     687059862089          655231   \n720432832290153985                    0.15     687058288850          655229   \n720432970313122903                    0.25     687058420479          655229   \n720434484456996712                     0.2     687059864480          655231   \n720432835157060433                    0.36     687058291588          655229   \n720432420190003514                    0.36     687057895842          655229   \n720435031368747437                     0.1     687060386055          655231   \n...                                    ...              ...             ...   \n1128893524233377784                   0.32    1076596760019         1026722   \n1128893589791736967                   0.43    1076596822537         1026722   \n1128893569383796065                   0.32    1076596803077         1026722   \n1128893542038473039                   0.29    1076596776999         1026722   \n1128893540953147706                   0.01    1076596775963         1026722   \n1128893538206451784                   0.47    1076596773323         1026722   \n1128893376581602470                    0.4    1076596619206         1026722   \n1128893337709122935                   0.59    1076596582134         1026722   \n1128893340254188261                   0.03    1076596584563         1026722   \n\n                              oid_ztf      ra_ztf    dec_ztf  fid_ztf  \\\n_healpix_29                                                             \n720434593244322473    826215200002321  269.918125   65.61082        2   \n720432428583862814    826215200031991  269.918892  65.529095        2   \n720434481587813232    848302400011626  269.918333  65.593788        3   \n720432832290153985    826215200011172  269.919267   65.54643        2   \n720432970313122903    848202400009734  269.920497  65.572115        2   \n720434484456996712    848202400022812  269.920449   65.59814        2   \n720432835157060433    826215200017597  269.921348   65.55124        2   \n720432420190003514    826215200022643  269.920704  65.523755        2   \n720435031368747437    848302400025079  269.921389   65.63984        3   \n...                               ...         ...        ...      ...   \n1128893524233377784   848201300011194  270.727673  66.272057        2   \n1128893589791736967   848201300001262  270.736013  66.287832        2   \n1128893569383796065   848201300001438   270.73629  66.273238        2   \n1128893542038473039   848201300001540  270.761399  66.263474        2   \n1128893540953147706  1857212300002383  270.773034  66.269382        2   \n1128893538206451784   848201300001497  270.781189  66.266031        2   \n1128893376581602470   848201300001788  270.797594  66.241162        2   \n1128893337709122935   848201300001975  270.839017  66.222907        2   \n1128893340254188261   848201300001966  270.847261  66.223523        2   \n\n                    filtercode_ztf  ngoodobsrel_ztf  chisq_ztf  magrms_ztf  \\\n_healpix_29                                                                  \n720434593244322473              zr              957   0.963843    0.142436   \n720432428583862814              zr               90   1.132518    0.316141   \n720434481587813232              zi              223   1.083044    0.085483   \n720432832290153985              zr               92   0.833866    0.237722   \n720432970313122903              zr              223   1.029616    0.264355   \n720434484456996712              zr             1041   0.971803    0.141235   \n720432835157060433              zr               66   1.291853    0.350705   \n720432420190003514              zr               82    1.10932    0.283498   \n720435031368747437              zi              235   1.307203    0.099071   \n...                            ...              ...        ...         ...   \n1128893524233377784             zr              172   0.957406    0.234242   \n1128893589791736967             zr              536   0.968066    0.219642   \n1128893569383796065             zr              347   0.939984    0.236459   \n1128893542038473039             zr              400    0.92098    0.217024   \n1128893540953147706             zr               53   1.208119    0.017946   \n1128893538206451784             zr              196   1.018292    0.256665   \n1128893376581602470             zr              599   0.958596    0.210892   \n1128893337709122935             zr               61   1.336956    0.333995   \n1128893340254188261             zr               83    1.09015      0.3153   \n\n                     meanmag_ztf  medianabsdev_ztf  _dist_arcsec  \n_healpix_29                                                       \n720434593244322473     20.150564          0.087977      0.050941  \n720432428583862814     21.188622          0.187522      0.168698  \n720434481587813232     19.007387          0.054602      0.961264  \n720432832290153985     21.323473           0.14329      0.393347  \n720432970313122903     21.137856           0.15752      0.173815  \n720434484456996712     20.038595          0.082394      0.017943  \n720432835157060433      21.23908          0.217272      0.732231  \n720432420190003514     21.253254          0.190222      0.570194  \n720435031368747437     18.976027          0.064419      0.047905  \n...                          ...               ...           ...  \n1128893524233377784    21.202761          0.160785      0.334972  \n1128893589791736967    20.804783           0.13789      0.075775  \n1128893569383796065    21.124443          0.153017      0.236522  \n1128893542038473039      21.0543          0.145107      0.183349  \n1128893540953147706    16.642914          0.011663      0.037508  \n1128893538206451784     21.14094          0.167229      0.350357  \n1128893376581602470    20.752556          0.132805      0.064059  \n1128893337709122935    21.316973          0.234939      0.436674  \n1128893340254188261    21.287346          0.189821      0.132318  \n\n[4833 rows x 20 columns]","content_type":"text/plain"},"text/html":{"content":"<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>_healpix_19_euclid</th>\n      <th>_healpix_9_euclid</th>\n      <th>tileid_euclid</th>\n      <th>object_id_euclid</th>\n      <th>ra_euclid</th>\n      <th>dec_euclid</th>\n      <th>phz_phz_median_euclid</th>\n      <th>_healpix_19_ztf</th>\n      <th>_healpix_9_ztf</th>\n      <th>oid_ztf</th>\n      <th>ra_ztf</th>\n      <th>dec_ztf</th>\n      <th>fid_ztf</th>\n      <th>filtercode_ztf</th>\n      <th>ngoodobsrel_ztf</th>\n      <th>chisq_ztf</th>\n      <th>magrms_ztf</th>\n      <th>meanmag_ztf</th>\n      <th>medianabsdev_ztf</th>\n      <th>_dist_arcsec</th>\n    </tr>\n    <tr>\n      <th>_healpix_29</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>720434593244322473</th>\n      <td>687059968227</td>\n      <td>655231</td>\n      <td>102158891</td>\n      <td>2699181571656108156</td>\n      <td>269.918157</td>\n      <td>65.610816</td>\n      <td>0.2</td>\n      <td>687059968227</td>\n      <td>655231</td>\n      <td>826215200002321</td>\n      <td>269.918125</td>\n      <td>65.61082</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>957</td>\n      <td>0.963843</td>\n      <td>0.142436</td>\n      <td>20.150564</td>\n      <td>0.087977</td>\n      <td>0.050941</td>\n    </tr>\n    <tr>\n      <th>720432428583862814</th>\n      <td>687057903846</td>\n      <td>655229</td>\n      <td>102158891</td>\n      <td>2699187793655290965</td>\n      <td>269.918779</td>\n      <td>65.529097</td>\n      <td>0.27</td>\n      <td>687057903846</td>\n      <td>655229</td>\n      <td>826215200031991</td>\n      <td>269.918892</td>\n      <td>65.529095</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>90</td>\n      <td>1.132518</td>\n      <td>0.316141</td>\n      <td>21.188622</td>\n      <td>0.187522</td>\n      <td>0.168698</td>\n    </tr>\n    <tr>\n      <th>720434481587813232</th>\n      <td>687059861743</td>\n      <td>655231</td>\n      <td>102158891</td>\n      <td>2699189269655936829</td>\n      <td>269.918927</td>\n      <td>65.593683</td>\n      <td>0.73</td>\n      <td>687059862089</td>\n      <td>655231</td>\n      <td>848302400011626</td>\n      <td>269.918333</td>\n      <td>65.593788</td>\n      <td>3</td>\n      <td>zi</td>\n      <td>223</td>\n      <td>1.083044</td>\n      <td>0.085483</td>\n      <td>19.007387</td>\n      <td>0.054602</td>\n      <td>0.961264</td>\n    </tr>\n    <tr>\n      <th>720432832290153985</th>\n      <td>687058288850</td>\n      <td>655229</td>\n      <td>102158891</td>\n      <td>2699194755655464972</td>\n      <td>269.919476</td>\n      <td>65.546497</td>\n      <td>0.15</td>\n      <td>687058288850</td>\n      <td>655229</td>\n      <td>826215200011172</td>\n      <td>269.919267</td>\n      <td>65.54643</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>92</td>\n      <td>0.833866</td>\n      <td>0.237722</td>\n      <td>21.323473</td>\n      <td>0.14329</td>\n      <td>0.393347</td>\n    </tr>\n    <tr>\n      <th>720432970313122903</th>\n      <td>687058420479</td>\n      <td>655229</td>\n      <td>102158891</td>\n      <td>2699203905655721348</td>\n      <td>269.920391</td>\n      <td>65.572135</td>\n      <td>0.25</td>\n      <td>687058420479</td>\n      <td>655229</td>\n      <td>848202400009734</td>\n      <td>269.920497</td>\n      <td>65.572115</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>223</td>\n      <td>1.029616</td>\n      <td>0.264355</td>\n      <td>21.137856</td>\n      <td>0.15752</td>\n      <td>0.173815</td>\n    </tr>\n    <tr>\n      <th>720434484456996712</th>\n      <td>687059864480</td>\n      <td>655231</td>\n      <td>102158891</td>\n      <td>2699204552655981362</td>\n      <td>269.920455</td>\n      <td>65.598136</td>\n      <td>0.2</td>\n      <td>687059864480</td>\n      <td>655231</td>\n      <td>848202400022812</td>\n      <td>269.920449</td>\n      <td>65.59814</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>1041</td>\n      <td>0.971803</td>\n      <td>0.141235</td>\n      <td>20.038595</td>\n      <td>0.082394</td>\n      <td>0.017943</td>\n    </tr>\n    <tr>\n      <th>720432835157060433</th>\n      <td>687058291585</td>\n      <td>655229</td>\n      <td>102158891</td>\n      <td>2699209485655511218</td>\n      <td>269.920949</td>\n      <td>65.551122</td>\n      <td>0.36</td>\n      <td>687058291588</td>\n      <td>655229</td>\n      <td>826215200017597</td>\n      <td>269.921348</td>\n      <td>65.55124</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>66</td>\n      <td>1.291853</td>\n      <td>0.350705</td>\n      <td>21.23908</td>\n      <td>0.217272</td>\n      <td>0.732231</td>\n    </tr>\n    <tr>\n      <th>720432420190003514</th>\n      <td>687057895841</td>\n      <td>655229</td>\n      <td>102158891</td>\n      <td>2699210741655237953</td>\n      <td>269.921074</td>\n      <td>65.523795</td>\n      <td>0.36</td>\n      <td>687057895842</td>\n      <td>655229</td>\n      <td>826215200022643</td>\n      <td>269.920704</td>\n      <td>65.523755</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>82</td>\n      <td>1.10932</td>\n      <td>0.283498</td>\n      <td>21.253254</td>\n      <td>0.190222</td>\n      <td>0.570194</td>\n    </tr>\n    <tr>\n      <th>720435031368747437</th>\n      <td>687060386055</td>\n      <td>655231</td>\n      <td>102158891</td>\n      <td>2699214091656398506</td>\n      <td>269.921409</td>\n      <td>65.639851</td>\n      <td>0.1</td>\n      <td>687060386055</td>\n      <td>655231</td>\n      <td>848302400025079</td>\n      <td>269.921389</td>\n      <td>65.63984</td>\n      <td>3</td>\n      <td>zi</td>\n      <td>235</td>\n      <td>1.307203</td>\n      <td>0.099071</td>\n      <td>18.976027</td>\n      <td>0.064419</td>\n      <td>0.047905</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>1128893524233377784</th>\n      <td>1076596760018</td>\n      <td>1026722</td>\n      <td>102159487</td>\n      <td>2707275041662719928</td>\n      <td>270.727504</td>\n      <td>66.271993</td>\n      <td>0.32</td>\n      <td>1076596760019</td>\n      <td>1026722</td>\n      <td>848201300011194</td>\n      <td>270.727673</td>\n      <td>66.272057</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>172</td>\n      <td>0.957406</td>\n      <td>0.234242</td>\n      <td>21.202761</td>\n      <td>0.160785</td>\n      <td>0.334972</td>\n    </tr>\n    <tr>\n      <th>1128893589791736967</th>\n      <td>1076596822540</td>\n      <td>1026722</td>\n      <td>102159487</td>\n      <td>2707360491662878475</td>\n      <td>270.736049</td>\n      <td>66.287848</td>\n      <td>0.43</td>\n      <td>1076596822537</td>\n      <td>1026722</td>\n      <td>848201300001262</td>\n      <td>270.736013</td>\n      <td>66.287832</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>536</td>\n      <td>0.968066</td>\n      <td>0.219642</td>\n      <td>20.804783</td>\n      <td>0.13789</td>\n      <td>0.075775</td>\n    </tr>\n    <tr>\n      <th>1128893569383796065</th>\n      <td>1076596803077</td>\n      <td>1026722</td>\n      <td>102159487</td>\n      <td>2707361465662732069</td>\n      <td>270.736147</td>\n      <td>66.273207</td>\n      <td>0.32</td>\n      <td>1076596803077</td>\n      <td>1026722</td>\n      <td>848201300001438</td>\n      <td>270.73629</td>\n      <td>66.273238</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>347</td>\n      <td>0.939984</td>\n      <td>0.236459</td>\n      <td>21.124443</td>\n      <td>0.153017</td>\n      <td>0.236522</td>\n    </tr>\n    <tr>\n      <th>1128893542038473039</th>\n      <td>1076596776998</td>\n      <td>1026722</td>\n      <td>102159487</td>\n      <td>2707612776662634595</td>\n      <td>270.761278</td>\n      <td>66.26346</td>\n      <td>0.29</td>\n      <td>1076596776999</td>\n      <td>1026722</td>\n      <td>848201300001540</td>\n      <td>270.761399</td>\n      <td>66.263474</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>400</td>\n      <td>0.92098</td>\n      <td>0.217024</td>\n      <td>21.0543</td>\n      <td>0.145107</td>\n      <td>0.183349</td>\n    </tr>\n    <tr>\n      <th>1128893540953147706</th>\n      <td>1076596775963</td>\n      <td>1026722</td>\n      <td>102159487</td>\n      <td>2707730517662693744</td>\n      <td>270.773052</td>\n      <td>66.269374</td>\n      <td>0.01</td>\n      <td>1076596775963</td>\n      <td>1026722</td>\n      <td>1857212300002383</td>\n      <td>270.773034</td>\n      <td>66.269382</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>53</td>\n      <td>1.208119</td>\n      <td>0.017946</td>\n      <td>16.642914</td>\n      <td>0.011663</td>\n      <td>0.037508</td>\n    </tr>\n    <tr>\n      <th>1128893538206451784</th>\n      <td>1076596773344</td>\n      <td>1026722</td>\n      <td>102159487</td>\n      <td>2707809557662660563</td>\n      <td>270.780956</td>\n      <td>66.266056</td>\n      <td>0.47</td>\n      <td>1076596773323</td>\n      <td>1026722</td>\n      <td>848201300001497</td>\n      <td>270.781189</td>\n      <td>66.266031</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>196</td>\n      <td>1.018292</td>\n      <td>0.256665</td>\n      <td>21.14094</td>\n      <td>0.167229</td>\n      <td>0.350357</td>\n    </tr>\n    <tr>\n      <th>1128893376581602470</th>\n      <td>1076596619207</td>\n      <td>1026722</td>\n      <td>102159193</td>\n      <td>2707976353662411561</td>\n      <td>270.797635</td>\n      <td>66.241156</td>\n      <td>0.4</td>\n      <td>1076596619206</td>\n      <td>1026722</td>\n      <td>848201300001788</td>\n      <td>270.797594</td>\n      <td>66.241162</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>599</td>\n      <td>0.958596</td>\n      <td>0.210892</td>\n      <td>20.752556</td>\n      <td>0.132805</td>\n      <td>0.064059</td>\n    </tr>\n    <tr>\n      <th>1128893337709122935</th>\n      <td>1076596582135</td>\n      <td>1026722</td>\n      <td>102159193</td>\n      <td>2708392307662229925</td>\n      <td>270.839231</td>\n      <td>66.222993</td>\n      <td>0.59</td>\n      <td>1076596582134</td>\n      <td>1026722</td>\n      <td>848201300001975</td>\n      <td>270.839017</td>\n      <td>66.222907</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>61</td>\n      <td>1.336956</td>\n      <td>0.333995</td>\n      <td>21.316973</td>\n      <td>0.234939</td>\n      <td>0.436674</td>\n    </tr>\n    <tr>\n      <th>1128893340254188261</th>\n      <td>1076596584562</td>\n      <td>1026722</td>\n      <td>102159193</td>\n      <td>2708472558662234858</td>\n      <td>270.847256</td>\n      <td>66.223486</td>\n      <td>0.03</td>\n      <td>1076596584563</td>\n      <td>1026722</td>\n      <td>848201300001966</td>\n      <td>270.847261</td>\n      <td>66.223523</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>83</td>\n      <td>1.09015</td>\n      <td>0.3153</td>\n      <td>21.287346</td>\n      <td>0.189821</td>\n      <td>0.132318</td>\n    </tr>\n  </tbody>\n</table>\n<p>4833 rows × 20 columns</p>","content_type":"text/html"}}},"key":"pKtEB28Hgb"}],"key":"qMKex4iERQ"}],"key":"quwxAT2PgS"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},"children":[{"type":"text","value":"5.3 Identify objects of interest from the crossmatch","position":{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},"key":"dnuAaVO7bw"}],"identifier":"id-5-3-identify-objects-of-interest-from-the-crossmatch","label":"5.3 Identify objects of interest from the crossmatch","html_id":"id-5-3-identify-objects-of-interest-from-the-crossmatch","implicit":true,"key":"gkjZWjqzhD"}],"key":"QkDrCR10IH"},{"type":"block","position":{"start":{"line":422,"column":1},"end":{"line":422,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":424,"column":1},"end":{"line":424,"column":1}},"children":[{"type":"text","value":"Check the number of unique Euclid and ZTF sources in the crossmatched catalog:","position":{"start":{"line":424,"column":1},"end":{"line":424,"column":1}},"key":"rXtWJwLdpN"}],"key":"Ho6iNeADkl"}],"key":"yG7yroxeMq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_x_ztf_df.shape[0], euclid_x_ztf_df['object_id_euclid'].nunique(), euclid_x_ztf_df['oid_ztf'].nunique()","key":"kYKhrTy7H4"},{"type":"outputs","id":"amJFE81Fsp4t0oIqco0GA","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":33,"metadata":{},"data":{"text/plain":{"content":"(4833, 4833, 4808)","content_type":"text/plain"}}},"key":"vYNOmAolsF"}],"key":"omswK3HV2a"}],"key":"SzuPACP8fE"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":430,"column":1},"end":{"line":431,"column":1}},"children":[{"type":"text","value":"This means there is one unique Euclid source for each row in the crossmatched catalog as expected (since we put Euclid on the left side of the crossmatch).\nBut for ZTF, this is not true as some ZTF objects have multiple Euclid matches since ZTF has lower resolution than Euclid.","position":{"start":{"line":430,"column":1},"end":{"line":430,"column":1}},"key":"U8QPHWHxyH"}],"key":"QEQ1kxkxwH"},{"type":"paragraph","position":{"start":{"line":433,"column":1},"end":{"line":434,"column":1}},"children":[{"type":"text","value":"Now let’s plot some variability metrics from ZTF against Euclid redshift to see if there are any trends.\nWe will use hexbin plots to visualize the density of sources in each panel:","position":{"start":{"line":433,"column":1},"end":{"line":433,"column":1}},"key":"LsYhbq36hN"}],"key":"uWscOH3tLw"}],"key":"OxMy1lefQc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"z = euclid_x_ztf_df[\"phz_phz_median_euclid\"].to_numpy() # x-axis\nmetrics = [ # y-axes\n    (\"magrms_ztf\",        \"ZTF mag RMS\"),\n    (\"chisq_ztf\",         \"ZTF χ²\"),\n    (\"medianabsdev_ztf\",  \"ZTF MAD\"),\n    (\"ngoodobsrel_ztf\",   \"ZTF # good obs\"),\n]\n\nfig, axes = plt.subplots(2, 2, figsize=(10, 6), constrained_layout=True, sharex=True)\naxes = axes.ravel()\n\nxmin, xmax = 0, 2.5\ngridsize = 48  # resolution: larger => finer grid\n\nfor i, (col, ylabel) in enumerate(metrics):\n    ax = axes[i]\n    y = euclid_x_ztf_df[col].to_numpy()\n\n    # clip y to robust range (1–99th percentile) for visibility\n    y_lo, y_hi = np.nanpercentile(y, [1, 99])\n\n    hb = ax.hexbin(\n        z, y,\n        gridsize=gridsize,\n        extent=(xmin, xmax, y_lo, y_hi),\n        mincnt=1,\n        bins='log'  # logarithmic color scale of counts\n    )\n\n    # ax.set_xlim(xmin, xmax)\n    # ax.set_ylim(y_lo, y_hi)\n    ax.set_ylabel(ylabel)\n\n    # x-label only on bottom row to reduce clutter\n    if i // 2 == 1:\n        ax.set_xlabel(\"Euclid redshift\")\n\n\n# Shared colorbar across all panels (uses last hexbin as mappable)\ncbar = fig.colorbar(hb, ax=axes[:-1], shrink=0.9, label=\"Galaxy sources count (log)\")\n\nfig.suptitle(\"Euclid redshift vs ZTF variability metrics\", y=1.04)\nplt.show()","key":"nGl97n9o3t"},{"type":"outputs","id":"lcX8olub_9L1g_4BwYUnS","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1000x600 with 5 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"63063f88ae09e7b15eecdee6d316587f","path":"/irsa-tutorials/build/63063f88ae09e7b15eecdee6d316587f.png"}}},"key":"EPq5zbTsrk"}],"key":"ICIVguSxBL"}],"key":"WgD40fUC0J"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":482,"column":1},"end":{"line":483,"column":1}},"children":[{"type":"text","value":"There’s no strong variability trend for higher redshift galaxies (z > 1) as the distributions of mag RMS, MAD, and Chi-squared are fairly stable with redshift.\nThis is likely because of the limited sensitivity of ZTF, as there are clearly fewer good observations as redshift increases.","position":{"start":{"line":482,"column":1},"end":{"line":482,"column":1}},"key":"yRYQNHBqKV"}],"key":"P5DlSfUdZL"},{"type":"paragraph","position":{"start":{"line":485,"column":1},"end":{"line":486,"column":1}},"children":[{"type":"text","value":"Despite this, we can still select some high-variability galaxy sources from the low redshift (z < 1) range for further analysis.\nLet’s focus only on Chi-squared (measure of significance) and RMS magnitude (measure of variability amplitude; similar to MAD) metrics:","position":{"start":{"line":485,"column":1},"end":{"line":485,"column":1}},"key":"hqiyNgkLKi"}],"key":"kXYW6R0f4X"}],"key":"LdNRR0wjIo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_x_ztf_df['chisq_ztf'].describe()","key":"Ce0n2nqfl6"},{"type":"outputs","id":"yg3Et9flcJ6rSvBF0L3f3","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":35,"metadata":{},"data":{"text/plain":{"content":"count       4833.0\nmean      1.125982\nstd       0.677987\nmin       0.648965\n25%       0.964728\n50%       1.050994\n75%       1.161509\nmax      27.873291\nName: chisq_ztf, dtype: double[pyarrow]","content_type":"text/plain"}}},"key":"fYX6PyHeiI"}],"key":"Nu8mNk6Zgd"}],"key":"N5xJ2zjuVf"},{"type":"block","children":[],"key":"a7RgT7NraW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"chisq_threshold = euclid_x_ztf_df['chisq_ztf'].quantile(0.95)\nchisq_threshold","key":"M2rjB1cOt6"},{"type":"outputs","id":"3WTC8WDPMfXZar7AcZe6k","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":36,"metadata":{},"data":{"text/plain":{"content":"1.4483341455459593","content_type":"text/plain"}}},"key":"YMdfjxpJlJ"}],"key":"KlledclHZ5"}],"key":"hsOZ1zcuPI"},{"type":"block","children":[],"key":"yX4Bq2sfxi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"euclid_x_ztf_df['magrms_ztf'].describe()","key":"eCIV1J2oGo"},{"type":"outputs","id":"Qbimty93hdC16Ne50HXpx","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":37,"metadata":{},"data":{"text/plain":{"content":"count      4833.0\nmean     0.219656\nstd      0.089749\nmin      0.010117\n25%      0.175114\n50%      0.234153\n75%      0.277245\nmax      0.923869\nName: magrms_ztf, dtype: double[pyarrow]","content_type":"text/plain"}}},"key":"NBnrNN773O"}],"key":"QV8F6YjnfB"}],"key":"d5ja3P3JgJ"},{"type":"block","children":[],"key":"Hzj5Yz8hsw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"magrms_threshold = euclid_x_ztf_df['magrms_ztf'].quantile(0.95)\nmagrms_threshold","key":"TCsr47Uzgi"},{"type":"outputs","id":"IwJGJI5KRBEKVeyUSf77T","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":38,"metadata":{},"data":{"text/plain":{"content":"0.33570506572723385","content_type":"text/plain"}}},"key":"WvBZSCCQFM"}],"key":"DWVe1rc9IH"}],"key":"ZBDkCxYCp0"},{"type":"block","children":[],"key":"lvD7iFRbW0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"variable_galaxies = euclid_x_ztf_df.query(\n    f\"chisq_ztf >= {chisq_threshold} & magrms_ztf >= {magrms_threshold}\"\n    ).sort_values(\"chisq_ztf\", ascending=False) # sort by significant variability","key":"LsbCSy1wd6"},{"type":"outputs","id":"aDRvKlgANf93VXgiBqI3O","children":[],"key":"LiGTgcONX6"}],"key":"z6D20I4ufq"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":512,"column":1},"end":{"line":512,"column":1}},"children":[{"type":"text","value":"Let’s inspect the top variable galaxies that we can use for plotting their light curves:","position":{"start":{"line":512,"column":1},"end":{"line":512,"column":1}},"key":"ms7kce6rxv"}],"key":"RvmeD8en7n"}],"key":"SKykP7JzKG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cols_of_interest = [\"oid_ztf\", \"fid_ztf\", \"filtercode_ztf\", \"phz_phz_median_euclid\", \"magrms_ztf\", \"chisq_ztf\"]\ntop_variable_galaxies = variable_galaxies.head(3)\ntop_variable_galaxies[cols_of_interest]","key":"Qwvs3aqokW"},{"type":"outputs","id":"P3fy33w4GS1fn9uAvhH0M","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":40,"metadata":{},"data":{"text/plain":{"content":"                             oid_ztf  fid_ztf filtercode_ztf  \\\n_healpix_29                                                    \n1080844064773760661  848201300014047        2             zr   \n816655967593598710   848102400023608        1             zg   \n816655965602458265   848202400038072        2             zr   \n\n                     phz_phz_median_euclid  magrms_ztf  chisq_ztf  \n_healpix_29                                                        \n1080844064773760661                   0.11    0.923869  27.873291  \n816655967593598710                     1.0    0.844652  19.543127  \n816655965602458265                    0.96    0.765504  17.694681  ","content_type":"text/plain"},"text/html":{"content":"<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>oid_ztf</th>\n      <th>fid_ztf</th>\n      <th>filtercode_ztf</th>\n      <th>phz_phz_median_euclid</th>\n      <th>magrms_ztf</th>\n      <th>chisq_ztf</th>\n    </tr>\n    <tr>\n      <th>_healpix_29</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1080844064773760661</th>\n      <td>848201300014047</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>0.11</td>\n      <td>0.923869</td>\n      <td>27.873291</td>\n    </tr>\n    <tr>\n      <th>816655967593598710</th>\n      <td>848102400023608</td>\n      <td>1</td>\n      <td>zg</td>\n      <td>1.0</td>\n      <td>0.844652</td>\n      <td>19.543127</td>\n    </tr>\n    <tr>\n      <th>816655965602458265</th>\n      <td>848202400038072</td>\n      <td>2</td>\n      <td>zr</td>\n      <td>0.96</td>\n      <td>0.765504</td>\n      <td>17.694681</td>\n    </tr>\n  </tbody>\n</table>\n<p>3 rows × 6 columns</p>","content_type":"text/html"}}},"key":"EsqcG3oRmR"}],"key":"Ah5XvDYG4a"}],"key":"hWazhibQGx"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"children":[{"type":"text","value":"6. Load ZTF lightcurves by object IDs","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"PQW9x0IsMR"}],"identifier":"id-6-load-ztf-lightcurves-by-object-ids","label":"6. Load ZTF lightcurves by object IDs","html_id":"id-6-load-ztf-lightcurves-by-object-ids","implicit":true,"key":"HLmE1Q4k4H"}],"key":"p5GvaTZ515"},{"type":"block","position":{"start":{"line":522,"column":1},"end":{"line":522,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":524,"column":1},"end":{"line":527,"column":1}},"children":[{"type":"text","value":"Let’s open the ZTF light curves HATS catalog.\nNote that we are using the same spatial filter as before.\nWe do not specify any column filters, because the default columns already contain the light curve data we need.\nWe also do not apply any row filters, since we will directly filter rows by object IDs.","position":{"start":{"line":524,"column":1},"end":{"line":524,"column":1}},"key":"s1M8iAJNjB"}],"key":"At7PP0PlDF"}],"key":"r1BlLiFm8c"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ztf_lc_catalog = lsdb.open_catalog(f\"s3://{ztf_bucket}/{ztf_lc_hats_prefix}\",\n                                   search_filter=spatial_filter\n                                   )\nztf_lc_catalog","key":"s5L2wI9ZK3"},{"type":"outputs","id":"ZiwrwSzfmIZlBuw-UC8w5","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":41,"metadata":{},"data":{"text/plain":{"content":"Dask NestedFrame Structure:\n                           objectid       filterid           objra          objdec                                                                                   lightcurve\nnpartitions=4                                                                                                                                                                  \n720294465402568704   int64[pyarrow]  int8[pyarrow]  float[pyarrow]  float[pyarrow]  nested<hmjd: [double], mag: [float], magerr: [float], clrcoeff: [float], catflags: [int32]>\n816558907437613056              ...            ...             ...             ...                                                                                          ...\n1080582435592208384             ...            ...             ...             ...                                                                                          ...\n1128714656609730560             ...            ...             ...             ...                                                                                          ...\n1128996131586441216             ...            ...             ...             ...                                                                                          ...\nDask Name: search_points, 5 expressions\nExpr=MapPartitions(search_points)","content_type":"text/plain"},"text/html":{"content":"<div><strong>lsdb Catalog ZTF_DR23_Lightcurves:</strong></div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>objectid</th>\n      <th>filterid</th>\n      <th>objra</th>\n      <th>objdec</th>\n      <th>lightcurve</th>\n    </tr>\n    <tr>\n      <th>npartitions=4</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Order: 5, Pixel: 2559</th>\n      <td>int64[pyarrow]</td>\n      <td>int8[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>nested&lt;hmjd: [double], mag: [float], magerr: [float], clrcoeff: [float], catflags: [int32]&gt;</td>\n    </tr>\n    <tr>\n      <th>Order: 5, Pixel: 2901</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>Order: 5, Pixel: 3839</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>Order: 5, Pixel: 4010</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n  </tbody>\n</table>\n</div><div>5 out of 13 available columns in the catalog have been loaded <strong>lazily</strong>, meaning no data has been read, only the catalog schema</div>","content_type":"text/html"}}},"key":"v5WZdqK7wi"}],"key":"nwwqQvUL5O"}],"key":"WP19GCCMQS"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"children":[{"type":"text","value":"We can inspect the catalog’s collection properties and find which columns have ancillary index tables (as explained in lsdb’s documentation on ","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"iEa5tkFvUK"},{"type":"link","url":"https://docs.lsdb.io/en/latest/tutorials/pre_executed/index_table.html","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"children":[{"type":"text","value":"using index tables","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"xaklF5rEdp"}],"urlSource":"https://docs.lsdb.io/en/latest/tutorials/pre_executed/index_table.html","key":"heOxw0dVPH"},{"type":"text","value":").","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":1}},"key":"xHON9EHkq7"}],"key":"ILexwxC9Rc"}],"key":"C4Jq3XkHrK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ztf_lc_idx_column = list(ztf_lc_catalog.hc_collection.all_indexes.keys())[0]\nztf_lc_idx_column","key":"xiHfGs6uIj"},{"type":"outputs","id":"5DZ1pQdByM66yYxChIAV5","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":42,"metadata":{},"data":{"text/plain":{"content":"'objectid'","content_type":"text/plain"}}},"key":"tfrelGYRYo"}],"key":"NA0jDKGmf2"}],"key":"v5LHU1phJV"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":543,"column":1},"end":{"line":543,"column":1}},"children":[{"type":"text","value":"Let’s just extract the object IDs of the top variable galaxies we identified above:","position":{"start":{"line":543,"column":1},"end":{"line":543,"column":1}},"key":"S3xobYma8g"}],"key":"SALvZZBHk3"}],"key":"i1nuKzaTb9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ztf_oids = top_variable_galaxies['oid_ztf'].tolist()\nztf_oids","key":"GBejIQ8xUR"},{"type":"outputs","id":"HSoSISByUpx84nBX7gL_H","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":43,"metadata":{},"data":{"text/plain":{"content":"[848201300014047, 848102400023608, 848202400038072]","content_type":"text/plain"}}},"key":"LsjMPyuJyC"}],"key":"xPxS7oulCd"}],"key":"je5KniUbgD"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":550,"column":1},"end":{"line":550,"column":1}},"children":[{"type":"text","value":"Now we can use these IDs to filter the ZTF light curves catalog by the ","position":{"start":{"line":550,"column":1},"end":{"line":550,"column":1}},"key":"OXmuh3PGHK"},{"type":"inlineCode","value":"id_search","position":{"start":{"line":550,"column":1},"end":{"line":550,"column":1}},"key":"YaomlsEnSM"},{"type":"text","value":" method:","position":{"start":{"line":550,"column":1},"end":{"line":550,"column":1}},"key":"E3iTJmcqRi"}],"key":"lrEE34pCNH"}],"key":"KtQsLGKIYV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ztf_lcs = ztf_lc_catalog.id_search(values={ztf_lc_idx_column: ztf_oids})\nztf_lcs","key":"xPW0jHzcTi"},{"type":"outputs","id":"CRaagE2ripaRep2x-O-jb","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"Searching for objectid=[848201300014047, 848102400023608, 848202400038072]\n"},"key":"dyj1JEgGDG"},{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":44,"metadata":{},"data":{"text/plain":{"content":"Dask NestedFrame Structure:\n                           objectid       filterid           objra          objdec                                                                                   lightcurve\nnpartitions=2                                                                                                                                                                  \n816558907437613056   int64[pyarrow]  int8[pyarrow]  float[pyarrow]  float[pyarrow]  nested<hmjd: [double], mag: [float], magerr: [float], clrcoeff: [float], catflags: [int32]>\n1080582435592208384             ...            ...             ...             ...                                                                                          ...\n1128714656609730560             ...            ...             ...             ...                                                                                          ...\nDask Name: search_points, 7 expressions\nExpr=MapPartitions(search_points)","content_type":"text/plain"},"text/html":{"content":"<div><strong>lsdb Catalog ZTF_DR23_Lightcurves:</strong></div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>objectid</th>\n      <th>filterid</th>\n      <th>objra</th>\n      <th>objdec</th>\n      <th>lightcurve</th>\n    </tr>\n    <tr>\n      <th>npartitions=2</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Order: 5, Pixel: 2901</th>\n      <td>int64[pyarrow]</td>\n      <td>int8[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>float[pyarrow]</td>\n      <td>nested&lt;hmjd: [double], mag: [float], magerr: [float], clrcoeff: [float], catflags: [int32]&gt;</td>\n    </tr>\n    <tr>\n      <th>Order: 5, Pixel: 3839</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n  </tbody>\n</table>\n</div><div>5 out of 13 available columns in the catalog have been loaded <strong>lazily</strong>, meaning no data has been read, only the catalog schema</div>","content_type":"text/html"}}},"key":"BivD1zWoLm"}],"key":"f6xTu7q69e"}],"key":"GpRoUCkGoX"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":557,"column":1},"end":{"line":558,"column":1}},"children":[{"type":"text","value":"As earlier, this creates a lazy catalog object with the partition(s) that contains our IDs.\nWe can load the light curves data into a DataFrame by using the ","position":{"start":{"line":557,"column":1},"end":{"line":557,"column":1}},"key":"tubZZ9i9gL"},{"type":"inlineCode","value":"compute()","position":{"start":{"line":557,"column":1},"end":{"line":557,"column":1}},"key":"H2gZFwzzAA"},{"type":"text","value":" method:","position":{"start":{"line":557,"column":1},"end":{"line":557,"column":1}},"key":"HLL4wplGCT"}],"key":"nMYtTB9YT0"}],"key":"jYg260GXIU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ztf_lcs_df = ztf_lcs.compute() # ID search runs out of memory if we try to parallelize it with Dask client\nztf_lcs_df","key":"OR3jBDl4jw"},{"type":"outputs","id":"c7sWZ0v-Tw0v0QHLuQCH-","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":45,"metadata":{},"data":{"text/plain":{"content":"                            objectid  filterid       objra     objdec  \\\n_healpix_29                                                             \n816655965609758114   848202400038072         2    268.8302  66.324913   \n816655967601097877   848102400023608         1  268.827881  66.326439   \n1080844064784050785  848201300014047         2  270.404602  65.946106   \n\n                                                                                                                 lightcurve  \n_healpix_29                                                                                                                  \n816655965609758114   [{hmjd: 58198.36545, mag: 17.170887, magerr: 0.016645, clrcoeff: 0.067037, catflags: 0}; …] (130 rows)  \n816655967601097877   [{hmjd: 58207.39283, mag: 18.013729, magerr: 0.028822, clrcoeff: -0.077841, catflags: 0}; …] (54 rows)  \n1080844064784050785  [{hmjd: 58226.44889, mag: 21.158422, magerr: 0.242976, clrcoeff: 0.094843, catflags: 0}; …] (148 rows)  ","content_type":"text/plain"},"text/html":{"content":"<style type=\"text/css\">\n</style>\n<table id=\"T_5abd8\">\n  <thead>\n    <tr>\n      <th class=\"blank level0\" >&nbsp;</th>\n      <th id=\"T_5abd8_level0_col0\" class=\"col_heading level0 col0\" >objectid</th>\n      <th id=\"T_5abd8_level0_col1\" class=\"col_heading level0 col1\" >filterid</th>\n      <th id=\"T_5abd8_level0_col2\" class=\"col_heading level0 col2\" >objra</th>\n      <th id=\"T_5abd8_level0_col3\" class=\"col_heading level0 col3\" >objdec</th>\n      <th id=\"T_5abd8_level0_col4\" class=\"col_heading level0 col4\" >lightcurve</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th id=\"T_5abd8_level0_row0\" class=\"row_heading level0 row0\" >816655965609758114</th>\n      <td id=\"T_5abd8_row0_col0\" class=\"data row0 col0\" >848202400038072</td>\n      <td id=\"T_5abd8_row0_col1\" class=\"data row0 col1\" >2</td>\n      <td id=\"T_5abd8_row0_col2\" class=\"data row0 col2\" >268.830200</td>\n      <td id=\"T_5abd8_row0_col3\" class=\"data row0 col3\" >66.324913</td>\n      <td id=\"T_5abd8_row0_col4\" class=\"data row0 col4\" ><table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>hmjd</th>\n      <th>mag</th>\n      <th>magerr</th>\n      <th>clrcoeff</th>\n      <th>catflags</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>58198.36545</td>\n      <td>17.170887</td>\n      <td>0.016645</td>\n      <td>0.067037</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <td><i>+129 rows</i></td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n  </tbody>\n</table></td>\n    </tr>\n    <tr>\n      <th id=\"T_5abd8_level0_row1\" class=\"row_heading level0 row1\" >816655967601097877</th>\n      <td id=\"T_5abd8_row1_col0\" class=\"data row1 col0\" >848102400023608</td>\n      <td id=\"T_5abd8_row1_col1\" class=\"data row1 col1\" >1</td>\n      <td id=\"T_5abd8_row1_col2\" class=\"data row1 col2\" >268.827881</td>\n      <td id=\"T_5abd8_row1_col3\" class=\"data row1 col3\" >66.326439</td>\n      <td id=\"T_5abd8_row1_col4\" class=\"data row1 col4\" ><table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>hmjd</th>\n      <th>mag</th>\n      <th>magerr</th>\n      <th>clrcoeff</th>\n      <th>catflags</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>58207.39283</td>\n      <td>18.013729</td>\n      <td>0.028822</td>\n      <td>-0.077841</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <td><i>+53 rows</i></td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n  </tbody>\n</table></td>\n    </tr>\n    <tr>\n      <th id=\"T_5abd8_level0_row2\" class=\"row_heading level0 row2\" >1080844064784050785</th>\n      <td id=\"T_5abd8_row2_col0\" class=\"data row2 col0\" >848201300014047</td>\n      <td id=\"T_5abd8_row2_col1\" class=\"data row2 col1\" >2</td>\n      <td id=\"T_5abd8_row2_col2\" class=\"data row2 col2\" >270.404602</td>\n      <td id=\"T_5abd8_row2_col3\" class=\"data row2 col3\" >65.946106</td>\n      <td id=\"T_5abd8_row2_col4\" class=\"data row2 col4\" ><table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>hmjd</th>\n      <th>mag</th>\n      <th>magerr</th>\n      <th>clrcoeff</th>\n      <th>catflags</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>58226.44889</td>\n      <td>21.158422</td>\n      <td>0.242976</td>\n      <td>0.094843</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <td><i>+147 rows</i></td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n  </tbody>\n</table></td>\n    </tr>\n  </tbody>\n</table>\n3 rows x 5 columns","content_type":"text/html"}}},"key":"eIMeKvW9G4"}],"key":"ANc6njtgjN"}],"key":"k0hh4M6piH"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":565,"column":1},"end":{"line":565,"column":1}},"children":[{"type":"text","value":"Let’s merge this light curves DataFrame with the crossmatched catalog (with variability filters and sorting) so that we can use collapsed light curves metrics for annotating the plots:","position":{"start":{"line":565,"column":1},"end":{"line":565,"column":1}},"key":"iY8f2EJ80t"}],"key":"iiiznTRZRX"}],"key":"v2HRlRN6ba"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"merged_ztf_lcs_df = ztf_lcs_df.merge(\n    top_variable_galaxies[cols_of_interest].set_index('oid_ztf'),\n    left_on='objectid', right_index=True\n).set_index('objectid', drop=False)\n\n# Sort by the order of top_variable_galaxies\nmerged_ztf_lcs_df = merged_ztf_lcs_df.loc[ztf_oids]\nmerged_ztf_lcs_df","key":"mTblB2aTy7"},{"type":"outputs","id":"W4Xwoc8MB3t-Re47ZYw7o","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":46,"metadata":{},"data":{"text/plain":{"content":"                        objectid  filterid       objra     objdec  \\\nobjectid                                                            \n848201300014047  848201300014047         2  270.404602  65.946106   \n848102400023608  848102400023608         1  268.827881  66.326439   \n848202400038072  848202400038072         2    268.8302  66.324913   \n\n                                                                                                             lightcurve  \\\nobjectid                                                                                                                  \n848201300014047  [{hmjd: 58226.44889, mag: 21.158422, magerr: 0.242976, clrcoeff: 0.094843, catflags: 0}; …] (148 rows)   \n848102400023608  [{hmjd: 58207.39283, mag: 18.013729, magerr: 0.028822, clrcoeff: -0.077841, catflags: 0}; …] (54 rows)   \n848202400038072  [{hmjd: 58198.36545, mag: 17.170887, magerr: 0.016645, clrcoeff: 0.067037, catflags: 0}; …] (130 rows)   \n\n                 fid_ztf filtercode_ztf  phz_phz_median_euclid  magrms_ztf  \\\nobjectid                                                                     \n848201300014047        2             zr                   0.11    0.923869   \n848102400023608        1             zg                    1.0    0.844652   \n848202400038072        2             zr                   0.96    0.765504   \n\n                 chisq_ztf  \nobjectid                    \n848201300014047  27.873291  \n848102400023608  19.543127  \n848202400038072  17.694681  ","content_type":"text/plain"},"text/html":{"content":"<style type=\"text/css\">\n</style>\n<table id=\"T_40a04\">\n  <thead>\n    <tr>\n      <th class=\"blank level0\" >&nbsp;</th>\n      <th id=\"T_40a04_level0_col0\" class=\"col_heading level0 col0\" >objectid</th>\n      <th id=\"T_40a04_level0_col1\" class=\"col_heading level0 col1\" >filterid</th>\n      <th id=\"T_40a04_level0_col2\" class=\"col_heading level0 col2\" >objra</th>\n      <th id=\"T_40a04_level0_col3\" class=\"col_heading level0 col3\" >objdec</th>\n      <th id=\"T_40a04_level0_col4\" class=\"col_heading level0 col4\" >lightcurve</th>\n      <th id=\"T_40a04_level0_col5\" class=\"col_heading level0 col5\" >fid_ztf</th>\n      <th id=\"T_40a04_level0_col6\" class=\"col_heading level0 col6\" >filtercode_ztf</th>\n      <th id=\"T_40a04_level0_col7\" class=\"col_heading level0 col7\" >phz_phz_median_euclid</th>\n      <th id=\"T_40a04_level0_col8\" class=\"col_heading level0 col8\" >magrms_ztf</th>\n      <th id=\"T_40a04_level0_col9\" class=\"col_heading level0 col9\" >chisq_ztf</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th id=\"T_40a04_level0_row0\" class=\"row_heading level0 row0\" >848201300014047</th>\n      <td id=\"T_40a04_row0_col0\" class=\"data row0 col0\" >848201300014047</td>\n      <td id=\"T_40a04_row0_col1\" class=\"data row0 col1\" >2</td>\n      <td id=\"T_40a04_row0_col2\" class=\"data row0 col2\" >270.404602</td>\n      <td id=\"T_40a04_row0_col3\" class=\"data row0 col3\" >65.946106</td>\n      <td id=\"T_40a04_row0_col4\" class=\"data row0 col4\" ><table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>hmjd</th>\n      <th>mag</th>\n      <th>magerr</th>\n      <th>clrcoeff</th>\n      <th>catflags</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>58226.44889</td>\n      <td>21.158422</td>\n      <td>0.242976</td>\n      <td>0.094843</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <td><i>+147 rows</i></td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n  </tbody>\n</table></td>\n      <td id=\"T_40a04_row0_col5\" class=\"data row0 col5\" >2</td>\n      <td id=\"T_40a04_row0_col6\" class=\"data row0 col6\" >zr</td>\n      <td id=\"T_40a04_row0_col7\" class=\"data row0 col7\" >0.110000</td>\n      <td id=\"T_40a04_row0_col8\" class=\"data row0 col8\" >0.923869</td>\n      <td id=\"T_40a04_row0_col9\" class=\"data row0 col9\" >27.873291</td>\n    </tr>\n    <tr>\n      <th id=\"T_40a04_level0_row1\" class=\"row_heading level0 row1\" >848102400023608</th>\n      <td id=\"T_40a04_row1_col0\" class=\"data row1 col0\" >848102400023608</td>\n      <td id=\"T_40a04_row1_col1\" class=\"data row1 col1\" >1</td>\n      <td id=\"T_40a04_row1_col2\" class=\"data row1 col2\" >268.827881</td>\n      <td id=\"T_40a04_row1_col3\" class=\"data row1 col3\" >66.326439</td>\n      <td id=\"T_40a04_row1_col4\" class=\"data row1 col4\" ><table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>hmjd</th>\n      <th>mag</th>\n      <th>magerr</th>\n      <th>clrcoeff</th>\n      <th>catflags</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>58207.39283</td>\n      <td>18.013729</td>\n      <td>0.028822</td>\n      <td>-0.077841</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <td><i>+53 rows</i></td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n  </tbody>\n</table></td>\n      <td id=\"T_40a04_row1_col5\" class=\"data row1 col5\" >1</td>\n      <td id=\"T_40a04_row1_col6\" class=\"data row1 col6\" >zg</td>\n      <td id=\"T_40a04_row1_col7\" class=\"data row1 col7\" >1.000000</td>\n      <td id=\"T_40a04_row1_col8\" class=\"data row1 col8\" >0.844652</td>\n      <td id=\"T_40a04_row1_col9\" class=\"data row1 col9\" >19.543127</td>\n    </tr>\n    <tr>\n      <th id=\"T_40a04_level0_row2\" class=\"row_heading level0 row2\" >848202400038072</th>\n      <td id=\"T_40a04_row2_col0\" class=\"data row2 col0\" >848202400038072</td>\n      <td id=\"T_40a04_row2_col1\" class=\"data row2 col1\" >2</td>\n      <td id=\"T_40a04_row2_col2\" class=\"data row2 col2\" >268.830200</td>\n      <td id=\"T_40a04_row2_col3\" class=\"data row2 col3\" >66.324913</td>\n      <td id=\"T_40a04_row2_col4\" class=\"data row2 col4\" ><table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>hmjd</th>\n      <th>mag</th>\n      <th>magerr</th>\n      <th>clrcoeff</th>\n      <th>catflags</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>58198.36545</td>\n      <td>17.170887</td>\n      <td>0.016645</td>\n      <td>0.067037</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <td><i>+129 rows</i></td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n  </tbody>\n</table></td>\n      <td id=\"T_40a04_row2_col5\" class=\"data row2 col5\" >2</td>\n      <td id=\"T_40a04_row2_col6\" class=\"data row2 col6\" >zr</td>\n      <td id=\"T_40a04_row2_col7\" class=\"data row2 col7\" >0.960000</td>\n      <td id=\"T_40a04_row2_col8\" class=\"data row2 col8\" >0.765504</td>\n      <td id=\"T_40a04_row2_col9\" class=\"data row2 col9\" >17.694681</td>\n    </tr>\n  </tbody>\n</table>\n3 rows x 10 columns","content_type":"text/html"}}},"key":"jPKy9GhYT2"}],"key":"aYn0QAHBEW"}],"key":"huVNWMWXDm"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":578,"column":1},"end":{"line":580,"column":1}},"children":[{"type":"text","value":"Now we can finally plot the light curves of these variable galaxy candidates.\nWe need to filter out bad epochs using the ","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"key":"suM7phqLnV"},{"type":"inlineCode","value":"catflags","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"key":"aLUM9j8qaK"},{"type":"text","value":" column as explained in the ","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"key":"hAEmycONzM"},{"type":"link","url":"https://irsa.ipac.caltech.edu/data/ZTF/docs/ztf_explanatory_supplement.pdf","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"children":[{"type":"text","value":"ZTF DR23 explanatory supplement","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"key":"ZgSj2C1v4v"}],"urlSource":"https://irsa.ipac.caltech.edu/data/ZTF/docs/ztf_explanatory_supplement.pdf","key":"LAp9C8Bk53"},{"type":"text","value":" section 13.6.\nThen, we will plot the light curves in separate panels for each object:","position":{"start":{"line":578,"column":1},"end":{"line":578,"column":1}},"key":"Ba185pru81"}],"key":"I8MSW2lkUF"}],"key":"mnKYMAmL0p"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axs = plt.subplots(len(merged_ztf_lcs_df), 1, figsize=(10, 4 * len(merged_ztf_lcs_df)), constrained_layout=True)\n\nif len(merged_ztf_lcs_df) == 1:\n    axs = [axs]\n\nfor ax, (_, row) in zip(axs, merged_ztf_lcs_df.iterrows()):\n    lc = row['lightcurve'].query(\"catflags == 0\")  # remove bad epochs\n    lc_label = (f'ZTF DR23 Object {row[\"objectid\"]} in band {row[\"filtercode_ztf\"][1]}\\n'\n                f'(z={row[\"phz_phz_median_euclid\"]:.2f}, RMS mag={row[\"magrms_ztf\"]:.3f}, Chi-sq={row[\"chisq_ztf\"]:.3f})')\n    pts = ax.plot(lc['hmjd'], lc['mag'], '.', markersize=4, label=lc_label, zorder=3)\n    ax.errorbar(\n        lc['hmjd'], lc['mag'], yerr=lc['magerr'],\n        fmt='none', ecolor=pts[0].get_color(), elinewidth=0.8, capsize=0, alpha=0.3, zorder=2\n    )\n    ax.set_ylabel('Magnitude')\n    ax.set_xlabel('HMJD')\n    ax.invert_yaxis()\n    ax.set_title(lc_label, fontsize=10)\n\nfig.suptitle(\"Lightcurves of Variable Galaxy Candidates\", fontsize=14, y=1.02)\nfig.set_constrained_layout_pads(h_pad=0.15)\nplt.show()","key":"mPfNxR0u6N"},{"type":"outputs","id":"qh1yXN8O7WvaIR1AfhRwW","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1000x1200 with 3 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"8055474477c87033c7deb9b9e7d965d7","path":"/irsa-tutorials/build/8055474477c87033c7deb9b9e7d965d7.png"}}},"key":"mdo4raNmS8"}],"key":"lhBE6MH2lj"}],"key":"cr0kILWJwz"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":607,"column":1},"end":{"line":607,"column":1}},"children":[{"type":"text","value":"About this notebook","position":{"start":{"line":607,"column":1},"end":{"line":607,"column":1}},"key":"bQOPpdzNFq"}],"identifier":"about-this-notebook","label":"About this notebook","html_id":"about-this-notebook","implicit":true,"key":"YnCGLm30cz"},{"type":"paragraph","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"children":[{"type":"text","value":"Author: Jaladh Singhal, Troy Raen, Jessica Krick, Brigitta Sipőcz, Vandana Desai, and the IRSA Data Science Team","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"szMsuHYqOZ"}],"key":"ZFClEKyK4t"},{"type":"paragraph","position":{"start":{"line":611,"column":1},"end":{"line":611,"column":1}},"children":[{"type":"text","value":"Updated: 2025-10-02","position":{"start":{"line":611,"column":1},"end":{"line":611,"column":1}},"key":"AjFhnq70oL"}],"key":"hyZjkeNAOj"},{"type":"paragraph","position":{"start":{"line":613,"column":1},"end":{"line":613,"column":1}},"children":[{"type":"text","value":"Contact: the ","position":{"start":{"line":613,"column":1},"end":{"line":613,"column":1}},"key":"tAixK20Asu"},{"type":"link","url":"https://irsa.ipac.caltech.edu/docs/help_desk.html","position":{"start":{"line":613,"column":1},"end":{"line":613,"column":1}},"children":[{"type":"text","value":"IRSA Helpdesk","position":{"start":{"line":613,"column":1},"end":{"line":613,"column":1}},"key":"tQJ2Iu6F1i"}],"urlSource":"https://irsa.ipac.caltech.edu/docs/help_desk.html","key":"oA1j2mzdvn"},{"type":"text","value":" with questions or to report problems.","position":{"start":{"line":613,"column":1},"end":{"line":613,"column":1}},"key":"z3VsVt4XQI"}],"key":"kg7bx2dRDh"}],"key":"YmAsqnxflg"}],"key":"I137mZCZ7v"},"references":{"cite":{"order":["Coughlin_2021"],"data":{"Coughlin_2021":{"label":"Coughlin_2021","enumerator":"1","doi":"10.1093/mnras/stab1502","html":"Coughlin, M. W., Burdge, K., Duev, D. A., Katz, M. L., van Roestel, J., Drake, A., Graham, M. J., Hillenbrand, L., Mahabal, A. A., Masci, F. J., Mróz, P., Prince, T. A., Yao, Y., Bellm, E. C., Burruss, R., Dekany, R., Jaodand, A., Kaplan, D. L., Kupfer, T., … Zolkower, J. (2021). The ZTF Source Classification Project – II. Periodicity and variability processing metrics. <i>Monthly Notices of the Royal Astronomical Society</i>, <i>505</i>(2), 2954–2965. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1093/mnras/stab1502\">10.1093/mnras/stab1502</a>","url":"https://doi.org/10.1093/mnras/stab1502"}}}},"footer":{"navigation":{"prev":{"title":"IRSA cloud access introduction","short_title":"Cloud Access","url":"/cloud-access-intro","group":"COSMOS"},"next":{"title":"Using Firefly visualization tools in Python to vet SEDs","short_title":"SED visualization","url":"/seds-in-firefly","group":"COSMOS"}}},"domain":"http://localhost:3000"}