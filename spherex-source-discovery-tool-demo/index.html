<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>SPHEREx Source Discovery Tool IRSA Demo - IRSA Tutorials</title><meta property="og:title" content="SPHEREx Source Discovery Tool IRSA Demo - IRSA Tutorials"/><meta name="generator" content="mystmd"/><meta name="description" content="IRSA Python Notebook tutorials to demostrate accessing data served by the NASA/IPAC Infrared Science Archive (IRSA)"/><meta property="og:description" content="IRSA Python Notebook tutorials to demostrate accessing data served by the NASA/IPAC Infrared Science Archive (IRSA)"/><meta name="keywords" content="astronomy"/><link rel="stylesheet" href="/irsa-tutorials/build/_assets/app-2K3KGISG.css"/><link rel="stylesheet" href="/irsa-tutorials/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/irsa-tutorials/favicon.ico"/><link rel="stylesheet" href="/irsa-tutorials/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100%;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-full top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center justify-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100 w-10 h-10"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/irsa-tutorials/"><div class="myst-home-link-logo mr-3 flex items-center dark:bg-white dark:rounded px-1"><img src="/irsa-tutorials/build/irsa_logo-de8969c6aec11b4451b997fa3bc3f181.png" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 dark:text-gray-300 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-10 h-10 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-full xl:pointer-events-none overflow-auto max-xl:w-[75vw] max-xl:max-w-[350px] max-xl:!top-0 max-xl:h-screen hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden max-xl:h-full hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity lg:hidden ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="IRSA Tutorials" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/irsa-tutorials/">IRSA Tutorials</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="SPHEREx Tutorial Notebooks" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/irsa-tutorials/spherex">SPHEREx</a><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Euclid Tutorial Notebooks" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/irsa-tutorials/euclid">Euclid</a><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rupsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rupsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="WISE Tutorial Notebooks" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/irsa-tutorials/wise">WISE</a><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Spitzer" class="block break-words rounded py-2 grow cursor-pointer">Spitzer</div><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2MASS" class="block break-words rounded py-2 grow cursor-pointer">2MASS</div><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1mpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1mpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="COSMOS" class="block break-words rounded py-2 grow cursor-pointer">COSMOS</div><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1upsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1upsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Simulated Data Tutorial Notebooks" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/irsa-tutorials/simulated">Simulated Data</a><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R26psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R26psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Techniques &amp; Tools Tutorial Notebooks" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/irsa-tutorials/techniques">Techniques &amp; Tools</a><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R2epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R2epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0 ml-3 xl:ml-0 mr-3 max-w-[350px]"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="myst-fm-block-subject flex-none pr-2 smallcaps">IRSA Tutorials</div><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/Caltech-IPAC/irsa-tutorials/blob/main/LICENSE" target="_blank" rel="noopener noreferrer" title="Content License: BSD 3-Clause &quot;New&quot; or &quot;Revised&quot; License (BSD-3-Clause)" class="myst-fm-license-badge text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-license-icon myst-fm-license-icon-osi mx-1 inline-block opacity-60 hover:opacity-100 hover:text-[#599F46] myst-fm-license-content"><path d="M13.2 15.6c1.4-.5 2.1-1.6 2.1-3.3S13.8 8.9 12 8.9c-1.9 0-3.3 1.6-3.3 3.3 0 1.8.8 3 2.2 3.4l-2.3 5.9c-3.1-.8-6.3-4.6-6.3-9.3 0-5.5 4.3-10 9.7-10s9.8 4.5 9.8 10c0 4.7-3.1 8.5-6.3 9.3l-2.3-5.9z"></path></svg></a><a href="https://github.com/Caltech-IPAC/irsa-tutorials/" title="GitHub Repository: Caltech-IPAC/irsa-tutorials/" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/Caltech-IPAC/irsa-tutorials//edit/main/tutorials/spherex/spherex_source_discovery/spherex_source_discovery_tool_demo.md" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div><button class="myst-fm-launch-button inline-flex size-[24px] hover:text-[#E18435] items-center justify-center" aria-label="Launch in external computing interface" title="Launch in external computing interface" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:Re8ucp:" data-state="closed"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" class="myst-fm-launch-icon"><path d="M6.85357 3.85355L7.65355 3.05353C8.2981 2.40901 9.42858 1.96172 10.552 1.80125C11.1056 1.72217 11.6291 1.71725 12.0564 1.78124C12.4987 1.84748 12.7698 1.97696 12.8965 2.10357C13.0231 2.23018 13.1526 2.50125 13.2188 2.94357C13.2828 3.37086 13.2779 3.89439 13.1988 4.44801C13.0383 5.57139 12.591 6.70188 11.9464 7.34645L7.49999 11.7929L6.35354 10.6465C6.15827 10.4512 5.84169 10.4512 5.64643 10.6465C5.45117 10.8417 5.45117 11.1583 5.64643 11.3536L7.14644 12.8536C7.34171 13.0488 7.65829 13.0488 7.85355 12.8536L8.40073 12.3064L9.57124 14.2572C9.65046 14.3893 9.78608 14.4774 9.9389 14.4963C10.0917 14.5151 10.2447 14.4624 10.3535 14.3536L12.3535 12.3536C12.4648 12.2423 12.5172 12.0851 12.495 11.9293L12.0303 8.67679L12.6536 8.05355C13.509 7.19808 14.0117 5.82855 14.1887 4.58943C14.2784 3.9618 14.2891 3.33847 14.2078 2.79546C14.1287 2.26748 13.9519 1.74482 13.6035 1.39645C13.2552 1.04809 12.7325 0.871332 12.2045 0.792264C11.6615 0.710945 11.0382 0.721644 10.4105 0.8113C9.17143 0.988306 7.80189 1.491 6.94644 2.34642L6.32322 2.96968L3.07071 2.50504C2.91492 2.48278 2.75773 2.53517 2.64645 2.64646L0.646451 4.64645C0.537579 4.75533 0.484938 4.90829 0.50375 5.0611C0.522563 5.21391 0.61073 5.34954 0.742757 5.42876L2.69364 6.59928L2.14646 7.14645C2.0527 7.24022 2.00002 7.3674 2.00002 7.50001C2.00002 7.63261 2.0527 7.75979 2.14646 7.85356L3.64647 9.35356C3.84173 9.54883 4.15831 9.54883 4.35357 9.35356C4.54884 9.1583 4.54884 8.84172 4.35357 8.64646L3.20712 7.50001L3.85357 6.85356L6.85357 3.85355ZM10.0993 13.1936L9.12959 11.5775L11.1464 9.56067L11.4697 11.8232L10.0993 13.1936ZM3.42251 5.87041L5.43935 3.85356L3.17678 3.53034L1.80638 4.90074L3.42251 5.87041ZM2.35356 10.3535C2.54882 10.1583 2.54882 9.8417 2.35356 9.64644C2.1583 9.45118 1.84171 9.45118 1.64645 9.64644L0.646451 10.6464C0.451188 10.8417 0.451188 11.1583 0.646451 11.3535C0.841713 11.5488 1.1583 11.5488 1.35356 11.3535L2.35356 10.3535ZM3.85358 11.8536C4.04884 11.6583 4.04885 11.3417 3.85359 11.1465C3.65833 10.9512 3.34175 10.9512 3.14648 11.1465L1.14645 13.1464C0.95119 13.3417 0.951187 13.6583 1.14645 13.8535C1.34171 14.0488 1.65829 14.0488 1.85355 13.8536L3.85358 11.8536ZM5.35356 13.3535C5.54882 13.1583 5.54882 12.8417 5.35356 12.6464C5.1583 12.4512 4.84171 12.4512 4.64645 12.6464L3.64645 13.6464C3.45119 13.8417 3.45119 14.1583 3.64645 14.3535C3.84171 14.5488 4.1583 14.5488 4.35356 14.3535L5.35356 13.3535ZM9.49997 6.74881C10.1897 6.74881 10.7488 6.1897 10.7488 5.5C10.7488 4.8103 10.1897 4.25118 9.49997 4.25118C8.81026 4.25118 8.25115 4.8103 8.25115 5.5C8.25115 6.1897 8.81026 6.74881 9.49997 6.74881Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg></button></div><h1 class="myst-fm-block-title mb-0">SPHEREx Source Discovery Tool IRSA Demo</h1><header class="myst-fm-authors-affiliations mt-4 not-prose"><div class="myst-fm-authors-list"><span class="myst-fm-author font-semibold text-sm myst-fm-author-item inline-block"><button class="myst-fm-author-popover focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R78ucp:" data-state="closed"><span class="myst-fm-author-name">IRSA Scientists and Developers</span></button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div class="myst-jp-nb-toolbar sticky top-[60px] pb-[14px] flex justify-end w-full z-20 pointer-events-none"><div class="myst-jp-nb-toolbar-inner flex p-1 m-1 space-x-1 border rounded-full shadow pointer-events-auto border-stone-300 bg-white/80 dark:bg-stone-900/80 backdrop-blur"><div class="myst-jp-nb-toolbar-power rounded"><button class="myst-jp-nb-toolbar-power-btn flex text-center rounded-full cursor-pointer text-stone-800 dark:text-white hover:opacity-100 opacity-60" aria-label="start compute environment"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="inline-block w-6 h-6 align-top"><title>Launch kernel</title><path stroke-linecap="round" stroke-linejoin="round" d="M5.636 5.636a9 9 0 1 0 12.728 0M12 3v9"></path></svg></button></div></div></div><div id="skip-to-article"></div><p>The SPHEREx Source Discovery Tool is the Python package <code>spherex_source_discovery_tool</code> (included in this directory), which is used to discover and extract sources from SPHEREx Spectral Images and visualize their spectra.
This notebook demonstrates how to use it.</p><h2 id="id-1-learning-goals" class="relative group"><span class="heading-text">1. Learning Goals</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-learning-goals" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><ul><li><p>Search and download SPHEREx images</p></li><li><p>Implement a simple image subtraction to find red sources in the SPHEREx images</p></li><li><p>Visualize images and catalog data in <em>Firefly</em> as well as interactive <em>bokeh</em> plots.</p></li><li><p>Select sources interactively and extract their SPHEREx spectra</p></li></ul><h2 id="id-2-spherex-overview" class="relative group"><span class="heading-text">2. SPHEREx Overview</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-spherex-overview" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>SPHEREx is a NASA Astrophysics Medium Explorer mission that launched in March 2025.
During its planned two-year mission, SPHEREx will obtain 0.75-5 micron spectroscopy over the entire sky, with deeper data in the SPHEREx Deep Fields.
SPHEREx data will be used to:</p><ul><li><p><strong>constrain the physics of inflation</strong> by measuring its imprints on the three-dimensional large-scale distribution of matter,</p></li><li><p><strong>trace the history of galactic light production</strong> through a deep multi-band measurement of large-scale clustering,</p></li><li><p><strong>investigate the abundance and composition of water and biogenic ices</strong> in the early phases of star and planetary disk formation.</p></li></ul><p>The community will also mine SPHEREx data and combine it with synergistic data sets to address a variety of additional topics in astrophysics.</p><p>More information is available in the <a target="_blank" rel="noreferrer" href="https://irsa.ipac.caltech.edu/data/SPHEREx/docs/SPHEREx_Expsupp_QR.pdf" class="link whitespace-nowrap"><span class="link-text whitespace-normal">SPHEREx Explanatory Supplement</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a>.</p><h2 id="id-3-requirements" class="relative group"><span class="heading-text">3. Requirements</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-requirements" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><h3 id="id-3-1-on-local-machines" class="relative group"><span class="heading-text">3.1 On local machines</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-1-on-local-machines" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>All necessary packages and tools (e.g., <code>SExtractor</code>) are listed in the <code>conda-spherex_sdt.yml</code> file.</p><p>To create a conda environment with the dependencies on your local machine use:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">conda env create --file conda-spherex_sdt.yml</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Then, make the environment available in the list of kernels for your JupyterLab:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">conda activate spherex_sdt
python -m ipykernel install --user --name=spherex_sdt</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>To use the environment in your Jupyter notebooks, either start JupyterLab in that environment by typing</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">conda activate spherex_sdt
jupyter-lab</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>or select the environment <code>spherex_sdt</code> in your Jupyter Notebook using the dropdown on the upper left.</p><h3 id="id-3-2-on-fornax" class="relative group"><span class="heading-text">3.2 On Fornax</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-2-on-fornax" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Installing the conda environment on the <a target="_blank" rel="noreferrer" href="https://science.nasa.gov/astrophysics/programs/physics-of-the-cosmos/community/the-fornax-initiative/" class="link whitespace-nowrap"><span class="link-text whitespace-normal">NASA Fornax Science Console</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a> needs slightly different steps. These can be reviewed in the documentation <a target="_blank" rel="noreferrer" href="https://docs.fornax.sciencecloud.nasa.gov/compute-environments/#create-new-env" class="link whitespace-nowrap"><span class="link-text whitespace-normal">create a new environment</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a>.</p><p>In order to install this specific conda environment on Fornax, the file name of the <code>yml</code> file specifically needs to be in the format <code>conda-*.yml</code>. The <code>yml</code> file distributed here is already provided in that format (<code>conda-spherex_sdt.yml</code>). Once this is set, open a new terminal (click on the large “+” button right under the “File” menu tab) and type to following command <em>inside</em> the same directory where the <code>yml</code> file is located:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">setup-conda-env --user</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Note that we use the <code>--user</code> option here, which will keep the environment available for subsequent Fornax sessions.</p><p>To use the environment in your Jupyter notebooks on Fornax, directly select the environment <code>spherex_sdt</code> in your Jupyter Notebook using the dropdown on the upper left.</p><h2 id="id-4-imports" class="relative group"><span class="heading-text">4. Imports</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-imports" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><div id="VAeZ11kXQM" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Standard library imports
import concurrent.futures
import copy
import json
import os
import io
import pickle
import time
from concurrent.futures import as_completed

# Related 3rd-party imports
import numpy as np
import pyvo
import sep
import astropy.units as u
from astropy.coordinates import SkyCoord
from astropy.io import fits
from astropy.nddata import Cutout2D
from astropy.table import Table
from astropy.units import Unit
from astropy.wcs import WCS
from astroquery.ipac.irsa import Irsa
from bokeh.io import output_notebook
from bokeh.resources import INLINE
from firefly_client import FireflyClient
from reproject import reproject_exact, reproject_interp

# Local application imports
from spherex_source_discovery_tool.aperture_photometry import build_phot_table, grab_star
from spherex_source_discovery_tool.bokeh_viz import (
    plot_apertures, plot_spectrum, plot_subtracted_trio, plot_overlap_trio)
from spherex_source_discovery_tool.firefly_viz import preview_query
from spherex_source_discovery_tool.sdt_utils import (
    format_extracted, get_filename, get_exp_id, get_obs_id, results_summary, get_lambda_range)
from spherex_source_discovery_tool.source_extraction import run_sextractor, get_sextractor_file</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Aopu9N2UhPYditZkEAC9p" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="usfVUVitO4" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Suppress logging temporarily to prevent astropy
# from repeatedly printing out warning notices related to alternate WCSs
import logging
logging.getLogger(&#x27;astropy&#x27;).setLevel(logging.ERROR)

# The time it takes to read SPHEREx files can exceed
# astropy&#x27;s default timeout limit. Increase it.
from astropy.utils.data import conf
conf.remote_timeout = 120

# For interactive bokeh visualizations
output_notebook(resources=INLINE)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="d5mWV7TjRQjb_DV8PcyFL" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-5-initialize-ephemeral-query-parameters" class="relative group"><span class="heading-text">5. Initialize Ephemeral Query Parameters</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-5-initialize-ephemeral-query-parameters" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><aside class="myst-admonition myst-admonition-attention my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path stroke-linecap="round" stroke-linejoin="round" d="M10.34 15.84c-.688-.06-1.386-.09-2.09-.09H7.5a4.5 4.5 0 1 1 0-9h.75c.704 0 1.402-.03 2.09-.09m0 9.18c.253.962.584 1.892.985 2.783.247.55.06 1.21-.463 1.511l-.657.38c-.551.318-1.26.117-1.527-.461a20.845 20.845 0 0 1-1.44-4.282m3.102.069a18.03 18.03 0 0 1-.59-4.59c0-1.586.205-3.124.59-4.59m0 9.18a23.848 23.848 0 0 1 8.835 2.535M10.34 6.66a23.847 23.847 0 0 0 8.835-2.535m0 0A23.74 23.74 0 0 0 18.795 3m.38 1.125a23.91 23.91 0 0 1 1.014 5.395m-1.014 8.855c-.118.38-.245.754-.38 1.125m.38-1.125a23.91 23.91 0 0 0 1.014-5.395m0-3.46c.495.413.811 1.035.811 1.73 0 .695-.316 1.317-.811 1.73m0-3.46a24.347 24.347 0 0 1 0 3.46"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Attention</div></div><div class="myst-admonition-body px-4 py-1"><p>The query parameters below are valid as of <strong>February 2026</strong>, but will need to be updated as the mission proceeds.
Specifically, the ephemeral query parameters <em>will</em> change for future SPHEREx data releases.</p></div></aside><div id="s0kag0mGII" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># General
data_release = &quot;qr2&quot;

# Spectral image queries
sia_collection = f&quot;spherex_{data_release}&quot;

# Solid angle pixel map queries
dataset_type=&quot;solid_angle_pixel_map&quot;
sapm_collection = &quot;cal-sapm-v2-2025-164&quot;
sapm_s3 = [
    f&quot;nasa-irsa-spherex/{data_release}/{dataset_type}/{sapm_collection}/{k}/&quot;\
    f&quot;{dataset_type}_D{k}_spx_{sapm_collection}.fits&quot; for k in range(1, 7)
]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="ApRgSOPGvS__R6IgAmJEW" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-6-search-for-spherex-spectral-images" class="relative group"><span class="heading-text">6. Search for SPHEREx Spectral Images</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-6-search-for-spherex-spectral-images" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We search first search for all the available SPHEREx images around a given position on the sky.</p><p>Here, we choose the random position at R.A. = 150.7817877 degrees and Decl. = 3.3502204 degrees, which is close to the COSMOS field. We also choose a search radius of 50 arc-seconds.</p><div id="kJZ7sS2Tmx" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">coord = SkyCoord(150.7817877, 3.3502204, unit=&#x27;deg&#x27;)
search_radius = 50 * u.arcsec</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="1qwHxjE8XcwtExwhsmtDG" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>We then search for the SPHEREx spectral images that overlap with the position in the search radius defined above.
For this we use the <a target="_blank" rel="noreferrer" href="https://astroquery.readthedocs.io/en/latest/ipac/irsa/irsa.html" class="link whitespace-nowrap"><span class="link-text whitespace-normal">IRSA module in astroquery</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a> and the Simple Image Access (SIA) API.</p><div id="ji147no2tg" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">results = Irsa.query_sia(pos=(coord, search_radius), collection=sia_collection)
results_summary(results)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="xDfvwXZuVBr2cWwGstdiH" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Note that we have used the collection <code>spherex_qr2</code> in this case. All the available collections are documented at <a target="_blank" rel="noreferrer" href="https://caltech-ipac.github.io/spherex-archive-documentation/spherex-data-access#application-program-interfaces-apis" class="link whitespace-nowrap"><span class="link-text whitespace-normal">SPHEREx Data Access: Application Program Interfaces (APIs)</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a>.</p><aside class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Tip</div></div><div class="myst-admonition-body px-4 py-1"><p>The IRSA SIA collections can be listed using using the <code>list_collections</code> method, we can filter on the ones containing “spherex” in the collection name:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">Irsa.list_collections(filter=&#x27;spherex&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></div></aside><p>Next, we set up the <em>Firefly</em> client and use it to visualize one image with the search coordinates (and search radius) indicated.</p><p>There are two ways to run <em>Firefly</em> from the JupyterLab environment:</p><ul><li><p>Open it in another browser tab</p></li><li><p>Open it in another Jupyter Notebook tab</p></li></ul><p>The second option requires setting some environment variables and installing the <em>Firefly</em> JupyterLab extension. See <a href="https://github.com/Caltech-IPAC/jupyter_firefly_extensions/blob/master/README.md" class="hover-link" target="_blank" rel="noreferrer" data-state="closed">here</a> for more information on how to do that.
More information can be found in the <a target="_blank" rel="noreferrer" href="https://caltech-ipac.github.io/firefly_client/usage/" class="link whitespace-nowrap"><span class="link-text whitespace-normal"><em>Firefly</em> documentation</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a>.</p><aside class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Tip</div></div><div class="myst-admonition-body px-4 py-1"><p>If you open <em>Firefly</em> in a new Jupyter Notebook tab, you can drag the <em>Firefly</em> tab to the right to enable split view. That way you can see the <em>Firefly</em> window next to this notebook, which makes it more convenient for visualization.</p></div></aside><p>Below, we give the two options to open <em>Firefly</em>.</p><div id="nJEapYekd4" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Set up Firefly client to open in a new browser tab
#fc = FireflyClient.make_client(url=&quot;https://irsa.ipac.caltech.edu/irsaviewer&quot;)

# Set up Firefly client to open in new JupyterLab tab
fc = FireflyClient.make_lab_client()

# Initiate Firefly
fc.reinit_viewer()

# Show image
preview_query(fc, results[&#x27;access_url&#x27;][0], coord, search_radius)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="zNN79Izr0bl_0jjIbj32V" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Now, we select two images, one each in Detector 2 (D2) and Detector (D4). For simplicity, we just select the first image in Detector 2 and the first in Detector 4.
Detector 2 covers 1.10 - 1.62 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">\mu</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">μ</span></span></span></span></span>m and Detector 4 covers 2.42 - 3.82 <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">\mu</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">μ</span></span></span></span></span>m.</p><p>We can use two different methods to obtain the images:</p><ul><li><p>using a boolean mask selecting <code>energy_bandpassname</code> as “SPHEREx_D2”</p></li><li><p>using the <code>astropy.table.TableGroups</code></p></li></ul><p>We show both methods below, the first one for the detector 2 spectral image and the second one for the detector 4 spectral image.</p><div id="dVv85CFJR7" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Using a boolean mask
d2_result = results[results[&#x27;energy_bandpassname&#x27;] == &#x27;SPHEREx-D2&#x27;][0]  # first D2 image

# Using `astropy.table.TableGroups`
results_by_detector = results.group_by(&#x27;energy_bandpassname&#x27;)
print(results_by_detector.groups.keys)
d4_result = results_by_detector.groups[3][0]  # first D4 image</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="l7qQC5B0c4cZLVaSWs2mj" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-7-load-the-data" class="relative group"><span class="heading-text">7. Load the Data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-7-load-the-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Next, we download the two SPHEREx spectral images. We download them directly from the cloud.</p><p>For this, we first define a handy function to obtain the S3 cloud path.</p><div id="hQ8864x87I" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Function to access data from cloud
def get_s3_fpath(cloud_access):
    cloud_info = json.loads(cloud_access) # converts str to dict
    bucket_name = cloud_info[&#x27;aws&#x27;][&#x27;bucket_name&#x27;]
    key = cloud_info[&#x27;aws&#x27;][&#x27;key&#x27;]
    return f&#x27;{bucket_name}/{key}&#x27;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="elvMOt3z1M18Lulr-hi8t" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Next we download the images.</p><div id="IosdZNXNGu" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># HDUs for D2 image
s3_fpath_d2 = get_s3_fpath(d2_result[&#x27;cloud_access&#x27;])
with fits.open(f&#x27;s3://{s3_fpath_d2}&#x27;, fsspec_kwargs={&quot;anon&quot;: True}) as hdul2:
    img_hdu2 = hdul2[&quot;IMAGE&quot;].copy()
    img_data2 = hdul2[&quot;IMAGE&quot;].data
    img_hdr2 = hdul2[&quot;IMAGE&quot;].header
    flags_data2 = hdul2[&quot;FLAGS&quot;].data

# HDUs for D4 image
s3_fpath_d4 = get_s3_fpath(d4_result[&#x27;cloud_access&#x27;])
with fits.open(f&#x27;s3://{s3_fpath_d4}&#x27;, fsspec_kwargs={&quot;anon&quot;: True}) as hdul4:
    img_hdu4 = hdul4[&quot;IMAGE&quot;].copy()
    img_data4 = hdul4[&quot;IMAGE&quot;].data
    img_hdr4 = hdul4[&quot;IMAGE&quot;].header
    flags_data4 = hdul4[&quot;FLAGS&quot;].data</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="hkhy0uguzOE_MO4XlUHCl" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Note</div></div><div class="myst-admonition-body px-4 py-1"><p>If you want to download the SPHEREx spectral images from IPAC directly (not from the cloud), simply use instead, for example,</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">with fits.open(d2_result[&#x27;access_url&#x27;]) as hdul2:
    ...</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></div></aside><h2 id="id-8-remove-local-background-create-masks-and-reproject" class="relative group"><span class="heading-text">8. Remove Local Background, Create Masks, and Reproject</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-8-remove-local-background-create-masks-and-reproject" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Before we can subtract the images, we have to do some preprocessing. This includes:</p><ul><li><p>Converting from surface brightness to flux density units</p></li><li><p>Removing the background</p></li><li><p>Creating masks to mask out bad pixels</p></li><li><p>Reproject the images on a common pixel grid (necessary for pixel-by-pixel subtraction of images later)</p></li></ul><p>First, we convert from surface brightness to flux units using the solid angle pixel map for each detector. We download these calibrations from the cloud using the S3 paths hardcoded below. Then, we use <code>astropy.units</code> to convert the image data from MJy/sr to <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">\mu</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">μ</span></span></span></span></span>Jy/arcsec<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>. This quantity is multiplied by the solid angle pixel map in arcsec<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span> to get image data in units of <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">\mu</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">μ</span></span></span></span></span>Jy.</p><aside class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Tip</div></div><div class="myst-admonition-body px-4 py-1"><p>You can find more calibration products for the SPHEREx spectral images on the S3 bucket:
<a target="_blank" rel="noreferrer" href="https://nasa-irsa-spherex.s3.us-east-1.amazonaws.com/index.html" class="link whitespace-nowrap"><span class="link-text whitespace-normal">https://<wbr/>nasa<wbr/>-irsa<wbr/>-spherex<wbr/>.s3<wbr/>.us<wbr/>-east<wbr/>-1<wbr/>.amazonaws<wbr/>.com<wbr/>/index<wbr/>.html</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a></p></div></aside><div id="V3DFf9A6Sj" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">s3_fpath_sapm2 = sapm_s3[1] # list idx 1 is value for D2 path
with fits.open(f&#x27;s3://{s3_fpath_sapm2}&#x27;, fsspec_kwargs={&quot;anon&quot;: True}) as hdul_sapm2:
    sapm_data2 = hdul_sapm2[&quot;IMAGE&quot;].data
    sapm_hdr2 = hdul_sapm2[&quot;IMAGE&quot;].header

s3_fpath_sapm4 = sapm_s3[3] # list idx 3 is value for D4 path
with fits.open(f&quot;s3://{s3_fpath_sapm4}&quot;, fsspec_kwargs={&quot;anon&quot;: True}) as hdul_sapm4:
    sapm_data4 = hdul_sapm4[&quot;IMAGE&quot;].data
    sapm_hdr4 = hdul_sapm4[&quot;IMAGE&quot;].header</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="oT0dz31zqkMVHbR7LVn_9" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>After downloading the solid angle pixel map calibration products for each detector, we convert the images from brightness (MJy/sr) to spectral flux density (<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">\mu</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">μ</span></span></span></span></span>Jy) and update the corresponding units in the headers of the imates.</p><div id="GRgCCISCTb" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">print(f&quot;Spectral image BUNIT: {img_hdr2[&#x27;BUNIT&#x27;]}&quot;)
print(f&quot;Solid angle pixel map BUNIT: {sapm_hdr2[&#x27;BUNIT&#x27;]}&quot;)

img_data2 = ((img_data2 * Unit(img_hdr2[&quot;BUNIT&quot;])).to(u.uJy / u.arcsec**2) * (sapm_data2 * Unit(sapm_hdr2[&quot;BUNIT&quot;]))).value
img_hdu2.header[&quot;BUNIT&quot;] = &quot;uJy&quot;
img_hdr2[&quot;BUNIT&quot;] = &quot;uJy&quot;

img_data4 = ((img_data4 * Unit(img_hdr4[&quot;BUNIT&quot;])).to(u.uJy / u.arcsec**2) * (sapm_data4 * Unit(sapm_hdr4[&quot;BUNIT&quot;]))).value
img_hdu4.header[&quot;BUNIT&quot;] = &quot;uJy&quot;
img_hdr4[&quot;BUNIT&quot;] = &quot;uJy&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="fTdb01M6x-DFMxJlKv2wX" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Next, we remove the background from both images. We estimate the background using the <code>sep</code> Python package, which allows fitting a non-parametric background to an image in user-defined zones.</p><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Warning</div></div><div class="myst-admonition-body px-4 py-1"><p><code>sep</code> only support native byte order arrays. We therefore have to apply</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">img.astype(img.dtype.newbyteorder(&quot;=&quot;))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>before feeding it to <code>sep</code>.</p></div></aside><div id="i9s25LQFSb" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">bkg2 = sep.Background(img_data2.astype(img_data2.dtype.newbyteorder(&quot;=&quot;)), bw=64, bh=64, fw=11, fh=11)
img_data2 = img_data2 - bkg2

bkg4 = sep.Background(img_data4.astype(img_data4.dtype.newbyteorder(&quot;=&quot;)), bw=64, bh=64, fw=11, fh=11)
img_data4 = img_data4 - bkg4</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="VfQ4PDnRuNCcVfYK31RUN" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Next we create masks (which also need to be reprojected). The merged masks will be applied later to the difference image.
Note that flags <code>2097152</code> (which corresponds to <span class="">2<sup>21</sup></span>, so bit 21), is assigned to pixel which are not contaminated by image errors, transients, cosmic rays, etc.
Note that we ignore the <code>OVERFLOW</code> flag, which is coincident with the <code>SUR_ERROR</code> flag. See the <a target="_blank" rel="noreferrer" href="https://irsa.ipac.caltech.edu/onlinehelp/spherex/spherex/sp.html#explorebitflags" class="link whitespace-nowrap"><span class="link-text whitespace-normal">SPHEREx bitmask flag description</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a> for more information about the different flag bits.
We therefore choose these as good pixels and flag the other ones.
For simplicity, we set the bad pixels to <code>np.nan</code>.</p><div id="styztExfkY" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">mask2 = np.zeros(flags_data2.shape) * np.nan
mask2[(flags_data2 == 2097152) | (flags_data2 == 2) | (flags_data2 == 0)] = 1

mask4 = np.zeros(flags_data4.shape) * np.nan
mask4[(flags_data4 == 2097152) | (flags_data2 == 2) | (flags_data4 == 0)] = 1</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="JUesgUoZR9DTE0KIVlcSq" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Finally, we reproject the images and masks to the same pixel grid. We reproject D2 on D4. For this we use <code>reproject_exact()</code> (for flux conservation) and <code>reproject_interp()</code> (for mask) from the <em>reproject</em> Python package.</p><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Warning</div></div><div class="myst-admonition-body px-4 py-1"><ul><li><p><code>reproject_exact</code> conserves the total flux, but it takes slightly longer than non-exact methods. The cell below should take between 2-3 minutes to execute.</p></li><li><p>Due to the bilinear method applied in <code>reproject_interp</code>, single-pixel NaNs get conservatively extended into multi-pixel NaN regions.</p></li></ul></div></aside><div id="q5U6cBEysY" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">img_data2_reproj, footprint = reproject_exact(input_data=(img_data2, img_hdr2), output_projection=img_hdr4)
footprint[footprint == 0] = np.nan  # Set zero values to NaN
mask2_reproj, _ = reproject_interp(input_data=(mask2, img_hdr2), output_projection=img_hdr4)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="RHIrAR4Q9_J4CIFdvTbF5" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>We use <em>bokeh</em> to visualize the two detector images as well as the reprojected D4 image. See the file <code>spherex_source_discovery_tool/bokeh_viz.py</code> for more information on the used function <code>plot_overlap_trio()</code> to learn how to use <em>bokeh</em>.</p><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Warning</div></div><div class="myst-admonition-body px-4 py-1"><p>The initial bokeh plot has a ~20 second rendering penalty due to static asset loading. Subsequent bokeh plots should take less time to display.</p></div></aside><div id="iwrqZbXPJQ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Plot data
plot1_info = {
    &quot;img_data&quot;: img_data4,
    &quot;title&quot;: &quot;D4 Image&quot;,
    &quot;units&quot;: img_hdu4.header[&quot;BUNIT&quot;]
}
plot2_info = {
    &quot;img_data&quot;: img_data2_reproj * footprint,
    &quot;title&quot;: &quot;D2 Reprojected on D4&quot;,
    &quot;units&quot;: img_hdu2.header[&quot;BUNIT&quot;]
}
plot3_info = {
    &quot;img_data&quot;: img_data4 * footprint,
    &quot;title&quot;: &quot;D4 Image with D2 Footprint Mask&quot;,
    &quot;units&quot;: img_hdu4.header[&quot;BUNIT&quot;]
}

plot_overlap_trio(plot1_info, plot2_info, plot3_info, clip=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="7SzxvvA7ikqALZS7iaOQn" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-9-generate-cutouts-and-subtracted-color-image" class="relative group"><span class="heading-text">9. Generate Cutouts and Subtracted Color Image</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-9-generate-cutouts-and-subtracted-color-image" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>For this example, we only use parts of the image. For this, we first generate cutouts of the D4 image as well as the reprojected D2 image.</p><p>Next, we subtract the images. For keeping track of the wavelength and file names, we create two handy dictionaries.</p><p>Finally, we use <em>bokeh</em> to show interactive representation of the two images as well as the subtracted image <em>inside</em> this Jupyter Notebook.</p><div id="oknQ4Dolya" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Set up data directory and cutout paths
data_dir = &#x27;./data/&#x27;
if not os.path.exists(data_dir):
    os.mkdir(data_dir)

cut_path2 = os.path.join(data_dir , f&quot;cutout_{get_filename(d2_result[&#x27;access_url&#x27;])}&quot;)
cut_path4 = os.path.join(data_dir , f&quot;cutout_{get_filename(d4_result[&#x27;access_url&#x27;])}&quot;)

# Generate cutouts from input images
# NOTE: We use D4&#x27;s WCS for both cutouts since we reprojected
cut2 = Cutout2D(img_data2_reproj, position=coord, size=(150, 150), wcs=WCS(img_hdu4.header))
cut2_hdu = copy.deepcopy(img_hdu4)  # make copy to avoid modifying HDU of full-size image
cut2_hdu.data = cut2.data
cut2_hdu.header.update(cut2.wcs.to_header())
cut2_hdu.writeto(cut_path2, overwrite=True)
cut2_mask = Cutout2D(mask2_reproj, position=coord, size=(150, 150), wcs=WCS(img_hdu4.header))

cut4 = Cutout2D(img_data4*footprint, position=coord, size=(150, 150), wcs=WCS(img_hdu4.header))
cut4_hdu = copy.deepcopy(img_hdu4)  # make copy to avoid modifying HDU of full-size image
cut4_hdu.data = cut4.data
cut4_hdu.header.update(cut4.wcs.to_header())
cut4_hdu.writeto(cut_path4, overwrite=True)
cut4_mask = Cutout2D(mask4, position=coord, size=(150, 150), wcs=WCS(img_hdu4.header))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="pjnaFTUNDzvJ48PXjBFqD" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="kayt6Vhb8D" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">d2_range = get_lambda_range(d2_result)
d2_info = {
    &quot;img_data&quot;: cut2.data,
    &quot;title&quot;: rf&quot;{d2_range[0]:.2f}-{d2_range[1]:.2f} um (D2)&quot;,
    &quot;units&quot;: img_hdr2[&quot;BUNIT&quot;]
}

d4_range = get_lambda_range(d4_result)
d4_info = {
    &quot;img_data&quot;: cut4.data,
    &quot;title&quot;: rf&quot;{d4_range[0]:.2f}-{d4_range[1]:.2f} um (D4)&quot;,
    &quot;units&quot;: img_hdr4[&quot;BUNIT&quot;]
}

subtracted_info = {
    &quot;img_data&quot;: np.subtract(cut2.data, cut4.data),
    &quot;title&quot;: &quot;Subtracted (D2-D4)&quot;,
    &quot;units&quot;: img_hdr4[&quot;BUNIT&quot;]
}

subtracted_masked_info = {
    &quot;img_data&quot;: np.subtract(cut2.data, cut4.data) * cut2_mask.data * cut4_mask.data,
    &quot;title&quot;: &quot;Subtracted (D2-D4)&quot;,
    &quot;units&quot;: img_hdr4[&quot;BUNIT&quot;]
}

plot_subtracted_trio(d2_info, d4_info, subtracted_masked_info, clip=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="YAA6O0QT6-b6ieWgwSWON" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-10-run-sextractor-on-the-subtracted-color-image" class="relative group"><span class="heading-text">10. Run <code>SExtractor</code> on the Subtracted Color Image</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-10-run-sextractor-on-the-subtracted-color-image" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>A use case could be to search for red sources such as galaxies with an Active Galactic Nucleus (AGN), which are manifested by red mid-infrared colors. Such red sources can be identified on the subtracted image.</p><p>In the following, we run <a target="_blank" rel="noreferrer" href="https://sextractor.readthedocs.io/en/latest/Introduction.html" class="link whitespace-nowrap"><span class="link-text whitespace-normal"><code>SExtractor</code></span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a> on all the images (reprojected D2, D4, and subtracted image) to identify sources. Before that, however, we have to save the subtracted image to disk (note that the D2 and D4 cutouts are already saved to disk).</p><div id="TKSXAOKQXm" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Save subtracted image to fits file for source extraction
subtracted_cut_path = os.path.join(data_dir , f&quot;subtracted_{get_exp_id(img_hdu2)}_{get_exp_id(img_hdu4)}.fits&quot;)
sub_hdu = copy.deepcopy(cut2_hdu)  # make copy to avoid modifying original
sub_hdu.data = subtracted_info[&quot;img_data&quot;]
sub_hdu.writeto(subtracted_cut_path, overwrite=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="_bJaACX0Fve5z4O6slxec" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Now, we run <code>SExtractor</code>. This software needs a few parameter files such as a configuration and parameter files as well as some others (for example a convolution filter). These files are provided in the <code>spherex_source_discovery_tool</code> directory. For <code>SExtractor</code> to find them, we have to give it absolute path names to these files. We use <code>os.path.realpath()</code> in the following to translate relative paths to absolute paths.
Finally, we run <code>SExtractor</code> on the last lines.</p><div id="dhIuowCaQT" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">sxt_config = get_sextractor_file(&quot;default_sdt.sex&quot;, package=&quot;spherex_source_discovery_tool&quot;)
sxt_params = get_sextractor_file(&quot;default_sdt.param&quot;, package=&quot;spherex_source_discovery_tool&quot;)
sxt_nnw = get_sextractor_file(&quot;default.nnw&quot;, package=&quot;spherex_source_discovery_tool&quot;)
sxt_conv = get_sextractor_file(&quot;default.conv&quot;, package=&quot;spherex_source_discovery_tool&quot;)

subtracted_cat = os.path.realpath( os.path.join(data_dir , f&quot;subtracted_{get_exp_id(img_hdu2)}_{get_exp_id(img_hdu4)}.cat&quot;)) # need to use absolute path here!
d2_cat = os.path.realpath( os.path.join(data_dir , f&quot;{get_exp_id(img_hdu2)}.cat&quot;) ) # need to use absolute path here!
d4_cat = os.path.realpath( os.path.join(data_dir , f&quot;{get_exp_id(img_hdu4)}.cat&quot;) ) # need to use absolute path here!

run_sextractor(os.path.realpath(subtracted_cut_path), sxt_config, sxt_params, subtracted_cat, sxt_nnw, sxt_conv)
run_sextractor(os.path.realpath(cut_path2), sxt_config, sxt_params, d2_cat, sxt_nnw, sxt_conv)
run_sextractor(os.path.realpath(cut_path4), sxt_config, sxt_params, d4_cat, sxt_nnw, sxt_conv)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="nSAGewAgewM_LvjwBVklN" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-11-select-sources-interactively" class="relative group"><span class="heading-text">11. Select Sources Interactively</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-11-select-sources-interactively" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In the following, we show two ways to visualize the extracted sources on the images and how to interactively select interesting sources. (Note that you can always select the source automatically in Python using, for example, <code>astropy</code> tables instead of doing it interactively.)</p><p>First, we read in the <code>SExtractor</code> catalog. Note that we want to change <code>ALPHA_J2000</code> and <code>DELTA_J2000</code> to the more universal <code>ra</code> and <code>dec</code> column names. This is especially important for Firefly to be able to read the table out of the box and mark the source in the table on the images.</p><div id="S1DkwnVSPK" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">extracted = Table.read(subtracted_cat , format=&quot;ascii&quot;)
extracted.rename_column(&quot;ALPHA_J2000&quot;, &quot;ra&quot;)
extracted.rename_column(&quot;DELTA_J2000&quot;, &quot;dec&quot;)
extracted.sort(keys=&quot;NUMBER&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="bAcQMCbJ1vjlXkAGbrPPC" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-11-1-using-bokeh-visualizations" class="relative group"><span class="heading-text">11.1 Using <em>bokeh</em> visualizations</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-11-1-using-bokeh-visualizations" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>First, we demonstrate how we can use <em>bokeh</em> to create an interactive dashboard to select sources.</p><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Warning</div></div><div class="myst-admonition-body px-4 py-1"><p>Currently, <em>bokeh</em> tables cannot be displayed in Fornax. Therefore the example below will not work. The user is encouraged to use <em>Firefly</em>, which use is demonstrated in Section 10.2 below.</p></div></aside><div id="daqPfEgRJh" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">plot_apertures(subtracted_cut_path, source_tab=extracted, label=&quot;Extracted Sources&quot;, clip=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="22ZhyNK1VZ5O_SDbB7LmP" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Alternatively, the sources can be easily selected in Python itself by defining a selection function.</p><div id="Dnt6pqGhcF" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Create custom selection function
def select_sources(sxt_tab):
    &quot;&quot;&quot;Selects the 25 brightest sources from the SExtractor-generated catalog.

    Parameters
    ----------
    sxt_tab: astropy.table.Table
        Table of extracted sources, including named IDs and converted fluxes

    Returns
    -------
    bright_tab: astropy.table.Table
        Table of selected sources
    &quot;&quot;&quot;
    # Select bright sources (using automatic aperture flux for now)
    sxt_tab.sort(&quot;FLUX_AUTO&quot;, reverse=True)
    bright_tab = sxt_tab[0:25]

    return bright_tab

# Preview selected sources
selected = select_sources(extracted)
plot_apertures(subtracted_cut_path, source_tab=selected, label=&quot;25 Brightest Sources&quot;, clip=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Z0zSbvLOwATsrww_y7OWg" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-11-2-using-firefly-visualization" class="relative group"><span class="heading-text">11.2 Using <em>Firefly</em> visualization</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-11-2-using-firefly-visualization" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Alternatively to <em>bokeh</em>, we can use the <em>Firefly</em> application to show the image including the data table. First we reinitiate <em>Firefly</em>, which will again open a new tab called “Firefly Viewer”.
As mentioned above, we give again two options for initiating <em>Firefly</em>; in a new browser tab or a new JupterLab tab.</p><div id="YnmgtC4GBO" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Set up Firefly client in browser tab
#fc = FireflyClient.make_client(url=&quot;https://irsa.ipac.caltech.edu/irsaviewer&quot;)

# Set up Firefly client in new JupyterLab tab
fc = FireflyClient.make_lab_client()

fc.reinit_viewer()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="wFT_VTBTEdctyPql48KZA" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Then, we load the images and finally the catalog to the application. <em>Firefly</em> takes care of the rest!</p><aside class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Tip</div></div><div class="myst-admonition-body px-4 py-1"><p>We do not have to save the table to disk. Instead, we can use a “stream” and directly feed it to <em>Firefly</em>. We do this by using</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">io.BytesIO()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>For more tips and tricks on how to use <em>Firefly</em> in Python, we encourage reviewing the <a target="_blank" rel="noreferrer" href="https://caltech-ipac.github.io/firefly_client/usage/" class="link whitespace-nowrap"><span class="link-text whitespace-normal"><em>Firefly</em> manual webpage</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a>.</p></div></aside><aside class="myst-admonition myst-admonition-tip my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-green-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-green-600 bg-green-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-green-600"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Tip</div></div><div class="myst-admonition-body px-4 py-1"><p>You can align and lock the images by their WCS by adding</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">fc.align_images(lock_match=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></div></aside><div id="M02X8IiGCQ" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Load images
fc.show_fits_image(
        file_input=cut_path2,
        plot_id=&quot;D2&quot;,
        Title=&quot;Detector 2&quot;
    )
fc.show_fits_image(
        file_input=cut_path4,
        plot_id=&quot;D4&quot;,
        Title=&quot;Detector 4&quot;
    )
fc.show_fits_image(
        file_input=subtracted_cut_path,
        plot_id=&quot;subtracted&quot;,
        Title=&quot;Subtracted image&quot;
    )
fc.align_images(lock_match=True)

# Load table
tbl_stream = io.BytesIO()
extracted.write(tbl_stream, format=&#x27;votable&#x27;)
fc.show_table(file_input=tbl_stream,
              tbl_id=&quot;SExtractor Table&quot;,
              title=&#x27;Table&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="RbHDSceyVYoIabeMVCXnG" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="id-12-perform-aperture-photometry-on-selected-sources" class="relative group"><span class="heading-text">12. Perform Aperture Photometry on Selected Sources</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-12-perform-aperture-photometry-on-selected-sources" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Finally, we compute the SPHEREx spectra for selected sources. This includes downloading all the available SPHEREx spectral image cutouts for the sources and then measuring their photometry to generate a spectrum. For simplicity, we here perform aperture photometry but include background subtraction.</p><h3 id="id-12-1-download-spherex-spectral-image-cutouts" class="relative group"><span class="heading-text">12.1 Download SPHEREx spectral image cutouts</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-12-1-download-spherex-spectral-image-cutouts" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Here we select one source to proceed (multiple sources can be measured by looping over the code below). Note that we here directly give it the unique source ID that we defined in the catalog column <code>NUMBER</code>.</p><div id="fU0ZB4YhAO" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">selected_ids = [65]
matched_stars = extracted[extracted[&#x27;NUMBER&#x27;] == selected_ids[0]][&quot;NUMBER&quot;, &quot;ra&quot;, &quot;dec&quot;].to_pandas()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Cv8oUnv3hYJvw32P2ANt6" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>We then set up the TAP service as well as the cutout size to run a query for all SPHEREx spectral images that contain the sources.</p><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Note</div></div><div class="myst-admonition-body px-4 py-1"><p>Note that the following procedure follows the one shown in the SPHEREx <a target="_blank" rel="noreferrer" href="https://caltech-ipac.github.io/irsa-tutorials/spherex-cutouts/" class="link whitespace-nowrap"><span class="link-text whitespace-normal">Image Cutout tutorial notebook</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a>.</p></div></aside><div id="afDcyZ8k4O" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Define the service endpoint for IRSA&#x27;s Table Access Protocol (TAP)
# so that we can query SPHEREx metadata tables.
service = pyvo.dal.TAPService(&quot;https://irsa.ipac.caltech.edu/TAP&quot;)

# Specify cutout size (approximately 60 pixels on a side)
size = 0.1 * u.degree

# Define a query that will search the appropriate SPHEREx metadata tables
# for spectral images that cover the chosen coordinates and match the
# specified bandpass. Return the cutout data access URL and the time of observation.
# Sort by observation time.
query = f&quot;&quot;&quot;
SELECT
    &#x27;https://irsa.ipac.caltech.edu/&#x27; || a.uri || &#x27;?center={matched_stars[&#x27;ra&#x27;][0]},{matched_stars[&#x27;dec&#x27;][0]}d&amp;size={size.value}&#x27; AS uri,
    p.time_bounds_lower
FROM spherex.artifact a
JOIN spherex.plane p ON a.planeid = p.planeid
WHERE 1 = CONTAINS(POINT(&#x27;ICRS&#x27;, {matched_stars[&#x27;ra&#x27;][0]}, {matched_stars[&#x27;dec&#x27;][0]}), p.poly)
ORDER BY p.time_bounds_lower
&quot;&quot;&quot;

# Execute the query and return as an astropy Table.
t1 = time.time()
tap_results = service.search(query)
print(&quot;Time to do TAP query: {:2.2f} seconds.&quot;.format(time.time() - t1))
print(&quot;Number of images found: {}&quot;.format(len(tap_results)))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="_3qm2kHrgyOru-oXj69_f" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>We then define a handy function that downloads the images.</p><div id="Sm7D8XlIG5" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def process_cutout(row, ra, dec, cache, retries=3, delay=5):
    &#x27;&#x27;&#x27;
    Downloads the cutouts given in a row of the table including all SPHEREx images overlapping with a position.

    Parameters
    ----------
    row : `astropy.table.Row`
        Row of a table that will be changed in place by this function. The table
        is created by the SQL TAP query.
    ra, dec : `float`
        RA and Dec coordinates (same as used for the TAP query) in degrees.
    cache : `bool`
        If set to `True`, the output of cached and the cutout processing will run faster next time.
        Turn this feature off by setting `cache = False`.
    retries : `int`, optional
        Number of times to retry downloading the cutout in case of failure.
    delay : `int`, optional
        Delay in seconds between retries.
    &#x27;&#x27;&#x27;
    for attempt in range(retries):
        try:
            with fits.open(row[&quot;uri&quot;]) as hdulist:
                # There are seven HDUs:
                # 0 contains minimal metadata in the header and no data.
                # 1 through 6 are: IMAGE, FLAGS, VARIANCE, ZODI, PSF, WCS-WAVE
                header = hdulist[1].header

                # Fetch spatial and spectral WCS
                spatial_wcs = WCS(header)
                spectral_wcs = WCS(header, fobj=hdulist, key=&quot;W&quot;)
                spectral_wcs.sip = None  # disable SIP distortions
                row[&quot;spectral_wcs&quot;] = spectral_wcs

                # Compute wavelength/bandpass at source position
                x_src, y_src = spatial_wcs.world_to_pixel(SkyCoord(ra=ra, dec=dec, unit=&quot;deg&quot;, frame=&quot;icrs&quot;))
                wl_src, bp_src = spectral_wcs.pixel_to_world(x_src, y_src)
                row[&quot;central_wl_src&quot;] = wl_src.to(u.micrometer).value

                # Collect the HDUs for this cutout and append the row&#x27;s cutout_index to the EXTNAME.
                hdus = []
                for hdu in hdulist[1:]:  # skip the primary header
                    hdu.header[&quot;EXTNAME&quot;] = f&quot;{hdu.header[&#x27;EXTNAME&#x27;]}{row[&#x27;cutout_index&#x27;]}&quot;
                    hdus.append(hdu.copy())  # Copy so the data is available after the file is closed
                row[&quot;hdus&quot;] = hdus
        except TimeoutError:
            if attempt == retries - 1:
                raise
            time.sleep(delay)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="7t_lWcz_tYeH38xSH4-y2" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>We add some placeholders and other information to the table so we can keep track of things.</p><div id="qmoNo4xp1b" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Add columns to hold relevant cutout information
results_table = tap_results.to_table()
results_table[&quot;cutout_index&quot;] = range(1, len(results_table) + 1)
results_table[&quot;central_wl_src&quot;] = np.full(len(results_table), np.nan)
results_table[&quot;hdus&quot;] = np.full(len(results_table), None)
results_table[&quot;spectral_wcs&quot;] = np.full(len(results_table), None)  # since we are not saving primary HDU</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="EgH0r9_nXPyCw3rn--pq9" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Finally, we can run the download of the cutouts in parallel via the function created above. The cutouts are saved directly in the table.</p><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Warning</div></div><div class="myst-admonition-body px-4 py-1"><p>The cell below can take a couple of minutes to run depending on the number of observations available at a given sky coordinate position.</p></div></aside><div id="r7IjUimyLF" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Process cutouts in parallel
t1 = time.time()
n_timeouts = 0
with concurrent.futures.ThreadPoolExecutor(max_workers=8) as executor:
    futures = [executor.submit(process_cutout, row, matched_stars[&#x27;ra&#x27;][0], matched_stars[&#x27;dec&#x27;][0], False) for row in results_table]

    # Raise any exceptions caught during cutout processing
    for future in concurrent.futures.as_completed(futures):
        try:
            future.result()
        except Exception as e:
            n_timeouts += 1
            print(f&quot;An error occurred: {e}&quot;)

# Check if any cutouts failed. If so, you might need to re-run this cell with
# fewer workers, cache enabled, or increased timeout/retries.
n_failed = np.count_nonzero(results_table[&#x27;hdus&#x27;] == None)
if n_timeouts &gt; 0 or n_failed &gt; 0:
    print(f&quot;\n!!!!! WARNING !!!!!\n{n_timeouts} cutouts had timeouts and {n_failed} cutouts&quot;
          f&quot; failed to process.\n&quot;)

print(&quot;Time to create cutouts in serial mode: {:2.2f} minutes.&quot;.format((time.time() - t1) / 60))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="BmZGev36AiczA___9E_gH" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h3 id="id-12-2-obtain-spectrum" class="relative group"><span class="heading-text">12.2 Obtain spectrum</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-12-2-obtain-spectrum" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Having obtained the cutouts, we can now perform aperture photometry on the cutouts and measure the fluxes as a function of wavelength.
See <code>spherex_source_discovery_tool/aperture_photometry.py</code> for more information on the functions used below.</p><div id="cjzXENcqcz" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">phot_path = os.path.realpath( &quot;./data/ap_phot_sources.pkl&quot; ) # this is where the photometry results are saved.
aperture_radii = [3.0, 4.0, 5.0]  # aperture radii in pixels
matched_stars = matched_stars.reset_index(drop=True)

# Perform aperture photometry
build_phot_table(results_table, matched_stars, aperture_radii, phot_path, sapm_s3)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="qk053FoYz9t0IXeWrN7Jx" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Load the photometry file we just created.</p><div id="XxZbH1lNIX" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">if os.path.exists(phot_path):
    with open(phot_path, &#x27;rb&#x27;) as f:
        all_stars_band_phot = pickle.load(f)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="d7P4JiFF9nkwA7hxOLFOE" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Apply flagging to the extracted 1D-Spectrum.</p><div id="Ig6bHamkp2" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Define bad photometry flags
bad_flags = [&#x27;TRANSIENT&#x27;, &#x27;OVERFLOW&#x27;, &#x27;SUR_ERROR&#x27;, &#x27;PHANTOM&#x27;, &#x27;REFERENCE&#x27;, &#x27;NONFUNC&#x27;, &#x27;DICHROIC&#x27;,
             &#x27;MISSING_DATA&#x27;, &#x27;HOT&#x27;, &#x27;COLD&#x27;, &#x27;FULLSAMPLE&#x27;, &#x27;PHANMISS&#x27;, &#x27;NONLINEAR&#x27;, &#x27;PERSIST&#x27;, &#x27;OUTLIER&#x27;]
ap_rad = 3.0  # set your preferred aperture radius, from the `aperture_radii` list you specified above
targ = 0  # pick index from `all_stars_band_phot` table
wvl, bdw, abmags, abmag_errs, flx, var, n_bad = \
                grab_star(obs_log_entry=all_stars_band_phot[&#x27;obs_log&#x27;][targ], ap_rad=ap_rad, bad_flags=bad_flags)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="y0gWyrK9e9_4vynjzzZr1" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><p>Finally visualize the spectrum using <em>bokeh</em> in flux and magnitudes!</p><div id="UaEhLIxa8t" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">plot_spectrum(wvl, bdw, flx, var, abmags, abmag_errs, n_bad, type=&quot;flux&quot;,
              source_id=all_stars_band_phot[&#x27;NUMBER&#x27;][targ], ap_size=3.0)
plot_spectrum(wvl, bdw, flx, var, abmags, abmag_errs, n_bad, type=&quot;magnitude&quot;,
              source_id=all_stars_band_phot[&#x27;NUMBER&#x27;][targ], ap_size=3.0)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="npyhuHWvCagb4LpcG2kqG" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><h2 id="acknowledgements" class="relative group"><span class="heading-text">Acknowledgements</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#acknowledgements" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><ul><li><p>The Source Discovery Tool aperture photometry functions are adapted from code by Zafar Rustamkulov.</p></li><li><p><a target="_blank" rel="noreferrer" href="https://irsa.ipac.caltech.edu/" class="link whitespace-nowrap"><span class="link-text whitespace-normal">Caltech/IPAC-IRSA</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a></p></li></ul><p>This work has made use of the NASA/IPAC Infrared Science Archive, which is funded by the National Aeronautics and Space Administration and operated by the California Institute of Technology. We acknowledge support from the SPHEREx project under a contract from the NASA/Goddard Space Flight Center to the California Institute of Technology. This research was partly carried out at the California Institute of Technology under a contract with the National Aeronautics and Space Administration (80GSFC18C0011).  The DOI for SPHEREx QR2 data is 10.26131/IRSA629 (<cite class="" data-state="closed"><a href="https://doi.org/10.26131/IRSA629" target="_blank" rel="noreferrer" class="hover-link">SPHEREx Team (2025)</a></cite>).</p><h2 id="about-this-notebook" class="relative group"><span class="heading-text">About this Notebook</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#about-this-notebook" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p><strong>Authors:</strong> Gabriela Torrini, Andreas Faisst, and the SPHEREx Science Data Center (SSDC); Troy Raen, Brigitta Sipőcz, and Jaladh Singhal</p><p><strong>Contact:</strong> <a target="_blank" rel="noreferrer" href="https://irsa.ipac.caltech.edu/docs/help_desk.html" class="link whitespace-nowrap"><span class="link-text whitespace-normal">IRSA Helpdesk</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a> with questions
or problems.</p><p><strong>Updated:</strong> 18 February 2026</p><p><strong>Runtime:</strong> approximately 5 minutes</p><div class="myst-backmatter-parts"></div><section id="references" class="myst-bibliography article-grid subgrid-gap col-screen"><div><header class="myst-bibliography-header text-lg font-semibold text-stone-900 dark:text-white group">References<a class="no-underline text-inherit hover:text-inherit ml-2 select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#references" title="Link to References" aria-label="Link to References">¶</a></header></div><div class="myst-bibliography-list pl-3 mb-8 text-xs text-stone-500 dark:text-stone-300"><ol><li class="myst-bibliography-item break-words" id="cite-https://doi.org/10.26131/irsa629">SPHEREx Team. (2025). <i>SPHEREx Quick Release Spectral Images</i>. IPAC. <a target="_blank" rel="noreferrer" href="https://doi.org/10.26131/IRSA629">10.26131/IRSA629</a></li></ol></div></section></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/irsa-tutorials/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-G62B6HZR.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/irsa-tutorials/build/root-PMP5BIHC.js"/><link rel="modulepreload" href="/irsa-tutorials/build/_shared/chunk-IX5KPAHP.js"/><link rel="modulepreload" href="/irsa-tutorials/build/routes/$-5ZLZ2O3Y.js"/><script>window.__remixContext = {"url":"/spherex-source-discovery-tool-demo","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.8.0","options":{"hide_footer_links":true,"outline_maxdepth":1,"favicon":"/irsa-tutorials/build/irsa-favicon-678cdaeb01f61c8d2353159823d4dcf0.ico","logo":"/irsa-tutorials/build/irsa_logo-de8969c6aec11b4451b997fa3bc3f181.png","style":"/irsa-tutorials/build/custom-2a2c8542b37f2d005c033a8776bc7e45.css"},"nav":[],"actions":[],"projects":[{"license":{"content":{"id":"BSD-3-Clause","url":"https://github.com/Caltech-IPAC/irsa-tutorials/blob/main/LICENSE","name":"BSD 3-Clause \"New\" or \"Revised\" License","free":true,"osi":true}},"subject":"IRSA Tutorials","settings":{"output_matplotlib_strings":"remove"},"title":"IRSA Tutorials","description":"IRSA Python Notebook tutorials to demostrate accessing data served by the NASA/IPAC Infrared Science Archive (IRSA)","authors":[{"id":"IRSA Scientists and Developers","name":"IRSA Scientists and Developers"}],"github":"https://github.com/Caltech-IPAC/irsa-tutorials/","keywords":["astronomy"],"thebe":{"binder":{"url":"https://mybinder.org","provider":"github","repo":"https://github.com/Caltech-IPAC/irsa-tutorials/","ref":"HEAD"}},"toc":[{"file":"index.md","title":"IRSA Tutorials"},{"children":[{"file":"tutorials/spherex/spherex_intro.md","title":"Data Overview"},{"file":"tutorials/spherex/spherex_cutouts.md","title":"Spectral Image Cutouts"},{"file":"tutorials/spherex/spherex_psf.md","title":"PSF Models"},{"file":"tutorials/spherex/spherex_source_discovery/spherex_source_discovery_tool_demo.md","title":"Source Discovery Tool"}],"file":"tutorials/spherex/spherex.md","title":"SPHEREx"},{"children":[{"file":"tutorials/euclid/1_Euclid_intro_MER_images.md","title":"MER Mosaics"},{"file":"tutorials/euclid/3_Euclid_intro_1D_spectra.md","title":"SIR 1D Spectra"},{"file":"tutorials/euclid/2_Euclid_intro_MER_catalog.md","title":"MER Catalogs"},{"file":"tutorials/euclid/4_Euclid_intro_PHZ_catalog.md","title":"PHZ Catalogs"},{"file":"tutorials/euclid/5_Euclid_intro_SPE_catalog.md","title":"SPE Catalogs"},{"children":[{"file":"tutorials/euclid/merged-objects-hats-catalog/1-euclid-q1-hats-intro.md","title":"Introduction"},{"file":"tutorials/euclid/merged-objects-hats-catalog/4-euclid-q1-hats-magnitudes.md","title":"Magnitudes"}],"title":"Merged Objects HATS Catalog"},{"file":"tutorials/euclid/euclid-cloud-access.md","title":"Cloud Access"},{"file":"tutorials/euclid/Euclid_ERO.md","title":"ERO Star Clusters"}],"file":"tutorials/euclid/euclid.md","title":"Euclid"},{"children":[{"file":"tutorials/wise/sia_allwise_atlas.md","title":"AllWISE Images"},{"file":"tutorials/wise/wise-allwise-catalog-demo.md","title":"AllWISE Catalog"},{"file":"tutorials/wise/NEOWISE_light_curve_demo.md","title":"NEOWISE Firefly"},{"file":"tutorials/wise/neowise-source-table-strategies.md","title":"NEOWISE Strategies"},{"file":"tutorials/wise/neowise-source-table-lightcurves.md","title":"NEOWISE Light Curves"}],"file":"tutorials/wise/wise.md","title":"WISE"},{"children":[{"file":"tutorials/spitzer/siav2_seip.md"}],"title":"Spitzer"},{"children":[{"file":"tutorials/2mass/sia_2mass_allsky.md"}],"title":"2MASS"},{"children":[{"file":"tutorials/cosmos/sia_cosmos.md"}],"title":"COSMOS"},{"children":[{"file":"tutorials/simulated-data/roman_hlss_number_density.md","title":"Roman HLSS Number Density"},{"file":"tutorials/simulated-data/openuniverse2024_roman_simulated_wideareasurvey.md","title":"OpenUniverse2024 Roman coadds"},{"file":"tutorials/simulated-data/OpenUniverse2024Preview_Firefly.md","title":"OpenUniverse2024 Visualization"},{"file":"tutorials/simulated-data/openuniverse2024_roman_simulated_timedomainsurvey.md","title":"OpenUniverse2024 Time Domain"},{"file":"tutorials/simulated-data/cosmoDC2_TAP_access.md","title":"CosmoDC2 Data Access"}],"file":"tutorials/simulated-data/simulated.md","title":"Simulated Data"},{"children":[{"file":"tutorials/techniques-and-tools/cloud-access-intro.md","title":"Cloud Access"},{"file":"tutorials/techniques-and-tools/irsa-hats-with-lsdb.md","title":"LSDB HATS"},{"file":"tutorials/techniques-and-tools/SEDs_in_Firefly.md","title":"SED visualization"},{"file":"tutorials/techniques-and-tools/Parallelize_Convolution.md","title":"Parallelization"}],"file":"tutorials/techniques-and-tools/techniques.md","title":"Techniques \u0026 Tools"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"spherex","title":"SPHEREx Tutorial Notebooks","short_title":"SPHEREx","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spherex-intro","title":"Introduction to SPHEREx Spectral Images","short_title":"Data Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spherex-cutouts","title":"Download a collection of SPHEREx Spectral Image cutouts as a multi-extension FITS file","short_title":"Spectral Image Cutouts","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spherex-psf","title":"Understanding and Extracting the PSF Extension in a SPHEREx Cutout","short_title":"PSF Models","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spherex-source-discovery-tool-demo","title":"SPHEREx Source Discovery Tool IRSA Demo","short_title":"Source Discovery Tool","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid","title":"Euclid Tutorial Notebooks","short_title":"Euclid","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"euclid-intro-mer-images","title":"Euclid Q1: MER Mosaics","short_title":"MER Mosaics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid-intro-1d-spectra","title":"Euclid Q1: SIR 1D Spectra","short_title":"SIR 1D Spectra","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid-intro-mer-catalog","title":"Euclid Q1: MER Catalogs","short_title":"MER Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid-intro-phz-catalog","title":"Euclid Q1: PHZ Catalogs","short_title":"PHZ Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid-intro-spe-catalog","title":"Euclid Q1: SPE Catalogs","short_title":"SPE Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":2,"title":"Merged Objects HATS Catalog"},{"slug":"euclid-q1-hats-intro","title":"Euclid Q1 Merged Objects HATS Catalog: Introduction","short_title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-q1-hats-magnitudes","title":"Euclid Q1 Merged Objects HATS Catalog: Magnitudes","short_title":"Magnitudes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-cloud-access","title":"Euclid Q1: Cloud Access","short_title":"Cloud Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid-ero","title":"Exploring Star Clusters in the Euclid ERO Data","short_title":"ERO Star Clusters","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"wise","title":"WISE Tutorial Notebooks","short_title":"WISE","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"sia-allwise-atlas","title":"Searching for AllWISE Atlas Images","short_title":"AllWISE Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"wise-allwise-catalog-demo","title":"Analyzing cloud-hosted AllWISE Source Catalog in Parquet format","short_title":"AllWISE Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"neowise-light-curve-demo","title":"Using Firefly visualization tools to understand the light curves of Solar System objects","short_title":"NEOWISE Firefly","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"neowise-source-table-strategies","title":"Strategies to Efficiently Work with NEOWISE Single-exposure Source Table in Parquet","short_title":"NEOWISE Strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"neowise-source-table-lightcurves","title":"Make Light Curves from NEOWISE Single-exposure Source Table","short_title":"NEOWISE Light Curves","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Spitzer"},{"slug":"siav2-seip","title":"Searching for Spitzer Enhanced Imaging Products","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"2MASS"},{"slug":"sia-2mass-allsky","title":"Searching for 2MASS All-Sky Atlas Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"COSMOS"},{"slug":"sia-cosmos","title":"Searching for contributed COSMOS images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"simulated","title":"Simulated Data Tutorial Notebooks","short_title":"Simulated Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"roman-hlss-number-density","title":"Number Density as a Function of Redshift","short_title":"Roman HLSS Number Density","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"openuniverse2024-roman-simulated-wideareasurvey","title":"Analyzing cloud-hosted simulated Roman coadded images","short_title":"OpenUniverse2024 Roman coadds","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"openuniverse2024preview-firefly","title":"Using Firefly to Explore OpenUniverse2024 Data Preview Simulated Roman and Rubin Images","short_title":"OpenUniverse2024 Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"openuniverse2024-roman-simulated-timedomainsurvey","title":"Analyzing cloud-hosted simulated Roman Time Domain Survey images","short_title":"OpenUniverse2024 Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"cosmodc2-tap-access","title":"Querying the CosmoDC2 Mock v1 Catalogs","short_title":"CosmoDC2 Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"techniques","title":"Techniques \u0026 Tools Tutorial Notebooks","short_title":"Techniques \u0026 Tools","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"cloud-access-intro","title":"IRSA cloud access introduction","short_title":"Cloud Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"irsa-hats-with-lsdb","title":"Access HATS Collections Using LSDB: Euclid Q1 and ZTF DR23","short_title":"LSDB HATS","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"seds-in-firefly","title":"Using Firefly visualization tools in Python to vet SEDs","short_title":"SED visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"parallelize-convolution","title":"Parallelizing image convolution","short_title":"Parallelization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/irsa-tutorials"},"routes/$":{"config":{"version":3,"myst":"1.8.0","options":{"hide_footer_links":true,"outline_maxdepth":1,"favicon":"/irsa-tutorials/build/irsa-favicon-678cdaeb01f61c8d2353159823d4dcf0.ico","logo":"/irsa-tutorials/build/irsa_logo-de8969c6aec11b4451b997fa3bc3f181.png","style":"/irsa-tutorials/build/custom-2a2c8542b37f2d005c033a8776bc7e45.css"},"nav":[],"actions":[],"projects":[{"license":{"content":{"id":"BSD-3-Clause","url":"https://github.com/Caltech-IPAC/irsa-tutorials/blob/main/LICENSE","name":"BSD 3-Clause \"New\" or \"Revised\" License","free":true,"osi":true}},"subject":"IRSA Tutorials","settings":{"output_matplotlib_strings":"remove"},"title":"IRSA Tutorials","description":"IRSA Python Notebook tutorials to demostrate accessing data served by the NASA/IPAC Infrared Science Archive (IRSA)","authors":[{"id":"IRSA Scientists and Developers","name":"IRSA Scientists and Developers"}],"github":"https://github.com/Caltech-IPAC/irsa-tutorials/","keywords":["astronomy"],"thebe":{"binder":{"url":"https://mybinder.org","provider":"github","repo":"https://github.com/Caltech-IPAC/irsa-tutorials/","ref":"HEAD"}},"toc":[{"file":"index.md","title":"IRSA Tutorials"},{"children":[{"file":"tutorials/spherex/spherex_intro.md","title":"Data Overview"},{"file":"tutorials/spherex/spherex_cutouts.md","title":"Spectral Image Cutouts"},{"file":"tutorials/spherex/spherex_psf.md","title":"PSF Models"},{"file":"tutorials/spherex/spherex_source_discovery/spherex_source_discovery_tool_demo.md","title":"Source Discovery Tool"}],"file":"tutorials/spherex/spherex.md","title":"SPHEREx"},{"children":[{"file":"tutorials/euclid/1_Euclid_intro_MER_images.md","title":"MER Mosaics"},{"file":"tutorials/euclid/3_Euclid_intro_1D_spectra.md","title":"SIR 1D Spectra"},{"file":"tutorials/euclid/2_Euclid_intro_MER_catalog.md","title":"MER Catalogs"},{"file":"tutorials/euclid/4_Euclid_intro_PHZ_catalog.md","title":"PHZ Catalogs"},{"file":"tutorials/euclid/5_Euclid_intro_SPE_catalog.md","title":"SPE Catalogs"},{"children":[{"file":"tutorials/euclid/merged-objects-hats-catalog/1-euclid-q1-hats-intro.md","title":"Introduction"},{"file":"tutorials/euclid/merged-objects-hats-catalog/4-euclid-q1-hats-magnitudes.md","title":"Magnitudes"}],"title":"Merged Objects HATS Catalog"},{"file":"tutorials/euclid/euclid-cloud-access.md","title":"Cloud Access"},{"file":"tutorials/euclid/Euclid_ERO.md","title":"ERO Star Clusters"}],"file":"tutorials/euclid/euclid.md","title":"Euclid"},{"children":[{"file":"tutorials/wise/sia_allwise_atlas.md","title":"AllWISE Images"},{"file":"tutorials/wise/wise-allwise-catalog-demo.md","title":"AllWISE Catalog"},{"file":"tutorials/wise/NEOWISE_light_curve_demo.md","title":"NEOWISE Firefly"},{"file":"tutorials/wise/neowise-source-table-strategies.md","title":"NEOWISE Strategies"},{"file":"tutorials/wise/neowise-source-table-lightcurves.md","title":"NEOWISE Light Curves"}],"file":"tutorials/wise/wise.md","title":"WISE"},{"children":[{"file":"tutorials/spitzer/siav2_seip.md"}],"title":"Spitzer"},{"children":[{"file":"tutorials/2mass/sia_2mass_allsky.md"}],"title":"2MASS"},{"children":[{"file":"tutorials/cosmos/sia_cosmos.md"}],"title":"COSMOS"},{"children":[{"file":"tutorials/simulated-data/roman_hlss_number_density.md","title":"Roman HLSS Number Density"},{"file":"tutorials/simulated-data/openuniverse2024_roman_simulated_wideareasurvey.md","title":"OpenUniverse2024 Roman coadds"},{"file":"tutorials/simulated-data/OpenUniverse2024Preview_Firefly.md","title":"OpenUniverse2024 Visualization"},{"file":"tutorials/simulated-data/openuniverse2024_roman_simulated_timedomainsurvey.md","title":"OpenUniverse2024 Time Domain"},{"file":"tutorials/simulated-data/cosmoDC2_TAP_access.md","title":"CosmoDC2 Data Access"}],"file":"tutorials/simulated-data/simulated.md","title":"Simulated Data"},{"children":[{"file":"tutorials/techniques-and-tools/cloud-access-intro.md","title":"Cloud Access"},{"file":"tutorials/techniques-and-tools/irsa-hats-with-lsdb.md","title":"LSDB HATS"},{"file":"tutorials/techniques-and-tools/SEDs_in_Firefly.md","title":"SED visualization"},{"file":"tutorials/techniques-and-tools/Parallelize_Convolution.md","title":"Parallelization"}],"file":"tutorials/techniques-and-tools/techniques.md","title":"Techniques \u0026 Tools"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"spherex","title":"SPHEREx Tutorial Notebooks","short_title":"SPHEREx","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spherex-intro","title":"Introduction to SPHEREx Spectral Images","short_title":"Data Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spherex-cutouts","title":"Download a collection of SPHEREx Spectral Image cutouts as a multi-extension FITS file","short_title":"Spectral Image Cutouts","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spherex-psf","title":"Understanding and Extracting the PSF Extension in a SPHEREx Cutout","short_title":"PSF Models","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spherex-source-discovery-tool-demo","title":"SPHEREx Source Discovery Tool IRSA Demo","short_title":"Source Discovery Tool","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid","title":"Euclid Tutorial Notebooks","short_title":"Euclid","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"euclid-intro-mer-images","title":"Euclid Q1: MER Mosaics","short_title":"MER Mosaics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid-intro-1d-spectra","title":"Euclid Q1: SIR 1D Spectra","short_title":"SIR 1D Spectra","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid-intro-mer-catalog","title":"Euclid Q1: MER Catalogs","short_title":"MER Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid-intro-phz-catalog","title":"Euclid Q1: PHZ Catalogs","short_title":"PHZ Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid-intro-spe-catalog","title":"Euclid Q1: SPE Catalogs","short_title":"SPE Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":2,"title":"Merged Objects HATS Catalog"},{"slug":"euclid-q1-hats-intro","title":"Euclid Q1 Merged Objects HATS Catalog: Introduction","short_title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-q1-hats-magnitudes","title":"Euclid Q1 Merged Objects HATS Catalog: Magnitudes","short_title":"Magnitudes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-cloud-access","title":"Euclid Q1: Cloud Access","short_title":"Cloud Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid-ero","title":"Exploring Star Clusters in the Euclid ERO Data","short_title":"ERO Star Clusters","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"wise","title":"WISE Tutorial Notebooks","short_title":"WISE","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"sia-allwise-atlas","title":"Searching for AllWISE Atlas Images","short_title":"AllWISE Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"wise-allwise-catalog-demo","title":"Analyzing cloud-hosted AllWISE Source Catalog in Parquet format","short_title":"AllWISE Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"neowise-light-curve-demo","title":"Using Firefly visualization tools to understand the light curves of Solar System objects","short_title":"NEOWISE Firefly","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"neowise-source-table-strategies","title":"Strategies to Efficiently Work with NEOWISE Single-exposure Source Table in Parquet","short_title":"NEOWISE Strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"neowise-source-table-lightcurves","title":"Make Light Curves from NEOWISE Single-exposure Source Table","short_title":"NEOWISE Light Curves","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Spitzer"},{"slug":"siav2-seip","title":"Searching for Spitzer Enhanced Imaging Products","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"2MASS"},{"slug":"sia-2mass-allsky","title":"Searching for 2MASS All-Sky Atlas Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"COSMOS"},{"slug":"sia-cosmos","title":"Searching for contributed COSMOS images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"simulated","title":"Simulated Data Tutorial Notebooks","short_title":"Simulated Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"roman-hlss-number-density","title":"Number Density as a Function of Redshift","short_title":"Roman HLSS Number Density","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"openuniverse2024-roman-simulated-wideareasurvey","title":"Analyzing cloud-hosted simulated Roman coadded images","short_title":"OpenUniverse2024 Roman coadds","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"openuniverse2024preview-firefly","title":"Using Firefly to Explore OpenUniverse2024 Data Preview Simulated Roman and Rubin Images","short_title":"OpenUniverse2024 Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"openuniverse2024-roman-simulated-timedomainsurvey","title":"Analyzing cloud-hosted simulated Roman Time Domain Survey images","short_title":"OpenUniverse2024 Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"cosmodc2-tap-access","title":"Querying the CosmoDC2 Mock v1 Catalogs","short_title":"CosmoDC2 Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"techniques","title":"Techniques \u0026 Tools Tutorial Notebooks","short_title":"Techniques \u0026 Tools","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"cloud-access-intro","title":"IRSA cloud access introduction","short_title":"Cloud Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"irsa-hats-with-lsdb","title":"Access HATS Collections Using LSDB: Euclid Q1 and ZTF DR23","short_title":"LSDB HATS","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"seds-in-firefly","title":"Using Firefly visualization tools in Python to vet SEDs","short_title":"SED visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"parallelize-convolution","title":"Parallelizing image convolution","short_title":"Parallelization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":3,"kind":"Notebook","sha256":"dbb23d6a9316c1e188dfc580cdec856952647ac2a618241885699c81294fee40","slug":"spherex-source-discovery-tool-demo","location":"/tutorials/spherex/spherex_source_discovery/spherex_source_discovery_tool_demo.md","dependencies":[],"frontmatter":{"title":"SPHEREx Source Discovery Tool IRSA Demo","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{"text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.18.1"}},"execute":{"skip":true},"content_includes_title":false,"authors":[{"id":"IRSA Scientists and Developers","name":"IRSA Scientists and Developers"}],"license":{"content":{"id":"BSD-3-Clause","url":"https://github.com/Caltech-IPAC/irsa-tutorials/blob/main/LICENSE","name":"BSD 3-Clause \"New\" or \"Revised\" License","free":true,"osi":true}},"github":"https://github.com/Caltech-IPAC/irsa-tutorials/","subject":"IRSA Tutorials","keywords":["astronomy"],"settings":{"output_matplotlib_strings":"remove"},"numbering":{"title":{"offset":1}},"source_url":"https://github.com/Caltech-IPAC/irsa-tutorials//blob/main/tutorials/spherex/spherex_source_discovery/spherex_source_discovery_tool_demo.md","edit_url":"https://github.com/Caltech-IPAC/irsa-tutorials//edit/main/tutorials/spherex/spherex_source_discovery/spherex_source_discovery_tool_demo.md","exports":[{"format":"md","filename":"spherex_source_discovery_tool_demo.md","url":"/irsa-tutorials/build/spherex_source_disco-fe40da9d7cf47cadb30908f0d298cf0f.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"The SPHEREx Source Discovery Tool is the Python package ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"jvfNsRvCCs"},{"type":"inlineCode","value":"spherex_source_discovery_tool","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"YxszEeFayB"},{"type":"text","value":" (included in this directory), which is used to discover and extract sources from SPHEREx Spectral Images and visualize their spectra.\nThis notebook demonstrates how to use it.","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"O3sQMMOnFz"}],"key":"nRb9NUJ2h3"},{"type":"heading","depth":2,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"1. Learning Goals","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"tgskz61mZC"}],"identifier":"id-1-learning-goals","label":"1. Learning Goals","html_id":"id-1-learning-goals","implicit":true,"key":"llyNMDdZ5v"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":23,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Search and download SPHEREx images","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"X1eGJAwJDq"}],"key":"ctITSPrrC2"}],"key":"Uj3XZkJF55"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Implement a simple image subtraction to find red sources in the SPHEREx images","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"H5giEP5x4f"}],"key":"VFg2V1HkET"}],"key":"Iljmn7On1t"},{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Visualize images and catalog data in ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"iCc2eIn7rq"},{"type":"emphasis","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"deDzVgMGGT"}],"key":"peGVkILwq2"},{"type":"text","value":" as well as interactive ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"qCQ4WBiqYe"},{"type":"emphasis","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"bokeh","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"VirwUh5MMt"}],"key":"QaG4P8poDY"},{"type":"text","value":" plots.","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"mzA9tfqhZc"}],"key":"myJom0Ekjy"}],"key":"Pade3iLzPJ"},{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"Select sources interactively and extract their SPHEREx spectra","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"i9LKmGhi6Y"}],"key":"P3PSsac33H"}],"key":"Lhhigg79Xq"}],"key":"fLBZPzsdXJ"}],"key":"zoYd9PhcMb"},{"type":"block","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"2. SPHEREx Overview","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"W2DuBRQx7T"}],"identifier":"id-2-spherex-overview","label":"2. SPHEREx Overview","html_id":"id-2-spherex-overview","implicit":true,"key":"nbvRkrfKtG"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"SPHEREx is a NASA Astrophysics Medium Explorer mission that launched in March 2025.\nDuring its planned two-year mission, SPHEREx will obtain 0.75-5 micron spectroscopy over the entire sky, with deeper data in the SPHEREx Deep Fields.\nSPHEREx data will be used to:","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"SG4aAbtkBj"}],"key":"K529H5q59q"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":39,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"constrain the physics of inflation","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"etj1m79N2x"}],"key":"DEZk6ZG40o"},{"type":"text","value":" by measuring its imprints on the three-dimensional large-scale distribution of matter,","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"S3jmkwv0Fo"}],"key":"QI7kzyTer3"}],"key":"Ar7twuZa8k"},{"type":"listItem","spread":true,"position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"trace the history of galactic light production","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"cEauwt1Weq"}],"key":"Smke6L1kwC"},{"type":"text","value":" through a deep multi-band measurement of large-scale clustering,","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"VsayXhkiVY"}],"key":"R05297cI1a"}],"key":"aNIQ89pl6g"},{"type":"listItem","spread":true,"position":{"start":{"line":41,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"investigate the abundance and composition of water and biogenic ices","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"IJVtNBS692"}],"key":"Tx63oGHrKr"},{"type":"text","value":" in the early phases of star and planetary disk formation.","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"g0cCXnnDUO"}],"key":"MNXKejyNCo"}],"key":"rfzHFZSSDF"}],"key":"TjOSCspJzz"},{"type":"paragraph","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"The community will also mine SPHEREx data and combine it with synergistic data sets to address a variety of additional topics in astrophysics.","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"bnzglpKKAx"}],"key":"YnEM8FjlKi"},{"type":"paragraph","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"text","value":"More information is available in the ","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"AeLe04he8Q"},{"type":"link","url":"https://irsa.ipac.caltech.edu/data/SPHEREx/docs/SPHEREx_Expsupp_QR.pdf","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"text","value":"SPHEREx Explanatory Supplement","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"fgjTjCepuH"}],"urlSource":"https://irsa.ipac.caltech.edu/data/SPHEREx/docs/SPHEREx_Expsupp_QR.pdf","key":"dSVvmmQLoN"},{"type":"text","value":".","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"lamPRgLUNx"}],"key":"QNpGGzWWzV"}],"key":"qut8cJdd1c"},{"type":"block","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"3. Requirements","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"GnXkugqGE6"}],"identifier":"id-3-requirements","label":"3. Requirements","html_id":"id-3-requirements","implicit":true,"key":"z8hN2izx42"}],"key":"s4HCugRrYH"},{"type":"block","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"text","value":"3.1 On local machines","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"WbuyiedZVi"}],"identifier":"id-3-1-on-local-machines","label":"3.1 On local machines","html_id":"id-3-1-on-local-machines","implicit":true,"key":"Gj7kJtNSkv"},{"type":"paragraph","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"All necessary packages and tools (e.g., ","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"k9fgFzsGHU"},{"type":"inlineCode","value":"SExtractor","key":"SQ8zkE1L4y"},{"type":"text","value":") are listed in the ","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"syUf2SHAUi"},{"type":"inlineCode","value":"conda-spherex_sdt.yml","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"ukcdazZi7Y"},{"type":"text","value":" file.","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"TUSLQvs5Ll"}],"key":"hBHEpIjBYx"},{"type":"paragraph","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"To create a conda environment with the dependencies on your local machine use:","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"CQZ0oO4jUZ"}],"key":"XQSVgOwiUv"},{"type":"code","lang":"","value":"conda env create --file conda-spherex_sdt.yml","position":{"start":{"line":58,"column":1},"end":{"line":60,"column":1}},"key":"ZVOVRFjAVr"},{"type":"paragraph","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"Then, make the environment available in the list of kernels for your JupyterLab:","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"tBhGzRfWnl"}],"key":"nJjDxgfqtn"},{"type":"code","lang":"","value":"conda activate spherex_sdt\npython -m ipykernel install --user --name=spherex_sdt","position":{"start":{"line":63,"column":1},"end":{"line":66,"column":1}},"key":"rD1fi3JAcD"},{"type":"paragraph","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"To use the environment in your Jupyter notebooks, either start JupyterLab in that environment by typing","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"sEs0pi8VVi"}],"key":"CSKoL5GiZM"},{"type":"code","lang":"","value":"conda activate spherex_sdt\njupyter-lab","position":{"start":{"line":70,"column":1},"end":{"line":73,"column":1}},"key":"Ze9sMks6JU"},{"type":"paragraph","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"or select the environment ","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"b3krhgRxFU"},{"type":"inlineCode","value":"spherex_sdt","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"ZshP7jNka7"},{"type":"text","value":" in your Jupyter Notebook using the dropdown on the upper left.","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"wRNaeee22T"}],"key":"Bk7kiTalUh"},{"type":"heading","depth":3,"position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"3.2 On Fornax","position":{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},"key":"dpD3Gk3lQc"}],"identifier":"id-3-2-on-fornax","label":"3.2 On Fornax","html_id":"id-3-2-on-fornax","implicit":true,"key":"PQUXwduIWe"},{"type":"paragraph","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"children":[{"type":"text","value":"Installing the conda environment on the ","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"oQMQXhzGkB"},{"type":"link","url":"https://science.nasa.gov/astrophysics/programs/physics-of-the-cosmos/community/the-fornax-initiative/","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"children":[{"type":"text","value":"NASA Fornax Science Console","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"AZwevCAiea"}],"urlSource":"https://science.nasa.gov/astrophysics/programs/physics-of-the-cosmos/community/the-fornax-initiative/","key":"ntPogu0pBV"},{"type":"text","value":" needs slightly different steps. These can be reviewed in the documentation ","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"RcRBrKETbi"},{"type":"link","url":"https://docs.fornax.sciencecloud.nasa.gov/compute-environments/#create-new-env","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"children":[{"type":"text","value":"create a new environment","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"XVmcSMjOfK"}],"urlSource":"https://docs.fornax.sciencecloud.nasa.gov/compute-environments/#create-new-env","key":"nJH4H47Rsb"},{"type":"text","value":".","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"Qbux3HZg7i"}],"key":"zAcYalUBuT"},{"type":"paragraph","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"In order to install this specific conda environment on Fornax, the file name of the ","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"Ax1irxsLxd"},{"type":"inlineCode","value":"yml","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"kXOAKdatIW"},{"type":"text","value":" file specifically needs to be in the format ","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"BGdYdwrt4s"},{"type":"inlineCode","value":"conda-*.yml","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"bTZquk7cYw"},{"type":"text","value":". The ","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"H2C80KIYq7"},{"type":"inlineCode","value":"yml","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"VY3A21wkbD"},{"type":"text","value":" file distributed here is already provided in that format (","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"HnvvDw4QnK"},{"type":"inlineCode","value":"conda-spherex_sdt.yml","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"y6rlO1mXcG"},{"type":"text","value":"). Once this is set, open a new terminal (click on the large “+” button right under the “File” menu tab) and type to following command ","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"T9GM3jzpiW"},{"type":"emphasis","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"inside","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"YAuEM9kqH5"}],"key":"Zg0QjlIild"},{"type":"text","value":" the same directory where the ","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"SrJ9ELxtPh"},{"type":"inlineCode","value":"yml","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"npg464Rj3d"},{"type":"text","value":" file is located:","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"w2hBeDpSug"}],"key":"GAqGlfmLFc"},{"type":"code","lang":"","value":"setup-conda-env --user","position":{"start":{"line":83,"column":1},"end":{"line":85,"column":1}},"key":"feQSgSw15I"},{"type":"paragraph","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"text","value":"Note that we use the ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"KmMOYcRJE1"},{"type":"inlineCode","value":"--user","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"hrKOycO3x8"},{"type":"text","value":" option here, which will keep the environment available for subsequent Fornax sessions.","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"pAsb0qadH9"}],"key":"PR0PZVWlIC"},{"type":"paragraph","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"To use the environment in your Jupyter notebooks on Fornax, directly select the environment ","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"IlLG5EHyvV"},{"type":"inlineCode","value":"spherex_sdt","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"jMPxOTHhkD"},{"type":"text","value":" in your Jupyter Notebook using the dropdown on the upper left.","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"vky6VRNeSy"}],"key":"Iqy0M2D0Kt"}],"key":"NcJSNiY3c2"},{"type":"block","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"4. Imports","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"uGu1Gz79pa"}],"identifier":"id-4-imports","label":"4. Imports","html_id":"id-4-imports","implicit":true,"key":"sJQELVcEbz"}],"key":"UFL93eV1cm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Standard library imports\nimport concurrent.futures\nimport copy\nimport json\nimport os\nimport io\nimport pickle\nimport time\nfrom concurrent.futures import as_completed\n\n# Related 3rd-party imports\nimport numpy as np\nimport pyvo\nimport sep\nimport astropy.units as u\nfrom astropy.coordinates import SkyCoord\nfrom astropy.io import fits\nfrom astropy.nddata import Cutout2D\nfrom astropy.table import Table\nfrom astropy.units import Unit\nfrom astropy.wcs import WCS\nfrom astroquery.ipac.irsa import Irsa\nfrom bokeh.io import output_notebook\nfrom bokeh.resources import INLINE\nfrom firefly_client import FireflyClient\nfrom reproject import reproject_exact, reproject_interp\n\n# Local application imports\nfrom spherex_source_discovery_tool.aperture_photometry import build_phot_table, grab_star\nfrom spherex_source_discovery_tool.bokeh_viz import (\n    plot_apertures, plot_spectrum, plot_subtracted_trio, plot_overlap_trio)\nfrom spherex_source_discovery_tool.firefly_viz import preview_query\nfrom spherex_source_discovery_tool.sdt_utils import (\n    format_extracted, get_filename, get_exp_id, get_obs_id, results_summary, get_lambda_range)\nfrom spherex_source_discovery_tool.source_extraction import run_sextractor, get_sextractor_file","key":"qdd24moTna"},{"type":"outputs","id":"Aopu9N2UhPYditZkEAC9p","children":[],"key":"KuIVvcadYs"}],"key":"VAeZ11kXQM"},{"type":"block","children":[],"key":"ckYV3zXCBz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Suppress logging temporarily to prevent astropy\n# from repeatedly printing out warning notices related to alternate WCSs\nimport logging\nlogging.getLogger('astropy').setLevel(logging.ERROR)\n\n# The time it takes to read SPHEREx files can exceed\n# astropy's default timeout limit. Increase it.\nfrom astropy.utils.data import conf\nconf.remote_timeout = 120\n\n# For interactive bokeh visualizations\noutput_notebook(resources=INLINE)","key":"goB8u6IllV"},{"type":"outputs","id":"d5mWV7TjRQjb_DV8PcyFL","children":[],"key":"ZjPD2dyUaB"}],"key":"usfVUVitO4"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"children":[{"type":"text","value":"5. Initialize Ephemeral Query Parameters","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"XzcpbMbvhm"}],"identifier":"id-5-initialize-ephemeral-query-parameters","label":"5. Initialize Ephemeral Query Parameters","html_id":"id-5-initialize-ephemeral-query-parameters","implicit":true,"key":"h7RdbjjBox"},{"type":"admonition","kind":"attention","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Attention","key":"FSeTnO6psV"}],"key":"sqJ8P9DovK"},{"type":"paragraph","position":{"start":{"line":151,"column":1},"end":{"line":152,"column":1}},"children":[{"type":"text","value":"The query parameters below are valid as of ","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"mXFS4nULVM"},{"type":"strong","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"text","value":"February 2026","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"kJb1tA7mnz"}],"key":"IeGkbIrp7g"},{"type":"text","value":", but will need to be updated as the mission proceeds.\nSpecifically, the ephemeral query parameters ","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"WmNUPk06EJ"},{"type":"emphasis","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"text","value":"will","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"MTNdsTssyX"}],"key":"kuZscbkLGA"},{"type":"text","value":" change for future SPHEREx data releases.","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"ElHhfrYDuE"}],"key":"Er9fyOEsNd"}],"key":"EEWyUQaVfs"}],"key":"MRS5AnFDES"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# General\ndata_release = \"qr2\"\n\n# Spectral image queries\nsia_collection = f\"spherex_{data_release}\"\n\n# Solid angle pixel map queries\ndataset_type=\"solid_angle_pixel_map\"\nsapm_collection = \"cal-sapm-v2-2025-164\"\nsapm_s3 = [\n    f\"nasa-irsa-spherex/{data_release}/{dataset_type}/{sapm_collection}/{k}/\"\\\n    f\"{dataset_type}_D{k}_spx_{sapm_collection}.fits\" for k in range(1, 7)\n]","key":"reIpbTlEyp"},{"type":"outputs","id":"ApRgSOPGvS__R6IgAmJEW","children":[],"key":"wg0q4URFDU"}],"key":"s0kag0mGII"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"children":[{"type":"text","value":"6. Search for SPHEREx Spectral Images","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"MsRVJ7GWug"}],"identifier":"id-6-search-for-spherex-spectral-images","label":"6. Search for SPHEREx Spectral Images","html_id":"id-6-search-for-spherex-spectral-images","implicit":true,"key":"vSS1g4tlTh"}],"key":"FKphVOVwa3"},{"type":"block","position":{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"children":[{"type":"text","value":"We search first search for all the available SPHEREx images around a given position on the sky.","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"key":"rfrpHdGfWH"}],"key":"NAzsKycqFl"},{"type":"paragraph","position":{"start":{"line":177,"column":1},"end":{"line":177,"column":1}},"children":[{"type":"text","value":"Here, we choose the random position at R.A. = 150.7817877 degrees and Decl. = 3.3502204 degrees, which is close to the COSMOS field. We also choose a search radius of 50 arc-seconds.","position":{"start":{"line":177,"column":1},"end":{"line":177,"column":1}},"key":"H7LaIYqrpg"}],"key":"WjTdYTWCI9"}],"key":"SoxK3FFAEf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"coord = SkyCoord(150.7817877, 3.3502204, unit='deg')\nsearch_radius = 50 * u.arcsec","key":"QhXbODbBnw"},{"type":"outputs","id":"1qwHxjE8XcwtExwhsmtDG","children":[],"key":"mrEil0TIyC"}],"key":"kJZ7sS2Tmx"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":184,"column":1},"end":{"line":185,"column":1}},"children":[{"type":"text","value":"We then search for the SPHEREx spectral images that overlap with the position in the search radius defined above.\nFor this we use the ","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"vH6aq7Fx2N"},{"type":"link","url":"https://astroquery.readthedocs.io/en/latest/ipac/irsa/irsa.html","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"IRSA module in astroquery","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"kOeR0Yzqws"}],"urlSource":"https://astroquery.readthedocs.io/en/latest/ipac/irsa/irsa.html","key":"Y3DHih33eY"},{"type":"text","value":" and the Simple Image Access (SIA) API.","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"lGmIORiBjM"}],"key":"ll66C9M6zD"}],"key":"IQFiPiAsAX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"results = Irsa.query_sia(pos=(coord, search_radius), collection=sia_collection)\nresults_summary(results)","key":"r2OjCl2bH7"},{"type":"outputs","id":"xDfvwXZuVBr2cWwGstdiH","children":[],"key":"O8os6eBf3q"}],"key":"ji147no2tg"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"children":[{"type":"text","value":"Note that we have used the collection ","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"mGN8mcXRrA"},{"type":"inlineCode","value":"spherex_qr2","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"RnSwzm9nSd"},{"type":"text","value":" in this case. All the available collections are documented at ","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"LpZAXyP65b"},{"type":"link","url":"https://caltech-ipac.github.io/spherex-archive-documentation/spherex-data-access#application-program-interfaces-apis","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"children":[{"type":"text","value":"SPHEREx Data Access: Application Program Interfaces (APIs)","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"SFJwWFxrSf"}],"urlSource":"https://caltech-ipac.github.io/spherex-archive-documentation/spherex-data-access#application-program-interfaces-apis","key":"DElCL6Mc6Q"},{"type":"text","value":".","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"jbYClOLqYi"}],"key":"kMsbHSgNvr"}],"key":"efBp1BjbUH"},{"type":"block","position":{"start":{"line":193,"column":1},"end":{"line":193,"column":1}},"children":[{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"GP6rfAwWct"}],"key":"jBanQMc5rr"},{"type":"paragraph","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"children":[{"type":"text","value":"The IRSA SIA collections can be listed using using the ","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"ECGt2orB3A"},{"type":"inlineCode","value":"list_collections","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"dIyryATIOp"},{"type":"text","value":" method, we can filter on the ones containing “spherex” in the collection name:","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"ReNqCLHmj2"}],"key":"kXHyz6zt20"},{"type":"code","lang":"","value":"Irsa.list_collections(filter='spherex')","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"V2yLDMUC8W"}],"key":"DJx555ykHO"}],"key":"om0BumiX5Y"},{"type":"block","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"children":[],"key":"n2wKIoRPnG"},{"type":"block","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"children":[{"type":"text","value":"Next, we set up the ","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"NWOWIxlY93"},{"type":"emphasis","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"FkqpWkyVZa"}],"key":"jEzwHp2ruR"},{"type":"text","value":" client and use it to visualize one image with the search coordinates (and search radius) indicated.","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"cdVG8IHnei"}],"key":"Lpal2nSytK"},{"type":"paragraph","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":1}},"children":[{"type":"text","value":"There are two ways to run ","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":1}},"key":"k0RI6eiB2z"},{"type":"emphasis","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":1}},"key":"SMOx3am9OX"}],"key":"uxhAcbYM3p"},{"type":"text","value":" from the JupyterLab environment:","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":1}},"key":"qoA0oUU6KE"}],"key":"mnIbRgQ99d"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":208,"column":1},"end":{"line":210,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Open it in another browser tab","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"WJj6KwcfDC"}],"key":"ZWwtC6HEmW"}],"key":"eoltK7jPBL"},{"type":"listItem","spread":true,"position":{"start":{"line":209,"column":1},"end":{"line":210,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Open it in another Jupyter Notebook tab","position":{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},"key":"t04onPgfuc"}],"key":"uXdFwyoso2"}],"key":"pbUaHy2aFI"}],"key":"v5omVCQ5vO"},{"type":"paragraph","position":{"start":{"line":211,"column":1},"end":{"line":212,"column":1}},"children":[{"type":"text","value":"The second option requires setting some environment variables and installing the ","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"j5QEfbGrE3"},{"type":"emphasis","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"j1qwSuf70P"}],"key":"TuUvjRru5e"},{"type":"text","value":" JupyterLab extension. See ","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"u9iIjeyS4Y"},{"type":"link","url":"https://github.com/Caltech-IPAC/jupyter_firefly_extensions/blob/master/README.md","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"rHhqCU6JwN"}],"urlSource":"https://github.com/Caltech-IPAC/jupyter_firefly_extensions/blob/master/README.md","data":{"kind":"file","org":"Caltech-IPAC","repo":"jupyter_firefly_extensions","reference":"master","file":"README.md","raw":"https://raw.githubusercontent.com/Caltech-IPAC/jupyter_firefly_extensions/master/README.md"},"internal":false,"protocol":"github","key":"Y6zuD8CkXP"},{"type":"text","value":" for more information on how to do that.\nMore information can be found in the ","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"vB0o1L2nGI"},{"type":"link","url":"https://caltech-ipac.github.io/firefly_client/usage/","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"OnSPtYZtZC"}],"key":"KWzk6hTAye"},{"type":"text","value":" documentation","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"zmOCRW4DVO"}],"urlSource":"https://caltech-ipac.github.io/firefly_client/usage/","key":"AXcCwnO0UJ"},{"type":"text","value":".","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"F7Zj2YC1fP"}],"key":"V2ThDAfQdn"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"pieMnkPZ2S"}],"key":"rm2gkYQnpe"},{"type":"paragraph","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"children":[{"type":"text","value":"If you open ","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"oHkh30L8nn"},{"type":"emphasis","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"JmZHc8upaj"}],"key":"OWIAvjt7D5"},{"type":"text","value":" in a new Jupyter Notebook tab, you can drag the ","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"o5iQco9Ccl"},{"type":"emphasis","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"CKDY0FJ0SM"}],"key":"EvWMALtNYD"},{"type":"text","value":" tab to the right to enable split view. That way you can see the ","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"oLcgT8PuyK"},{"type":"emphasis","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"N9MMosA25k"}],"key":"GQ5XmwxLHL"},{"type":"text","value":" window next to this notebook, which makes it more convenient for visualization.","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"XVP1A1TlXy"}],"key":"OydpElMDxz"}],"key":"Zwk5S7NkQF"},{"type":"paragraph","position":{"start":{"line":219,"column":1},"end":{"line":219,"column":1}},"children":[{"type":"text","value":"Below, we give the two options to open ","position":{"start":{"line":219,"column":1},"end":{"line":219,"column":1}},"key":"TD9qzMcram"},{"type":"emphasis","position":{"start":{"line":219,"column":1},"end":{"line":219,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":219,"column":1},"end":{"line":219,"column":1}},"key":"dcf5YJ2JuC"}],"key":"KAGquCrszM"},{"type":"text","value":".","position":{"start":{"line":219,"column":1},"end":{"line":219,"column":1}},"key":"DtOkOgmLT0"}],"key":"tGTWk19j3h"}],"key":"ATcEESmzgl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set up Firefly client to open in a new browser tab\n#fc = FireflyClient.make_client(url=\"https://irsa.ipac.caltech.edu/irsaviewer\")\n\n# Set up Firefly client to open in new JupyterLab tab\nfc = FireflyClient.make_lab_client()\n\n# Initiate Firefly\nfc.reinit_viewer()\n\n# Show image\npreview_query(fc, results['access_url'][0], coord, search_radius)","key":"g4AecYQJVn"},{"type":"outputs","id":"zNN79Izr0bl_0jjIbj32V","children":[],"key":"V90hTX1pCX"}],"key":"nJEapYekd4"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":235,"column":1},"end":{"line":236,"column":1}},"children":[{"type":"text","value":"Now, we select two images, one each in Detector 2 (D2) and Detector (D4). For simplicity, we just select the first image in Detector 2 and the first in Detector 4.\nDetector 2 covers 1.10 - 1.62 ","position":{"start":{"line":235,"column":1},"end":{"line":235,"column":1}},"key":"fDVHr3A6FF"},{"type":"inlineMath","value":"\\mu","position":{"start":{"line":235,"column":1},"end":{"line":235,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eμ\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\mu\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eμ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"JvdAl4KMEP"},{"type":"text","value":"m and Detector 4 covers 2.42 - 3.82 ","position":{"start":{"line":235,"column":1},"end":{"line":235,"column":1}},"key":"EZOAqe0FSi"},{"type":"inlineMath","value":"\\mu","position":{"start":{"line":235,"column":1},"end":{"line":235,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eμ\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\mu\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eμ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"CAc3XXQBHB"},{"type":"text","value":"m.","position":{"start":{"line":235,"column":1},"end":{"line":235,"column":1}},"key":"fQjTb7L4hM"}],"key":"nHi0wbGqIw"},{"type":"paragraph","position":{"start":{"line":238,"column":1},"end":{"line":238,"column":1}},"children":[{"type":"text","value":"We can use two different methods to obtain the images:","position":{"start":{"line":238,"column":1},"end":{"line":238,"column":1}},"key":"IVwAsOJiQS"}],"key":"rkJUyEvQ4y"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":239,"column":1},"end":{"line":241,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"using a boolean mask selecting ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"Ec4cVOTJVi"},{"type":"inlineCode","value":"energy_bandpassname","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"DLX8GQxe8l"},{"type":"text","value":" as “SPHEREx_D2”","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"Y7Dtq7Dk4c"}],"key":"Jt1Y45ORNq"}],"key":"Lfz3VK4kns"},{"type":"listItem","spread":true,"position":{"start":{"line":240,"column":1},"end":{"line":241,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"using the ","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"key":"XQAuOynLp3"},{"type":"inlineCode","value":"astropy.table.TableGroups","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"key":"MTYMyaLTun"}],"key":"iky4teFmFR"}],"key":"pm1xSuJgPS"}],"key":"MMf4Vlp2i7"},{"type":"paragraph","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"children":[{"type":"text","value":"We show both methods below, the first one for the detector 2 spectral image and the second one for the detector 4 spectral image.","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"key":"RV5uxFPuUm"}],"key":"lPttLcGxV9"}],"key":"nyC7HgfJKl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Using a boolean mask\nd2_result = results[results['energy_bandpassname'] == 'SPHEREx-D2'][0]  # first D2 image\n\n# Using `astropy.table.TableGroups`\nresults_by_detector = results.group_by('energy_bandpassname')\nprint(results_by_detector.groups.keys)\nd4_result = results_by_detector.groups[3][0]  # first D4 image","key":"cqPpHTydDb"},{"type":"outputs","id":"l7qQC5B0c4cZLVaSWs2mj","children":[],"key":"vdYsV6prLX"}],"key":"dVv85CFJR7"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":254,"column":1},"end":{"line":254,"column":1}},"children":[{"type":"text","value":"7. Load the Data","position":{"start":{"line":254,"column":1},"end":{"line":254,"column":1}},"key":"sTqTPuc3RD"}],"identifier":"id-7-load-the-data","label":"7. Load the Data","html_id":"id-7-load-the-data","implicit":true,"key":"FCnX8HGmRZ"},{"type":"paragraph","position":{"start":{"line":256,"column":1},"end":{"line":256,"column":1}},"children":[{"type":"text","value":"Next, we download the two SPHEREx spectral images. We download them directly from the cloud.","position":{"start":{"line":256,"column":1},"end":{"line":256,"column":1}},"key":"xmeZwC7Jjb"}],"key":"iOMuv1ccy2"},{"type":"paragraph","position":{"start":{"line":258,"column":1},"end":{"line":258,"column":1}},"children":[{"type":"text","value":"For this, we first define a handy function to obtain the S3 cloud path.","position":{"start":{"line":258,"column":1},"end":{"line":258,"column":1}},"key":"jmaGDwxjcZ"}],"key":"o7O7I0FEBf"}],"key":"oZgYMUTrYw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Function to access data from cloud\ndef get_s3_fpath(cloud_access):\n    cloud_info = json.loads(cloud_access) # converts str to dict\n    bucket_name = cloud_info['aws']['bucket_name']\n    key = cloud_info['aws']['key']\n    return f'{bucket_name}/{key}'","key":"xiLASgqcZW"},{"type":"outputs","id":"elvMOt3z1M18Lulr-hi8t","children":[],"key":"LO5dhUVQdp"}],"key":"hQ8864x87I"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":269,"column":1},"end":{"line":269,"column":1}},"children":[{"type":"text","value":"Next we download the images.","position":{"start":{"line":269,"column":1},"end":{"line":269,"column":1}},"key":"rMRz3seJxD"}],"key":"MwDzcALToM"}],"key":"Qp05lHfOuR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# HDUs for D2 image\ns3_fpath_d2 = get_s3_fpath(d2_result['cloud_access'])\nwith fits.open(f's3://{s3_fpath_d2}', fsspec_kwargs={\"anon\": True}) as hdul2:\n    img_hdu2 = hdul2[\"IMAGE\"].copy()\n    img_data2 = hdul2[\"IMAGE\"].data\n    img_hdr2 = hdul2[\"IMAGE\"].header\n    flags_data2 = hdul2[\"FLAGS\"].data\n\n# HDUs for D4 image\ns3_fpath_d4 = get_s3_fpath(d4_result['cloud_access'])\nwith fits.open(f's3://{s3_fpath_d4}', fsspec_kwargs={\"anon\": True}) as hdul4:\n    img_hdu4 = hdul4[\"IMAGE\"].copy()\n    img_data4 = hdul4[\"IMAGE\"].data\n    img_hdr4 = hdul4[\"IMAGE\"].header\n    flags_data4 = hdul4[\"FLAGS\"].data","key":"jTG37ez7x5"},{"type":"outputs","id":"hkhy0uguzOE_MO4XlUHCl","children":[],"key":"I350x5fmJF"}],"key":"IosdZNXNGu"},{"type":"block","children":[{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"XJLmeFHHjC"}],"key":"fRaCIt3Zl9"},{"type":"paragraph","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"children":[{"type":"text","value":"If you want to download the SPHEREx spectral images from IPAC directly (not from the cloud), simply use instead, for example,","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"key":"urq5OoOwIL"}],"key":"elCGbvkYng"},{"type":"code","lang":"","value":"with fits.open(d2_result['access_url']) as hdul2:\n    ...","position":{"start":{"line":293,"column":1},"end":{"line":294,"column":1}},"key":"IQaTCWq4z8"}],"key":"cocxlJpxuI"}],"key":"qs7irm3CVs"},{"type":"block","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"children":[{"type":"text","value":"8. Remove Local Background, Create Masks, and Reproject","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"Rbg1KP5uEd"}],"identifier":"id-8-remove-local-background-create-masks-and-reproject","label":"8. Remove Local Background, Create Masks, and Reproject","html_id":"id-8-remove-local-background-create-masks-and-reproject","implicit":true,"key":"YNU2urg215"},{"type":"paragraph","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"children":[{"type":"text","value":"Before we can subtract the images, we have to do some preprocessing. This includes:","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"IYwhhTslSB"}],"key":"drbScvwPoZ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":304,"column":1},"end":{"line":308,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Converting from surface brightness to flux density units","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"soeVwH8ktW"}],"key":"C2O46sttMw"}],"key":"CQFP1lRP25"},{"type":"listItem","spread":true,"position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Removing the background","position":{"start":{"line":305,"column":1},"end":{"line":305,"column":1}},"key":"WJCEWlwSYh"}],"key":"oSmDZIlVWN"}],"key":"wiXrQVDP3f"},{"type":"listItem","spread":true,"position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Creating masks to mask out bad pixels","position":{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},"key":"zqTUpU8MNZ"}],"key":"fdoZewSOGr"}],"key":"hIiMqRUqSR"},{"type":"listItem","spread":true,"position":{"start":{"line":307,"column":1},"end":{"line":308,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Reproject the images on a common pixel grid (necessary for pixel-by-pixel subtraction of images later)","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"kS8C54GHLt"}],"key":"QFSzW0eLpi"}],"key":"Hqqup2EC79"}],"key":"EXIWcg0yVw"},{"type":"paragraph","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"children":[{"type":"text","value":"First, we convert from surface brightness to flux units using the solid angle pixel map for each detector. We download these calibrations from the cloud using the S3 paths hardcoded below. Then, we use ","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"key":"HBPZwuahDU"},{"type":"inlineCode","value":"astropy.units","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"key":"g01GQH0Yso"},{"type":"text","value":" to convert the image data from MJy/sr to ","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"key":"u9uO16YmWq"},{"type":"inlineMath","value":"\\mu","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eμ\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\mu\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eμ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"u6Cj8lQOG2"},{"type":"text","value":"Jy/arcsec","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"key":"Kr7FMJMdOh"},{"type":"inlineMath","value":"^2","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmrow\u003e\u003c/mrow\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/msup\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e^2\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8141em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8141em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"uOpA3qvhT6"},{"type":"text","value":". This quantity is multiplied by the solid angle pixel map in arcsec","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"key":"BQAlf8tIJ4"},{"type":"inlineMath","value":"^2","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmrow\u003e\u003c/mrow\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/msup\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e^2\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8141em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8141em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"VtZnhxPOHs"},{"type":"text","value":" to get image data in units of ","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"key":"NaTz8Iy2gX"},{"type":"inlineMath","value":"\\mu","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eμ\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\mu\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eμ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"SdV5tBmY16"},{"type":"text","value":"Jy.","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"key":"Le9Cexb6Ha"}],"key":"LRWKm12p9E"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"yBdPgydbLA"}],"key":"Y6vVjcyyIy"},{"type":"paragraph","position":{"start":{"line":312,"column":1},"end":{"line":313,"column":1}},"children":[{"type":"text","value":"You can find more calibration products for the SPHEREx spectral images on the S3 bucket:\n","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"key":"EbfBydRDIA"},{"type":"link","url":"https://nasa-irsa-spherex.s3.us-east-1.amazonaws.com/index.html","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"children":[{"type":"text","value":"https://​nasa​-irsa​-spherex​.s3​.us​-east​-1​.amazonaws​.com​/index​.html","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"key":"IclHJ0AUx6"}],"urlSource":"https://nasa-irsa-spherex.s3.us-east-1.amazonaws.com/index.html","key":"z3Tm4gBEzH"}],"key":"qNxtMs8o3C"}],"key":"RG6aqq3ExT"}],"key":"tnLWhu3WhV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"s3_fpath_sapm2 = sapm_s3[1] # list idx 1 is value for D2 path\nwith fits.open(f's3://{s3_fpath_sapm2}', fsspec_kwargs={\"anon\": True}) as hdul_sapm2:\n    sapm_data2 = hdul_sapm2[\"IMAGE\"].data\n    sapm_hdr2 = hdul_sapm2[\"IMAGE\"].header\n\ns3_fpath_sapm4 = sapm_s3[3] # list idx 3 is value for D4 path\nwith fits.open(f\"s3://{s3_fpath_sapm4}\", fsspec_kwargs={\"anon\": True}) as hdul_sapm4:\n    sapm_data4 = hdul_sapm4[\"IMAGE\"].data\n    sapm_hdr4 = hdul_sapm4[\"IMAGE\"].header","key":"y0WVL2sf0N"},{"type":"outputs","id":"oT0dz31zqkMVHbR7LVn_9","children":[],"key":"xVbmkfGn9y"}],"key":"V3DFf9A6Sj"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":329,"column":1},"end":{"line":329,"column":1}},"children":[{"type":"text","value":"After downloading the solid angle pixel map calibration products for each detector, we convert the images from brightness (MJy/sr) to spectral flux density (","position":{"start":{"line":329,"column":1},"end":{"line":329,"column":1}},"key":"PiaUyGOtmR"},{"type":"inlineMath","value":"\\mu","position":{"start":{"line":329,"column":1},"end":{"line":329,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eμ\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\mu\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eμ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"URpumHbXgi"},{"type":"text","value":"Jy) and update the corresponding units in the headers of the imates.","position":{"start":{"line":329,"column":1},"end":{"line":329,"column":1}},"key":"Fv4kbr5V9z"}],"key":"UOLwF22DpN"}],"key":"ApNzJQZvyH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"Spectral image BUNIT: {img_hdr2['BUNIT']}\")\nprint(f\"Solid angle pixel map BUNIT: {sapm_hdr2['BUNIT']}\")\n\nimg_data2 = ((img_data2 * Unit(img_hdr2[\"BUNIT\"])).to(u.uJy / u.arcsec**2) * (sapm_data2 * Unit(sapm_hdr2[\"BUNIT\"]))).value\nimg_hdu2.header[\"BUNIT\"] = \"uJy\"\nimg_hdr2[\"BUNIT\"] = \"uJy\"\n\nimg_data4 = ((img_data4 * Unit(img_hdr4[\"BUNIT\"])).to(u.uJy / u.arcsec**2) * (sapm_data4 * Unit(sapm_hdr4[\"BUNIT\"]))).value\nimg_hdu4.header[\"BUNIT\"] = \"uJy\"\nimg_hdr4[\"BUNIT\"] = \"uJy\"","key":"QIXlN9aqDE"},{"type":"outputs","id":"fTdb01M6x-DFMxJlKv2wX","children":[],"key":"gwqCgegbPw"}],"key":"GRgCCISCTb"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"children":[{"type":"text","value":"Next, we remove the background from both images. We estimate the background using the ","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"key":"UEpfat56r0"},{"type":"inlineCode","value":"sep","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"key":"lICYR3BU7i"},{"type":"text","value":" Python package, which allows fitting a non-parametric background to an image in user-defined zones.","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"key":"IRJHM9zhhv"}],"key":"qcy4s1pQeJ"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"et73Gy6Lu5"}],"key":"IPxcTUZeAn"},{"type":"paragraph","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"children":[{"type":"inlineCode","value":"sep","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"key":"ohYZ9qnUTw"},{"type":"text","value":" only support native byte order arrays. We therefore have to apply","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"key":"qXQ0VStMbm"}],"key":"XEtH9LbhYD"},{"type":"code","lang":"","value":"img.astype(img.dtype.newbyteorder(\"=\"))","position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"key":"AJkTxVi1na"},{"type":"paragraph","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"children":[{"type":"text","value":"before feeding it to ","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"key":"qJSl6mOnxL"},{"type":"inlineCode","value":"sep","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"key":"t2ztTdZH5Z"},{"type":"text","value":".","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"key":"CtVk2hGa9R"}],"key":"CupUvQSo4t"}],"key":"R65wsKJjFo"}],"key":"I20jSCtDKI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bkg2 = sep.Background(img_data2.astype(img_data2.dtype.newbyteorder(\"=\")), bw=64, bh=64, fw=11, fh=11)\nimg_data2 = img_data2 - bkg2\n\nbkg4 = sep.Background(img_data4.astype(img_data4.dtype.newbyteorder(\"=\")), bw=64, bh=64, fw=11, fh=11)\nimg_data4 = img_data4 - bkg4","key":"IeN8r7qAov"},{"type":"outputs","id":"VfQ4PDnRuNCcVfYK31RUN","children":[],"key":"wWs0Fx6FLW"}],"key":"i9s25LQFSb"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":362,"column":1},"end":{"line":366,"column":1}},"children":[{"type":"text","value":"Next we create masks (which also need to be reprojected). The merged masks will be applied later to the difference image.\nNote that flags ","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"key":"YcCqn5eXPw"},{"type":"inlineCode","value":"2097152","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"key":"WwtINshn6q"},{"type":"text","value":" (which corresponds to ","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"key":"vwhflhwIJx"},{"type":"span","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"children":[{"type":"text","value":"2","key":"tgprVa21hz"},{"type":"superscript","children":[{"type":"text","value":"21","key":"xiOXN8i0YP"}],"key":"cRkKxyfeym"}],"key":"xJEga0Cjvp"},{"type":"text","value":", so bit 21), is assigned to pixel which are not contaminated by image errors, transients, cosmic rays, etc.\nNote that we ignore the ","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"key":"SVj69REozy"},{"type":"inlineCode","value":"OVERFLOW","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"key":"lXfcHtrCYE"},{"type":"text","value":" flag, which is coincident with the ","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"key":"E2KXzauWVE"},{"type":"inlineCode","value":"SUR_ERROR","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"key":"KYitZrU8YI"},{"type":"text","value":" flag. See the ","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"key":"V1vR6HSYHf"},{"type":"link","url":"https://irsa.ipac.caltech.edu/onlinehelp/spherex/spherex/sp.html#explorebitflags","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"children":[{"type":"text","value":"SPHEREx bitmask flag description","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"key":"MO2nPRVMuW"}],"urlSource":"https://irsa.ipac.caltech.edu/onlinehelp/spherex/spherex/sp.html#explorebitflags","key":"VFoap4SY5F"},{"type":"text","value":" for more information about the different flag bits.\nWe therefore choose these as good pixels and flag the other ones.\nFor simplicity, we set the bad pixels to ","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"key":"TP5htWlYpe"},{"type":"inlineCode","value":"np.nan","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"key":"BureHBMAYt"},{"type":"text","value":".","position":{"start":{"line":362,"column":1},"end":{"line":362,"column":1}},"key":"XauWKKiMIO"}],"key":"zP3tjHWnpa"}],"key":"rlNwXwmxXu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"mask2 = np.zeros(flags_data2.shape) * np.nan\nmask2[(flags_data2 == 2097152) | (flags_data2 == 2) | (flags_data2 == 0)] = 1\n\nmask4 = np.zeros(flags_data4.shape) * np.nan\nmask4[(flags_data4 == 2097152) | (flags_data2 == 2) | (flags_data4 == 0)] = 1","key":"Svx9ikM7bM"},{"type":"outputs","id":"JUesgUoZR9DTE0KIVlcSq","children":[],"key":"U1W0fExQ9q"}],"key":"styztExfkY"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"children":[{"type":"text","value":"Finally, we reproject the images and masks to the same pixel grid. We reproject D2 on D4. For this we use ","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"XLkEAmLUuc"},{"type":"inlineCode","value":"reproject_exact()","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"KkZVlS276B"},{"type":"text","value":" (for flux conservation) and ","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"ufhpydLinN"},{"type":"inlineCode","value":"reproject_interp()","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"wXM5XZtTr8"},{"type":"text","value":" (for mask) from the ","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"KCufipOxwM"},{"type":"emphasis","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"children":[{"type":"text","value":"reproject","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"ExrL0ckS84"}],"key":"h6FskWQWeG"},{"type":"text","value":" Python package.","position":{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},"key":"v9n8NP9KTE"}],"key":"im5TYjyy3y"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"mhwHkoVGCt"}],"key":"slwKTwbU32"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":379,"column":1},"end":{"line":380,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"reproject_exact","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"paYlZOXkdL"},{"type":"text","value":" conserves the total flux, but it takes slightly longer than non-exact methods. The cell below should take between 2-3 minutes to execute.","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"vac8wQZMGU"}],"key":"XfyLv0ZW4R"}],"key":"YA5iP9Fnvm"},{"type":"listItem","spread":true,"position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Due to the bilinear method applied in ","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"key":"mYeCWuIayM"},{"type":"inlineCode","value":"reproject_interp","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"key":"AuBj0GogXA"},{"type":"text","value":", single-pixel NaNs get conservatively extended into multi-pixel NaN regions.","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"key":"VmGShHZq4F"}],"key":"IKWPuqnXxT"}],"key":"DYvTrtUR8Q"}],"key":"wqkE0SlI9B"}],"key":"zXGTJVhz88"}],"key":"YCLrqzi1vV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"img_data2_reproj, footprint = reproject_exact(input_data=(img_data2, img_hdr2), output_projection=img_hdr4)\nfootprint[footprint == 0] = np.nan  # Set zero values to NaN\nmask2_reproj, _ = reproject_interp(input_data=(mask2, img_hdr2), output_projection=img_hdr4)","key":"ZbRTUsrKDl"},{"type":"outputs","id":"RHIrAR4Q9_J4CIFdvTbF5","children":[],"key":"rvgbt5OkuI"}],"key":"q5U6cBEysY"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"children":[{"type":"text","value":"We use ","position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"key":"DENWIv11Wb"},{"type":"emphasis","position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"children":[{"type":"text","value":"bokeh","position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"key":"StZ86vzteb"}],"key":"rBl4zYKesQ"},{"type":"text","value":" to visualize the two detector images as well as the reprojected D4 image. See the file ","position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"key":"nXyM9dn6FV"},{"type":"inlineCode","value":"spherex_source_discovery_tool/bokeh_viz.py","position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"key":"MBxqpgy1dO"},{"type":"text","value":" for more information on the used function ","position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"key":"il9he31i3R"},{"type":"inlineCode","value":"plot_overlap_trio()","position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"key":"GsDT1JklBr"},{"type":"text","value":" to learn how to use ","position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"key":"MKRuHeZ60b"},{"type":"emphasis","position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"children":[{"type":"text","value":"bokeh","position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"key":"GCHqqskSM3"}],"key":"NIlq9nX5pz"},{"type":"text","value":".","position":{"start":{"line":389,"column":1},"end":{"line":389,"column":1}},"key":"lUAiA33zmN"}],"key":"MM72VG1XWt"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"JiGrPIf0kb"}],"key":"tuP2WSYzqL"},{"type":"paragraph","position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"children":[{"type":"text","value":"The initial bokeh plot has a ~20 second rendering penalty due to static asset loading. Subsequent bokeh plots should take less time to display.","position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"key":"LuYCcaCB2A"}],"key":"hUBako6oQ7"}],"key":"hVu65bVcjN"}],"key":"w5UIxdWZgS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Plot data\nplot1_info = {\n    \"img_data\": img_data4,\n    \"title\": \"D4 Image\",\n    \"units\": img_hdu4.header[\"BUNIT\"]\n}\nplot2_info = {\n    \"img_data\": img_data2_reproj * footprint,\n    \"title\": \"D2 Reprojected on D4\",\n    \"units\": img_hdu2.header[\"BUNIT\"]\n}\nplot3_info = {\n    \"img_data\": img_data4 * footprint,\n    \"title\": \"D4 Image with D2 Footprint Mask\",\n    \"units\": img_hdu4.header[\"BUNIT\"]\n}\n\nplot_overlap_trio(plot1_info, plot2_info, plot3_info, clip=True)","key":"Y6FrHX6qG5"},{"type":"outputs","id":"7SzxvvA7ikqALZS7iaOQn","children":[],"key":"pJv4hYfxSL"}],"key":"iwrqZbXPJQ"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":416,"column":1},"end":{"line":416,"column":1}},"children":[{"type":"text","value":"9. Generate Cutouts and Subtracted Color Image","position":{"start":{"line":416,"column":1},"end":{"line":416,"column":1}},"key":"BlILmgGKpm"}],"identifier":"id-9-generate-cutouts-and-subtracted-color-image","label":"9. Generate Cutouts and Subtracted Color Image","html_id":"id-9-generate-cutouts-and-subtracted-color-image","implicit":true,"key":"wD4WdtSQpt"}],"key":"f5eTA9vw4S"},{"type":"block","position":{"start":{"line":418,"column":1},"end":{"line":418,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},"children":[{"type":"text","value":"For this example, we only use parts of the image. For this, we first generate cutouts of the D4 image as well as the reprojected D2 image.","position":{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},"key":"xITE4DHXTE"}],"key":"Txa0ynWpBK"}],"key":"OtYBLPboPJ"},{"type":"block","position":{"start":{"line":422,"column":1},"end":{"line":422,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":424,"column":1},"end":{"line":424,"column":1}},"children":[{"type":"text","value":"Next, we subtract the images. For keeping track of the wavelength and file names, we create two handy dictionaries.","position":{"start":{"line":424,"column":1},"end":{"line":424,"column":1}},"key":"brw1gjgQE8"}],"key":"EBJx2PwSsa"},{"type":"paragraph","position":{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},"children":[{"type":"text","value":"Finally, we use ","position":{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},"key":"eCzGbnovTM"},{"type":"emphasis","position":{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},"children":[{"type":"text","value":"bokeh","position":{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},"key":"LOKN1slxzJ"}],"key":"iTBdsBkNnZ"},{"type":"text","value":" to show interactive representation of the two images as well as the subtracted image ","position":{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},"key":"RdCF8r7wFU"},{"type":"emphasis","position":{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},"children":[{"type":"text","value":"inside","position":{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},"key":"liqqwK7WQX"}],"key":"g7KQgd8xIg"},{"type":"text","value":" this Jupyter Notebook.","position":{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},"key":"ccxtNrU0Qp"}],"key":"EcQArToKra"}],"key":"KZapc7xrIY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set up data directory and cutout paths\ndata_dir = './data/'\nif not os.path.exists(data_dir):\n    os.mkdir(data_dir)\n\ncut_path2 = os.path.join(data_dir , f\"cutout_{get_filename(d2_result['access_url'])}\")\ncut_path4 = os.path.join(data_dir , f\"cutout_{get_filename(d4_result['access_url'])}\")\n\n# Generate cutouts from input images\n# NOTE: We use D4's WCS for both cutouts since we reprojected\ncut2 = Cutout2D(img_data2_reproj, position=coord, size=(150, 150), wcs=WCS(img_hdu4.header))\ncut2_hdu = copy.deepcopy(img_hdu4)  # make copy to avoid modifying HDU of full-size image\ncut2_hdu.data = cut2.data\ncut2_hdu.header.update(cut2.wcs.to_header())\ncut2_hdu.writeto(cut_path2, overwrite=True)\ncut2_mask = Cutout2D(mask2_reproj, position=coord, size=(150, 150), wcs=WCS(img_hdu4.header))\n\ncut4 = Cutout2D(img_data4*footprint, position=coord, size=(150, 150), wcs=WCS(img_hdu4.header))\ncut4_hdu = copy.deepcopy(img_hdu4)  # make copy to avoid modifying HDU of full-size image\ncut4_hdu.data = cut4.data\ncut4_hdu.header.update(cut4.wcs.to_header())\ncut4_hdu.writeto(cut_path4, overwrite=True)\ncut4_mask = Cutout2D(mask4, position=coord, size=(150, 150), wcs=WCS(img_hdu4.header))","key":"DzQ36P7Fhx"},{"type":"outputs","id":"pjnaFTUNDzvJ48PXjBFqD","children":[],"key":"pROUFrXM1x"}],"key":"oknQ4Dolya"},{"type":"block","children":[],"key":"KQusVOkmHS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"d2_range = get_lambda_range(d2_result)\nd2_info = {\n    \"img_data\": cut2.data,\n    \"title\": rf\"{d2_range[0]:.2f}-{d2_range[1]:.2f} um (D2)\",\n    \"units\": img_hdr2[\"BUNIT\"]\n}\n\nd4_range = get_lambda_range(d4_result)\nd4_info = {\n    \"img_data\": cut4.data,\n    \"title\": rf\"{d4_range[0]:.2f}-{d4_range[1]:.2f} um (D4)\",\n    \"units\": img_hdr4[\"BUNIT\"]\n}\n\nsubtracted_info = {\n    \"img_data\": np.subtract(cut2.data, cut4.data),\n    \"title\": \"Subtracted (D2-D4)\",\n    \"units\": img_hdr4[\"BUNIT\"]\n}\n\nsubtracted_masked_info = {\n    \"img_data\": np.subtract(cut2.data, cut4.data) * cut2_mask.data * cut4_mask.data,\n    \"title\": \"Subtracted (D2-D4)\",\n    \"units\": img_hdr4[\"BUNIT\"]\n}\n\nplot_subtracted_trio(d2_info, d4_info, subtracted_masked_info, clip=True)","key":"TxLlvKudZQ"},{"type":"outputs","id":"YAA6O0QT6-b6ieWgwSWON","children":[],"key":"OFvR8ASReN"}],"key":"kayt6Vhb8D"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":484,"column":1},"end":{"line":484,"column":1}},"children":[{"type":"text","value":"10. Run ","position":{"start":{"line":484,"column":1},"end":{"line":484,"column":1}},"key":"aakRiudtta"},{"type":"inlineCode","value":"SExtractor","key":"mi1mkWeROJ"},{"type":"text","value":" on the Subtracted Color Image","position":{"start":{"line":484,"column":1},"end":{"line":484,"column":1}},"key":"XIpcvacLtK"}],"identifier":"id-10-run-sextractor-on-the-subtracted-color-image","label":"10. Run SExtractor on the Subtracted Color Image","html_id":"id-10-run-sextractor-on-the-subtracted-color-image","implicit":true,"key":"YQoBL4PbBk"},{"type":"paragraph","position":{"start":{"line":486,"column":1},"end":{"line":486,"column":1}},"children":[{"type":"text","value":"A use case could be to search for red sources such as galaxies with an Active Galactic Nucleus (AGN), which are manifested by red mid-infrared colors. Such red sources can be identified on the subtracted image.","position":{"start":{"line":486,"column":1},"end":{"line":486,"column":1}},"key":"XnCEA1pXna"}],"key":"CCqZlEroyn"},{"type":"paragraph","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"children":[{"type":"text","value":"In the following, we run ","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"key":"hdiqaqPbAO"},{"type":"link","url":"https://sextractor.readthedocs.io/en/latest/Introduction.html","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"children":[{"type":"inlineCode","value":"SExtractor","key":"bv6pepJrUd"}],"urlSource":"https://sextractor.readthedocs.io/en/latest/Introduction.html","key":"wKc3i30FVo"},{"type":"text","value":" on all the images (reprojected D2, D4, and subtracted image) to identify sources. Before that, however, we have to save the subtracted image to disk (note that the D2 and D4 cutouts are already saved to disk).","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"key":"sLInhV655S"}],"key":"h7ggfEI14y"}],"key":"Ie4hbpImTT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Save subtracted image to fits file for source extraction\nsubtracted_cut_path = os.path.join(data_dir , f\"subtracted_{get_exp_id(img_hdu2)}_{get_exp_id(img_hdu4)}.fits\")\nsub_hdu = copy.deepcopy(cut2_hdu)  # make copy to avoid modifying original\nsub_hdu.data = subtracted_info[\"img_data\"]\nsub_hdu.writeto(subtracted_cut_path, overwrite=True)","key":"XVMHRYfFJY"},{"type":"outputs","id":"_bJaACX0Fve5z4O6slxec","children":[],"key":"BajmQitv8R"}],"key":"TKSXAOKQXm"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":498,"column":1},"end":{"line":499,"column":1}},"children":[{"type":"text","value":"Now, we run ","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"TUzmZOju2E"},{"type":"inlineCode","value":"SExtractor","key":"qQpbjmExhj"},{"type":"text","value":". This software needs a few parameter files such as a configuration and parameter files as well as some others (for example a convolution filter). These files are provided in the ","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"C7fpoeDZkp"},{"type":"inlineCode","value":"spherex_source_discovery_tool","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"Sp43Z6tkdK"},{"type":"text","value":" directory. For ","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"SMpQtjX4Fj"},{"type":"inlineCode","value":"SExtractor","key":"aOKJdlRI3o"},{"type":"text","value":" to find them, we have to give it absolute path names to these files. We use ","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"UkK9i0mHqd"},{"type":"inlineCode","value":"os.path.realpath()","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"qhfECZayQu"},{"type":"text","value":" in the following to translate relative paths to absolute paths.\nFinally, we run ","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"Ug99EynZlm"},{"type":"inlineCode","value":"SExtractor","key":"Y0eDoxWv7j"},{"type":"text","value":" on the last lines.","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"JMUPTPI2sO"}],"key":"toXfZ47QvV"}],"key":"Nes8DcvzF8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sxt_config = get_sextractor_file(\"default_sdt.sex\", package=\"spherex_source_discovery_tool\")\nsxt_params = get_sextractor_file(\"default_sdt.param\", package=\"spherex_source_discovery_tool\")\nsxt_nnw = get_sextractor_file(\"default.nnw\", package=\"spherex_source_discovery_tool\")\nsxt_conv = get_sextractor_file(\"default.conv\", package=\"spherex_source_discovery_tool\")\n\nsubtracted_cat = os.path.realpath( os.path.join(data_dir , f\"subtracted_{get_exp_id(img_hdu2)}_{get_exp_id(img_hdu4)}.cat\")) # need to use absolute path here!\nd2_cat = os.path.realpath( os.path.join(data_dir , f\"{get_exp_id(img_hdu2)}.cat\") ) # need to use absolute path here!\nd4_cat = os.path.realpath( os.path.join(data_dir , f\"{get_exp_id(img_hdu4)}.cat\") ) # need to use absolute path here!\n\nrun_sextractor(os.path.realpath(subtracted_cut_path), sxt_config, sxt_params, subtracted_cat, sxt_nnw, sxt_conv)\nrun_sextractor(os.path.realpath(cut_path2), sxt_config, sxt_params, d2_cat, sxt_nnw, sxt_conv)\nrun_sextractor(os.path.realpath(cut_path4), sxt_config, sxt_params, d4_cat, sxt_nnw, sxt_conv)","key":"EARm8e8j4F"},{"type":"outputs","id":"nSAGewAgewM_LvjwBVklN","children":[],"key":"bcOZ2r3JGv"}],"key":"dhIuowCaQT"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":516,"column":1},"end":{"line":516,"column":1}},"children":[{"type":"text","value":"11. Select Sources Interactively","position":{"start":{"line":516,"column":1},"end":{"line":516,"column":1}},"key":"Pw03guo6yx"}],"identifier":"id-11-select-sources-interactively","label":"11. Select Sources Interactively","html_id":"id-11-select-sources-interactively","implicit":true,"key":"xkn4MJ5FXO"},{"type":"paragraph","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"children":[{"type":"text","value":"In the following, we show two ways to visualize the extracted sources on the images and how to interactively select interesting sources. (Note that you can always select the source automatically in Python using, for example, ","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"PLt5hCCWkw"},{"type":"inlineCode","value":"astropy","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"BzA4nXGTKG"},{"type":"text","value":" tables instead of doing it interactively.)","position":{"start":{"line":518,"column":1},"end":{"line":518,"column":1}},"key":"qKT8VTvZOy"}],"key":"WALWRJrMxB"},{"type":"paragraph","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"children":[{"type":"text","value":"First, we read in the ","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"fCP7FxOgLg"},{"type":"inlineCode","value":"SExtractor","key":"zhLdrVwyDP"},{"type":"text","value":" catalog. Note that we want to change ","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"zf4ZArL1m2"},{"type":"inlineCode","value":"ALPHA_J2000","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"K2GDrdNWbj"},{"type":"text","value":" and ","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"aMEjoVMKPu"},{"type":"inlineCode","value":"DELTA_J2000","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"ZEvVPQWdJ3"},{"type":"text","value":" to the more universal ","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"IpGUjtjitP"},{"type":"inlineCode","value":"ra","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"K75Bcdzt9i"},{"type":"text","value":" and ","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"Eq58ptdB6R"},{"type":"inlineCode","value":"dec","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"IMr17WeRrY"},{"type":"text","value":" column names. This is especially important for Firefly to be able to read the table out of the box and mark the source in the table on the images.","position":{"start":{"line":520,"column":1},"end":{"line":520,"column":1}},"key":"D0z9q4BwH6"}],"key":"UJ5iuUwAJy"}],"key":"An0ZLbFlrE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"extracted = Table.read(subtracted_cat , format=\"ascii\")\nextracted.rename_column(\"ALPHA_J2000\", \"ra\")\nextracted.rename_column(\"DELTA_J2000\", \"dec\")\nextracted.sort(keys=\"NUMBER\")","key":"FdwwO8y9LZ"},{"type":"outputs","id":"bAcQMCbJ1vjlXkAGbrPPC","children":[],"key":"FPCDG8iAII"}],"key":"S1DkwnVSPK"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":529,"column":1},"end":{"line":529,"column":1}},"children":[{"type":"text","value":"11.1 Using ","position":{"start":{"line":529,"column":1},"end":{"line":529,"column":1}},"key":"k7Zfa11kmm"},{"type":"emphasis","position":{"start":{"line":529,"column":1},"end":{"line":529,"column":1}},"children":[{"type":"text","value":"bokeh","position":{"start":{"line":529,"column":1},"end":{"line":529,"column":1}},"key":"xHsyZXjyxc"}],"key":"ysChg6VVlZ"},{"type":"text","value":" visualizations","position":{"start":{"line":529,"column":1},"end":{"line":529,"column":1}},"key":"jJUWR1TAUD"}],"identifier":"id-11-1-using-bokeh-visualizations","label":"11.1 Using bokeh visualizations","html_id":"id-11-1-using-bokeh-visualizations","implicit":true,"key":"DekHNiZ7v7"},{"type":"paragraph","position":{"start":{"line":531,"column":1},"end":{"line":531,"column":1}},"children":[{"type":"text","value":"First, we demonstrate how we can use ","position":{"start":{"line":531,"column":1},"end":{"line":531,"column":1}},"key":"qghaoBiGkv"},{"type":"emphasis","position":{"start":{"line":531,"column":1},"end":{"line":531,"column":1}},"children":[{"type":"text","value":"bokeh","position":{"start":{"line":531,"column":1},"end":{"line":531,"column":1}},"key":"L67bRMvXpk"}],"key":"MSz4GORr8Q"},{"type":"text","value":" to create an interactive dashboard to select sources.","position":{"start":{"line":531,"column":1},"end":{"line":531,"column":1}},"key":"GVcLVESeOJ"}],"key":"RuOp9Aof4e"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"E4oybgUuwM"}],"key":"doecIgw3Xo"},{"type":"paragraph","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"children":[{"type":"text","value":"Currently, ","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"AYj17PHkBF"},{"type":"emphasis","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"children":[{"type":"text","value":"bokeh","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"kSAZbKYhlI"}],"key":"TPMscJtwLX"},{"type":"text","value":" tables cannot be displayed in Fornax. Therefore the example below will not work. The user is encouraged to use ","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"CbW4RRpB3c"},{"type":"emphasis","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"IlI9Y8QsXC"}],"key":"pV7BnMIjZy"},{"type":"text","value":", which use is demonstrated in Section 10.2 below.","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"Xs6ww7GA6l"}],"key":"aN8T3vpbCL"}],"key":"kAfE4PuLzT"}],"key":"lkXeNsMZae"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plot_apertures(subtracted_cut_path, source_tab=extracted, label=\"Extracted Sources\", clip=True)","key":"AYcACj0WXu"},{"type":"outputs","id":"22ZhyNK1VZ5O_SDbB7LmP","children":[],"key":"ZRRuFq6QMy"}],"key":"daqPfEgRJh"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":541,"column":1},"end":{"line":541,"column":1}},"children":[{"type":"text","value":"Alternatively, the sources can be easily selected in Python itself by defining a selection function.","position":{"start":{"line":541,"column":1},"end":{"line":541,"column":1}},"key":"CPuUZBf0g4"}],"key":"pBNy7EZt3U"}],"key":"tVOYf491l7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Create custom selection function\ndef select_sources(sxt_tab):\n    \"\"\"Selects the 25 brightest sources from the SExtractor-generated catalog.\n\n    Parameters\n    ----------\n    sxt_tab: astropy.table.Table\n        Table of extracted sources, including named IDs and converted fluxes\n\n    Returns\n    -------\n    bright_tab: astropy.table.Table\n        Table of selected sources\n    \"\"\"\n    # Select bright sources (using automatic aperture flux for now)\n    sxt_tab.sort(\"FLUX_AUTO\", reverse=True)\n    bright_tab = sxt_tab[0:25]\n\n    return bright_tab\n\n# Preview selected sources\nselected = select_sources(extracted)\nplot_apertures(subtracted_cut_path, source_tab=selected, label=\"25 Brightest Sources\", clip=True)","key":"QKaCdw0zQZ"},{"type":"outputs","id":"Z0zSbvLOwATsrww_y7OWg","children":[],"key":"bihA7Ns4Wx"}],"key":"Dnt6pqGhcF"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":569,"column":1},"end":{"line":569,"column":1}},"children":[{"type":"text","value":"11.2 Using ","position":{"start":{"line":569,"column":1},"end":{"line":569,"column":1}},"key":"qWhouOPHWl"},{"type":"emphasis","position":{"start":{"line":569,"column":1},"end":{"line":569,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":569,"column":1},"end":{"line":569,"column":1}},"key":"Q1KoI460cY"}],"key":"n3ycCspZTA"},{"type":"text","value":" visualization","position":{"start":{"line":569,"column":1},"end":{"line":569,"column":1}},"key":"jYqLJFMulA"}],"identifier":"id-11-2-using-firefly-visualization","label":"11.2 Using Firefly visualization","html_id":"id-11-2-using-firefly-visualization","implicit":true,"key":"QA6LyXFgp3"},{"type":"paragraph","position":{"start":{"line":571,"column":1},"end":{"line":572,"column":1}},"children":[{"type":"text","value":"Alternatively to ","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"key":"jHwUy2G4iD"},{"type":"emphasis","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"children":[{"type":"text","value":"bokeh","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"key":"Uii84wIL4S"}],"key":"o8zvs425I3"},{"type":"text","value":", we can use the ","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"key":"f9N3sXi0iR"},{"type":"emphasis","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"key":"M5PB1sAlpK"}],"key":"m5jsNDgorm"},{"type":"text","value":" application to show the image including the data table. First we reinitiate ","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"key":"PVOuaFT0Cl"},{"type":"emphasis","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"key":"B3SLh31gfr"}],"key":"CO6K7R5sD2"},{"type":"text","value":", which will again open a new tab called “Firefly Viewer”.\nAs mentioned above, we give again two options for initiating ","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"key":"Ci906tp1X5"},{"type":"emphasis","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"key":"c2hgYf5HMS"}],"key":"QJuypanflY"},{"type":"text","value":"; in a new browser tab or a new JupterLab tab.","position":{"start":{"line":571,"column":1},"end":{"line":571,"column":1}},"key":"mxQsoATnXL"}],"key":"KWeREfG0zj"}],"key":"kSV7urvxoB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set up Firefly client in browser tab\n#fc = FireflyClient.make_client(url=\"https://irsa.ipac.caltech.edu/irsaviewer\")\n\n# Set up Firefly client in new JupyterLab tab\nfc = FireflyClient.make_lab_client()\n\nfc.reinit_viewer()","key":"c37CGic6mC"},{"type":"outputs","id":"wFT_VTBTEdctyPql48KZA","children":[],"key":"Fwt8YNq0bY"}],"key":"YnmgtC4GBO"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":584,"column":1},"end":{"line":584,"column":1}},"children":[{"type":"text","value":"Then, we load the images and finally the catalog to the application. ","position":{"start":{"line":584,"column":1},"end":{"line":584,"column":1}},"key":"aqx7YModen"},{"type":"emphasis","position":{"start":{"line":584,"column":1},"end":{"line":584,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":584,"column":1},"end":{"line":584,"column":1}},"key":"v6oCTzc7ph"}],"key":"NthfzJcFmE"},{"type":"text","value":" takes care of the rest!","position":{"start":{"line":584,"column":1},"end":{"line":584,"column":1}},"key":"T7j4OmgKln"}],"key":"gFo4swgRQC"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"rpWQ032fOj"}],"key":"y9rx1nfupO"},{"type":"paragraph","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"children":[{"type":"text","value":"We do not have to save the table to disk. Instead, we can use a “stream” and directly feed it to ","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"key":"KNc5Q3e4sx"},{"type":"emphasis","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"key":"zNeOzM0cyH"}],"key":"l2OkhYacaR"},{"type":"text","value":". We do this by using","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"key":"TbgEmrbKRk"}],"key":"nuJAGqm5Rq"},{"type":"code","lang":"","value":"io.BytesIO()","position":{"start":{"line":589,"column":1},"end":{"line":589,"column":1}},"key":"Fvsr8ERB9E"},{"type":"paragraph","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"children":[{"type":"text","value":"For more tips and tricks on how to use ","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"key":"NYU2YzCPcL"},{"type":"emphasis","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"key":"ockNGTwwcV"}],"key":"cc0ipdYG9B"},{"type":"text","value":" in Python, we encourage reviewing the ","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"key":"ldX4jVwCuG"},{"type":"link","url":"https://caltech-ipac.github.io/firefly_client/usage/","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"children":[{"type":"text","value":"Firefly","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"key":"zdrgNrrsmf"}],"key":"RyKgf7vrLb"},{"type":"text","value":" manual webpage","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"key":"lkAC8Jcxbg"}],"urlSource":"https://caltech-ipac.github.io/firefly_client/usage/","key":"J4Hnaa6QER"},{"type":"text","value":".","position":{"start":{"line":591,"column":1},"end":{"line":591,"column":1}},"key":"ugMHBrLJd7"}],"key":"IGXtVQMKNn"}],"key":"twJJLznEP0"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"iysUJEHFMU"}],"key":"FQJnglCwA1"},{"type":"paragraph","position":{"start":{"line":595,"column":1},"end":{"line":595,"column":1}},"children":[{"type":"text","value":"You can align and lock the images by their WCS by adding","position":{"start":{"line":595,"column":1},"end":{"line":595,"column":1}},"key":"mEMJJUtIve"}],"key":"qVQb2jGIvY"},{"type":"code","lang":"","value":"fc.align_images(lock_match=True)","position":{"start":{"line":597,"column":1},"end":{"line":597,"column":1}},"key":"E5ZAiNkqGp"}],"key":"tNqcUr5x84"}],"key":"gJC6ICR0CL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Load images\nfc.show_fits_image(\n        file_input=cut_path2,\n        plot_id=\"D2\",\n        Title=\"Detector 2\"\n    )\nfc.show_fits_image(\n        file_input=cut_path4,\n        plot_id=\"D4\",\n        Title=\"Detector 4\"\n    )\nfc.show_fits_image(\n        file_input=subtracted_cut_path,\n        plot_id=\"subtracted\",\n        Title=\"Subtracted image\"\n    )\nfc.align_images(lock_match=True)\n\n# Load table\ntbl_stream = io.BytesIO()\nextracted.write(tbl_stream, format='votable')\nfc.show_table(file_input=tbl_stream,\n              tbl_id=\"SExtractor Table\",\n              title='Table')","key":"StWGo51Njo"},{"type":"outputs","id":"RbHDSceyVYoIabeMVCXnG","children":[],"key":"pUB1JA11hd"}],"key":"M02X8IiGCQ"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":628,"column":1},"end":{"line":628,"column":1}},"children":[{"type":"text","value":"12. Perform Aperture Photometry on Selected Sources","position":{"start":{"line":628,"column":1},"end":{"line":628,"column":1}},"key":"ZLnIvHqjUz"}],"identifier":"id-12-perform-aperture-photometry-on-selected-sources","label":"12. Perform Aperture Photometry on Selected Sources","html_id":"id-12-perform-aperture-photometry-on-selected-sources","implicit":true,"key":"O1Tj0PX7SB"},{"type":"paragraph","position":{"start":{"line":630,"column":1},"end":{"line":630,"column":1}},"children":[{"type":"text","value":"Finally, we compute the SPHEREx spectra for selected sources. This includes downloading all the available SPHEREx spectral image cutouts for the sources and then measuring their photometry to generate a spectrum. For simplicity, we here perform aperture photometry but include background subtraction.","position":{"start":{"line":630,"column":1},"end":{"line":630,"column":1}},"key":"rjkDrD50Zg"}],"key":"yCgSDfzezB"},{"type":"heading","depth":3,"position":{"start":{"line":632,"column":1},"end":{"line":632,"column":1}},"children":[{"type":"text","value":"12.1 Download SPHEREx spectral image cutouts","position":{"start":{"line":632,"column":1},"end":{"line":632,"column":1}},"key":"SBk9fkx1zb"}],"identifier":"id-12-1-download-spherex-spectral-image-cutouts","label":"12.1 Download SPHEREx spectral image cutouts","html_id":"id-12-1-download-spherex-spectral-image-cutouts","implicit":true,"key":"AxJ9t5rJz6"},{"type":"paragraph","position":{"start":{"line":634,"column":1},"end":{"line":634,"column":1}},"children":[{"type":"text","value":"Here we select one source to proceed (multiple sources can be measured by looping over the code below). Note that we here directly give it the unique source ID that we defined in the catalog column ","position":{"start":{"line":634,"column":1},"end":{"line":634,"column":1}},"key":"kih1G7lu5l"},{"type":"inlineCode","value":"NUMBER","position":{"start":{"line":634,"column":1},"end":{"line":634,"column":1}},"key":"SrDkJQygeF"},{"type":"text","value":".","position":{"start":{"line":634,"column":1},"end":{"line":634,"column":1}},"key":"EnOkRRzds9"}],"key":"Rgphx1psTz"}],"key":"AfBYUSQtPD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"selected_ids = [65]\nmatched_stars = extracted[extracted['NUMBER'] == selected_ids[0]][\"NUMBER\", \"ra\", \"dec\"].to_pandas()","key":"gnWCHMh1Av"},{"type":"outputs","id":"Cv8oUnv3hYJvw32P2ANt6","children":[],"key":"inK2B3UOho"}],"key":"fU0ZB4YhAO"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":641,"column":1},"end":{"line":641,"column":1}},"children":[{"type":"text","value":"We then set up the TAP service as well as the cutout size to run a query for all SPHEREx spectral images that contain the sources.","position":{"start":{"line":641,"column":1},"end":{"line":641,"column":1}},"key":"pXHIs4u31c"}],"key":"N6rhOEp4nW"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"Ski85Wn62l"}],"key":"eL3Fd5NTNO"},{"type":"paragraph","position":{"start":{"line":643,"column":1},"end":{"line":643,"column":1}},"children":[{"type":"text","value":"Note that the following procedure follows the one shown in the SPHEREx ","position":{"start":{"line":643,"column":1},"end":{"line":643,"column":1}},"key":"BtaN7b5mCr"},{"type":"link","url":"https://caltech-ipac.github.io/irsa-tutorials/spherex-cutouts/","position":{"start":{"line":643,"column":1},"end":{"line":643,"column":1}},"children":[{"type":"text","value":"Image Cutout tutorial notebook","position":{"start":{"line":643,"column":1},"end":{"line":643,"column":1}},"key":"bkCkHrDViz"}],"urlSource":"https://caltech-ipac.github.io/irsa-tutorials/spherex-cutouts/","key":"LbyE4TOIW3"},{"type":"text","value":".","position":{"start":{"line":643,"column":1},"end":{"line":643,"column":1}},"key":"HzflJ1ssEO"}],"key":"MxuKrAPzkl"}],"key":"a6SbJ9oe4w"}],"key":"UqIpIhML2f"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Define the service endpoint for IRSA's Table Access Protocol (TAP)\n# so that we can query SPHEREx metadata tables.\nservice = pyvo.dal.TAPService(\"https://irsa.ipac.caltech.edu/TAP\")\n\n# Specify cutout size (approximately 60 pixels on a side)\nsize = 0.1 * u.degree\n\n# Define a query that will search the appropriate SPHEREx metadata tables\n# for spectral images that cover the chosen coordinates and match the\n# specified bandpass. Return the cutout data access URL and the time of observation.\n# Sort by observation time.\nquery = f\"\"\"\nSELECT\n    'https://irsa.ipac.caltech.edu/' || a.uri || '?center={matched_stars['ra'][0]},{matched_stars['dec'][0]}d\u0026size={size.value}' AS uri,\n    p.time_bounds_lower\nFROM spherex.artifact a\nJOIN spherex.plane p ON a.planeid = p.planeid\nWHERE 1 = CONTAINS(POINT('ICRS', {matched_stars['ra'][0]}, {matched_stars['dec'][0]}), p.poly)\nORDER BY p.time_bounds_lower\n\"\"\"\n\n# Execute the query and return as an astropy Table.\nt1 = time.time()\ntap_results = service.search(query)\nprint(\"Time to do TAP query: {:2.2f} seconds.\".format(time.time() - t1))\nprint(\"Number of images found: {}\".format(len(tap_results)))","key":"IN30yf9zHu"},{"type":"outputs","id":"_3qm2kHrgyOru-oXj69_f","children":[],"key":"qZgKNXFKCv"}],"key":"afDcyZ8k4O"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":675,"column":1},"end":{"line":675,"column":1}},"children":[{"type":"text","value":"We then define a handy function that downloads the images.","position":{"start":{"line":675,"column":1},"end":{"line":675,"column":1}},"key":"E2Y51MWRP0"}],"key":"aOu4eRZurr"}],"key":"B5U2oA90aO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def process_cutout(row, ra, dec, cache, retries=3, delay=5):\n    '''\n    Downloads the cutouts given in a row of the table including all SPHEREx images overlapping with a position.\n\n    Parameters\n    ----------\n    row : `astropy.table.Row`\n        Row of a table that will be changed in place by this function. The table\n        is created by the SQL TAP query.\n    ra, dec : `float`\n        RA and Dec coordinates (same as used for the TAP query) in degrees.\n    cache : `bool`\n        If set to `True`, the output of cached and the cutout processing will run faster next time.\n        Turn this feature off by setting `cache = False`.\n    retries : `int`, optional\n        Number of times to retry downloading the cutout in case of failure.\n    delay : `int`, optional\n        Delay in seconds between retries.\n    '''\n    for attempt in range(retries):\n        try:\n            with fits.open(row[\"uri\"]) as hdulist:\n                # There are seven HDUs:\n                # 0 contains minimal metadata in the header and no data.\n                # 1 through 6 are: IMAGE, FLAGS, VARIANCE, ZODI, PSF, WCS-WAVE\n                header = hdulist[1].header\n\n                # Fetch spatial and spectral WCS\n                spatial_wcs = WCS(header)\n                spectral_wcs = WCS(header, fobj=hdulist, key=\"W\")\n                spectral_wcs.sip = None  # disable SIP distortions\n                row[\"spectral_wcs\"] = spectral_wcs\n\n                # Compute wavelength/bandpass at source position\n                x_src, y_src = spatial_wcs.world_to_pixel(SkyCoord(ra=ra, dec=dec, unit=\"deg\", frame=\"icrs\"))\n                wl_src, bp_src = spectral_wcs.pixel_to_world(x_src, y_src)\n                row[\"central_wl_src\"] = wl_src.to(u.micrometer).value\n\n                # Collect the HDUs for this cutout and append the row's cutout_index to the EXTNAME.\n                hdus = []\n                for hdu in hdulist[1:]:  # skip the primary header\n                    hdu.header[\"EXTNAME\"] = f\"{hdu.header['EXTNAME']}{row['cutout_index']}\"\n                    hdus.append(hdu.copy())  # Copy so the data is available after the file is closed\n                row[\"hdus\"] = hdus\n        except TimeoutError:\n            if attempt == retries - 1:\n                raise\n            time.sleep(delay)","key":"NUWu1xdMd0"},{"type":"outputs","id":"7t_lWcz_tYeH38xSH4-y2","children":[],"key":"h0OEJ8UVno"}],"key":"Sm7D8XlIG5"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":728,"column":1},"end":{"line":728,"column":1}},"children":[{"type":"text","value":"We add some placeholders and other information to the table so we can keep track of things.","position":{"start":{"line":728,"column":1},"end":{"line":728,"column":1}},"key":"QiO1QgMZqv"}],"key":"h9lggrJIpu"}],"key":"SNgdk1MuKl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Add columns to hold relevant cutout information\nresults_table = tap_results.to_table()\nresults_table[\"cutout_index\"] = range(1, len(results_table) + 1)\nresults_table[\"central_wl_src\"] = np.full(len(results_table), np.nan)\nresults_table[\"hdus\"] = np.full(len(results_table), None)\nresults_table[\"spectral_wcs\"] = np.full(len(results_table), None)  # since we are not saving primary HDU","key":"GHQwCRep3h"},{"type":"outputs","id":"EgH0r9_nXPyCw3rn--pq9","children":[],"key":"msTfnJTuY1"}],"key":"qmoNo4xp1b"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":739,"column":1},"end":{"line":739,"column":1}},"children":[{"type":"text","value":"Finally, we can run the download of the cutouts in parallel via the function created above. The cutouts are saved directly in the table.","position":{"start":{"line":739,"column":1},"end":{"line":739,"column":1}},"key":"J6gYCuwzbt"}],"key":"z9CnKEeIS2"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"slzcocRJyA"}],"key":"D6XtAd0DnL"},{"type":"paragraph","position":{"start":{"line":742,"column":1},"end":{"line":742,"column":1}},"children":[{"type":"text","value":"The cell below can take a couple of minutes to run depending on the number of observations available at a given sky coordinate position.","position":{"start":{"line":742,"column":1},"end":{"line":742,"column":1}},"key":"B6InTO1yVu"}],"key":"NqizjzUpnw"}],"key":"aT2FOCJqrm"}],"key":"KWdWlqG9D3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Process cutouts in parallel\nt1 = time.time()\nn_timeouts = 0\nwith concurrent.futures.ThreadPoolExecutor(max_workers=8) as executor:\n    futures = [executor.submit(process_cutout, row, matched_stars['ra'][0], matched_stars['dec'][0], False) for row in results_table]\n\n    # Raise any exceptions caught during cutout processing\n    for future in concurrent.futures.as_completed(futures):\n        try:\n            future.result()\n        except Exception as e:\n            n_timeouts += 1\n            print(f\"An error occurred: {e}\")\n\n# Check if any cutouts failed. If so, you might need to re-run this cell with\n# fewer workers, cache enabled, or increased timeout/retries.\nn_failed = np.count_nonzero(results_table['hdus'] == None)\nif n_timeouts \u003e 0 or n_failed \u003e 0:\n    print(f\"\\n!!!!! WARNING !!!!!\\n{n_timeouts} cutouts had timeouts and {n_failed} cutouts\"\n          f\" failed to process.\\n\")\n\nprint(\"Time to create cutouts in serial mode: {:2.2f} minutes.\".format((time.time() - t1) / 60))","key":"iRuVWB91WX"},{"type":"outputs","id":"BmZGev36AiczA___9E_gH","children":[],"key":"sjBm1w13Yk"}],"key":"r7IjUimyLF"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":770,"column":1},"end":{"line":770,"column":1}},"children":[{"type":"text","value":"12.2 Obtain spectrum","position":{"start":{"line":770,"column":1},"end":{"line":770,"column":1}},"key":"Zhr1unc9gc"}],"identifier":"id-12-2-obtain-spectrum","label":"12.2 Obtain spectrum","html_id":"id-12-2-obtain-spectrum","implicit":true,"key":"sSkXL3cOvj"},{"type":"paragraph","position":{"start":{"line":772,"column":1},"end":{"line":773,"column":1}},"children":[{"type":"text","value":"Having obtained the cutouts, we can now perform aperture photometry on the cutouts and measure the fluxes as a function of wavelength.\nSee ","position":{"start":{"line":772,"column":1},"end":{"line":772,"column":1}},"key":"PSoxIv2jMt"},{"type":"inlineCode","value":"spherex_source_discovery_tool/aperture_photometry.py","position":{"start":{"line":772,"column":1},"end":{"line":772,"column":1}},"key":"CTy1PwdOfk"},{"type":"text","value":" for more information on the functions used below.","position":{"start":{"line":772,"column":1},"end":{"line":772,"column":1}},"key":"sozxDIr0Sb"}],"key":"jCcbawWhcZ"}],"key":"aFGM9T2uXK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"phot_path = os.path.realpath( \"./data/ap_phot_sources.pkl\" ) # this is where the photometry results are saved.\naperture_radii = [3.0, 4.0, 5.0]  # aperture radii in pixels\nmatched_stars = matched_stars.reset_index(drop=True)\n\n# Perform aperture photometry\nbuild_phot_table(results_table, matched_stars, aperture_radii, phot_path, sapm_s3)","key":"yuZk3wfqe5"},{"type":"outputs","id":"qk053FoYz9t0IXeWrN7Jx","children":[],"key":"aAAmTylF39"}],"key":"cjzXENcqcz"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"children":[{"type":"text","value":"Load the photometry file we just created.","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"key":"P8suYUjxqn"}],"key":"gK80GNK1ly"}],"key":"Tyyc9HRP0C"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"if os.path.exists(phot_path):\n    with open(phot_path, 'rb') as f:\n        all_stars_band_phot = pickle.load(f)","key":"PZJGYgRqUB"},{"type":"outputs","id":"d7P4JiFF9nkwA7hxOLFOE","children":[],"key":"FoHQvTywYC"}],"key":"XxZbH1lNIX"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":792,"column":1},"end":{"line":792,"column":1}},"children":[{"type":"text","value":"Apply flagging to the extracted 1D-Spectrum.","position":{"start":{"line":792,"column":1},"end":{"line":792,"column":1}},"key":"sieybMSqcQ"}],"key":"mMvJOBlB2C"}],"key":"QPsxAfVAbt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Define bad photometry flags\nbad_flags = ['TRANSIENT', 'OVERFLOW', 'SUR_ERROR', 'PHANTOM', 'REFERENCE', 'NONFUNC', 'DICHROIC',\n             'MISSING_DATA', 'HOT', 'COLD', 'FULLSAMPLE', 'PHANMISS', 'NONLINEAR', 'PERSIST', 'OUTLIER']\nap_rad = 3.0  # set your preferred aperture radius, from the `aperture_radii` list you specified above\ntarg = 0  # pick index from `all_stars_band_phot` table\nwvl, bdw, abmags, abmag_errs, flx, var, n_bad = \\\n                grab_star(obs_log_entry=all_stars_band_phot['obs_log'][targ], ap_rad=ap_rad, bad_flags=bad_flags)","key":"fDoji72zwm"},{"type":"outputs","id":"y0gWyrK9e9_4vynjzzZr1","children":[],"key":"vwF5u0RhpQ"}],"key":"Ig6bHamkp2"},{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"children":[{"type":"text","value":"Finally visualize the spectrum using ","position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"key":"Y56YmyKkIf"},{"type":"emphasis","position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"children":[{"type":"text","value":"bokeh","position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"key":"lUAh5IanQS"}],"key":"nAO0idYY5f"},{"type":"text","value":" in flux and magnitudes!","position":{"start":{"line":804,"column":1},"end":{"line":804,"column":1}},"key":"n8La2e07ni"}],"key":"YA8lARqkV6"}],"key":"ue0rlg9aPv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plot_spectrum(wvl, bdw, flx, var, abmags, abmag_errs, n_bad, type=\"flux\",\n              source_id=all_stars_band_phot['NUMBER'][targ], ap_size=3.0)\nplot_spectrum(wvl, bdw, flx, var, abmags, abmag_errs, n_bad, type=\"magnitude\",\n              source_id=all_stars_band_phot['NUMBER'][targ], ap_size=3.0)","key":"FVy5B9sszW"},{"type":"outputs","id":"npyhuHWvCagb4LpcG2kqG","children":[],"key":"SbqAAJ0t5X"}],"key":"UaEhLIxa8t"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":813,"column":1},"end":{"line":813,"column":1}},"children":[{"type":"text","value":"Acknowledgements","position":{"start":{"line":813,"column":1},"end":{"line":813,"column":1}},"key":"Fo9jK3xjle"}],"identifier":"acknowledgements","label":"Acknowledgements","html_id":"acknowledgements","implicit":true,"key":"iPhkRzpTrq"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":815,"column":1},"end":{"line":817,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":815,"column":1},"end":{"line":815,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The Source Discovery Tool aperture photometry functions are adapted from code by Zafar Rustamkulov.","position":{"start":{"line":815,"column":1},"end":{"line":815,"column":1}},"key":"QFshGrknXe"}],"key":"MpLoafXvBc"}],"key":"JzgbBBOGEW"},{"type":"listItem","spread":true,"position":{"start":{"line":816,"column":1},"end":{"line":817,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://irsa.ipac.caltech.edu/","position":{"start":{"line":816,"column":1},"end":{"line":816,"column":1}},"children":[{"type":"text","value":"Caltech/IPAC-IRSA","position":{"start":{"line":816,"column":1},"end":{"line":816,"column":1}},"key":"qFSsJO8rmc"}],"urlSource":"https://irsa.ipac.caltech.edu/","key":"vL8BZfXvjg"}],"key":"hhab1nYZk6"}],"key":"sXGjof0VeD"}],"key":"y41fWpy5EL"},{"type":"paragraph","position":{"start":{"line":818,"column":1},"end":{"line":818,"column":1}},"children":[{"type":"text","value":"This work has made use of the NASA/IPAC Infrared Science Archive, which is funded by the National Aeronautics and Space Administration and operated by the California Institute of Technology. We acknowledge support from the SPHEREx project under a contract from the NASA/Goddard Space Flight Center to the California Institute of Technology. This research was partly carried out at the California Institute of Technology under a contract with the National Aeronautics and Space Administration (80GSFC18C0011).  The DOI for SPHEREx QR2 data is 10.26131/IRSA629 (","position":{"start":{"line":818,"column":1},"end":{"line":818,"column":1}},"key":"nkBJOqJVzZ"},{"type":"cite","url":"https://doi.org/10.26131/IRSA629","position":{"start":{"line":818,"column":1},"end":{"line":818,"column":1}},"children":[{"type":"text","value":"SPHEREx Team (2025)","key":"QH4TIkzH0d"}],"kind":"narrative","label":"https://doi.org/10.26131/irsa629","identifier":"https://doi.org/10.26131/IRSA629","enumerator":"1","key":"sf2xKMoFYx"},{"type":"text","value":").","position":{"start":{"line":818,"column":1},"end":{"line":818,"column":1}},"key":"kuRKZV2MR1"}],"key":"fDp3076Ubq"}],"key":"clBAnd6fwJ"},{"type":"block","position":{"start":{"line":820,"column":1},"end":{"line":820,"column":1}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"children":[{"type":"text","value":"About this Notebook","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":1}},"key":"aeZr0i35iF"}],"identifier":"about-this-notebook","label":"About this Notebook","html_id":"about-this-notebook","implicit":true,"key":"svZ9K2YO19"},{"type":"paragraph","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"children":[{"type":"strong","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"children":[{"type":"text","value":"Authors:","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"key":"CYXUW1KAgt"}],"key":"Yh8RLNIVgI"},{"type":"text","value":" Gabriela Torrini, Andreas Faisst, and the SPHEREx Science Data Center (SSDC); Troy Raen, Brigitta Sipőcz, and Jaladh Singhal","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"key":"ZITqDJ6Vak"}],"key":"Tz4vd5NTBY"},{"type":"paragraph","position":{"start":{"line":826,"column":1},"end":{"line":827,"column":1}},"children":[{"type":"strong","position":{"start":{"line":826,"column":1},"end":{"line":826,"column":1}},"children":[{"type":"text","value":"Contact:","position":{"start":{"line":826,"column":1},"end":{"line":826,"column":1}},"key":"rBMTerxv2I"}],"key":"K5kE7RwGVw"},{"type":"text","value":" ","position":{"start":{"line":826,"column":1},"end":{"line":826,"column":1}},"key":"kKQTqdjRYD"},{"type":"link","url":"https://irsa.ipac.caltech.edu/docs/help_desk.html","position":{"start":{"line":826,"column":1},"end":{"line":826,"column":1}},"children":[{"type":"text","value":"IRSA Helpdesk","position":{"start":{"line":826,"column":1},"end":{"line":826,"column":1}},"key":"L6rjNMARzj"}],"urlSource":"https://irsa.ipac.caltech.edu/docs/help_desk.html","key":"MFF3R3tbZs"},{"type":"text","value":" with questions\nor problems.","position":{"start":{"line":826,"column":1},"end":{"line":826,"column":1}},"key":"wqdOm0f2AJ"}],"key":"X8jXePI2ss"},{"type":"paragraph","position":{"start":{"line":829,"column":1},"end":{"line":829,"column":1}},"children":[{"type":"strong","position":{"start":{"line":829,"column":1},"end":{"line":829,"column":1}},"children":[{"type":"text","value":"Updated:","position":{"start":{"line":829,"column":1},"end":{"line":829,"column":1}},"key":"wFpI3JXjif"}],"key":"xDW86PwIeo"},{"type":"text","value":" 18 February 2026","position":{"start":{"line":829,"column":1},"end":{"line":829,"column":1}},"key":"TV8xXSttDs"}],"key":"Jk1vG5B4oX"},{"type":"paragraph","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"children":[{"type":"strong","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"children":[{"type":"text","value":"Runtime:","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"key":"qC6cUt62fV"}],"key":"f0O8gB0Izo"},{"type":"text","value":" approximately 5 minutes","position":{"start":{"line":831,"column":1},"end":{"line":831,"column":1}},"key":"yY7EEIPJSE"}],"key":"atcLTzOA5H"}],"key":"OXCcJ2wz4a"}],"key":"MF4IOqemM0"},"references":{"cite":{"order":["https://doi.org/10.26131/irsa629"],"data":{"https://doi.org/10.26131/irsa629":{"label":"https://doi.org/10.26131/irsa629","enumerator":"1","doi":"10.26131/IRSA629","html":"SPHEREx Team. (2025). \u003ci\u003eSPHEREx Quick Release Spectral Images\u003c/i\u003e. IPAC. \u003ca target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.26131/IRSA629\"\u003e10.26131/IRSA629\u003c/a\u003e","url":"https://doi.org/10.26131/IRSA629"}}}},"footer":{"navigation":{"prev":{"title":"Understanding and Extracting the PSF Extension in a SPHEREx Cutout","short_title":"PSF Models","url":"/spherex-psf","group":"IRSA Tutorials"},"next":{"title":"Euclid Tutorial Notebooks","short_title":"Euclid","url":"/euclid","group":"IRSA Tutorials"}}},"domain":"http://localhost:3000"},"project":{"license":{"content":{"id":"BSD-3-Clause","url":"https://github.com/Caltech-IPAC/irsa-tutorials/blob/main/LICENSE","name":"BSD 3-Clause \"New\" or \"Revised\" License","free":true,"osi":true}},"subject":"IRSA Tutorials","settings":{"output_matplotlib_strings":"remove"},"title":"IRSA Tutorials","description":"IRSA Python Notebook tutorials to demostrate accessing data served by the NASA/IPAC Infrared Science Archive (IRSA)","authors":[{"id":"IRSA Scientists and Developers","name":"IRSA Scientists and Developers"}],"github":"https://github.com/Caltech-IPAC/irsa-tutorials/","keywords":["astronomy"],"thebe":{"binder":{"url":"https://mybinder.org","provider":"github","repo":"https://github.com/Caltech-IPAC/irsa-tutorials/","ref":"HEAD"}},"toc":[{"file":"index.md","title":"IRSA Tutorials"},{"children":[{"file":"tutorials/spherex/spherex_intro.md","title":"Data Overview"},{"file":"tutorials/spherex/spherex_cutouts.md","title":"Spectral Image Cutouts"},{"file":"tutorials/spherex/spherex_psf.md","title":"PSF Models"},{"file":"tutorials/spherex/spherex_source_discovery/spherex_source_discovery_tool_demo.md","title":"Source Discovery Tool"}],"file":"tutorials/spherex/spherex.md","title":"SPHEREx"},{"children":[{"file":"tutorials/euclid/1_Euclid_intro_MER_images.md","title":"MER Mosaics"},{"file":"tutorials/euclid/3_Euclid_intro_1D_spectra.md","title":"SIR 1D Spectra"},{"file":"tutorials/euclid/2_Euclid_intro_MER_catalog.md","title":"MER Catalogs"},{"file":"tutorials/euclid/4_Euclid_intro_PHZ_catalog.md","title":"PHZ Catalogs"},{"file":"tutorials/euclid/5_Euclid_intro_SPE_catalog.md","title":"SPE Catalogs"},{"children":[{"file":"tutorials/euclid/merged-objects-hats-catalog/1-euclid-q1-hats-intro.md","title":"Introduction"},{"file":"tutorials/euclid/merged-objects-hats-catalog/4-euclid-q1-hats-magnitudes.md","title":"Magnitudes"}],"title":"Merged Objects HATS Catalog"},{"file":"tutorials/euclid/euclid-cloud-access.md","title":"Cloud Access"},{"file":"tutorials/euclid/Euclid_ERO.md","title":"ERO Star Clusters"}],"file":"tutorials/euclid/euclid.md","title":"Euclid"},{"children":[{"file":"tutorials/wise/sia_allwise_atlas.md","title":"AllWISE Images"},{"file":"tutorials/wise/wise-allwise-catalog-demo.md","title":"AllWISE Catalog"},{"file":"tutorials/wise/NEOWISE_light_curve_demo.md","title":"NEOWISE Firefly"},{"file":"tutorials/wise/neowise-source-table-strategies.md","title":"NEOWISE Strategies"},{"file":"tutorials/wise/neowise-source-table-lightcurves.md","title":"NEOWISE Light Curves"}],"file":"tutorials/wise/wise.md","title":"WISE"},{"children":[{"file":"tutorials/spitzer/siav2_seip.md"}],"title":"Spitzer"},{"children":[{"file":"tutorials/2mass/sia_2mass_allsky.md"}],"title":"2MASS"},{"children":[{"file":"tutorials/cosmos/sia_cosmos.md"}],"title":"COSMOS"},{"children":[{"file":"tutorials/simulated-data/roman_hlss_number_density.md","title":"Roman HLSS Number Density"},{"file":"tutorials/simulated-data/openuniverse2024_roman_simulated_wideareasurvey.md","title":"OpenUniverse2024 Roman coadds"},{"file":"tutorials/simulated-data/OpenUniverse2024Preview_Firefly.md","title":"OpenUniverse2024 Visualization"},{"file":"tutorials/simulated-data/openuniverse2024_roman_simulated_timedomainsurvey.md","title":"OpenUniverse2024 Time Domain"},{"file":"tutorials/simulated-data/cosmoDC2_TAP_access.md","title":"CosmoDC2 Data Access"}],"file":"tutorials/simulated-data/simulated.md","title":"Simulated Data"},{"children":[{"file":"tutorials/techniques-and-tools/cloud-access-intro.md","title":"Cloud Access"},{"file":"tutorials/techniques-and-tools/irsa-hats-with-lsdb.md","title":"LSDB HATS"},{"file":"tutorials/techniques-and-tools/SEDs_in_Firefly.md","title":"SED visualization"},{"file":"tutorials/techniques-and-tools/Parallelize_Convolution.md","title":"Parallelization"}],"file":"tutorials/techniques-and-tools/techniques.md","title":"Techniques \u0026 Tools"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"spherex","title":"SPHEREx Tutorial Notebooks","short_title":"SPHEREx","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spherex-intro","title":"Introduction to SPHEREx Spectral Images","short_title":"Data Overview","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spherex-cutouts","title":"Download a collection of SPHEREx Spectral Image cutouts as a multi-extension FITS file","short_title":"Spectral Image Cutouts","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spherex-psf","title":"Understanding and Extracting the PSF Extension in a SPHEREx Cutout","short_title":"PSF Models","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"spherex-source-discovery-tool-demo","title":"SPHEREx Source Discovery Tool IRSA Demo","short_title":"Source Discovery Tool","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid","title":"Euclid Tutorial Notebooks","short_title":"Euclid","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"euclid-intro-mer-images","title":"Euclid Q1: MER Mosaics","short_title":"MER Mosaics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid-intro-1d-spectra","title":"Euclid Q1: SIR 1D Spectra","short_title":"SIR 1D Spectra","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid-intro-mer-catalog","title":"Euclid Q1: MER Catalogs","short_title":"MER Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid-intro-phz-catalog","title":"Euclid Q1: PHZ Catalogs","short_title":"PHZ Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid-intro-spe-catalog","title":"Euclid Q1: SPE Catalogs","short_title":"SPE Catalogs","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":2,"title":"Merged Objects HATS Catalog"},{"slug":"euclid-q1-hats-intro","title":"Euclid Q1 Merged Objects HATS Catalog: Introduction","short_title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-q1-hats-magnitudes","title":"Euclid Q1 Merged Objects HATS Catalog: Magnitudes","short_title":"Magnitudes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"euclid-cloud-access","title":"Euclid Q1: Cloud Access","short_title":"Cloud Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"euclid-ero","title":"Exploring Star Clusters in the Euclid ERO Data","short_title":"ERO Star Clusters","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"wise","title":"WISE Tutorial Notebooks","short_title":"WISE","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"sia-allwise-atlas","title":"Searching for AllWISE Atlas Images","short_title":"AllWISE Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"wise-allwise-catalog-demo","title":"Analyzing cloud-hosted AllWISE Source Catalog in Parquet format","short_title":"AllWISE Catalog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"neowise-light-curve-demo","title":"Using Firefly visualization tools to understand the light curves of Solar System objects","short_title":"NEOWISE Firefly","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"neowise-source-table-strategies","title":"Strategies to Efficiently Work with NEOWISE Single-exposure Source Table in Parquet","short_title":"NEOWISE Strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"neowise-source-table-lightcurves","title":"Make Light Curves from NEOWISE Single-exposure Source Table","short_title":"NEOWISE Light Curves","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Spitzer"},{"slug":"siav2-seip","title":"Searching for Spitzer Enhanced Imaging Products","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"2MASS"},{"slug":"sia-2mass-allsky","title":"Searching for 2MASS All-Sky Atlas Images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"COSMOS"},{"slug":"sia-cosmos","title":"Searching for contributed COSMOS images","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"simulated","title":"Simulated Data Tutorial Notebooks","short_title":"Simulated Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"roman-hlss-number-density","title":"Number Density as a Function of Redshift","short_title":"Roman HLSS Number Density","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"openuniverse2024-roman-simulated-wideareasurvey","title":"Analyzing cloud-hosted simulated Roman coadded images","short_title":"OpenUniverse2024 Roman coadds","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"openuniverse2024preview-firefly","title":"Using Firefly to Explore OpenUniverse2024 Data Preview Simulated Roman and Rubin Images","short_title":"OpenUniverse2024 Visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"openuniverse2024-roman-simulated-timedomainsurvey","title":"Analyzing cloud-hosted simulated Roman Time Domain Survey images","short_title":"OpenUniverse2024 Time Domain","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"cosmodc2-tap-access","title":"Querying the CosmoDC2 Mock v1 Catalogs","short_title":"CosmoDC2 Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"techniques","title":"Techniques \u0026 Tools Tutorial Notebooks","short_title":"Techniques \u0026 Tools","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"cloud-access-intro","title":"IRSA cloud access introduction","short_title":"Cloud Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"irsa-hats-with-lsdb","title":"Access HATS Collections Using LSDB: Euclid Q1 and ZTF DR23","short_title":"LSDB HATS","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"seds-in-firefly","title":"Using Firefly visualization tools in Python to vet SEDs","short_title":"SED visualization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"parallelize-convolution","title":"Parallelizing image convolution","short_title":"Parallelization","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/irsa-tutorials/build/manifest-54BD5942.js";
import * as route0 from "/irsa-tutorials/build/root-PMP5BIHC.js";
import * as route1 from "/irsa-tutorials/build/routes/$-5ZLZ2O3Y.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/irsa-tutorials/build/entry.client-PCJPW7TK.js");</script></body></html>